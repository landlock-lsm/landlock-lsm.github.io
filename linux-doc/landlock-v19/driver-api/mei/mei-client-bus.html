

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Intel(R) Management Engine (ME) Client bus API &mdash; The Linux Kernel 5.8.0-rc4+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HDCP:" href="hdcp.html" />
    <link rel="prev" title="Introduction" href="mei.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0-rc4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux driver implementer’s API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../driver-model/index.html">Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioctl.html">ioctl based interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../early-userspace/index.html">Early Userspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">CPU and Device Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_connection.html">Device connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dma-buf.html">Buffer Sharing and Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../component.html">Component Helper for Aggregate Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound.html">Sound Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb/index.html">Linux USB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pci/index.html">The Linux PCI driver implementer’s API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devfreq.html">Device Frequency Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mei.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="mei.html#intel-mei-driver">Intel MEI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="mei.html#ioctls">IOCTLs:</a></li>
<li class="toctree-l3"><a class="reference internal" href="mei.html#supported-chipsets">Supported Chipsets</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Intel(R) Management Engine (ME) Client bus API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rationale">Rationale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mei-cl-bus-api">MEI CL bus API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mei-client-bus-drivers">MEI Client Bus Drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="iamt.html">Intel(R) Active Management Technology (Intel AMT)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../w1.html">W1: Dallas’ 1-wire bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctl.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thermal/index.html">Thermal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connector.html">Kernel Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eisa.html">EISA bus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isa.html">ISA Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isapnp.html">ISA Plug &amp; Play support by Jaroslav Kysela &lt;perex&#64;suse.cz&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io-mapping.html">The io_mapping functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io_ordering.html">Ordering I/O writes to memory-mapped addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lightnvm-pblk.html">pblk: Physical Block Device Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pti_intel_mid.html">Intel MID PTI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smsc_ece1099.html">Msc Keyboard Scan Expansion/GPIO Expansion device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio-mediated-device.html">VFIO Mediated devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio.html">VFIO - “Virtual Function I/O” </a></li>
<li class="toctree-l2"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The Linux driver implementer’s API guide</a> &raquo;</li>
        
          <li><a href="index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a> &raquo;</li>
        
      <li>Intel(R) Management Engine (ME) Client bus API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/driver-api/mei/mei-client-bus.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="intel-r-management-engine-me-client-bus-api">
<h1>Intel(R) Management Engine (ME) Client bus API<a class="headerlink" href="#intel-r-management-engine-me-client-bus-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>The MEI character device is useful for dedicated applications to send and receive
data to the many FW appliance found in Intel’s ME from the user space.
However, for some of the ME functionalities it makes sense to leverage existing software
stack and expose them through existing kernel subsystems.</p>
<p>In order to plug seamlessly into the kernel device driver model we add kernel virtual
bus abstraction on top of the MEI driver. This allows implementing Linux kernel drivers
for the various MEI features as a stand alone entities found in their respective subsystem.
Existing device drivers can even potentially be re-used by adding an MEI CL bus layer to
the existing code.</p>
</div>
<div class="section" id="mei-cl-bus-api">
<h2>MEI CL bus API<a class="headerlink" href="#mei-cl-bus-api" title="Permalink to this headline">¶</a></h2>
<p>A driver implementation for an MEI Client is very similar to any other existing bus
based device drivers. The driver registers itself as an MEI CL bus driver through
the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_driver</span></code> structure defined in <code class="file docutils literal notranslate"><span class="pre">include/linux/mei_cl_bus.c</span></code></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">mei_cl_driver</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">device_driver</span> <span class="n">driver</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

        <span class="k">const</span> <span class="k">struct</span> <span class="n">mei_cl_device_id</span> <span class="o">*</span><span class="n">id_table</span><span class="p">;</span>

        <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mei_cl_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">mei_cl_id</span> <span class="o">*</span><span class="n">id</span><span class="p">);</span>
        <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mei_cl_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The mei_cl_device_id structure defined in <code class="file docutils literal notranslate"><span class="pre">include/linux/mod_devicetable.h</span></code> allows a
driver to bind itself against a device name.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">mei_cl_device_id</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">MEI_CL_NAME_SIZE</span><span class="p">];</span>
        <span class="n">uuid_le</span> <span class="n">uuid</span><span class="p">;</span>
        <span class="n">__u8</span>    <span class="n">version</span><span class="p">;</span>
        <span class="n">kernel_ulong_t</span> <span class="n">driver_info</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>To actually register a driver on the ME Client bus one must call the <code class="xref c c-func docutils literal notranslate"><span class="pre">mei_cl_add_driver()</span></code>
API. This is typically called at module initialization time.</p>
<p>Once the driver is registered and bound to the device, a driver will typically
try to do some I/O on this bus and this should be done through the <code class="xref c c-func docutils literal notranslate"><span class="pre">mei_cl_send()</span></code>
and <code class="xref c c-func docutils literal notranslate"><span class="pre">mei_cl_recv()</span></code> functions. More detailed information is in <a class="reference internal" href="#api"><span class="std std-ref">API:</span></a> section.</p>
<p>In order for a driver to be notified about pending traffic or event, the driver
should register a callback via <code class="xref c c-func docutils literal notranslate"><span class="pre">mei_cl_devev_register_rx_cb()</span></code> and
<code class="xref c c-func docutils literal notranslate"><span class="pre">mei_cldev_register_notify_cb()</span></code> function respectively.</p>
<div class="section" id="api">
<span id="id1"></span><h3>API:<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.mei_cldev_send">
ssize_t <code class="sig-name descname">mei_cldev_send</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em>, u8 *<em> buf</em>, size_t<em> length</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_send" title="Permalink to this definition">¶</a></dt>
<dd><p>me device send (write)</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt><dd><p>buffer to send</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">length</span></code></dt><dd><p>buffer length</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>written size in bytes or &lt; 0 on error</p>
<dl class="function">
<dt id="c.mei_cldev_recv_nonblock">
ssize_t <code class="sig-name descname">mei_cldev_recv_nonblock</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em>, u8 *<em> buf</em>, size_t<em> length</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_recv_nonblock" title="Permalink to this definition">¶</a></dt>
<dd><p>non block client receive (read)</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt><dd><p>buffer to receive</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">length</span></code></dt><dd><p>buffer length</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<dl class="simple">
<dt>read size in bytes of &lt; 0 on error</dt><dd><p>-EAGAIN if function will block.</p>
</dd>
</dl>
<dl class="function">
<dt id="c.mei_cldev_recv">
ssize_t <code class="sig-name descname">mei_cldev_recv</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em>, u8 *<em> buf</em>, size_t<em> length</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_recv" title="Permalink to this definition">¶</a></dt>
<dd><p>client receive (read)</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt><dd><p>buffer to receive</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">length</span></code></dt><dd><p>buffer length</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>read size in bytes of &lt; 0 on error</p>
<dl class="function">
<dt id="c.mei_cldev_register_rx_cb">
int <code class="sig-name descname">mei_cldev_register_rx_cb</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em>, mei_cldev_cb_t<em> rx_cb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_register_rx_cb" title="Permalink to this definition">¶</a></dt>
<dd><p>register Rx event callback</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client devices</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mei_cldev_cb_t</span> <span class="pre">rx_cb</span></code></dt><dd><p>callback function</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<dl class="simple">
<dt>0 on success</dt><dd><p>-EALREADY if an callback is already registered
&lt;0 on other errors</p>
</dd>
</dl>
<dl class="function">
<dt id="c.mei_cldev_register_notif_cb">
int <code class="sig-name descname">mei_cldev_register_notif_cb</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em>, mei_cldev_cb_t<em> notif_cb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_register_notif_cb" title="Permalink to this definition">¶</a></dt>
<dd><p>register FW notification event callback</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client devices</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mei_cldev_cb_t</span> <span class="pre">notif_cb</span></code></dt><dd><p>callback function</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<dl class="simple">
<dt>0 on success</dt><dd><p>-EALREADY if an callback is already registered
&lt;0 on other errors</p>
</dd>
</dl>
<dl class="function">
<dt id="c.mei_cldev_get_drvdata">
void * <code class="sig-name descname">mei_cldev_get_drvdata</code><span class="sig-paren">(</span>const struct mei_cl_device *<em> cldev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_get_drvdata" title="Permalink to this definition">¶</a></dt>
<dd><p>driver data getter</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>mei client device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>driver private data</p>
<dl class="function">
<dt id="c.mei_cldev_set_drvdata">
void <code class="sig-name descname">mei_cldev_set_drvdata</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em>, void *<em> data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_set_drvdata" title="Permalink to this definition">¶</a></dt>
<dd><p>driver data setter</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>mei client device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">data</span></code></dt><dd><p>data to store</p>
</dd>
</dl>
<dl class="function">
<dt id="c.mei_cldev_uuid">
const uuid_le * <code class="sig-name descname">mei_cldev_uuid</code><span class="sig-paren">(</span>const struct mei_cl_device *<em> cldev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_uuid" title="Permalink to this definition">¶</a></dt>
<dd><p>return uuid of the underlying me client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>mei client device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>me client uuid</p>
<dl class="function">
<dt id="c.mei_cldev_ver">
u8 <code class="sig-name descname">mei_cldev_ver</code><span class="sig-paren">(</span>const struct mei_cl_device *<em> cldev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_ver" title="Permalink to this definition">¶</a></dt>
<dd><p>return protocol version of the underlying me client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>mei client device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>me client protocol version</p>
<dl class="function">
<dt id="c.mei_cldev_enabled">
bool <code class="sig-name descname">mei_cldev_enabled</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether the device is enabled</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>mei client device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if me client is initialized and connected</p>
<dl class="function">
<dt id="c.mei_cldev_enable">
int <code class="sig-name descname">mei_cldev_enable</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>enable me client device create connection with me client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success and &lt; 0 on error</p>
<dl class="function">
<dt id="c.mei_cldev_disable">
int <code class="sig-name descname">mei_cldev_disable</code><span class="sig-paren">(</span>struct mei_cl_device *<em> cldev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mei_cldev_disable" title="Permalink to this definition">¶</a></dt>
<dd><p>disable me client device disconnect form the me client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mei_cl_device</span> <span class="pre">*</span> <span class="pre">cldev</span></code></dt><dd><p>me client device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success and &lt; 0 on error</p>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>As a theoretical example let’s pretend the ME comes with a “contact” NFC IP.
The driver init and exit routines for this device would look like:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONTACT_DRIVER_NAME &quot;contact&quot;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mei_cl_device_id</span> <span class="n">contact_mei_cl_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span> <span class="n">CONTACT_DRIVER_NAME</span><span class="p">,</span> <span class="p">},</span>

        <span class="cm">/* required last entry */</span>
        <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">mei_cl</span><span class="p">,</span> <span class="n">contact_mei_cl_tbl</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mei_cl_driver</span> <span class="n">contact_driver</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">contact_mei_tbl</span><span class="p">,</span>
        <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">CONTACT_DRIVER_NAME</span><span class="p">,</span>

        <span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">contact_probe</span><span class="p">,</span>
        <span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">contact_remove</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">contact_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">mei_cl_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">contact_driver</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pr_err</span><span class="p">(</span><span class="n">CONTACT_DRIVER_NAME</span> <span class="s">&quot;: driver registration failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">contact_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">mei_cl_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">contact_driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">contact_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">contact_exit</span><span class="p">);</span>
</pre></div>
</div>
<p>And the driver’s simplified probe routine would look like that:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">contact_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">mei_cl_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mei_cl_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
        <span class="p">[...]</span>
        <span class="n">mei_cldev_enable</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

        <span class="n">mei_cldev_register_rx_cb</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">contact_rx_cb</span><span class="p">);</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the probe routine the driver first enable the MEI device and then registers
an rx handler which is as close as it can get to registering a threaded IRQ handler.
The handler implementation will typically call <a class="reference internal" href="#c.mei_cldev_recv" title="mei_cldev_recv"><code class="xref c c-func docutils literal notranslate"><span class="pre">mei_cldev_recv()</span></code></a> and then
process received data.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MAX_PAYLOAD 128</span>
<span class="cp">#define HDR_SIZE 4</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">conntact_rx_cb</span><span class="p">(</span><span class="k">struct</span> <span class="n">mei_cl_device</span> <span class="o">*</span><span class="n">cldev</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">contact</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">mei_cldev_get_drvdata</span><span class="p">(</span><span class="n">cldev</span><span class="p">);</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">payload</span><span class="p">[</span><span class="n">MAX_PAYLOAD</span><span class="p">];</span>
        <span class="kt">ssize_t</span> <span class="n">payload_sz</span><span class="p">;</span>

        <span class="n">payload_sz</span> <span class="o">=</span> <span class="n">mei_cldev_recv</span><span class="p">(</span><span class="n">cldev</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span>  <span class="n">MAX_PAYLOAD</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">reply_size</span> <span class="o">&lt;</span> <span class="n">HDR_SIZE</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">c</span><span class="o">-&gt;</span><span class="n">process_rx</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="mei-client-bus-drivers">
<h2>MEI Client Bus Drivers<a class="headerlink" href="#mei-client-bus-drivers" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="hdcp.html">HDCP:</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hdcp.html#mei-hdcp-driver">mei_hdcp driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdcp.html#mei-hdcp-api">mei_hdcp api</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nfc.html">MEI NFC</a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hdcp.html" class="btn btn-neutral float-right" title="HDCP:" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mei.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>