

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HugeTLB Pages &mdash; The Linux Kernel 5.7.0-rc1+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Idle Page Tracking" href="idle_page_tracking.html" />
    <link rel="prev" title="CMA Debugfs Interface" href="cma_debugfs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../init.html">Explaining the dreaded “No init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blockdev/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md.html">RAID arrays</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Memory Management</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="concepts.html">Concepts overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="cma_debugfs.html">CMA Debugfs Interface</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">HugeTLB Pages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interaction-of-task-memory-policy-with-huge-page-allocation-freeing">Interaction of Task Memory Policy with Huge Page Allocation/Freeing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#per-node-hugepages-attributes">Per Node Hugepages Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-huge-pages">Using Huge Pages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="idle_page_tracking.html">Idle Page Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="ksm.html">Kernel Samepage Merging</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory-hotplug.html">Memory Hotplug</a></li>
<li class="toctree-l3"><a class="reference internal" href="numa_memory_policy.html">NUMA Memory Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="numaperf.html">NUMA Locality</a></li>
<li class="toctree-l3"><a class="reference internal" href="numaperf.html#numa-performance">NUMA Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="numaperf.html#numa-cache">NUMA Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="numaperf.html#see-also">See Also</a></li>
<li class="toctree-l3"><a class="reference internal" href="pagemap.html">Examining Process Page Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft-dirty.html">Soft-Dirty PTEs</a></li>
<li class="toctree-l3"><a class="reference internal" href="transhuge.html">Transparent Hugepage Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="userfaultfd.html">Userfaultfd</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf-security.html">Perf Events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
          <li><a href="index.html">Memory Management</a> &raquo;</li>
        
      <li>HugeTLB Pages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/mm/hugetlbpage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hugetlb-pages">
<span id="hugetlbpage"></span><h1>HugeTLB Pages<a class="headerlink" href="#hugetlb-pages" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The intent of this file is to give a brief summary of hugetlbpage support in
the Linux kernel.  This support is built on top of multiple page size support
that is provided by most modern architectures.  For example, x86 CPUs normally
support 4K and 2M (1G if architecturally supported) page sizes, ia64
architecture supports multiple page sizes 4K, 8K, 64K, 256K, 1M, 4M, 16M,
256M and ppc64 supports 4K and 16M.  A TLB is a cache of virtual-to-physical
translations.  Typically this is a very scarce resource on processor.
Operating systems try to make best use of limited number of TLB resources.
This optimization is more critical now as bigger and bigger physical memories
(several GBs) are more readily available.</p>
<p>Users can use the huge page support in Linux kernel by either using the mmap
system call or standard SYSV shared memory system calls (shmget, shmat).</p>
<p>First the Linux kernel needs to be built with the CONFIG_HUGETLBFS
(present under “File systems”) and CONFIG_HUGETLB_PAGE (selected
automatically when CONFIG_HUGETLBFS is selected) configuration
options.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/proc/meminfo</span></code> file provides information about the total number of
persistent hugetlb pages in the kernel’s huge page pool.  It also displays
default huge page size and information about the number of free, reserved
and surplus huge pages in the pool of huge pages of default size.
The huge page size is needed for generating the proper alignment and
size of the arguments to system calls that map huge page regions.</p>
<p>The output of <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/proc/meminfo</span></code> will include lines like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>HugePages_Total: uuu
HugePages_Free:  vvv
HugePages_Rsvd:  www
HugePages_Surp:  xxx
Hugepagesize:    yyy kB
Hugetlb:         zzz kB
</pre></div>
</div>
<p>where:</p>
<dl class="simple">
<dt>HugePages_Total</dt><dd><p>is the size of the pool of huge pages.</p>
</dd>
<dt>HugePages_Free</dt><dd><p>is the number of huge pages in the pool that are not yet
allocated.</p>
</dd>
<dt>HugePages_Rsvd</dt><dd><p>is short for “reserved,” and is the number of huge pages for
which a commitment to allocate from the pool has been made,
but no allocation has yet been made.  Reserved huge pages
guarantee that an application will be able to allocate a
huge page from the pool of huge pages at fault time.</p>
</dd>
<dt>HugePages_Surp</dt><dd><p>is short for “surplus,” and is the number of huge pages in
the pool above the value in <code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/nr_hugepages</span></code>. The
maximum number of surplus huge pages is controlled by
<code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/nr_overcommit_hugepages</span></code>.</p>
</dd>
<dt>Hugepagesize</dt><dd><p>is the default hugepage size (in Kb).</p>
</dd>
<dt>Hugetlb</dt><dd><p>is the total amount of memory (in kB), consumed by huge
pages of all sizes.
If huge pages of different sizes are in use, this number
will exceed HugePages_Total * Hugepagesize. To get more
detailed information, please, refer to
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/mm/hugepages</span></code> (described below).</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">/proc/filesystems</span></code> should also show a filesystem of type “hugetlbfs”
configured in the kernel.</p>
<p><code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/nr_hugepages</span></code> indicates the current number of “persistent” huge
pages in the kernel’s huge page pool.  “Persistent” huge pages will be
returned to the huge page pool when freed by a task.  A user with root
privileges can dynamically allocate more or free some persistent huge pages
by increasing or decreasing the value of <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code>.</p>
<p>Pages that are used as huge pages are reserved inside the kernel and cannot
be used for other purposes.  Huge pages cannot be swapped out under
memory pressure.</p>
<p>Once a number of huge pages have been pre-allocated to the kernel huge page
pool, a user with appropriate privilege can use either the mmap system call
or shared memory system calls to use the huge pages.  See the discussion of
<a class="reference internal" href="#using-huge-pages"><span class="std std-ref">Using Huge Pages</span></a>, below.</p>
<p>The administrator can allocate persistent huge pages on the kernel boot
command line by specifying the “hugepages=N” parameter, where ‘N’ = the
number of huge pages requested.  This is the most reliable method of
allocating huge pages as memory has not yet become fragmented.</p>
<p>Some platforms support multiple huge page sizes.  To allocate huge pages
of a specific size, one must precede the huge pages boot command parameters
with a huge page size selection parameter “hugepagesz=&lt;size&gt;”.  &lt;size&gt; must
be specified in bytes with optional scale suffix [kKmMgG].  The default huge
page size may be selected with the “default_hugepagesz=&lt;size&gt;” boot parameter.</p>
<p>When multiple huge page sizes are supported, <code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/nr_hugepages</span></code>
indicates the current number of pre-allocated huge pages of the default size.
Thus, one can use the following command to dynamically allocate/deallocate
default sized persistent huge pages:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 20 &gt; /proc/sys/vm/nr_hugepages
</pre></div>
</div>
<p>This command will try to adjust the number of default sized huge pages in the
huge page pool to 20, allocating or freeing huge pages, as required.</p>
<p>On a NUMA platform, the kernel will attempt to distribute the huge page pool
over all the set of allowed nodes specified by the NUMA memory policy of the
task that modifies <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code>. The default for the allowed nodes–when the
task has default memory policy–is all on-line nodes with memory.  Allowed
nodes with insufficient available, contiguous memory for a huge page will be
silently skipped when allocating persistent huge pages.  See the
<a class="reference internal" href="#mem-policy-and-hp-alloc"><span class="std std-ref">discussion below</span></a>
of the interaction of task memory policy, cpusets and per node attributes
with the allocation and freeing of persistent huge pages.</p>
<p>The success or failure of huge page allocation depends on the amount of
physically contiguous memory that is present in system at the time of the
allocation attempt.  If the kernel is unable to allocate huge pages from
some nodes in a NUMA system, it will attempt to make up the difference by
allocating extra pages on other nodes with sufficient available contiguous
memory, if any.</p>
<p>System administrators may want to put this command in one of the local rc
init files.  This will enable the kernel to allocate huge pages early in
the boot process when the possibility of getting physical contiguous pages
is still very high.  Administrators can verify the number of huge pages
actually allocated by checking the sysctl or meminfo.  To check the per node
distribution of huge pages in a NUMA system, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/devices/system/node/node*/meminfo | fgrep Huge
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/nr_overcommit_hugepages</span></code> specifies how large the pool of
huge pages can grow, if more huge pages than <code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/nr_hugepages</span></code> are
requested by applications.  Writing any non-zero value into this file
indicates that the hugetlb subsystem is allowed to try to obtain that
number of “surplus” huge pages from the kernel’s normal page pool, when the
persistent huge page pool is exhausted. As these surplus huge pages become
unused, they are freed back to the kernel’s normal page pool.</p>
<p>When increasing the huge page pool size via <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code>, any existing
surplus pages will first be promoted to persistent huge pages.  Then, additional
huge pages will be allocated, if necessary and if possible, to fulfill
the new persistent huge page pool size.</p>
<p>The administrator may shrink the pool of persistent huge pages for
the default huge page size by setting the <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code> sysctl to a
smaller value.  The kernel will attempt to balance the freeing of huge pages
across all nodes in the memory policy of the task modifying <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code>.
Any free huge pages on the selected nodes will be freed back to the kernel’s
normal page pool.</p>
<p>Caveat: Shrinking the persistent huge page pool via <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code> such that
it becomes less than the number of huge pages in use will convert the balance
of the in-use huge pages to surplus huge pages.  This will occur even if
the number of surplus pages would exceed the overcommit value.  As long as
this condition holds–that is, until <code class="docutils literal notranslate"><span class="pre">nr_hugepages+nr_overcommit_hugepages</span></code> is
increased sufficiently, or the surplus huge pages go out of use and are freed–
no more surplus huge pages will be allowed to be allocated.</p>
<p>With support for multiple huge page pools at run-time available, much of
the huge page userspace interface in <code class="docutils literal notranslate"><span class="pre">/proc/sys/vm</span></code> has been duplicated in
sysfs.
The <code class="docutils literal notranslate"><span class="pre">/proc</span></code> interfaces discussed above have been retained for backwards
compatibility. The root huge page control directory in sysfs is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/kernel/mm/hugepages
</pre></div>
</div>
<p>For each huge page size supported by the running kernel, a subdirectory
will exist, of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>hugepages-${size}kB
</pre></div>
</div>
<p>Inside each of these directories, the same set of files will exist:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nr_hugepages
nr_hugepages_mempolicy
nr_overcommit_hugepages
free_hugepages
resv_hugepages
surplus_hugepages
</pre></div>
</div>
<p>which function as described above for the default huge page-sized case.</p>
</div>
<div class="section" id="interaction-of-task-memory-policy-with-huge-page-allocation-freeing">
<span id="mem-policy-and-hp-alloc"></span><h2>Interaction of Task Memory Policy with Huge Page Allocation/Freeing<a class="headerlink" href="#interaction-of-task-memory-policy-with-huge-page-allocation-freeing" title="Permalink to this headline">¶</a></h2>
<p>Whether huge pages are allocated and freed via the <code class="docutils literal notranslate"><span class="pre">/proc</span></code> interface or
the <code class="docutils literal notranslate"><span class="pre">/sysfs</span></code> interface using the <code class="docutils literal notranslate"><span class="pre">nr_hugepages_mempolicy</span></code> attribute, the
NUMA nodes from which huge pages are allocated or freed are controlled by the
NUMA memory policy of the task that modifies the <code class="docutils literal notranslate"><span class="pre">nr_hugepages_mempolicy</span></code>
sysctl or attribute.  When the <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code> attribute is used, mempolicy
is ignored.</p>
<p>The recommended method to allocate or free huge pages to/from the kernel
huge page pool, using the <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code> example above, is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>numactl --interleave &lt;node-list&gt; echo 20 \
                            &gt;/proc/sys/vm/nr_hugepages_mempolicy
</pre></div>
</div>
<p>or, more succinctly:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>numactl -m &lt;node-list&gt; echo 20 &gt;/proc/sys/vm/nr_hugepages_mempolicy
</pre></div>
</div>
<p>This will allocate or free <code class="docutils literal notranslate"><span class="pre">abs(20</span> <span class="pre">-</span> <span class="pre">nr_hugepages)</span></code> to or from the nodes
specified in &lt;node-list&gt;, depending on whether number of persistent huge pages
is initially less than or greater than 20, respectively.  No huge pages will be
allocated nor freed on any node not included in the specified &lt;node-list&gt;.</p>
<p>When adjusting the persistent hugepage count via <code class="docutils literal notranslate"><span class="pre">nr_hugepages_mempolicy</span></code>, any
memory policy mode–bind, preferred, local or interleave–may be used.  The
resulting effect on persistent huge page allocation is as follows:</p>
<ol class="arabic simple">
<li><p>Regardless of mempolicy mode [see
<a class="reference internal" href="numa_memory_policy.html#numa-memory-policy"><span class="std std-ref">Documentation/admin-guide/mm/numa_memory_policy.rst</span></a>],
persistent huge pages will be distributed across the node or nodes
specified in the mempolicy as if “interleave” had been specified.
However, if a node in the policy does not contain sufficient contiguous
memory for a huge page, the allocation will not “fallback” to the nearest
neighbor node with sufficient contiguous memory.  To do this would cause
undesirable imbalance in the distribution of the huge page pool, or
possibly, allocation of persistent huge pages on nodes not allowed by
the task’s memory policy.</p></li>
<li><p>One or more nodes may be specified with the bind or interleave policy.
If more than one node is specified with the preferred policy, only the
lowest numeric id will be used.  Local policy will select the node where
the task is running at the time the nodes_allowed mask is constructed.
For local policy to be deterministic, the task must be bound to a cpu or
cpus in a single node.  Otherwise, the task could be migrated to some
other node at any time after launch and the resulting node will be
indeterminate.  Thus, local policy is not very useful for this purpose.
Any of the other mempolicy modes may be used to specify a single node.</p></li>
<li><p>The nodes allowed mask will be derived from any non-default task mempolicy,
whether this policy was set explicitly by the task itself or one of its
ancestors, such as numactl.  This means that if the task is invoked from a
shell with non-default policy, that policy will be used.  One can specify a
node list of “all” with numactl –interleave or –membind [-m] to achieve
interleaving over all nodes in the system or cpuset.</p></li>
<li><p>Any task mempolicy specified–e.g., using numactl–will be constrained by
the resource limits of any cpuset in which the task runs.  Thus, there will
be no way for a task with non-default policy running in a cpuset with a
subset of the system nodes to allocate huge pages outside the cpuset
without first moving to a cpuset that contains all of the desired nodes.</p></li>
<li><p>Boot-time huge page allocation attempts to distribute the requested number
of huge pages over all on-lines nodes with memory.</p></li>
</ol>
</div>
<div class="section" id="per-node-hugepages-attributes">
<h2>Per Node Hugepages Attributes<a class="headerlink" href="#per-node-hugepages-attributes" title="Permalink to this headline">¶</a></h2>
<p>A subset of the contents of the root huge page control directory in sysfs,
described above, will be replicated under each the system device of each
NUMA node with memory in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/devices/system/node/node[0-9]*/hugepages/
</pre></div>
</div>
<p>Under this directory, the subdirectory for each supported huge page size
contains the following attribute files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nr_hugepages
free_hugepages
surplus_hugepages
</pre></div>
</div>
<p>The free_’ and surplus_’ attribute files are read-only.  They return the number
of free and surplus [overcommitted] huge pages, respectively, on the parent
node.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code> attribute returns the total number of huge pages on the
specified node.  When this attribute is written, the number of persistent huge
pages on the parent node will be adjusted to the specified value, if sufficient
resources exist, regardless of the task’s mempolicy or cpuset constraints.</p>
<p>Note that the number of overcommit and reserve pages remain global quantities,
as we don’t know until fault time, when the faulting task’s mempolicy is
applied, from which node the huge page allocation will be attempted.</p>
</div>
<div class="section" id="using-huge-pages">
<span id="id1"></span><h2>Using Huge Pages<a class="headerlink" href="#using-huge-pages" title="Permalink to this headline">¶</a></h2>
<p>If the user applications are going to request huge pages using mmap system
call, then it is required that system administrator mount a file system of
type hugetlbfs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mount -t hugetlbfs \
      -o uid=&lt;value&gt;,gid=&lt;value&gt;,mode=&lt;value&gt;,pagesize=&lt;value&gt;,size=&lt;value&gt;,\
      min_size=&lt;value&gt;,nr_inodes=&lt;value&gt; none /mnt/huge
</pre></div>
</div>
<p>This command mounts a (pseudo) filesystem of type hugetlbfs on the directory
<code class="docutils literal notranslate"><span class="pre">/mnt/huge</span></code>.  Any file created on <code class="docutils literal notranslate"><span class="pre">/mnt/huge</span></code> uses huge pages.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">uid</span></code> and <code class="docutils literal notranslate"><span class="pre">gid</span></code> options sets the owner and group of the root of the
file system.  By default the <code class="docutils literal notranslate"><span class="pre">uid</span></code> and <code class="docutils literal notranslate"><span class="pre">gid</span></code> of the current process
are taken.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mode</span></code> option sets the mode of root of file system to value &amp; 01777.
This value is given in octal. By default the value 0755 is picked.</p>
<p>If the platform supports multiple huge page sizes, the <code class="docutils literal notranslate"><span class="pre">pagesize</span></code> option can
be used to specify the huge page size and associated pool. <code class="docutils literal notranslate"><span class="pre">pagesize</span></code>
is specified in bytes. If <code class="docutils literal notranslate"><span class="pre">pagesize</span></code> is not specified the platform’s
default huge page size and associated pool will be used.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">size</span></code> option sets the maximum value of memory (huge pages) allowed
for that filesystem (<code class="docutils literal notranslate"><span class="pre">/mnt/huge</span></code>). The <code class="docutils literal notranslate"><span class="pre">size</span></code> option can be specified
in bytes, or as a percentage of the specified huge page pool (<code class="docutils literal notranslate"><span class="pre">nr_hugepages</span></code>).
The size is rounded down to HPAGE_SIZE boundary.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">min_size</span></code> option sets the minimum value of memory (huge pages) allowed
for the filesystem. <code class="docutils literal notranslate"><span class="pre">min_size</span></code> can be specified in the same way as <code class="docutils literal notranslate"><span class="pre">size</span></code>,
either bytes or a percentage of the huge page pool.
At mount time, the number of huge pages specified by <code class="docutils literal notranslate"><span class="pre">min_size</span></code> are reserved
for use by the filesystem.
If there are not enough free huge pages available, the mount will fail.
As huge pages are allocated to the filesystem and freed, the reserve count
is adjusted so that the sum of allocated and reserved huge pages is always
at least <code class="docutils literal notranslate"><span class="pre">min_size</span></code>.</p>
<p>The option <code class="docutils literal notranslate"><span class="pre">nr_inodes</span></code> sets the maximum number of inodes that <code class="docutils literal notranslate"><span class="pre">/mnt/huge</span></code>
can use.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">size</span></code>, <code class="docutils literal notranslate"><span class="pre">min_size</span></code> or <code class="docutils literal notranslate"><span class="pre">nr_inodes</span></code> option is not provided on
command line then no limits are set.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">pagesize</span></code>, <code class="docutils literal notranslate"><span class="pre">size</span></code>, <code class="docutils literal notranslate"><span class="pre">min_size</span></code> and <code class="docutils literal notranslate"><span class="pre">nr_inodes</span></code> options, you can
use [G|g]/[M|m]/[K|k] to represent giga/mega/kilo.
For example, size=2K has the same meaning as size=2048.</p>
<p>While read system calls are supported on files that reside on hugetlb
file systems, write system calls are not.</p>
<p>Regular chown, chgrp, and chmod commands (with right permissions) could be
used to change the file attributes on hugetlbfs.</p>
<p>Also, it is important to note that no such mount command is required if
applications are going to use only shmat/shmget system calls or mmap with
MAP_HUGETLB.  For an example of how to use mmap with MAP_HUGETLB see
<a class="reference internal" href="#map-hugetlb"><span class="std std-ref">map_hugetlb</span></a> below.</p>
<p>Users who wish to use hugetlb memory via shared memory segment should be
members of a supplementary group and system admin needs to configure that gid
into <code class="docutils literal notranslate"><span class="pre">/proc/sys/vm/hugetlb_shm_group</span></code>.  It is possible for same or different
applications to use any combination of mmaps and shm* calls, though the mount of
filesystem will be required for using mmap calls without MAP_HUGETLB.</p>
<p>Syscalls that operate on memory backed by hugetlb pages only have their lengths
aligned to the native page size of the processor; they will normally fail with
errno set to EINVAL or exclude hugetlb pages that extend beyond the length if
not hugepage aligned.  For example, munmap(2) will fail if memory is backed by
a hugetlb page and the length is smaller than the hugepage size.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<dl class="simple" id="map-hugetlb">
<dt><code class="docutils literal notranslate"><span class="pre">map_hugetlb</span></code></dt><dd><p>see tools/testing/selftests/vm/map_hugetlb.c</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hugepage-shm</span></code></dt><dd><p>see tools/testing/selftests/vm/hugepage-shm.c</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hugepage-mmap</span></code></dt><dd><p>see tools/testing/selftests/vm/hugepage-mmap.c</p>
</dd>
</dl>
<p>The <a class="reference external" href="https://github.com/libhugetlbfs/libhugetlbfs">libhugetlbfs</a>  library provides a wide range of userspace tools
to help with huge page usability, environment setup, and control.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="idle_page_tracking.html" class="btn btn-neutral float-right" title="Idle Page Tracking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cma_debugfs.html" class="btn btn-neutral float-left" title="CMA Debugfs Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>