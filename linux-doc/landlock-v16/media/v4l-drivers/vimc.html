

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>35. The Virtual Media Controller Driver (vimc) &mdash; The Linux Kernel 5.7.0-rc1+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="36. The Virtual Video Test Driver (vivid)" href="vivid.html" />
    <link rel="prev" title="34. The Linux USB Video Class (UVC) driver" href="uvcvideo.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Video4Linux (V4L)  driver-specific documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fourcc.html">1. Guidelines for Video4Linux pixel format 4CCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html">2. Infrared remote control support in video4linux drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-with-lircd">3. Using with lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-without-lircd">4. Using without lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuners.html">5. Tuner drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cardlist.html">6. Cards List</a></li>
<li class="toctree-l3"><a class="reference internal" href="bttv.html">7. The bttv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cafe_ccic.html">8. The cafe_ccic driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpia2.html">9. The cpia2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx2341x.html">10. The cx2341x driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx88.html">11. The cx88 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="davinci-vpbe.html">12. The VPBE V4L2 driver design</a></li>
<li class="toctree-l3"><a class="reference internal" href="fimc.html">13. The Samsung S5P/EXYNOS4 FIMC driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="imx.html">14. i.MX Video Capture Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="imx7.html">15. i.MX7 Video Capture Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipu3.html">16. Intel Image Processing Unit 3 (IPU3) Imaging Unit (ImgU) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ivtv.html">17. The ivtv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="max2175.html">18. Maxim Integrated MAX2175 RF to bits tuner driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="meye.html">19. Vaio Picturebook Motion Eye Camera Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omap3isp.html">20. OMAP 3 Image Signal Processor (ISP) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omap4_camera.html">21. OMAP4 ISS Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="philips.html">22. Philips webcams (pwc driver)</a></li>
<li class="toctree-l3"><a class="reference internal" href="pvrusb2.html">23. The pvrusb2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="pxa_camera.html">24. PXA-Camera Host Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="qcom_camss.html">25. Qualcomm Camera Subsystem driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="radiotrack.html">26. The Radiotrack radio driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="rcar-fdp1.html">27. Renesas R-Car Fine Display Processor (FDP1) Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="saa7134.html">28. The saa7134 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sh_mobile_ceu_camera.html">29. Cropping and Scaling algorithm, used in the sh_mobile_ceu_camera driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si470x.html">30. The Silicon Labs Si470x FM Radio Receivers driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si4713.html">31. The Silicon Labs Si4713 FM Radio Transmitter Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si476x.html">32. The SI476x Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="soc-camera.html">33. The Soc-Camera Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="uvcvideo.html">34. The Linux USB Video Class (UVC) driver</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">35. The Virtual Media Controller Driver (vimc)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#topology">35.1. Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subdevices">35.2. Subdevices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-options">35.3. Module options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-code-documentation">35.4. Source code documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="vivid.html">36. The Virtual Video Test Driver (vivid)</a></li>
<li class="toctree-l3"><a class="reference internal" href="zr364xx.html">37. Zoran 364xx based USB webcam module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Video4Linux (V4L)  driver-specific documentation</a> &raquo;</li>
        
      <li><span class="section-number">35. </span>The Virtual Media Controller Driver (vimc)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/media/v4l-drivers/vimc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-virtual-media-controller-driver-vimc">
<h1><span class="section-number">35. </span>The Virtual Media Controller Driver (vimc)<a class="headerlink" href="#the-virtual-media-controller-driver-vimc" title="Permalink to this headline">¶</a></h1>
<p>The vimc driver emulates complex video hardware using the V4L2 API and the Media
API. It has a capture device and three subdevices: sensor, debayer and scaler.</p>
<div class="section" id="topology">
<h2><span class="section-number">35.1. </span>Topology<a class="headerlink" href="#topology" title="Permalink to this headline">¶</a></h2>
<p>The topology is hardcoded, although you could modify it in vimc-core and
recompile the driver to achieve your own topology. This is the default topology:</p>
<div class="figure align-center" id="id1">
<img alt="Diagram of the default media pipeline topology" src="../../_images/vimc.svg" /><p class="caption"><span class="caption-text">Media pipeline graph on vimc</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="configuring-the-topology">
<h3><span class="section-number">35.1.1. </span>Configuring the topology<a class="headerlink" href="#configuring-the-topology" title="Permalink to this headline">¶</a></h3>
<p>Each subdevice will come with its default configuration (pixelformat, height,
width, …). One needs to configure the topology in order to match the
configuration on each linked subdevice to stream frames through the pipeline.
If the configuration doesn’t match, the stream will fail. The <code class="docutils literal notranslate"><span class="pre">v4l-utils</span></code>
package is a bundle of user-space applications, that comes with <code class="docutils literal notranslate"><span class="pre">media-ctl</span></code> and
<code class="docutils literal notranslate"><span class="pre">v4l2-ctl</span></code> that can be used to configure the vimc configuration. This sequence
of commands fits for the default topology:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>media-ctl -d platform:vimc -V <span class="s1">&#39;&quot;Sensor A&quot;:0[fmt:SBGGR8_1X8/640x480]&#39;</span>
media-ctl -d platform:vimc -V <span class="s1">&#39;&quot;Debayer A&quot;:0[fmt:SBGGR8_1X8/640x480]&#39;</span>
media-ctl -d platform:vimc -V <span class="s1">&#39;&quot;Sensor B&quot;:0[fmt:SBGGR8_1X8/640x480]&#39;</span>
media-ctl -d platform:vimc -V <span class="s1">&#39;&quot;Debayer B&quot;:0[fmt:SBGGR8_1X8/640x480]&#39;</span>
v4l2-ctl -z platform:vimc -d <span class="s2">&quot;RGB/YUV Capture&quot;</span> -v <span class="nv">width</span><span class="o">=</span><span class="m">1920</span>,height<span class="o">=</span><span class="m">1440</span>
v4l2-ctl -z platform:vimc -d <span class="s2">&quot;Raw Capture 0&quot;</span> -v <span class="nv">pixelformat</span><span class="o">=</span>BA81
v4l2-ctl -z platform:vimc -d <span class="s2">&quot;Raw Capture 1&quot;</span> -v <span class="nv">pixelformat</span><span class="o">=</span>BA81
</pre></div>
</div>
</div>
</div>
<div class="section" id="subdevices">
<h2><span class="section-number">35.2. </span>Subdevices<a class="headerlink" href="#subdevices" title="Permalink to this headline">¶</a></h2>
<p>Subdevices define the behavior of an entity in the topology. Depending on the
subdevice, the entity can have multiple pads of type source or sink.</p>
<dl class="simple">
<dt>vimc-sensor:</dt><dd><p>Generates images in several formats using video test pattern generator.
Exposes:</p>
<ul class="simple">
<li><p>1 Pad source</p></li>
</ul>
</dd>
<dt>vimc-debayer:</dt><dd><p>Transforms images in bayer format into a non-bayer format.
Exposes:</p>
<ul class="simple">
<li><p>1 Pad sink</p></li>
<li><p>1 Pad source</p></li>
</ul>
</dd>
<dt>vimc-scaler:</dt><dd><p>Scale up the image by a factor of 3. E.g.: a 640x480 image becomes a
1920x1440 image. (this value can be configured, see at
<a class="reference internal" href="#module-options">Module options</a>).
Exposes:</p>
<ul class="simple">
<li><p>1 Pad sink</p></li>
<li><p>1 Pad source</p></li>
</ul>
</dd>
<dt>vimc-capture:</dt><dd><p>Exposes node /dev/videoX to allow userspace to capture the stream.
Exposes:</p>
<ul class="simple">
<li><p>1 Pad sink</p></li>
<li><p>1 Pad source</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="module-options">
<h2><span class="section-number">35.3. </span>Module options<a class="headerlink" href="#module-options" title="Permalink to this headline">¶</a></h2>
<p>Vimc has a module parameter to configure the driver.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sca_mult=&lt;unsigned</span> <span class="pre">int&gt;</span></code></p>
<blockquote>
<div><p>Image size multiplier factor to be used to multiply both width and
height, so the image size will be <code class="docutils literal notranslate"><span class="pre">sca_mult^2</span></code> bigger than the
original one. Currently, only supports scaling up (the default value
is 3).</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="source-code-documentation">
<h2><span class="section-number">35.4. </span>Source code documentation<a class="headerlink" href="#source-code-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="vimc-streamer">
<h3><span class="section-number">35.4.1. </span>vimc-streamer<a class="headerlink" href="#vimc-streamer" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="c.vimc_stream">
struct <code class="sig-name descname">vimc_stream</code><a class="headerlink" href="#c.vimc_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>struct that represents a stream in the pipeline</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct vimc_stream {
  struct media_pipeline pipe;
  struct vimc_ent_device *ved_pipeline[VIMC_STREAMER_PIPELINE_MAX_SIZE];
  unsigned int pipe_size;
  struct task_struct *kthread;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pipe</span></code></dt><dd><p>the media pipeline object associated with this stream</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ved_pipeline</span></code></dt><dd><p>array containing all the entities participating in the
stream. The order is from a video device (usually a capture device) where
stream_on was called, to the entity generating the first base image to be
processed in the pipeline.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pipe_size</span></code></dt><dd><p>size of <strong>ved_pipeline</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kthread</span></code></dt><dd><p>thread that generates the frames of the stream.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>When the user call stream_on in a video device, struct vimc_stream is
used to keep track of all entities and subdevices that generates and
process frames for the stream.</p>
<dl class="function">
<dt id="c.vimc_get_source_entity">
struct <a class="reference internal" href="../kapi/mc-core.html#c.media_entity" title="media_entity">media_entity</a> * <code class="sig-name descname">vimc_get_source_entity</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../kapi/mc-core.html#c.media_entity" title="media_entity">media_entity</a> *<em> ent</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vimc_get_source_entity" title="Permalink to this definition">¶</a></dt>
<dd><p>get the entity connected with the first sink pad</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_entity</span> <span class="pre">*</span> <span class="pre">ent</span></code></dt><dd><p>reference media_entity</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function that returns the media entity containing the source pad
linked with the first sink pad from the given media entity pad list.</p>
<p><strong>Return</strong></p>
<p>The source pad or NULL, if it wasn’t found.</p>
<dl class="function">
<dt id="c.vimc_streamer_pipeline_terminate">
void <code class="sig-name descname">vimc_streamer_pipeline_terminate</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.vimc_stream" title="vimc_stream">vimc_stream</a> *<em> stream</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vimc_streamer_pipeline_terminate" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable stream in all ved in stream</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vimc_stream</span> <span class="pre">*</span> <span class="pre">stream</span></code></dt><dd><p>the pointer to the stream structure with the pipeline to be
disabled.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Calls s_stream to disable the stream in each entity of the pipeline</p>
<dl class="function">
<dt id="c.vimc_streamer_pipeline_init">
int <code class="sig-name descname">vimc_streamer_pipeline_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.vimc_stream" title="vimc_stream">vimc_stream</a> *<em> stream</em>, struct vimc_ent_device *<em> ved</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vimc_streamer_pipeline_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the stream structure</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vimc_stream</span> <span class="pre">*</span> <span class="pre">stream</span></code></dt><dd><p>the pointer to the stream structure to be initialized</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vimc_ent_device</span> <span class="pre">*</span> <span class="pre">ved</span></code></dt><dd><p>the pointer to the vimc entity initializing the stream</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initializes the stream structure. Walks through the entity graph to
construct the pipeline used later on the streamer thread.
Calls <a class="reference internal" href="#c.vimc_streamer_s_stream" title="vimc_streamer_s_stream"><code class="xref c c-func docutils literal notranslate"><span class="pre">vimc_streamer_s_stream()</span></code></a> to enable stream in all entities of
the pipeline.</p>
<p><strong>Return</strong></p>
<p>0 if success, error code otherwise.</p>
<dl class="function">
<dt id="c.vimc_streamer_thread">
int <code class="sig-name descname">vimc_streamer_thread</code><span class="sig-paren">(</span>void *<em> data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vimc_streamer_thread" title="Permalink to this definition">¶</a></dt>
<dd><p>Process frames through the pipeline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">data</span></code></dt><dd><p>vimc_stream struct of the current stream</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>From the source to the sink, gets a frame from each subdevice and send to
the next one of the pipeline at a fixed framerate.</p>
<p><strong>Return</strong></p>
<p>Always zero (created as <code class="docutils literal notranslate"><span class="pre">int</span></code> instead of <code class="docutils literal notranslate"><span class="pre">void</span></code> to comply with
kthread API).</p>
<dl class="function">
<dt id="c.vimc_streamer_s_stream">
int <code class="sig-name descname">vimc_streamer_s_stream</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.vimc_stream" title="vimc_stream">vimc_stream</a> *<em> stream</em>, struct vimc_ent_device *<em> ved</em>, int<em> enable</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vimc_streamer_s_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Start/stop the streaming on the media pipeline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vimc_stream</span> <span class="pre">*</span> <span class="pre">stream</span></code></dt><dd><p>the pointer to the stream structure of the current stream</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vimc_ent_device</span> <span class="pre">*</span> <span class="pre">ved</span></code></dt><dd><p>pointer to the vimc entity of the entity of the stream</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">enable</span></code></dt><dd><p>flag to determine if stream should start/stop</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>When starting, check if there is no <code class="docutils literal notranslate"><span class="pre">stream-&gt;kthread</span></code> allocated. This
should indicate that a stream is already running. Then, it initializes the
pipeline, creates and runs a kthread to consume buffers through the pipeline.
When stopping, analogously check if there is a stream running, stop the
thread and terminates the pipeline.</p>
<p><strong>Return</strong></p>
<p>0 if success, error code otherwise.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vivid.html" class="btn btn-neutral float-right" title="36. The Virtual Video Test Driver (vivid)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="uvcvideo.html" class="btn btn-neutral float-left" title="34. The Linux USB Video Class (UVC) driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>