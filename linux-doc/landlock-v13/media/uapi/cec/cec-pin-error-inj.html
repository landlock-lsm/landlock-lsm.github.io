

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. CEC Pin Framework Error Injection &mdash; The Linux Kernel 5.4.0-rc3+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="4. CEC Header File" href="cec-header.html" />
    <link rel="prev" title="2.10. ioctls CEC_RECEIVE and CEC_TRANSMIT" href="cec-ioc-receive.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.4.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ioctl/index.html">IOCTLs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../media_uapi.html">Linux Media Infrastructure userspace API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../v4l/v4l2.html">Part I - Video for Linux API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dvb/dvbapi.html">Part II - Digital TV API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rc/remote_controllers.html">Part III - Remote Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mediactl/media-controller.html">Part IV - Media Controller API</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="cec-api.html">Part V - Consumer Electronics Control API</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cec-intro.html">1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="cec-funcs.html">2. Function Reference</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3. CEC Pin Framework Error Injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="cec-header.html">4. CEC Header File</a></li>
<li class="toctree-l4"><a class="reference internal" href="cec-api.html#revision-and-copyright">Revision and Copyright</a></li>
<li class="toctree-l4"><a class="reference internal" href="cec-api.html#revision-history">Revision History</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../gen-errors.html">Generic Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fdl-appendix.html">GNU Free Documentation License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="../../media_uapi.html">Linux Media Infrastructure userspace API</a> &raquo;</li>
        
          <li><a href="cec-api.html">Part V - Consumer Electronics Control API</a> &raquo;</li>
        
      <li>3. CEC Pin Framework Error Injection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/media/uapi/cec/cec-pin-error-inj.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cec-pin-framework-error-injection">
<h1>3. CEC Pin Framework Error Injection<a class="headerlink" href="#cec-pin-framework-error-injection" title="Permalink to this headline">¶</a></h1>
<p>The CEC Pin Framework is a core CEC framework for CEC hardware that only
has low-level support for the CEC bus. Most hardware today will have
high-level CEC support where the hardware deals with driving the CEC bus,
but some older devices aren’t that fancy. However, this framework also
allows you to connect the CEC pin to a GPIO on e.g. a Raspberry Pi and
you have now made a CEC adapter.</p>
<p>What makes doing this so interesting is that since we have full control
over the bus it is easy to support error injection. This is ideal to
test how well CEC adapters can handle error conditions.</p>
<p>Currently only the cec-gpio driver (when the CEC line is directly
connected to a pull-up GPIO line) and the AllWinner A10/A20 drm driver
support this framework.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">CONFIG_CEC_PIN_ERROR_INJ</span></code> is enabled, then error injection is available
through debugfs. Specifically, in <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/cec/cecX/</span></code> there is
now an <code class="docutils literal notranslate"><span class="pre">error-inj</span></code> file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The error injection commands are not a stable ABI and may change in the
future.</p>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">error-inj</span></code> you can see both the possible commands and the current
error injection status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat /sys/kernel/debug/cec/cec0/error-inj
# Clear error injections:
#   clear          clear all rx and tx error injections
#   rx-clear       clear all rx error injections
#   tx-clear       clear all tx error injections
#   &lt;op&gt; clear     clear all rx and tx error injections for &lt;op&gt;
#   &lt;op&gt; rx-clear  clear all rx error injections for &lt;op&gt;
#   &lt;op&gt; tx-clear  clear all tx error injections for &lt;op&gt;
#
# RX error injection:
#   &lt;op&gt;[,&lt;mode&gt;] rx-nack              NACK the message instead of sending an ACK
#   &lt;op&gt;[,&lt;mode&gt;] rx-low-drive &lt;bit&gt;   force a low-drive condition at this bit position
#   &lt;op&gt;[,&lt;mode&gt;] rx-add-byte          add a spurious byte to the received CEC message
#   &lt;op&gt;[,&lt;mode&gt;] rx-remove-byte       remove the last byte from the received CEC message
#   &lt;op&gt;[,&lt;mode&gt;] rx-arb-lost &lt;poll&gt;   generate a POLL message to trigger an arbitration lost
#
# TX error injection settings:
#   tx-ignore-nack-until-eom           ignore early NACKs until EOM
#   tx-custom-low-usecs &lt;usecs&gt;        define the &#39;low&#39; time for the custom pulse
#   tx-custom-high-usecs &lt;usecs&gt;       define the &#39;high&#39; time for the custom pulse
#   tx-custom-pulse                    transmit the custom pulse once the bus is idle
#
# TX error injection:
#   &lt;op&gt;[,&lt;mode&gt;] tx-no-eom            don&#39;t set the EOM bit
#   &lt;op&gt;[,&lt;mode&gt;] tx-early-eom         set the EOM bit one byte too soon
#   &lt;op&gt;[,&lt;mode&gt;] tx-add-bytes &lt;num&gt;   append &lt;num&gt; (1-255) spurious bytes to the message
#   &lt;op&gt;[,&lt;mode&gt;] tx-remove-byte       drop the last byte from the message
#   &lt;op&gt;[,&lt;mode&gt;] tx-short-bit &lt;bit&gt;   make this bit shorter than allowed
#   &lt;op&gt;[,&lt;mode&gt;] tx-long-bit &lt;bit&gt;    make this bit longer than allowed
#   &lt;op&gt;[,&lt;mode&gt;] tx-custom-bit &lt;bit&gt;  send the custom pulse instead of this bit
#   &lt;op&gt;[,&lt;mode&gt;] tx-short-start       send a start pulse that&#39;s too short
#   &lt;op&gt;[,&lt;mode&gt;] tx-long-start        send a start pulse that&#39;s too long
#   &lt;op&gt;[,&lt;mode&gt;] tx-custom-start      send the custom pulse instead of the start pulse
#   &lt;op&gt;[,&lt;mode&gt;] tx-last-bit &lt;bit&gt;    stop sending after this bit
#   &lt;op&gt;[,&lt;mode&gt;] tx-low-drive &lt;bit&gt;   force a low-drive condition at this bit position
#
# &lt;op&gt;       CEC message opcode (0-255) or &#39;any&#39;
# &lt;mode&gt;     &#39;once&#39; (default), &#39;always&#39;, &#39;toggle&#39; or &#39;off&#39;
# &lt;bit&gt;      CEC message bit (0-159)
#            10 bits per &#39;byte&#39;: bits 0-7: data, bit 8: EOM, bit 9: ACK
# &lt;poll&gt;     CEC poll message used to test arbitration lost (0x00-0xff, default 0x0f)
# &lt;usecs&gt;    microseconds (0-10000000, default 1000)

clear
</pre></div>
</div>
<p>You can write error injection commands to <code class="docutils literal notranslate"><span class="pre">error-inj</span></code> using
<code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">'cmd'</span> <span class="pre">&gt;error-inj</span></code> or <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">cmd.txt</span> <span class="pre">&gt;error-inj</span></code>. The <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">error-inj</span></code>
output contains the current error commands. You can save the output to a file
and use it as an input to <code class="docutils literal notranslate"><span class="pre">error-inj</span></code> later.</p>
<div class="section" id="basic-syntax">
<h2>3.1. Basic Syntax<a class="headerlink" href="#basic-syntax" title="Permalink to this headline">¶</a></h2>
<p>Leading spaces/tabs are ignored. If the next character is a <code class="docutils literal notranslate"><span class="pre">#</span></code> or the end
of the line was reached, then the whole line is ignored. Otherwise a command
is expected.</p>
<p>The error injection commands fall in two main groups: those relating to
receiving CEC messages and those relating to transmitting CEC messages. In
addition, there are commands to clear existing error injection commands and
to create custom pulses on the CEC bus.</p>
<p>Most error injection commands can be executed for specific CEC opcodes or for
all opcodes (<code class="docutils literal notranslate"><span class="pre">any</span></code>). Each command also has a ‘mode’ which can be <code class="docutils literal notranslate"><span class="pre">off</span></code>
(can be used to turn off an existing error injection command), <code class="docutils literal notranslate"><span class="pre">once</span></code>
(the default) which will trigger the error injection only once for the next
received or transmitted message, <code class="docutils literal notranslate"><span class="pre">always</span></code> to always trigger the error
injection and <code class="docutils literal notranslate"><span class="pre">toggle</span></code> to toggle the error injection on or off for every
transmit or receive.</p>
<p>So ‘<code class="docutils literal notranslate"><span class="pre">any</span> <span class="pre">rx-nack</span></code>’ will NACK the next received CEC message,
‘<code class="docutils literal notranslate"><span class="pre">any,always</span> <span class="pre">rx-nack</span></code>’ will NACK all received CEC messages and
‘<code class="docutils literal notranslate"><span class="pre">0x82,toggle</span> <span class="pre">rx-nack</span></code>’ will only NACK if an Active Source message was
received and do that only for every other received message.</p>
<p>After an error was injected with mode <code class="docutils literal notranslate"><span class="pre">once</span></code> the error injection command
is cleared automatically, so <code class="docutils literal notranslate"><span class="pre">once</span></code> is a one-time deal.</p>
<p>All combinations of <code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span></code> and error injection commands can co-exist. So
this is fine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x9e tx-add-bytes 1
0x9e tx-early-eom
0x9f tx-add-bytes 2
any rx-nack
</pre></div>
</div>
<p>All four error injection commands will be active simultaneously.</p>
<p>However, if the same <code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span></code> and command combination is specified,
but with different arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x9e tx-add-bytes 1
0x9e tx-add-bytes 2
</pre></div>
</div>
<p>Then the second will overwrite the first.</p>
</div>
<div class="section" id="clear-error-injections">
<h2>3.2. Clear Error Injections<a class="headerlink" href="#clear-error-injections" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clear</span></code></dt>
<dd>Clear all error injections.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rx-clear</span></code></dt>
<dd>Clear all receive error injections</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tx-clear</span></code></dt>
<dd>Clear all transmit error injections</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span> <span class="pre">clear</span></code></dt>
<dd>Clear all error injections for the given opcode.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span> <span class="pre">rx-clear</span></code></dt>
<dd>Clear all receive error injections for the given opcode.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span> <span class="pre">tx-clear</span></code></dt>
<dd>Clear all transmit error injections for the given opcode.</dd>
</dl>
</div>
<div class="section" id="receive-messages">
<h2>3.3. Receive Messages<a class="headerlink" href="#receive-messages" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">rx-nack</span></code></dt>
<dd>NACK broadcast messages and messages directed to this CEC adapter.
Every byte of the message will be NACKed in case the transmitter
keeps transmitting after the first byte was NACKed.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">rx-low-drive</span> <span class="pre">&lt;bit&gt;</span></code></dt>
<dd>Force a Low Drive condition at this bit position. If &lt;op&gt; specifies
a specific CEC opcode then the bit position must be at least 18,
otherwise the opcode hasn’t been received yet. This tests if the
transmitter can handle the Low Drive condition correctly and reports
the error correctly. Note that a Low Drive in the first 4 bits can also
be interpreted as an Arbitration Lost condition by the transmitter.
This is implementation dependent.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">rx-add-byte</span></code></dt>
<dd>Add a spurious 0x55 byte to the received CEC message, provided
the message was 15 bytes long or less. This is useful to test
the high-level protocol since spurious bytes should be ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">rx-remove-byte</span></code></dt>
<dd>Remove the last byte from the received CEC message, provided it
was at least 2 bytes long. This is useful to test the high-level
protocol since messages that are too short should be ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">rx-arb-lost</span> <span class="pre">&lt;poll&gt;</span></code></dt>
<dd><p class="first">Generate a POLL message to trigger an Arbitration Lost condition.
This command is only allowed for <code class="docutils literal notranslate"><span class="pre">&lt;op&gt;</span></code> values of <code class="docutils literal notranslate"><span class="pre">next</span></code> or <code class="docutils literal notranslate"><span class="pre">all</span></code>.
As soon as a start bit has been received the CEC adapter will switch
to transmit mode and it will transmit a POLL message. By default this is
0x0f, but it can also be specified explicitly via the <code class="docutils literal notranslate"><span class="pre">&lt;poll&gt;</span></code> argument.</p>
<p>This command can be used to test the Arbitration Lost condition in
the remote CEC transmitter. Arbitration happens when two CEC adapters
start sending a message at the same time. In that case the initiator
with the most leading zeroes wins and the other transmitter has to
stop transmitting (‘Arbitration Lost’). This is very hard to test,
except by using this error injection command.</p>
<p class="last">This does not work if the remote CEC transmitter has logical address
0 (‘TV’) since that will always win.</p>
</dd>
</dl>
</div>
<div class="section" id="transmit-messages">
<h2>3.4. Transmit Messages<a class="headerlink" href="#transmit-messages" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">tx-ignore-nack-until-eom</span></code></dt>
<dd><p class="first">This setting changes the behavior of transmitting CEC messages. Normally
as soon as the receiver NACKs a byte the transmit will stop, but the
specification also allows that the full message is transmitted and only
at the end will the transmitter look at the ACK bit. This is not
recommended behavior since there is no point in keeping the CEC bus busy
for longer than is strictly needed. Especially given how slow the bus is.</p>
<p class="last">This setting can be used to test how well a receiver deals with
transmitters that ignore NACKs until the very end of the message.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-no-eom</span></code></dt>
<dd>Don’t set the EOM bit. Normally the last byte of the message has the EOM
(End-Of-Message) bit set. With this command the transmit will just stop
without ever sending an EOM. This can be used to test how a receiver
handles this case. Normally receivers have a time-out after which
they will go back to the Idle state.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-early-eom</span></code></dt>
<dd>Set the EOM bit one byte too soon. This obviously only works for messages
of two bytes or more. The EOM bit will be set for the second-to-last byte
and not for the final byte. The receiver should ignore the last byte in
this case. Since the resulting message is likely to be too short for this
same reason the whole message is typically ignored. The receiver should be
in Idle state after the last byte was transmitted.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-add-bytes</span> <span class="pre">&lt;num&gt;</span></code></dt>
<dd><p class="first">Append <code class="docutils literal notranslate"><span class="pre">&lt;num&gt;</span></code> (1-255) spurious bytes to the message. The extra bytes
have the value of the byte position in the message. So if you transmit a
two byte message (e.g. a Get CEC Version message) and add 2 bytes, then
the full message received by the remote CEC adapter is
<code class="docutils literal notranslate"><span class="pre">0x40</span> <span class="pre">0x9f</span> <span class="pre">0x02</span> <span class="pre">0x03</span></code>.</p>
<p class="last">This command can be used to test buffer overflows in the receiver. E.g.
what does it do when it receives more than the maximum message size of 16
bytes.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-remove-byte</span></code></dt>
<dd>Drop the last byte from the message, provided the message is at least
two bytes long. The receiver should ignore messages that are too short.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-short-bit</span> <span class="pre">&lt;bit&gt;</span></code></dt>
<dd><p class="first">Make this bit period shorter than allowed. The bit position cannot be
an Ack bit.  If &lt;op&gt; specifies a specific CEC opcode then the bit position
must be at least 18, otherwise the opcode hasn’t been received yet.
Normally the period of a data bit is between 2.05 and 2.75 milliseconds.
With this command the period of this bit is 1.8 milliseconds, this is
done by reducing the time the CEC bus is high. This bit period is less
than is allowed and the receiver should respond with a Low Drive
condition.</p>
<p class="last">This command is ignored for 0 bits in bit positions 0 to 3. This is
because the receiver also looks for an Arbitration Lost condition in
those first four bits and it is undefined what will happen if it
sees a too-short 0 bit.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-long-bit</span> <span class="pre">&lt;bit&gt;</span></code></dt>
<dd><p class="first">Make this bit period longer than is valid. The bit position cannot be
an Ack bit.  If &lt;op&gt; specifies a specific CEC opcode then the bit position
must be at least 18, otherwise the opcode hasn’t been received yet.
Normally the period of a data bit is between 2.05 and 2.75 milliseconds.
With this command the period of this bit is 2.9 milliseconds, this is
done by increasing the time the CEC bus is high.</p>
<p>Even though this bit period is longer than is valid it is undefined what
a receiver will do. It might just accept it, or it might time out and
return to Idle state. Unfortunately the CEC specification is silent about
this.</p>
<p class="last">This command is ignored for 0 bits in bit positions 0 to 3. This is
because the receiver also looks for an Arbitration Lost condition in
those first four bits and it is undefined what will happen if it
sees a too-long 0 bit.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-short-start</span></code></dt>
<dd>Make this start bit period shorter than allowed. Normally the period of
a start bit is between 4.3 and 4.7 milliseconds. With this command the
period of the start bit is 4.1 milliseconds, this is done by reducing
the time the CEC bus is high. This start bit period is less than is
allowed and the receiver should return to Idle state when this is detected.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-long-start</span></code></dt>
<dd><p class="first">Make this start bit period longer than is valid. Normally the period of
a start bit is between 4.3 and 4.7 milliseconds. With this command the
period of the start bit is 5 milliseconds, this is done by increasing
the time the CEC bus is high. This start bit period is more than is
valid and the receiver should return to Idle state when this is detected.</p>
<p class="last">Even though this start bit period is longer than is valid it is undefined
what a receiver will do. It might just accept it, or it might time out and
return to Idle state. Unfortunately the CEC specification is silent about
this.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-last-bit</span> <span class="pre">&lt;bit&gt;</span></code></dt>
<dd>Just stop transmitting after this bit.  If &lt;op&gt; specifies a specific CEC
opcode then the bit position must be at least 18, otherwise the opcode
hasn’t been received yet. This command can be used to test how the receiver
reacts when a message just suddenly stops. It should time out and go back
to Idle state.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-low-drive</span> <span class="pre">&lt;bit&gt;</span></code></dt>
<dd>Force a Low Drive condition at this bit position. If &lt;op&gt; specifies a
specific CEC opcode then the bit position must be at least 18, otherwise
the opcode hasn’t been received yet. This can be used to test how the
receiver handles Low Drive conditions. Note that if this happens at bit
positions 0-3 the receiver can interpret this as an Arbitration Lost
condition. This is implementation dependent.</dd>
</dl>
</div>
<div class="section" id="custom-pulses">
<h2>3.5. Custom Pulses<a class="headerlink" href="#custom-pulses" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">tx-custom-low-usecs</span> <span class="pre">&lt;usecs&gt;</span></code></dt>
<dd>This defines the duration in microseconds that the custom pulse pulls
the CEC line low. The default is 1000 microseconds.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tx-custom-high-usecs</span> <span class="pre">&lt;usecs&gt;</span></code></dt>
<dd>This defines the duration in microseconds that the custom pulse keeps the
CEC line high (unless another CEC adapter pulls it low in that time).
The default is 1000 microseconds. The total period of the custom pulse is
<code class="docutils literal notranslate"><span class="pre">tx-custom-low-usecs</span> <span class="pre">+</span> <span class="pre">tx-custom-high-usecs</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-custom-bit</span> <span class="pre">&lt;bit&gt;</span></code></dt>
<dd>Send the custom bit instead of a regular data bit. The bit position cannot
be an Ack bit.  If &lt;op&gt; specifies a specific CEC opcode then the bit
position must be at least 18, otherwise the opcode hasn’t been received yet.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;op&gt;[,&lt;mode&gt;]</span> <span class="pre">tx-custom-start</span></code></dt>
<dd>Send the custom bit instead of a regular start bit.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tx-custom-pulse</span></code></dt>
<dd>Transmit a single custom pulse as soon as the CEC bus is idle.</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cec-header.html" class="btn btn-neutral float-right" title="4. CEC Header File" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cec-ioc-receive.html" class="btn btn-neutral float-left" title="2.10. ioctls CEC_RECEIVE and CEC_TRANSMIT" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>