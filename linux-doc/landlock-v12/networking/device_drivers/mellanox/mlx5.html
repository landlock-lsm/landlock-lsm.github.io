

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mellanox ConnectX(R) mlx5 core VPI Network Driver &mdash; The Linux Kernel 5.2.0+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Netronome Flow Processor (NFP) Kernel Drivers" href="../netronome/nfp.html" />
    <link rel="prev" title="Linux kernel driver for Compute Engine Virtual Ethernet (gve):" href="../google/gve.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.4.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ioctl/index.html">IOCTLs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../netdev-FAQ.html">netdev FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../batman-adv.html">batman-adv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Vendor Device Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../freescale/dpaa2/index.html">DPAA2 Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/e100.html">Linux* Base Driver for the Intel(R) PRO/100 Family of Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/e1000.html">Linux* Base Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/e1000e.html">Linux* Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/fm10k.html">Linux* Base Driver for Intel(R) Ethernet Multi-host Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/igb.html">Linux* Base Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/igbvf.html">Linux* Base Virtual Function Driver for Intel(R) 1G Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/ixgb.html">Linux Base Driver for 10 Gigabit Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/ixgbe.html">Linux* Base Driver for the Intel(R) Ethernet 10 Gigabit PCI Express Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/ixgbevf.html">Linux* Base Virtual Function Driver for Intel(R) 10G Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/i40e.html">Linux* Base Driver for the Intel(R) Ethernet Controller 700 Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/iavf.html">Linux* Base Driver for Intel(R) Ethernet Adaptive Virtual Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intel/ice.html">Linux* Base Driver for the Intel(R) Ethernet Connection E800 Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../google/gve.html">Linux kernel driver for Compute Engine Virtual Ethernet (gve):</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mellanox ConnectX(R) mlx5 core VPI Network Driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contents">Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-the-driver-and-kconfig-options">Enabling the driver and kconfig options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#devlink-info">Devlink info</a></li>
<li class="toctree-l4"><a class="reference internal" href="#devlink-parameters">Devlink parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#devlink-health-reporters">Devlink health reporters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mlx5-tracepoints">mlx5 tracepoints</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../netronome/nfp.html">Netronome Flow Processor (NFP) Kernel Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pensando/ionic.html">Linux* Driver for the Pensando(R) Ethernet adapter family</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devlink-info-versions.html">Devlink info versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devlink-trap.html">Devlink Trap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devlink-trap-netdevsim.html">Devlink Trap netdevsim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ieee802154.html">IEEE 802.15.4 Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../j1939.html">J1939 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../z8530book.html">Z8530 Programming Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sfp-phylink.html">phylink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tls.html">Kernel TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tls-offload.html">Kernel TLS offload</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Linux Networking Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Vendor Device Drivers</a> &raquo;</li>
        
      <li>Mellanox ConnectX(R) mlx5 core VPI Network Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/networking/device_drivers/mellanox/mlx5.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mellanox-connectx-r-mlx5-core-vpi-network-driver">
<h1>Mellanox ConnectX(R) mlx5 core VPI Network Driver<a class="headerlink" href="#mellanox-connectx-r-mlx5-core-vpi-network-driver" title="Permalink to this headline">¶</a></h1>
<p>Copyright (c) 2019, Mellanox Technologies LTD.</p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#enabling-the-driver-and-kconfig-options">Enabling the driver and kconfig options</a></li>
<li><a class="reference internal" href="#devlink-info">Devlink info</a></li>
<li><a class="reference internal" href="#devlink-parameters">Devlink parameters</a></li>
<li><a class="reference internal" href="#devlink-health-reporters">Devlink health reporters</a></li>
<li><a class="reference internal" href="#mlx5-tracepoints">mlx5 tracepoints</a></li>
</ul>
</div>
<div class="section" id="enabling-the-driver-and-kconfig-options">
<h2>Enabling the driver and kconfig options<a class="headerlink" href="#enabling-the-driver-and-kconfig-options" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">mlx5 core is modular and most of the major mlx5 core driver features can be selected (compiled in/out)</div>
<div class="line">at build time via kernel Kconfig flags.</div>
<div class="line">Basic features, ethernet net device rx/tx offloads and XDP, are available with the most basic flags</div>
<div class="line">CONFIG_MLX5_CORE=y/m and CONFIG_MLX5_CORE_EN=y.</div>
<div class="line">For the list of advanced features please see below.</div>
</div>
<p><strong>CONFIG_MLX5_CORE=(y/m/n)</strong> (module mlx5_core.ko)</p>
<div class="line-block">
<div class="line">The driver can be enabled by choosing CONFIG_MLX5_CORE=y/m in kernel config.</div>
<div class="line">This will provide mlx5 core driver for mlx5 ulps to interface with (mlx5e, mlx5_ib).</div>
</div>
<p><strong>CONFIG_MLX5_CORE_EN=(y/n)</strong></p>
<div class="line-block">
<div class="line">Choosing this option will allow basic ethernet netdevice support with all of the standard rx/tx offloads.</div>
<div class="line">mlx5e is the mlx5 ulp driver which provides netdevice kernel interface, when chosen, mlx5e will be</div>
<div class="line">built-in into mlx5_core.ko.</div>
</div>
<p><strong>CONFIG_MLX5_EN_ARFS=(y/n)</strong></p>
<div class="line-block">
<div class="line">Enables Hardware-accelerated receive flow steering (arfs) support, and ntuple filtering.</div>
<div class="line"><a class="reference external" href="https://community.mellanox.com/s/article/howto-configure-arfs-on-connectx-4">https://community.mellanox.com/s/article/howto-configure-arfs-on-connectx-4</a></div>
</div>
<p><strong>CONFIG_MLX5_EN_RXNFC=(y/n)</strong></p>
<div class="line-block">
<div class="line">Enables ethtool receive network flow classification, which allows user defined</div>
<div class="line">flow rules to direct traffic into arbitrary rx queue via ethtool set/get_rxnfc API.</div>
</div>
<p><strong>CONFIG_MLX5_CORE_EN_DCB=(y/n)</strong>:</p>
<div class="line-block">
<div class="line">Enables <a class="reference external" href="https://community.mellanox.com/s/article/howto-auto-config-pfc-and-ets-on-connectx-4-via-lldp-dcbx">Data Center Bridging (DCB) Support</a>.</div>
</div>
<p><strong>CONFIG_MLX5_MPFS=(y/n)</strong></p>
<div class="line-block">
<div class="line">Ethernet Multi-Physical Function Switch (MPFS) support in ConnectX NIC.</div>
<div class="line">MPFs is required for when <a class="reference external" href="http://www.mellanox.com/page/multihost">Multi-Host</a> configuration is enabled to allow passing</div>
<div class="line">user configured unicast MAC addresses to the requesting PF.</div>
</div>
<p><strong>CONFIG_MLX5_ESWITCH=(y/n)</strong></p>
<div class="line-block">
<div class="line">Ethernet SRIOV E-Switch support in ConnectX NIC. E-Switch provides internal SRIOV packet steering</div>
<div class="line">and switching for the enabled VFs and PF in two available modes:</div>
<div class="line-block">
<div class="line">1) <a class="reference external" href="https://community.mellanox.com/s/article/howto-configure-sr-iov-for-connectx-4-connectx-5-with-kvm--ethernet-x">Legacy SRIOV mode (L2 mac vlan steering based)</a>.</div>
<div class="line">2) <a class="reference external" href="https://www.mellanox.com/related-docs/prod_software/ASAP2_Hardware_Offloading_for_vSwitches_User_Manual_v4.4.pdf">Switchdev mode (eswitch offloads)</a>.</div>
</div>
</div>
<p><strong>CONFIG_MLX5_CORE_IPOIB=(y/n)</strong></p>
<div class="line-block">
<div class="line">IPoIB offloads &amp; acceleration support.</div>
<div class="line">Requires CONFIG_MLX5_CORE_EN to provide an accelerated interface for the rdma</div>
<div class="line">IPoIB ulp netdevice.</div>
</div>
<p><strong>CONFIG_MLX5_FPGA=(y/n)</strong></p>
<div class="line-block">
<div class="line">Build support for the Innova family of network cards by Mellanox Technologies.</div>
<div class="line">Innova network cards are comprised of a ConnectX chip and an FPGA chip on one board.</div>
<div class="line">If you select this option, the mlx5_core driver will include the Innova FPGA core and allow</div>
<div class="line">building sandbox-specific client drivers.</div>
</div>
<p><strong>CONFIG_MLX5_EN_IPSEC=(y/n)</strong></p>
<div class="line-block">
<div class="line">Enables <a class="reference external" href="http://www.mellanox.com/related-docs/prod_software/Mellanox_Innova_IPsec_Ethernet_Adapter_Card_User_Manual.pdf">IPSec XFRM cryptography-offload accelaration</a>.</div>
</div>
<p><strong>CONFIG_MLX5_EN_TLS=(y/n)</strong></p>
<div class="line-block">
<div class="line">TLS cryptography-offload accelaration.</div>
</div>
<p><strong>CONFIG_MLX5_INFINIBAND=(y/n/m)</strong> (module mlx5_ib.ko)</p>
<div class="line-block">
<div class="line">Provides low-level InfiniBand/RDMA and <a class="reference external" href="https://community.mellanox.com/s/article/recommended-network-configuration-examples-for-roce-deployment">RoCE</a> support.</div>
</div>
<p><strong>External options</strong> ( Choose if the corresponding mlx5 feature is required )</p>
<ul class="simple">
<li>CONFIG_PTP_1588_CLOCK: When chosen, mlx5 ptp support will be enabled</li>
<li>CONFIG_VXLAN: When chosen, mlx5 vxaln support will be enabled.</li>
<li>CONFIG_MLXFW: When chosen, mlx5 firmware flashing support will be enabled (via devlink and ethtool).</li>
</ul>
</div>
<div class="section" id="devlink-info">
<h2>Devlink info<a class="headerlink" href="#devlink-info" title="Permalink to this headline">¶</a></h2>
<p>The devlink info reports the running and stored firmware versions on device.
It also prints the device PSID which represents the HCA board type ID.</p>
<p>User command example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev info pci/0000:00:06.0
   pci/0000:00:06.0:
   driver mlx5_core
   versions:
      fixed:
         fw.psid MT_0000000009
      running:
         fw.version 16.26.0100
      stored:
         fw.version 16.26.0100
</pre></div>
</div>
</div>
<div class="section" id="devlink-parameters">
<h2>Devlink parameters<a class="headerlink" href="#devlink-parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flow-steering-mode-device-flow-steering-mode">
<h3>flow_steering_mode: Device flow steering mode<a class="headerlink" href="#flow-steering-mode-device-flow-steering-mode" title="Permalink to this headline">¶</a></h3>
<p>The flow steering mode parameter controls the flow steering mode of the driver.
Two modes are supported:
1. ‘dmfs’ - Device managed flow steering.
2. ‘smfs  - Software/Driver managed flow steering.</p>
<p>In DMFS mode, the HW steering entities are created and managed through the
Firmware.
In SMFS mode, the HW steering entities are created and managed though by
the driver directly into Hardware without firmware intervention.</p>
<p>SMFS mode is faster and provides better rule inserstion rate compared to default DMFS mode.</p>
<p>User command examples:</p>
<ul>
<li><p class="first">Set SMFS flow steering mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param set pci/0000:06:00.0 name flow_steering_mode value &quot;smfs&quot; cmode runtime
</pre></div>
</div>
</li>
<li><p class="first">Read device flow steering mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param show pci/0000:06:00.0 name flow_steering_mode
  pci/0000:06:00.0:
  name flow_steering_mode type driver-specific
  values:
     cmode runtime value smfs
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="devlink-health-reporters">
<h2>Devlink health reporters<a class="headerlink" href="#devlink-health-reporters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tx-reporter">
<h3>tx reporter<a class="headerlink" href="#tx-reporter" title="Permalink to this headline">¶</a></h3>
<p>The tx reporter is responsible for reporting and recovering of the following two error scenarios:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>TX timeout</dt>
<dd>Report on kernel tx timeout detection.
Recover by searching lost interrupts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>TX error completion</dt>
<dd>Report on error tx completion.
Recover by flushing the TX queue and reset it.</dd>
</dl>
</li>
</ul>
<p>TX reporter also support on demand diagnose callback, on which it provides
real time information of its send queues status.</p>
<p>User commands examples:</p>
<ul>
<li><p class="first">Diagnose send queues status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health diagnose pci/0000:82:00.0 reporter tx
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command has valid output only when interface is up, otherwise the command has empty output.</p>
<ul>
<li><p class="first">Show number of tx errors indicated, number of recover flows ended successfully,
is autorecover enabled and graceful period from last recover:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health show pci/0000:82:00.0 reporter tx
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="rx-reporter">
<h3>rx reporter<a class="headerlink" href="#rx-reporter" title="Permalink to this headline">¶</a></h3>
<p>The rx reporter is responsible for reporting and recovering of the following two error scenarios:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>RX queues initialization (population) timeout</dt>
<dd>RX queues descriptors population on ring initialization is done in
napi context via triggering an irq, in case of a failure to get
the minimum amount of descriptors, a timeout would occur and it
could be recoverable by polling the EQ (Event Queue).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>RX completions with errors (reported by HW on interrupt context)</dt>
<dd>Report on rx completion error.
Recover (if needed) by flushing the related queue and reset it.</dd>
</dl>
</li>
</ul>
<p>RX reporter also supports on demand diagnose callback, on which it
provides real time information of its receive queues status.</p>
<ul>
<li><p class="first">Diagnose rx queues status, and corresponding completion queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health diagnose pci/0000:82:00.0 reporter rx
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command has valid output only when interface is up, otherwise the command has empty output.</p>
<ul>
<li><p class="first">Show number of rx errors indicated, number of recover flows ended successfully,
is autorecover enabled and graceful period from last recover:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health show pci/0000:82:00.0 reporter rx
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="fw-reporter">
<h3>fw reporter<a class="headerlink" href="#fw-reporter" title="Permalink to this headline">¶</a></h3>
<p>The fw reporter implements diagnose and dump callbacks.
It follows symptoms of fw error such as fw syndrome by triggering
fw core dump and storing it into the dump buffer.
The fw reporter diagnose command can be triggered any time by the user to check
current fw status.</p>
<p>User commands examples:</p>
<ul>
<li><p class="first">Check fw heath status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health diagnose pci/0000:82:00.0 reporter fw
</pre></div>
</div>
</li>
<li><p class="first">Read FW core dump if already stored or trigger new one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health dump show pci/0000:82:00.0 reporter fw
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command can run only on the PF which has fw tracer ownership,
running it on other PF or any VF will return “Operation not permitted”.</p>
</div>
<div class="section" id="fw-fatal-reporter">
<h3>fw fatal reporter<a class="headerlink" href="#fw-fatal-reporter" title="Permalink to this headline">¶</a></h3>
<p>The fw fatal reporter implements dump and recover callbacks.
It follows fatal errors indications by CR-space dump and recover flow.
The CR-space dump uses vsc interface which is valid even if the FW command
interface is not functional, which is the case in most FW fatal errors.
The recover function runs recover flow which reloads the driver and triggers fw
reset if needed.</p>
<p>User commands examples:</p>
<ul>
<li><p class="first">Run fw recover flow manually:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health recover pci/0000:82:00.0 reporter fw_fatal
</pre></div>
</div>
</li>
<li><p class="first">Read FW CR-space dump if already strored or trigger new one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health dump show pci/0000:82:00.1 reporter fw_fatal
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command can run only on PF.</p>
</div>
</div>
<div class="section" id="mlx5-tracepoints">
<h2>mlx5 tracepoints<a class="headerlink" href="#mlx5-tracepoints" title="Permalink to this headline">¶</a></h2>
<p>mlx5 driver provides internal trace points for tracking and debugging using
kernel tracepoints interfaces (refer to Documentation/trace/ftrase.rst).</p>
<p>For the list of support mlx5 events check /sys/kernel/debug/tracing/events/mlx5/</p>
<p>tc and eswitch offloads tracepoints:</p>
<ul>
<li><p class="first">mlx5e_configure_flower: trace flower filter actions and cookies offloaded to mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_configure_flower &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
tc-6535  [019] ...1  2672.404466: mlx5e_configure_flower: cookie=0000000067874a55 actions= REDIRECT
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_delete_flower: trace flower filter actions and cookies deleted from mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_delete_flower &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
tc-6569  [010] .N.1  2686.379075: mlx5e_delete_flower: cookie=0000000067874a55 actions= NULL
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_stats_flower: trace flower stats request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_stats_flower &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
tc-6546  [010] ...1  2679.704889: mlx5e_stats_flower: cookie=0000000060eb3d6a bytes=0 packets=0 lastused=4295560217
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_tc_update_neigh_used_value: trace tunnel rule neigh update value offloaded to mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_tc_update_neigh_used_value &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u48:4-8806  [009] ...1 55117.882428: mlx5e_tc_update_neigh_used_value: netdev: ens1f0 IPv4: 1.1.1.10 IPv6: ::ffff:1.1.1.10 neigh_used=1
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_rep_neigh_update: trace neigh update tasks scheduled due to neigh state change events:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_rep_neigh_update &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u48:7-2221  [009] ...1  1475.387435: mlx5e_rep_neigh_update: netdev: ens1f0 MAC: 24:8a:07:9a:17:9a IPv4: 1.1.1.10 IPv6: ::ffff:1.1.1.10 neigh_connected=1
</pre></div>
</div>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../netronome/nfp.html" class="btn btn-neutral float-right" title="Netronome Flow Processor (NFP) Kernel Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../google/gve.html" class="btn btn-neutral float-left" title="Linux kernel driver for Compute Engine Virtual Ethernet (gve):" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>