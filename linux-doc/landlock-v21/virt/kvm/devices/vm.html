

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generic vm interface &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="XICS interrupt controller" href="xics.html" />
    <link rel="prev" title="VFIO virtual device" href="vfio.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.9.0-rc8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Virtualization Support</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">KVM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../api.html">The Definitive KVM (Kernel-based Virtual Machine) API Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../amd-memory-encryption.html">Secure Encrypted Virtualization (SEV)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpuid.html">KVM CPUID bits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../halt-polling.html">The KVM halt polling system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hypercalls.html">Linux KVM Hypercall</a></li>
<li class="toctree-l3"><a class="reference internal" href="../locking.html">KVM Lock Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmu.html">The x86 kvm shadow mmu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../msr.html">KVM-specific MSRs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nested-vmx.html">Nested VMX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ppc-pv.html">The PPC KVM paravirtual interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../s390-diag.html">The s390 DIAGNOSE call on KVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../s390-pv.html">s390 (IBM Z) Ultravisor and Protected VMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../s390-pv-boot.html">s390 (IBM Z) Boot/IPL of Protected VMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../timekeeping.html">Timekeeping Virtualization for X86-Based Architectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vcpu-requests.html">KVM VCPU Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../review-checklist.html">Review checklist for kvm patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arm/index.html">ARM</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Devices</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="arm-vgic-its.html">ARM Virtual Interrupt Translation Service (ITS)</a></li>
<li class="toctree-l4"><a class="reference internal" href="arm-vgic.html">ARM Virtual Generic Interrupt Controller v2 (VGIC)</a></li>
<li class="toctree-l4"><a class="reference internal" href="arm-vgic-v3.html">ARM Virtual Generic Interrupt Controller v3 and later (VGICv3)</a></li>
<li class="toctree-l4"><a class="reference internal" href="mpic.html">MPIC interrupt controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="s390_flic.html">FLIC (floating interrupt controller)</a></li>
<li class="toctree-l4"><a class="reference internal" href="vcpu.html">Generic vcpu interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="vfio.html">VFIO virtual device</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Generic vm interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="xics.html">XICS interrupt controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="xive.html">POWER9 eXternal Interrupt Virtualization Engine (XIVE Gen1)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../running-nested-guests.html">Running nested guests with KVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../uml/user_mode_linux.html">User Mode Linux HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../paravirt_ops.html">Paravirt_ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guest-halt-polling.html">Guest halt polling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Linux Virtualization Support</a> &raquo;</li>
        
          <li><a href="../index.html">KVM</a> &raquo;</li>
        
          <li><a href="index.html">Devices</a> &raquo;</li>
        
      <li>Generic vm interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/virt/kvm/devices/vm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generic-vm-interface">
<h1>Generic vm interface<a class="headerlink" href="#generic-vm-interface" title="Permalink to this headline">¶</a></h1>
<p>The virtual machine “device” also accepts the ioctls KVM_SET_DEVICE_ATTR,
KVM_GET_DEVICE_ATTR, and KVM_HAS_DEVICE_ATTR. The interface uses the same
struct kvm_device_attr as other devices, but targets VM-wide settings
and controls.</p>
<p>The groups and attributes per virtual machine, if any, are architecture
specific.</p>
<div class="section" id="group-kvm-s390-vm-mem-ctrl">
<h2>1. GROUP: KVM_S390_VM_MEM_CTRL<a class="headerlink" href="#group-kvm-s390-vm-mem-ctrl" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Architectures:</th><td class="field-body">s390</td>
</tr>
</tbody>
</table>
<div class="section" id="attribute-kvm-s390-vm-mem-enable-cmma">
<h3>1.1. ATTRIBUTE: KVM_S390_VM_MEM_ENABLE_CMMA<a class="headerlink" href="#attribute-kvm-s390-vm-mem-enable-cmma" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EBUSY if a vcpu is already defined, otherwise 0</td>
</tr>
</tbody>
</table>
<p>Enables Collaborative Memory Management Assist (CMMA) for the virtual machine.</p>
</div>
<div class="section" id="attribute-kvm-s390-vm-mem-clr-cmma">
<h3>1.2. ATTRIBUTE: KVM_S390_VM_MEM_CLR_CMMA<a class="headerlink" href="#attribute-kvm-s390-vm-mem-clr-cmma" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EINVAL if CMMA was not enabled;
0 otherwise</td>
</tr>
</tbody>
</table>
<p>Clear the CMMA status for all guest pages, so any pages the guest marked
as unused are again used any may not be reclaimed by the host.</p>
</div>
<div class="section" id="attribute-kvm-s390-vm-mem-limit-size">
<h3>1.3. ATTRIBUTE KVM_S390_VM_MEM_LIMIT_SIZE<a class="headerlink" href="#attribute-kvm-s390-vm-mem-limit-size" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">in attr-&gt;addr the address for the new limit of guest memory</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible;
-EINVAL if the virtual machine is of type UCONTROL;
-E2BIG if the given guest memory is to big for that machine;
-EBUSY if a vcpu is already defined;
-ENOMEM if not enough memory is available for a new shadow guest mapping;
0 otherwise.</td>
</tr>
</tbody>
</table>
<p>Allows userspace to query the actual limit and set a new limit for
the maximum guest memory size. The limit will be rounded up to
2048 MB, 4096 GB, 8192 TB respectively, as this limit is governed by
the number of page table levels. In the case that there is no limit we will set
the limit to KVM_S390_NO_MEM_LIMIT (U64_MAX).</p>
</div>
</div>
<div class="section" id="group-kvm-s390-vm-cpu-model">
<h2>2. GROUP: KVM_S390_VM_CPU_MODEL<a class="headerlink" href="#group-kvm-s390-vm-cpu-model" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Architectures:</th><td class="field-body">s390</td>
</tr>
</tbody>
</table>
<div class="section" id="attribute-kvm-s390-vm-cpu-machine-r-o">
<h3>2.1. ATTRIBUTE: KVM_S390_VM_CPU_MACHINE (r/o)<a class="headerlink" href="#attribute-kvm-s390-vm-cpu-machine-r-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to retrieve machine and kvm specific cpu related information:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_s390_vm_cpu_machine {
     __u64 cpuid;           # CPUID of host
     __u32 ibc;             # IBC level range offered by host
     __u8  pad[4];
     __u64 fac_mask[256];   # set of cpu facilities enabled by KVM
     __u64 fac_list[256];   # set of cpu facilities offered by host
}
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of buffer to store the machine related cpu data
of type struct kvm_s390_vm_cpu_machine*</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
-ENOMEM if not enough memory is available to process the ioctl;
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="attribute-kvm-s390-vm-cpu-processor-r-w">
<h2>2.2. ATTRIBUTE: KVM_S390_VM_CPU_PROCESSOR (r/w)<a class="headerlink" href="#attribute-kvm-s390-vm-cpu-processor-r-w" title="Permalink to this headline">¶</a></h2>
<p>Allows user space to retrieve or request to change cpu related information for a vcpu:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_s390_vm_cpu_processor {
     __u64 cpuid;           # CPUID currently (to be) used by this vcpu
     __u16 ibc;             # IBC level currently (to be) used by this vcpu
     __u8  pad[6];
     __u64 fac_list[256];   # set of cpu facilities currently (to be) used
                            # by this vcpu
}
</pre></div>
</div>
<p>KVM does not enforce or limit the cpu model data in any form. Take the information
retrieved by means of KVM_S390_VM_CPU_MACHINE as hint for reasonable configuration
setups. Instruction interceptions triggered by additionally set facility bits that
are not handled by KVM need to by imlemented in the VM driver code.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of buffer to store/set the processor related cpu
data of type struct kvm_s390_vm_cpu_processor*.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EBUSY in case 1 or more vcpus are already activated (only in write case);
-EFAULT if the given address is not accessible from kernel space;
-ENOMEM if not enough memory is available to process the ioctl;
0 in case of success.</td>
</tr>
</tbody>
</table>
<div class="section" id="attribute-kvm-s390-vm-cpu-machine-feat-r-o">
<span id="kvm-s390-vm-cpu-machine-feat"></span><h3>2.3. ATTRIBUTE: KVM_S390_VM_CPU_MACHINE_FEAT (r/o)<a class="headerlink" href="#attribute-kvm-s390-vm-cpu-machine-feat-r-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to retrieve available cpu features. A feature is available if
provided by the hardware and supported by kvm. In theory, cpu features could
even be completely emulated by kvm.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_s390_vm_cpu_feat {
      __u64 feat[16]; # Bitmap (1 = feature available), MSB 0 bit numbering
};
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer to load the feature list from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-cpu-processor-feat-r-w">
<h3>2.4. ATTRIBUTE: KVM_S390_VM_CPU_PROCESSOR_FEAT (r/w)<a class="headerlink" href="#attribute-kvm-s390-vm-cpu-processor-feat-r-w" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to retrieve or change enabled cpu features for all VCPUs of a
VM. Features that are not available cannot be enabled.</p>
<p>See <a class="reference internal" href="#kvm-s390-vm-cpu-machine-feat"><span class="std std-ref">2.3. ATTRIBUTE: KVM_S390_VM_CPU_MACHINE_FEAT (r/o)</span></a> for
a description of the parameter struct.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer to store/load the feature list from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
-EINVAL if a cpu feature that is not available is to be enabled;
-EBUSY if at least one VCPU has already been defined;
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-cpu-machine-subfunc-r-o">
<span id="kvm-s390-vm-cpu-machine-subfunc"></span><h3>2.5. ATTRIBUTE: KVM_S390_VM_CPU_MACHINE_SUBFUNC (r/o)<a class="headerlink" href="#attribute-kvm-s390-vm-cpu-machine-subfunc-r-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to retrieve available cpu subfunctions without any filtering
done by a set IBC. These subfunctions are indicated to the guest VCPU via
query or “test bit” subfunctions and used e.g. by cpacf functions, plo and ptff.</p>
<p>A subfunction block is only valid if KVM_S390_VM_CPU_MACHINE contains the
STFL(E) bit introducing the affected instruction. If the affected instruction
indicates subfunctions via a “query subfunction”, the response block is
contained in the returned struct. If the affected instruction
indicates subfunctions via a “test bit” mechanism, the subfunction codes are
contained in the returned struct in MSB 0 bit numbering.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_s390_vm_cpu_subfunc {
     u8 plo[32];           # always valid (ESA/390 feature)
     u8 ptff[16];          # valid with TOD-clock steering
     u8 kmac[16];          # valid with Message-Security-Assist
     u8 kmc[16];           # valid with Message-Security-Assist
     u8 km[16];            # valid with Message-Security-Assist
     u8 kimd[16];          # valid with Message-Security-Assist
     u8 klmd[16];          # valid with Message-Security-Assist
     u8 pckmo[16];         # valid with Message-Security-Assist-Extension 3
     u8 kmctr[16];         # valid with Message-Security-Assist-Extension 4
     u8 kmf[16];           # valid with Message-Security-Assist-Extension 4
     u8 kmo[16];           # valid with Message-Security-Assist-Extension 4
     u8 pcc[16];           # valid with Message-Security-Assist-Extension 4
     u8 ppno[16];          # valid with Message-Security-Assist-Extension 5
     u8 kma[16];           # valid with Message-Security-Assist-Extension 8
     u8 kdsa[16];          # valid with Message-Security-Assist-Extension 9
     u8 reserved[1792];    # reserved for future instructions
};
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer to load the subfunction blocks from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-cpu-processor-subfunc-r-w">
<h3>2.6. ATTRIBUTE: KVM_S390_VM_CPU_PROCESSOR_SUBFUNC (r/w)<a class="headerlink" href="#attribute-kvm-s390-vm-cpu-processor-subfunc-r-w" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to retrieve or change cpu subfunctions to be indicated for
all VCPUs of a VM. This attribute will only be available if kernel and
hardware support are in place.</p>
<p>The kernel uses the configured subfunction blocks for indication to
the guest. A subfunction block will only be used if the associated STFL(E) bit
has not been disabled by user space (so the instruction to be queried is
actually available for the guest).</p>
<p>As long as no data has been written, a read will fail. The IBC will be used
to determine available subfunctions in this case, this will guarantee backward
compatibility.</p>
<p>See <a class="reference internal" href="#kvm-s390-vm-cpu-machine-subfunc"><span class="std std-ref">2.5. ATTRIBUTE: KVM_S390_VM_CPU_MACHINE_SUBFUNC (r/o)</span></a> for a
description of the parameter struct.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer to store/load the subfunction blocks from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
-EINVAL when reading, if there was no write yet;
-EBUSY if at least one VCPU has already been defined;
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="group-kvm-s390-vm-tod">
<h2>3. GROUP: KVM_S390_VM_TOD<a class="headerlink" href="#group-kvm-s390-vm-tod" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Architectures:</th><td class="field-body">s390</td>
</tr>
</tbody>
</table>
<div class="section" id="attribute-kvm-s390-vm-tod-high">
<h3>3.1. ATTRIBUTE: KVM_S390_VM_TOD_HIGH<a class="headerlink" href="#attribute-kvm-s390-vm-tod-high" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to set/get the TOD clock extension (u8) (superseded by
KVM_S390_VM_TOD_EXT).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer in user space to store the data (u8) to</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
-EINVAL if setting the TOD clock extension to != 0 is not supported</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-tod-low">
<h3>3.2. ATTRIBUTE: KVM_S390_VM_TOD_LOW<a class="headerlink" href="#attribute-kvm-s390-vm-tod-low" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to set/get bits 0-63 of the TOD clock register as defined in
the POP (u64).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer in user space to store the data (u64) to</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-tod-ext">
<h3>3.3. ATTRIBUTE: KVM_S390_VM_TOD_EXT<a class="headerlink" href="#attribute-kvm-s390-vm-tod-ext" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to set/get bits 0-63 of the TOD clock register as defined in
the POP (u64). If the guest CPU model supports the TOD clock extension (u8), it
also allows user space to get/set it. If the guest CPU model does not support
it, it is stored as 0 and not allowed to be set to a value != 0.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer in user space to store the data
(kvm_s390_vm_tod_clock) to</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
-EINVAL if setting the TOD clock extension to != 0 is not supported</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="group-kvm-s390-vm-crypto">
<h2>4. GROUP: KVM_S390_VM_CRYPTO<a class="headerlink" href="#group-kvm-s390-vm-crypto" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Architectures:</th><td class="field-body">s390</td>
</tr>
</tbody>
</table>
<div class="section" id="attribute-kvm-s390-vm-crypto-enable-aes-kw-w-o">
<h3>4.1. ATTRIBUTE: KVM_S390_VM_CRYPTO_ENABLE_AES_KW (w/o)<a class="headerlink" href="#attribute-kvm-s390-vm-crypto-enable-aes-kw-w-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to enable aes key wrapping, including generating a new
wrapping key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-crypto-enable-dea-kw-w-o">
<h3>4.2. ATTRIBUTE: KVM_S390_VM_CRYPTO_ENABLE_DEA_KW (w/o)<a class="headerlink" href="#attribute-kvm-s390-vm-crypto-enable-dea-kw-w-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to enable dea key wrapping, including generating a new
wrapping key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-crypto-disable-aes-kw-w-o">
<h3>4.3. ATTRIBUTE: KVM_S390_VM_CRYPTO_DISABLE_AES_KW (w/o)<a class="headerlink" href="#attribute-kvm-s390-vm-crypto-disable-aes-kw-w-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to disable aes key wrapping, clearing the wrapping key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-crypto-disable-dea-kw-w-o">
<h3>4.4. ATTRIBUTE: KVM_S390_VM_CRYPTO_DISABLE_DEA_KW (w/o)<a class="headerlink" href="#attribute-kvm-s390-vm-crypto-disable-dea-kw-w-o" title="Permalink to this headline">¶</a></h3>
<p>Allows user space to disable dea key wrapping, clearing the wrapping key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="group-kvm-s390-vm-migration">
<h2>5. GROUP: KVM_S390_VM_MIGRATION<a class="headerlink" href="#group-kvm-s390-vm-migration" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Architectures:</th><td class="field-body">s390</td>
</tr>
</tbody>
</table>
<div class="section" id="attribute-kvm-s390-vm-migration-stop-w-o">
<h3>5.1. ATTRIBUTE: KVM_S390_VM_MIGRATION_STOP (w/o)<a class="headerlink" href="#attribute-kvm-s390-vm-migration-stop-w-o" title="Permalink to this headline">¶</a></h3>
<p>Allows userspace to stop migration mode, needed for PGSTE migration.
Setting this attribute when migration mode is not active will have no
effects.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-migration-start-w-o">
<h3>5.2. ATTRIBUTE: KVM_S390_VM_MIGRATION_START (w/o)<a class="headerlink" href="#attribute-kvm-s390-vm-migration-start-w-o" title="Permalink to this headline">¶</a></h3>
<p>Allows userspace to start migration mode, needed for PGSTE migration.
Setting this attribute when migration mode is already active will have
no effects.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">none</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-ENOMEM if there is not enough free memory to start migration mode;
-EINVAL if the state of the VM is invalid (e.g. no memory defined);
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-kvm-s390-vm-migration-status-r-o">
<h3>5.3. ATTRIBUTE: KVM_S390_VM_MIGRATION_STATUS (r/o)<a class="headerlink" href="#attribute-kvm-s390-vm-migration-status-r-o" title="Permalink to this headline">¶</a></h3>
<p>Allows userspace to query the status of migration mode.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body">address of a buffer in user space to store the data (u64) to;
the data itself is either 0 if migration mode is disabled or 1
if it is enabled</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">-EFAULT if the given address is not accessible from kernel space;
0 in case of success.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="xics.html" class="btn btn-neutral float-right" title="XICS interrupt controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="vfio.html" class="btn btn-neutral float-left" title="VFIO virtual device" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>