

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Index Nodes &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.9.0-rc8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Index Nodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/filesystems/ext4/inodes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="index-nodes">
<h1>Index Nodes<a class="headerlink" href="#index-nodes" title="Permalink to this headline">¶</a></h1>
<p>In a regular UNIX filesystem, the inode stores all the metadata
pertaining to the file (time stamps, block maps, extended attributes,
etc), not the directory entry. To find the information associated with a
file, one must traverse the directory files to find the directory entry
associated with a file, then load the inode to find the metadata for
that file. ext4 appears to cheat (for performance reasons) a little bit
by storing a copy of the file type (normally stored in the inode) in the
directory entry. (Compare all this to FAT, which stores all the file
information directly in the directory entry, but does not support hard
links and is in general more seek-happy than ext4 due to its simpler
block allocator and extensive use of linked lists.)</p>
<p>The inode table is a linear array of <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ext4_inode</span></code>. The table is
sized to have enough blocks to store at least
<code class="docutils literal notranslate"><span class="pre">sb.s_inode_size</span> <span class="pre">*</span> <span class="pre">sb.s_inodes_per_group</span></code> bytes. The number of the
block group containing an inode can be calculated as
<code class="docutils literal notranslate"><span class="pre">(inode_number</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">/</span> <span class="pre">sb.s_inodes_per_group</span></code>, and the offset into the
group’s table is <code class="docutils literal notranslate"><span class="pre">(inode_number</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">%</span> <span class="pre">sb.s_inodes_per_group</span></code>. There
is no inode 0.</p>
<p>The inode checksum is calculated against the FS UUID, the inode number,
and the inode structure itself.</p>
<p>The inode table entry is laid out in <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ext4_inode</span></code>.</p>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le16</td>
<td>i_mode</td>
<td>File mode. See the table <a class="reference internal" href="#i-mode">i_mode</a> below.</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>__le16</td>
<td>i_uid</td>
<td>Lower 16-bits of Owner UID.</td>
</tr>
<tr class="row-even"><td>0x4</td>
<td>__le32</td>
<td>i_size_lo</td>
<td>Lower 32-bits of size in bytes.</td>
</tr>
<tr class="row-odd"><td>0x8</td>
<td>__le32</td>
<td>i_atime</td>
<td>Last access time, in seconds since the epoch. However, if the EA_INODE
inode flag is set, this inode stores an extended attribute value and
this field contains the checksum of the value.</td>
</tr>
<tr class="row-even"><td>0xC</td>
<td>__le32</td>
<td>i_ctime</td>
<td>Last inode change time, in seconds since the epoch. However, if the
EA_INODE inode flag is set, this inode stores an extended attribute
value and this field contains the lower 32 bits of the attribute value’s
reference count.</td>
</tr>
<tr class="row-odd"><td>0x10</td>
<td>__le32</td>
<td>i_mtime</td>
<td>Last data modification time, in seconds since the epoch. However, if the
EA_INODE inode flag is set, this inode stores an extended attribute
value and this field contains the number of the inode that owns the
extended attribute.</td>
</tr>
<tr class="row-even"><td>0x14</td>
<td>__le32</td>
<td>i_dtime</td>
<td>Deletion Time, in seconds since the epoch.</td>
</tr>
<tr class="row-odd"><td>0x18</td>
<td>__le16</td>
<td>i_gid</td>
<td>Lower 16-bits of GID.</td>
</tr>
<tr class="row-even"><td>0x1A</td>
<td>__le16</td>
<td>i_links_count</td>
<td>Hard link count. Normally, ext4 does not permit an inode to have more
than 65,000 hard links. This applies to files as well as directories,
which means that there cannot be more than 64,998 subdirectories in a
directory (each subdirectory’s ‘..’ entry counts as a hard link, as does
the ‘.’ entry in the directory itself). With the DIR_NLINK feature
enabled, ext4 supports more than 64,998 subdirectories by setting this
field to 1 to indicate that the number of hard links is not known.</td>
</tr>
<tr class="row-odd"><td>0x1C</td>
<td>__le32</td>
<td>i_blocks_lo</td>
<td>Lower 32-bits of “block” count. If the huge_file feature flag is not
set on the filesystem, the file consumes <code class="docutils literal notranslate"><span class="pre">i_blocks_lo</span></code> 512-byte blocks
on disk. If huge_file is set and EXT4_HUGE_FILE_FL is NOT set in
<code class="docutils literal notranslate"><span class="pre">inode.i_flags</span></code>, then the file consumes <code class="docutils literal notranslate"><span class="pre">i_blocks_lo</span> <span class="pre">+</span> <span class="pre">(i_blocks_hi</span>
<span class="pre">&lt;&lt;</span> <span class="pre">32)</span></code> 512-byte blocks on disk. If huge_file is set and
EXT4_HUGE_FILE_FL IS set in <code class="docutils literal notranslate"><span class="pre">inode.i_flags</span></code>, then this file
consumes (<code class="docutils literal notranslate"><span class="pre">i_blocks_lo</span> <span class="pre">+</span> <span class="pre">i_blocks_hi</span></code> &lt;&lt; 32) filesystem blocks on
disk.</td>
</tr>
<tr class="row-even"><td>0x20</td>
<td>__le32</td>
<td>i_flags</td>
<td>Inode flags. See the table <a class="reference internal" href="#i-flags">i_flags</a> below.</td>
</tr>
<tr class="row-odd"><td>0x24</td>
<td>4 bytes</td>
<td>i_osd1</td>
<td>See the table <a class="reference internal" href="#i-osd1">i_osd1</a> for more details.</td>
</tr>
<tr class="row-even"><td>0x28</td>
<td>60 bytes</td>
<td>i_block[EXT4_N_BLOCKS=15]</td>
<td>Block map or extent tree. See the section “The Contents of inode.i_block”.</td>
</tr>
<tr class="row-odd"><td>0x64</td>
<td>__le32</td>
<td>i_generation</td>
<td>File version (for NFS).</td>
</tr>
<tr class="row-even"><td>0x68</td>
<td>__le32</td>
<td>i_file_acl_lo</td>
<td>Lower 32-bits of extended attribute block. ACLs are of course one of
many possible extended attributes; I think the name of this field is a
result of the first use of extended attributes being for ACLs.</td>
</tr>
<tr class="row-odd"><td>0x6C</td>
<td>__le32</td>
<td>i_size_high / i_dir_acl</td>
<td>Upper 32-bits of file/directory size. In ext2/3 this field was named
i_dir_acl, though it was usually set to zero and never used.</td>
</tr>
<tr class="row-even"><td>0x70</td>
<td>__le32</td>
<td>i_obso_faddr</td>
<td>(Obsolete) fragment address.</td>
</tr>
<tr class="row-odd"><td>0x74</td>
<td>12 bytes</td>
<td>i_osd2</td>
<td>See the table <a class="reference internal" href="#i-osd2">i_osd2</a> for more details.</td>
</tr>
<tr class="row-even"><td>0x80</td>
<td>__le16</td>
<td>i_extra_isize</td>
<td>Size of this inode - 128. Alternately, the size of the extended inode
fields beyond the original ext2 inode, including this field.</td>
</tr>
<tr class="row-odd"><td>0x82</td>
<td>__le16</td>
<td>i_checksum_hi</td>
<td>Upper 16-bits of the inode checksum.</td>
</tr>
<tr class="row-even"><td>0x84</td>
<td>__le32</td>
<td>i_ctime_extra</td>
<td>Extra change time bits. This provides sub-second precision. See Inode
Timestamps section.</td>
</tr>
<tr class="row-odd"><td>0x88</td>
<td>__le32</td>
<td>i_mtime_extra</td>
<td>Extra modification time bits. This provides sub-second precision.</td>
</tr>
<tr class="row-even"><td>0x8C</td>
<td>__le32</td>
<td>i_atime_extra</td>
<td>Extra access time bits. This provides sub-second precision.</td>
</tr>
<tr class="row-odd"><td>0x90</td>
<td>__le32</td>
<td>i_crtime</td>
<td>File creation time, in seconds since the epoch.</td>
</tr>
<tr class="row-even"><td>0x94</td>
<td>__le32</td>
<td>i_crtime_extra</td>
<td>Extra file creation time bits. This provides sub-second precision.</td>
</tr>
<tr class="row-odd"><td>0x98</td>
<td>__le32</td>
<td>i_version_hi</td>
<td>Upper 32-bits for version number.</td>
</tr>
<tr class="row-even"><td>0x9C</td>
<td>__le32</td>
<td>i_projid</td>
<td>Project ID.</td>
</tr>
</tbody>
</table>
<p id="i-mode">The <code class="docutils literal notranslate"><span class="pre">i_mode</span></code> value is a combination of the following flags:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x1</td>
<td>S_IXOTH (Others may execute)</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>S_IWOTH (Others may write)</td>
</tr>
<tr class="row-even"><td>0x4</td>
<td>S_IROTH (Others may read)</td>
</tr>
<tr class="row-odd"><td>0x8</td>
<td>S_IXGRP (Group members may execute)</td>
</tr>
<tr class="row-even"><td>0x10</td>
<td>S_IWGRP (Group members may write)</td>
</tr>
<tr class="row-odd"><td>0x20</td>
<td>S_IRGRP (Group members may read)</td>
</tr>
<tr class="row-even"><td>0x40</td>
<td>S_IXUSR (Owner may execute)</td>
</tr>
<tr class="row-odd"><td>0x80</td>
<td>S_IWUSR (Owner may write)</td>
</tr>
<tr class="row-even"><td>0x100</td>
<td>S_IRUSR (Owner may read)</td>
</tr>
<tr class="row-odd"><td>0x200</td>
<td>S_ISVTX (Sticky bit)</td>
</tr>
<tr class="row-even"><td>0x400</td>
<td>S_ISGID (Set GID)</td>
</tr>
<tr class="row-odd"><td>0x800</td>
<td>S_ISUID (Set UID)</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>These are mutually-exclusive file types:</td>
</tr>
<tr class="row-odd"><td>0x1000</td>
<td>S_IFIFO (FIFO)</td>
</tr>
<tr class="row-even"><td>0x2000</td>
<td>S_IFCHR (Character device)</td>
</tr>
<tr class="row-odd"><td>0x4000</td>
<td>S_IFDIR (Directory)</td>
</tr>
<tr class="row-even"><td>0x6000</td>
<td>S_IFBLK (Block device)</td>
</tr>
<tr class="row-odd"><td>0x8000</td>
<td>S_IFREG (Regular file)</td>
</tr>
<tr class="row-even"><td>0xA000</td>
<td>S_IFLNK (Symbolic link)</td>
</tr>
<tr class="row-odd"><td>0xC000</td>
<td>S_IFSOCK (Socket)</td>
</tr>
</tbody>
</table>
<p id="i-flags">The <code class="docutils literal notranslate"><span class="pre">i_flags</span></code> field is a combination of these values:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x1</td>
<td>This file requires secure deletion (EXT4_SECRM_FL). (not implemented)</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>This file should be preserved, should undeletion be desired
(EXT4_UNRM_FL). (not implemented)</td>
</tr>
<tr class="row-even"><td>0x4</td>
<td>File is compressed (EXT4_COMPR_FL). (not really implemented)</td>
</tr>
<tr class="row-odd"><td>0x8</td>
<td>All writes to the file must be synchronous (EXT4_SYNC_FL).</td>
</tr>
<tr class="row-even"><td>0x10</td>
<td>File is immutable (EXT4_IMMUTABLE_FL).</td>
</tr>
<tr class="row-odd"><td>0x20</td>
<td>File can only be appended (EXT4_APPEND_FL).</td>
</tr>
<tr class="row-even"><td>0x40</td>
<td>The dump(1) utility should not dump this file (EXT4_NODUMP_FL).</td>
</tr>
<tr class="row-odd"><td>0x80</td>
<td>Do not update access time (EXT4_NOATIME_FL).</td>
</tr>
<tr class="row-even"><td>0x100</td>
<td>Dirty compressed file (EXT4_DIRTY_FL). (not used)</td>
</tr>
<tr class="row-odd"><td>0x200</td>
<td>File has one or more compressed clusters (EXT4_COMPRBLK_FL). (not used)</td>
</tr>
<tr class="row-even"><td>0x400</td>
<td>Do not compress file (EXT4_NOCOMPR_FL). (not used)</td>
</tr>
<tr class="row-odd"><td>0x800</td>
<td>Encrypted inode (EXT4_ENCRYPT_FL). This bit value previously was
EXT4_ECOMPR_FL (compression error), which was never used.</td>
</tr>
<tr class="row-even"><td>0x1000</td>
<td>Directory has hashed indexes (EXT4_INDEX_FL).</td>
</tr>
<tr class="row-odd"><td>0x2000</td>
<td>AFS magic directory (EXT4_IMAGIC_FL).</td>
</tr>
<tr class="row-even"><td>0x4000</td>
<td>File data must always be written through the journal
(EXT4_JOURNAL_DATA_FL).</td>
</tr>
<tr class="row-odd"><td>0x8000</td>
<td>File tail should not be merged (EXT4_NOTAIL_FL). (not used by ext4)</td>
</tr>
<tr class="row-even"><td>0x10000</td>
<td>All directory entry data should be written synchronously (see
<code class="docutils literal notranslate"><span class="pre">dirsync</span></code>) (EXT4_DIRSYNC_FL).</td>
</tr>
<tr class="row-odd"><td>0x20000</td>
<td>Top of directory hierarchy (EXT4_TOPDIR_FL).</td>
</tr>
<tr class="row-even"><td>0x40000</td>
<td>This is a huge file (EXT4_HUGE_FILE_FL).</td>
</tr>
<tr class="row-odd"><td>0x80000</td>
<td>Inode uses extents (EXT4_EXTENTS_FL).</td>
</tr>
<tr class="row-even"><td>0x100000</td>
<td>Verity protected file (EXT4_VERITY_FL).</td>
</tr>
<tr class="row-odd"><td>0x200000</td>
<td>Inode stores a large extended attribute value in its data blocks
(EXT4_EA_INODE_FL).</td>
</tr>
<tr class="row-even"><td>0x400000</td>
<td>This file has blocks allocated past EOF (EXT4_EOFBLOCKS_FL).
(deprecated)</td>
</tr>
<tr class="row-odd"><td>0x01000000</td>
<td>Inode is a snapshot (<code class="docutils literal notranslate"><span class="pre">EXT4_SNAPFILE_FL</span></code>). (not in mainline)</td>
</tr>
<tr class="row-even"><td>0x04000000</td>
<td>Snapshot is being deleted (<code class="docutils literal notranslate"><span class="pre">EXT4_SNAPFILE_DELETED_FL</span></code>). (not in
mainline)</td>
</tr>
<tr class="row-odd"><td>0x08000000</td>
<td>Snapshot shrink has completed (<code class="docutils literal notranslate"><span class="pre">EXT4_SNAPFILE_SHRUNK_FL</span></code>). (not in
mainline)</td>
</tr>
<tr class="row-even"><td>0x10000000</td>
<td>Inode has inline data (EXT4_INLINE_DATA_FL).</td>
</tr>
<tr class="row-odd"><td>0x20000000</td>
<td>Create children with the same project ID (EXT4_PROJINHERIT_FL).</td>
</tr>
<tr class="row-even"><td>0x80000000</td>
<td>Reserved for ext4 library (EXT4_RESERVED_FL).</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Aggregate flags:</td>
</tr>
<tr class="row-even"><td>0x705BDFFF</td>
<td>User-visible flags.</td>
</tr>
<tr class="row-odd"><td>0x604BC0FF</td>
<td>User-modifiable flags. Note that while EXT4_JOURNAL_DATA_FL and
EXT4_EXTENTS_FL can be set with setattr, they are not in the kernel’s
EXT4_FL_USER_MODIFIABLE mask, since it needs to handle the setting of
these flags in a special manner and they are masked out of the set of
flags that are saved directly to i_flags.</td>
</tr>
</tbody>
</table>
<p id="i-osd1">The <code class="docutils literal notranslate"><span class="pre">osd1</span></code> field has multiple meanings depending on the creator:</p>
<p>Linux:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le32</td>
<td>l_i_version</td>
<td>Inode version. However, if the EA_INODE inode flag is set, this inode
stores an extended attribute value and this field contains the upper 32
bits of the attribute value’s reference count.</td>
</tr>
</tbody>
</table>
<p>Hurd:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le32</td>
<td>h_i_translator</td>
<td>??</td>
</tr>
</tbody>
</table>
<p>Masix:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le32</td>
<td>m_i_reserved</td>
<td>??</td>
</tr>
</tbody>
</table>
<p id="i-osd2">The <code class="docutils literal notranslate"><span class="pre">osd2</span></code> field has multiple meanings depending on the filesystem creator:</p>
<p>Linux:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le16</td>
<td>l_i_blocks_high</td>
<td>Upper 16-bits of the block count. Please see the note attached to
i_blocks_lo.</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>__le16</td>
<td>l_i_file_acl_high</td>
<td>Upper 16-bits of the extended attribute block (historically, the file
ACL location). See the Extended Attributes section below.</td>
</tr>
<tr class="row-even"><td>0x4</td>
<td>__le16</td>
<td>l_i_uid_high</td>
<td>Upper 16-bits of the Owner UID.</td>
</tr>
<tr class="row-odd"><td>0x6</td>
<td>__le16</td>
<td>l_i_gid_high</td>
<td>Upper 16-bits of the GID.</td>
</tr>
<tr class="row-even"><td>0x8</td>
<td>__le16</td>
<td>l_i_checksum_lo</td>
<td>Lower 16-bits of the inode checksum.</td>
</tr>
<tr class="row-odd"><td>0xA</td>
<td>__le16</td>
<td>l_i_reserved</td>
<td>Unused.</td>
</tr>
</tbody>
</table>
<p>Hurd:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le16</td>
<td>h_i_reserved1</td>
<td>??</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>__u16</td>
<td>h_i_mode_high</td>
<td>Upper 16-bits of the file mode.</td>
</tr>
<tr class="row-even"><td>0x4</td>
<td>__le16</td>
<td>h_i_uid_high</td>
<td>Upper 16-bits of the Owner UID.</td>
</tr>
<tr class="row-odd"><td>0x6</td>
<td>__le16</td>
<td>h_i_gid_high</td>
<td>Upper 16-bits of the GID.</td>
</tr>
<tr class="row-even"><td>0x8</td>
<td>__u32</td>
<td>h_i_author</td>
<td>Author code?</td>
</tr>
</tbody>
</table>
<p>Masix:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Size</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le16</td>
<td>h_i_reserved1</td>
<td>??</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>__u16</td>
<td>m_i_file_acl_high</td>
<td>Upper 16-bits of the extended attribute block (historically, the file
ACL location).</td>
</tr>
<tr class="row-even"><td>0x4</td>
<td>__u32</td>
<td>m_i_reserved2[2]</td>
<td>??</td>
</tr>
</tbody>
</table>
<div class="section" id="inode-size">
<h2>Inode Size<a class="headerlink" href="#inode-size" title="Permalink to this headline">¶</a></h2>
<p>In ext2 and ext3, the inode structure size was fixed at 128 bytes
(<code class="docutils literal notranslate"><span class="pre">EXT2_GOOD_OLD_INODE_SIZE</span></code>) and each inode had a disk record size of
128 bytes. Starting with ext4, it is possible to allocate a larger
on-disk inode at format time for all inodes in the filesystem to provide
space beyond the end of the original ext2 inode. The on-disk inode
record size is recorded in the superblock as <code class="docutils literal notranslate"><span class="pre">s_inode_size</span></code>. The
number of bytes actually used by struct ext4_inode beyond the original
128-byte ext2 inode is recorded in the <code class="docutils literal notranslate"><span class="pre">i_extra_isize</span></code> field for each
inode, which allows struct ext4_inode to grow for a new kernel without
having to upgrade all of the on-disk inodes. Access to fields beyond
EXT2_GOOD_OLD_INODE_SIZE should be verified to be within
<code class="docutils literal notranslate"><span class="pre">i_extra_isize</span></code>. By default, ext4 inode records are 256 bytes, and (as
of August 2019) the inode structure is 160 bytes
(<code class="docutils literal notranslate"><span class="pre">i_extra_isize</span> <span class="pre">=</span> <span class="pre">32</span></code>). The extra space between the end of the inode
structure and the end of the inode record can be used to store extended
attributes. Each inode record can be as large as the filesystem block
size, though this is not terribly efficient.</p>
</div>
<div class="section" id="finding-an-inode">
<h2>Finding an Inode<a class="headerlink" href="#finding-an-inode" title="Permalink to this headline">¶</a></h2>
<p>Each block group contains <code class="docutils literal notranslate"><span class="pre">sb-&gt;s_inodes_per_group</span></code> inodes. Because
inode 0 is defined not to exist, this formula can be used to find the
block group that an inode lives in:
<code class="docutils literal notranslate"><span class="pre">bg</span> <span class="pre">=</span> <span class="pre">(inode_num</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">/</span> <span class="pre">sb-&gt;s_inodes_per_group</span></code>. The particular inode
can be found within the block group’s inode table at
<code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">=</span> <span class="pre">(inode_num</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">%</span> <span class="pre">sb-&gt;s_inodes_per_group</span></code>. To get the byte
address within the inode table, use
<code class="docutils literal notranslate"><span class="pre">offset</span> <span class="pre">=</span> <span class="pre">index</span> <span class="pre">*</span> <span class="pre">sb-&gt;s_inode_size</span></code>.</p>
</div>
<div class="section" id="inode-timestamps">
<h2>Inode Timestamps<a class="headerlink" href="#inode-timestamps" title="Permalink to this headline">¶</a></h2>
<p>Four timestamps are recorded in the lower 128 bytes of the inode
structure – inode change time (ctime), access time (atime), data
modification time (mtime), and deletion time (dtime). The four fields
are 32-bit signed integers that represent seconds since the Unix epoch
(1970-01-01 00:00:00 GMT), which means that the fields will overflow in
January 2038. For inodes that are not linked from any directory but are
still open (orphan inodes), the dtime field is overloaded for use with
the orphan list. The superblock field <code class="docutils literal notranslate"><span class="pre">s_last_orphan</span></code> points to the
first inode in the orphan list; dtime is then the number of the next
orphaned inode, or zero if there are no more orphans.</p>
<p>If the inode structure size <code class="docutils literal notranslate"><span class="pre">sb-&gt;s_inode_size</span></code> is larger than 128
bytes and the <code class="docutils literal notranslate"><span class="pre">i_inode_extra</span></code> field is large enough to encompass the
respective <code class="docutils literal notranslate"><span class="pre">i_[cma]time_extra</span></code> field, the ctime, atime, and mtime
inode fields are widened to 64 bits. Within this “extra” 32-bit field,
the lower two bits are used to extend the 32-bit seconds field to be 34
bit wide; the upper 30 bits are used to provide nanosecond timestamp
accuracy. Therefore, timestamps should not overflow until May 2446.
dtime was not widened. There is also a fifth timestamp to record inode
creation time (crtime); this field is 64-bits wide and decoded in the
same manner as 64-bit [cma]time. Neither crtime nor dtime are accessible
through the regular stat() interface, though debugfs will report them.</p>
<p>We use the 32-bit signed time value plus (2^32 * (extra epoch bits)).
In other words:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Extra epoch bits</th>
<th class="head">MSB of 32-bit time</th>
<th class="head">Adjustment for signed 32-bit to 64-bit tv_sec</th>
<th class="head">Decoded 64-bit tv_sec</th>
<th class="head">valid time range</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0 0</td>
<td>1</td>
<td>0</td>
<td><code class="docutils literal notranslate"><span class="pre">-0x80000000</span> <span class="pre">-</span> <span class="pre">-0x00000001</span></code></td>
<td>1901-12-13 to 1969-12-31</td>
</tr>
<tr class="row-odd"><td>0 0</td>
<td>0</td>
<td>0</td>
<td><code class="docutils literal notranslate"><span class="pre">0x000000000</span> <span class="pre">-</span> <span class="pre">0x07fffffff</span></code></td>
<td>1970-01-01 to 2038-01-19</td>
</tr>
<tr class="row-even"><td>0 1</td>
<td>1</td>
<td>0x100000000</td>
<td><code class="docutils literal notranslate"><span class="pre">0x080000000</span> <span class="pre">-</span> <span class="pre">0x0ffffffff</span></code></td>
<td>2038-01-19 to 2106-02-07</td>
</tr>
<tr class="row-odd"><td>0 1</td>
<td>0</td>
<td>0x100000000</td>
<td><code class="docutils literal notranslate"><span class="pre">0x100000000</span> <span class="pre">-</span> <span class="pre">0x17fffffff</span></code></td>
<td>2106-02-07 to 2174-02-25</td>
</tr>
<tr class="row-even"><td>1 0</td>
<td>1</td>
<td>0x200000000</td>
<td><code class="docutils literal notranslate"><span class="pre">0x180000000</span> <span class="pre">-</span> <span class="pre">0x1ffffffff</span></code></td>
<td>2174-02-25 to 2242-03-16</td>
</tr>
<tr class="row-odd"><td>1 0</td>
<td>0</td>
<td>0x200000000</td>
<td><code class="docutils literal notranslate"><span class="pre">0x200000000</span> <span class="pre">-</span> <span class="pre">0x27fffffff</span></code></td>
<td>2242-03-16 to 2310-04-04</td>
</tr>
<tr class="row-even"><td>1 1</td>
<td>1</td>
<td>0x300000000</td>
<td><code class="docutils literal notranslate"><span class="pre">0x280000000</span> <span class="pre">-</span> <span class="pre">0x2ffffffff</span></code></td>
<td>2310-04-04 to 2378-04-22</td>
</tr>
<tr class="row-odd"><td>1 1</td>
<td>0</td>
<td>0x300000000</td>
<td><code class="docutils literal notranslate"><span class="pre">0x300000000</span> <span class="pre">-</span> <span class="pre">0x37fffffff</span></code></td>
<td>2378-04-22 to 2446-05-10</td>
</tr>
</tbody>
</table>
<p>This is a somewhat odd encoding since there are effectively seven times
as many positive values as negative values. There have also been
long-standing bugs decoding and encoding dates beyond 2038, which don’t
seem to be fixed as of kernel 3.12 and e2fsprogs 1.42.8. 64-bit kernels
incorrectly use the extra epoch bits 1,1 for dates between 1901 and
1970. At some point the kernel will be fixed and e2fsck will fix this
situation, assuming that it is run before 2310.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>