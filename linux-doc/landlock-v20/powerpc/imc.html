

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IMC (In-Memory Collection Counters) &mdash; The Linux Kernel 5.8.0-rc4+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CPU to ISA Version Mapping" href="isa-versions.html" />
    <link rel="prev" title="HVCS IBM “Hypervisor Virtual Console Server” Installation Guide" href="hvcs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0-rc4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">powerpc</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bootwrapper.html">The PowerPC boot wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_families.html">CPU Families</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu_features.html">CPU Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxl.html">Coherent Accelerator Interface (CXL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxlflash.html">Coherent Accelerator (CXL) Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="dawr-power9.html">DAWR issues on POWER9</a></li>
<li class="toctree-l2"><a class="reference internal" href="dscr.html">DSCR (Data Stream Control Register)</a></li>
<li class="toctree-l2"><a class="reference internal" href="eeh-pci-error-recovery.html">PCI Bus EEH Error Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="elfnote.html">ELF Note PowerPC Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware-assisted-dump.html">Firmware-Assisted Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="hvcs.html">HVCS IBM “Hypervisor Virtual Console Server” Installation Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">IMC (In-Memory Collection Counters)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-overview">Basic overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imc-example-usage">IMC example usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imc-trace-mode">IMC Trace-mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ldbar-register-layout">LDBAR Register Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trace-imc-scom-bit-representation">TRACE_IMC_SCOM bit representation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#trace-imc-example-usage">Trace IMC example usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#benefits-of-using-imc-trace-mode">Benefits of using IMC trace-mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="isa-versions.html">CPU to ISA Version Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="kaslr-booke32.html">KASLR for Freescale BookE32</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpc52xx.html">Linux 2.6.x on MPC52xx family</a></li>
<li class="toctree-l2"><a class="reference internal" href="papr_hcalls.html">Hypercall Op-codes (hcalls)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pci_iov_resource_on_powernv.html">PCI Express I/O Virtualization Resource on Powerenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="pmu-ebb.html">PMU Event Based Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="ptrace.html">Ptrace</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe_firmware.html">Freescale QUICC Engine Firmware Uploading</a></li>
<li class="toctree-l2"><a class="reference internal" href="syscall64-abi.html">Power Architecture 64-bit Linux system call ABI</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactional_memory.html">Transactional Memory support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ultravisor.html">Protected Execution Facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="vas-api.html">Virtual Accelerator Switchboard (VAS) userspace API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">powerpc</a> &raquo;</li>
        
      <li>IMC (In-Memory Collection Counters)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/powerpc/imc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="imc-in-memory-collection-counters">
<span id="imc"></span><h1><a class="toc-backref" href="#id1">IMC (In-Memory Collection Counters)</a><a class="headerlink" href="#imc-in-memory-collection-counters" title="Permalink to this headline">¶</a></h1>
<p>Anju T Sudhakar, 10 May 2019</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#imc-in-memory-collection-counters" id="id1">IMC (In-Memory Collection Counters)</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-overview" id="id2">Basic overview</a></p></li>
<li><p><a class="reference internal" href="#imc-example-usage" id="id3">IMC example usage</a></p></li>
<li><p><a class="reference internal" href="#imc-trace-mode" id="id4">IMC Trace-mode</a></p>
<ul>
<li><p><a class="reference internal" href="#ldbar-register-layout" id="id5">LDBAR Register Layout</a></p></li>
<li><p><a class="reference internal" href="#trace-imc-scom-bit-representation" id="id6">TRACE_IMC_SCOM bit representation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#trace-imc-example-usage" id="id7">Trace IMC example usage</a></p></li>
<li><p><a class="reference internal" href="#benefits-of-using-imc-trace-mode" id="id8">Benefits of using IMC trace-mode</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="basic-overview">
<h2><a class="toc-backref" href="#id2">Basic overview</a><a class="headerlink" href="#basic-overview" title="Permalink to this headline">¶</a></h2>
<p>IMC (In-Memory collection counters) is a hardware monitoring facility that
collects large numbers of hardware performance events at Nest level (these are
on-chip but off-core), Core level and Thread level.</p>
<p>The Nest PMU counters are handled by a Nest IMC microcode which runs in the OCC
(On-Chip Controller) complex. The microcode collects the counter data and moves
the nest IMC counter data to memory.</p>
<p>The Core and Thread IMC PMU counters are handled in the core. Core level PMU
counters give us the IMC counters’ data per core and thread level PMU counters
give us the IMC counters’ data per CPU thread.</p>
<p>OPAL obtains the IMC PMU and supported events information from the IMC Catalog
and passes on to the kernel via the device tree. The event’s information
contains:</p>
<ul class="simple">
<li><p>Event name</p></li>
<li><p>Event Offset</p></li>
<li><p>Event description</p></li>
</ul>
<p>and possibly also:</p>
<ul class="simple">
<li><p>Event scale</p></li>
<li><p>Event unit</p></li>
</ul>
<p>Some PMUs may have a common scale and unit values for all their supported
events. For those cases, the scale and unit properties for those events must be
inherited from the PMU.</p>
<p>The event offset in the memory is where the counter data gets accumulated.</p>
<dl class="simple">
<dt>IMC catalog is available at:</dt><dd><p><a class="reference external" href="https://github.com/open-power/ima-catalog">https://github.com/open-power/ima-catalog</a></p>
</dd>
</dl>
<p>The kernel discovers the IMC counters information in the device tree at the
<cite>imc-counters</cite> device node which has a compatible field
<cite>ibm,opal-in-memory-counters</cite>. From the device tree, the kernel parses the PMUs
and their event’s information and register the PMU and its attributes in the
kernel.</p>
</div>
<div class="section" id="imc-example-usage">
<h2><a class="toc-backref" href="#id3">IMC example usage</a><a class="headerlink" href="#imc-example-usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># perf list</span>
<span class="o">[</span>...<span class="o">]</span>
nest_mcs01/PM_MCS01_64B_RD_DISP_PORT01/            <span class="o">[</span>Kernel PMU event<span class="o">]</span>
nest_mcs01/PM_MCS01_64B_RD_DISP_PORT23/            <span class="o">[</span>Kernel PMU event<span class="o">]</span>
<span class="o">[</span>...<span class="o">]</span>
core_imc/CPM_0THRD_NON_IDLE_PCYC/                  <span class="o">[</span>Kernel PMU event<span class="o">]</span>
core_imc/CPM_1THRD_NON_IDLE_INST/                  <span class="o">[</span>Kernel PMU event<span class="o">]</span>
<span class="o">[</span>...<span class="o">]</span>
thread_imc/CPM_0THRD_NON_IDLE_PCYC/                <span class="o">[</span>Kernel PMU event<span class="o">]</span>
thread_imc/CPM_1THRD_NON_IDLE_INST/                <span class="o">[</span>Kernel PMU event<span class="o">]</span>
</pre></div>
</div>
<p>To see per chip data for nest_mcs0/PM_MCS_DOWN_128B_DATA_XFER_MC0/:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># ./perf stat -e &quot;nest_mcs01/PM_MCS01_64B_WR_DISP_PORT01/&quot; -a --per-socket</span>
</pre></div>
</div>
<p>To see non-idle instructions for core 0:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># ./perf stat -e &quot;core_imc/CPM_NON_IDLE_INST/&quot; -C 0 -I 1000</span>
</pre></div>
</div>
<p>To see non-idle instructions for a “make”:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># ./perf stat -e &quot;thread_imc/CPM_NON_IDLE_PCYC/&quot; make</span>
</pre></div>
</div>
</div>
<div class="section" id="imc-trace-mode">
<h2><a class="toc-backref" href="#id4">IMC Trace-mode</a><a class="headerlink" href="#imc-trace-mode" title="Permalink to this headline">¶</a></h2>
<p>POWER9 supports two modes for IMC which are the Accumulation mode and Trace
mode. In Accumulation mode, event counts are accumulated in system Memory.
Hypervisor then reads the posted counts periodically or when requested. In IMC
Trace mode, the 64 bit trace SCOM value is initialized with the event
information. The CPMCxSEL and CPMC_LOAD in the trace SCOM, specifies the event
to be monitored and the sampling duration. On each overflow in the CPMCxSEL,
hardware snapshots the program counter along with event counts and writes into
memory pointed by LDBAR.</p>
<p>LDBAR is a 64 bit special purpose per thread register, it has bits to indicate
whether hardware is configured for accumulation or trace mode.</p>
<div class="section" id="ldbar-register-layout">
<h3><a class="toc-backref" href="#id5">LDBAR Register Layout</a><a class="headerlink" href="#ldbar-register-layout" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0</p></td>
<td><p>Enable/Disable</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>1</p></td>
<td><p>0: Accumulation Mode</p></td>
</tr>
<tr class="row-odd"><td><p>1: Trace Mode</p></td>
</tr>
<tr class="row-even"><td><p>2:3</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>4-6</p></td>
<td><p>PB scope</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>8:50</p></td>
<td><p>Counter Address</p></td>
</tr>
<tr class="row-even"><td><p>51:63</p></td>
<td><p>Reserved</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="trace-imc-scom-bit-representation">
<h3><a class="toc-backref" href="#id6">TRACE_IMC_SCOM bit representation</a><a class="headerlink" href="#trace-imc-scom-bit-representation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0:1</p></td>
<td><p>SAMPSEL</p></td>
</tr>
<tr class="row-even"><td><p>2:33</p></td>
<td><p>CPMC_LOAD</p></td>
</tr>
<tr class="row-odd"><td><p>34:40</p></td>
<td><p>CPMC1SEL</p></td>
</tr>
<tr class="row-even"><td><p>41:47</p></td>
<td><p>CPMC2SEL</p></td>
</tr>
<tr class="row-odd"><td><p>48:50</p></td>
<td><p>BUFFERSIZE</p></td>
</tr>
<tr class="row-even"><td><p>51:63</p></td>
<td><p>RESERVED</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>CPMC_LOAD contains the sampling duration. SAMPSEL and CPMCxSEL determines the
event to count. BUFFERSIZE indicates the memory range. On each overflow,
hardware snapshots the program counter along with event counts and updates the
memory and reloads the CMPC_LOAD value for the next sampling duration. IMC
hardware does not support exceptions, so it quietly wraps around if memory
buffer reaches the end.</p>
<p><em>Currently the event monitored for trace-mode is fixed as cycle.</em></p>
</div>
</div>
<div class="section" id="trace-imc-example-usage">
<h2><a class="toc-backref" href="#id7">Trace IMC example usage</a><a class="headerlink" href="#trace-imc-example-usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># perf list</span>
<span class="o">[</span>....<span class="o">]</span>
trace_imc/trace_cycles/                            <span class="o">[</span>Kernel PMU event<span class="o">]</span>
</pre></div>
</div>
<p>To record an application/process with trace-imc event:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># perf record -e trace_imc/trace_cycles/ yes &gt; /dev/null</span>
<span class="o">[</span> perf record: Woken up <span class="m">1</span> <span class="nb">times</span> to write data <span class="o">]</span>
<span class="o">[</span> perf record: Captured and wrote <span class="m">0</span>.012 MB perf.data <span class="o">(</span><span class="m">21</span> samples<span class="o">)</span> <span class="o">]</span>
</pre></div>
</div>
<p>The <cite>perf.data</cite> generated, can be read using perf report.</p>
</div>
<div class="section" id="benefits-of-using-imc-trace-mode">
<h2><a class="toc-backref" href="#id8">Benefits of using IMC trace-mode</a><a class="headerlink" href="#benefits-of-using-imc-trace-mode" title="Permalink to this headline">¶</a></h2>
<p>PMI (Performance Monitoring Interrupts) interrupt handling is avoided, since IMC
trace mode snapshots the program counter and updates to the memory. And this
also provide a way for the operating system to do instruction sampling in real
time without PMI processing overhead.</p>
<p>Performance data using <cite>perf top</cite> with and without trace-imc event.</p>
<p>PMI interrupts count when <cite>perf top</cite> command is executed without trace-imc event.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># grep PMI /proc/interrupts</span>
PMI:          <span class="m">0</span>          <span class="m">0</span>          <span class="m">0</span>          <span class="m">0</span>   Performance monitoring interrupts
<span class="c1"># ./perf top</span>
...
<span class="c1"># grep PMI /proc/interrupts</span>
PMI:      <span class="m">39735</span>       <span class="m">8710</span>      <span class="m">17338</span>      <span class="m">17801</span>   Performance monitoring interrupts
<span class="c1"># ./perf top -e trace_imc/trace_cycles/</span>
...
<span class="c1"># grep PMI /proc/interrupts</span>
PMI:      <span class="m">39735</span>       <span class="m">8710</span>      <span class="m">17338</span>      <span class="m">17801</span>   Performance monitoring interrupts
</pre></div>
</div>
<p>That is, the PMI interrupt counts do not increment when using the <cite>trace_imc</cite> event.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="isa-versions.html" class="btn btn-neutral float-right" title="CPU to ISA Version Mapping" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hvcs.html" class="btn btn-neutral float-left" title="HVCS IBM “Hypervisor Virtual Console Server” Installation Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>