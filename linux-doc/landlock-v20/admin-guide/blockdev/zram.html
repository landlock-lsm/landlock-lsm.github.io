

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>zram: Compressed RAM-based block devices &mdash; The Linux Kernel 5.8.0-rc4+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Distributed Replicated Block Device - DRBD" href="drbd/index.html" />
    <link rel="prev" title="Using the RAM disk block device with Linux" href="ramdisk.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0-rc4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">The Linux RapidIO Subsystem</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="floppy.html">Floppy Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="nbd.html">Network Block Device (TCP version)</a></li>
<li class="toctree-l3"><a class="reference internal" href="paride.html">Linux and parallel port IDE devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="ramdisk.html">Using the RAM disk block device with Linux</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">zram: Compressed RAM-based block devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#warning">WARNING</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-module">1) Load Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-max-number-of-compression-streams">2) Set max number of compression streams</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select-compression-algorithm">3) Select compression algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-disksize">4) Set Disksize</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-memory-limit-optional">5) Set memory limit: Optional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#activate">6) Activate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-remove-zram-devices">7) Add/remove zram devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stats">8) Stats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deactivate">9) Deactivate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reset">10) Reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-feature">Optional Feature</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory-tracking">memory tracking</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="drbd/index.html">Distributed Replicated Block Device - DRBD</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
          <li><a href="index.html">The Linux RapidIO Subsystem</a> &raquo;</li>
        
      <li>zram: Compressed RAM-based block devices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/blockdev/zram.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="zram-compressed-ram-based-block-devices">
<h1>zram: Compressed RAM-based block devices<a class="headerlink" href="#zram-compressed-ram-based-block-devices" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The zram module creates RAM-based block devices named /dev/zram&lt;id&gt;
(&lt;id&gt; = 0, 1, …). Pages written to these disks are compressed and stored
in memory itself. These disks allow very fast I/O and compression provides
good amounts of memory savings. Some of the use cases include /tmp storage,
use as swap disks, various caches under /var and maybe many more. :)</p>
<p>Statistics for individual zram devices are exported through sysfs nodes at
/sys/block/zram&lt;id&gt;/</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>There are several ways to configure and manage zram device(-s):</p>
<ol class="loweralpha simple">
<li><p>using zram and zram_control sysfs attributes</p></li>
<li><p>using zramctl utility, provided by util-linux (<a class="reference external" href="mailto:util-linux&#37;&#52;&#48;vger&#46;kernel&#46;org">util-linux<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a>).</p></li>
</ol>
<p>In this document we will describe only ‘manual’ zram configuration steps,
IOW, zram and zram_control sysfs attributes.</p>
<p>In order to get a better idea about zramctl please consult util-linux
documentation, zramctl man-page or <cite>zramctl –help</cite>. Please be informed
that zram maintainers do not develop/maintain util-linux or zramctl, should
you have any questions please contact <a class="reference external" href="mailto:util-linux&#37;&#52;&#48;vger&#46;kernel&#46;org">util-linux<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a></p>
<p>Following shows a typical sequence of steps for using zram.</p>
</div>
<div class="section" id="warning">
<h2>WARNING<a class="headerlink" href="#warning" title="Permalink to this headline">¶</a></h2>
<p>For the sake of simplicity we skip error checking parts in most of the
examples below. However, it is your sole responsibility to handle errors.</p>
<p>zram sysfs attributes always return negative values in case of errors.
The list of possible return codes:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 88%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>-EBUSY</p></td>
<td><p>an attempt to modify an attribute that cannot be changed once
the device has been initialised. Please reset device first.</p></td>
</tr>
<tr class="row-even"><td><p>-ENOMEM</p></td>
<td><p>zram was not able to allocate enough memory to fulfil your
needs.</p></td>
</tr>
<tr class="row-odd"><td><p>-EINVAL</p></td>
<td><p>invalid input has been provided.</p></td>
</tr>
</tbody>
</table>
<p>If you use ‘echo’, the returned value is set by the ‘echo’ utility,
and, in general case, something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 3 &gt; /sys/block/zram0/max_comp_streams
if [ $? -ne 0 ]; then
        handle_error
fi
</pre></div>
</div>
<p>should suffice.</p>
</div>
<div class="section" id="load-module">
<h2>1) Load Module<a class="headerlink" href="#load-module" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe zram num_devices=4
</pre></div>
</div>
<p>This creates 4 devices: /dev/zram{0,1,2,3}</p>
<p>num_devices parameter is optional and tells zram how many devices should be
pre-created. Default: 1.</p>
</div>
<div class="section" id="set-max-number-of-compression-streams">
<h2>2) Set max number of compression streams<a class="headerlink" href="#set-max-number-of-compression-streams" title="Permalink to this headline">¶</a></h2>
<p>Regardless of the value passed to this attribute, ZRAM will always
allocate multiple compression streams - one per online CPU - thus
allowing several concurrent compression operations. The number of
allocated compression streams goes down when some of the CPUs
become offline. There is no single-compression-stream mode anymore,
unless you are running a UP system or have only 1 CPU online.</p>
<p>To find out how many streams are currently available:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/block/zram0/max_comp_streams
</pre></div>
</div>
</div>
<div class="section" id="select-compression-algorithm">
<h2>3) Select compression algorithm<a class="headerlink" href="#select-compression-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Using comp_algorithm device attribute one can see available and
currently selected (shown in square brackets) compression algorithms,
or change the selected compression algorithm (once the device is initialised
there is no way to change compression algorithm).</p>
<p>Examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#show supported compression algorithms
cat /sys/block/zram0/comp_algorithm
lzo [lz4]

#select lzo compression algorithm
echo lzo &gt; /sys/block/zram0/comp_algorithm
</pre></div>
</div>
<p>For the time being, the <cite>comp_algorithm</cite> content does not necessarily
show every compression algorithm supported by the kernel. We keep this
list primarily to simplify device configuration and one can configure
a new device with a compression algorithm that is not listed in
<cite>comp_algorithm</cite>. The thing is that, internally, ZRAM uses Crypto API
and, if some of the algorithms were built as modules, it’s impossible
to list all of them using, for instance, /proc/crypto or any other
method. This, however, has an advantage of permitting the usage of
custom crypto compression modules (implementing S/W or H/W compression).</p>
</div>
<div class="section" id="set-disksize">
<h2>4) Set Disksize<a class="headerlink" href="#set-disksize" title="Permalink to this headline">¶</a></h2>
<p>Set disk size by writing the value to sysfs node ‘disksize’.
The value can be either in bytes or you can use mem suffixes.
Examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Initialize /dev/zram0 with 50MB disksize
echo $((50*1024*1024)) &gt; /sys/block/zram0/disksize

# Using mem suffixes
echo 256K &gt; /sys/block/zram0/disksize
echo 512M &gt; /sys/block/zram0/disksize
echo 1G &gt; /sys/block/zram0/disksize
</pre></div>
</div>
<p>Note:
There is little point creating a zram of greater than twice the size of memory
since we expect a 2:1 compression ratio. Note that zram uses about 0.1% of the
size of the disk when not in use so a huge zram is wasteful.</p>
</div>
<div class="section" id="set-memory-limit-optional">
<h2>5) Set memory limit: Optional<a class="headerlink" href="#set-memory-limit-optional" title="Permalink to this headline">¶</a></h2>
<p>Set memory limit by writing the value to sysfs node ‘mem_limit’.
The value can be either in bytes or you can use mem suffixes.
In addition, you could change the value in runtime.
Examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># limit /dev/zram0 with 50MB memory
echo $((50*1024*1024)) &gt; /sys/block/zram0/mem_limit

# Using mem suffixes
echo 256K &gt; /sys/block/zram0/mem_limit
echo 512M &gt; /sys/block/zram0/mem_limit
echo 1G &gt; /sys/block/zram0/mem_limit

# To disable memory limit
echo 0 &gt; /sys/block/zram0/mem_limit
</pre></div>
</div>
</div>
<div class="section" id="activate">
<h2>6) Activate<a class="headerlink" href="#activate" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mkswap /dev/zram0
swapon /dev/zram0

mkfs.ext4 /dev/zram1
mount /dev/zram1 /tmp
</pre></div>
</div>
</div>
<div class="section" id="add-remove-zram-devices">
<h2>7) Add/remove zram devices<a class="headerlink" href="#add-remove-zram-devices" title="Permalink to this headline">¶</a></h2>
<p>zram provides a control interface, which enables dynamic (on-demand) device
addition and removal.</p>
<p>In order to add a new /dev/zramX device, perform a read operation on the hot_add
attribute. This will return either the new device’s device id (meaning that you
can use /dev/zram&lt;id&gt;) or an error code.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/class/zram-control/hot_add
1
</pre></div>
</div>
<p>To remove the existing /dev/zramX device (where X is a device id)
execute:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo X &gt; /sys/class/zram-control/hot_remove
</pre></div>
</div>
</div>
<div class="section" id="stats">
<h2>8) Stats<a class="headerlink" href="#stats" title="Permalink to this headline">¶</a></h2>
<p>Per-device statistics are exported as various nodes under /sys/block/zram&lt;id&gt;/</p>
<p>A brief description of exported device attributes follows. For more details
please read Documentation/ABI/testing/sysfs-block-zram.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 8%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>access</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>disksize</p></td>
<td><p>RW</p></td>
<td><p>show and set the device’s disk size</p></td>
</tr>
<tr class="row-odd"><td><p>initstate</p></td>
<td><p>RO</p></td>
<td><p>shows the initialization state of the device</p></td>
</tr>
<tr class="row-even"><td><p>reset</p></td>
<td><p>WO</p></td>
<td><p>trigger device reset</p></td>
</tr>
<tr class="row-odd"><td><p>mem_used_max</p></td>
<td><p>WO</p></td>
<td><p>reset the <cite>mem_used_max</cite> counter (see later)</p></td>
</tr>
<tr class="row-even"><td><p>mem_limit</p></td>
<td><p>WO</p></td>
<td><p>specifies the maximum amount of memory ZRAM can
use to store the compressed data</p></td>
</tr>
<tr class="row-odd"><td><p>writeback_limit</p></td>
<td><p>WO</p></td>
<td><p>specifies the maximum amount of write IO zram
can write out to backing device as 4KB unit</p></td>
</tr>
<tr class="row-even"><td><p>writeback_limit_enable</p></td>
<td><p>RW</p></td>
<td><p>show and set writeback_limit feature</p></td>
</tr>
<tr class="row-odd"><td><p>max_comp_streams</p></td>
<td><p>RW</p></td>
<td><p>the number of possible concurrent compress
operations</p></td>
</tr>
<tr class="row-even"><td><p>comp_algorithm</p></td>
<td><p>RW</p></td>
<td><p>show and change the compression algorithm</p></td>
</tr>
<tr class="row-odd"><td><p>compact</p></td>
<td><p>WO</p></td>
<td><p>trigger memory compaction</p></td>
</tr>
<tr class="row-even"><td><p>debug_stat</p></td>
<td><p>RO</p></td>
<td><p>this file is used for zram debugging purposes</p></td>
</tr>
<tr class="row-odd"><td><p>backing_dev</p></td>
<td><p>RW</p></td>
<td><p>set up backend storage for zram to write out</p></td>
</tr>
<tr class="row-even"><td><p>idle</p></td>
<td><p>WO</p></td>
<td><p>mark allocated slot as idle</p></td>
</tr>
</tbody>
</table>
<p>User space is advised to use the following files to read the device statistics.</p>
<p>File /sys/block/zram&lt;id&gt;/stat</p>
<p>Represents block layer statistics. Read Documentation/block/stat.rst for
details.</p>
<p>File /sys/block/zram&lt;id&gt;/io_stat</p>
<p>The stat file represents device’s I/O statistics not accounted by block
layer and, thus, not available in zram&lt;id&gt;/stat file. It consists of a
single line of text and contains the following stats separated by
whitespace:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 82%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>failed_reads</p></td>
<td><p>The number of failed reads</p></td>
</tr>
<tr class="row-even"><td><p>failed_writes</p></td>
<td><p>The number of failed writes</p></td>
</tr>
<tr class="row-odd"><td><p>invalid_io</p></td>
<td><p>The number of non-page-size-aligned I/O requests</p></td>
</tr>
<tr class="row-even"><td><p>notify_free</p></td>
<td><p>Depending on device usage scenario it may account</p>
<ol class="loweralpha simple">
<li><p>the number of pages freed because of swap slot free
notifications</p></li>
<li><p>the number of pages freed because of
REQ_OP_DISCARD requests sent by bio. The former ones are
sent to a swap block device when a swap slot is freed,
which implies that this disk is being used as a swap disk.</p></li>
</ol>
<p>The latter ones are sent by filesystem mounted with
discard option, whenever some data blocks are getting
discarded.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>File /sys/block/zram&lt;id&gt;/mm_stat</p>
<p>The mm_stat file represents the device’s mm statistics. It consists of a single
line of text and contains the following stats separated by whitespace:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>orig_data_size</p></td>
<td><p>uncompressed size of data stored in this disk.
Unit: bytes</p></td>
</tr>
<tr class="row-even"><td><p>compr_data_size</p></td>
<td><p>compressed size of data stored in this disk</p></td>
</tr>
<tr class="row-odd"><td><p>mem_used_total</p></td>
<td><p>the amount of memory allocated for this disk. This
includes allocator fragmentation and metadata overhead,
allocated for this disk. So, allocator space efficiency
can be calculated using compr_data_size and this statistic.
Unit: bytes</p></td>
</tr>
<tr class="row-even"><td><p>mem_limit</p></td>
<td><p>the maximum amount of memory ZRAM can use to store
the compressed data</p></td>
</tr>
<tr class="row-odd"><td><p>mem_used_max</p></td>
<td><p>the maximum amount of memory zram has consumed to
store the data</p></td>
</tr>
<tr class="row-even"><td><p>same_pages</p></td>
<td><p>the number of same element filled pages written to this disk.
No memory is allocated for such pages.</p></td>
</tr>
<tr class="row-odd"><td><p>pages_compacted</p></td>
<td><p>the number of pages freed during compaction</p></td>
</tr>
<tr class="row-even"><td><p>huge_pages</p></td>
<td><p>the number of incompressible pages</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>File /sys/block/zram&lt;id&gt;/bd_stat</p>
<p>The bd_stat file represents a device’s backing device statistics. It consists of
a single line of text and contains the following stats separated by whitespace:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>bd_count</p></td>
<td><p>size of data written in backing device.
Unit: 4K bytes</p></td>
</tr>
<tr class="row-even"><td><p>bd_reads</p></td>
<td><p>the number of reads from backing device
Unit: 4K bytes</p></td>
</tr>
<tr class="row-odd"><td><p>bd_writes</p></td>
<td><p>the number of writes to backing device
Unit: 4K bytes</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="deactivate">
<h2>9) Deactivate<a class="headerlink" href="#deactivate" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>swapoff /dev/zram0
umount /dev/zram1
</pre></div>
</div>
</div>
<div class="section" id="reset">
<h2>10) Reset<a class="headerlink" href="#reset" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Write any positive value to ‘reset’ sysfs node:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; /sys/block/zram0/reset
echo 1 &gt; /sys/block/zram1/reset
</pre></div>
</div>
<p>This frees all the memory allocated for the given device and
resets the disksize to zero. You must set the disksize again
before reusing the device.</p>
</div></blockquote>
</div>
<div class="section" id="optional-feature">
<h2>Optional Feature<a class="headerlink" href="#optional-feature" title="Permalink to this headline">¶</a></h2>
<div class="section" id="writeback">
<h3>writeback<a class="headerlink" href="#writeback" title="Permalink to this headline">¶</a></h3>
<p>With CONFIG_ZRAM_WRITEBACK, zram can write idle/incompressible page
to backing storage rather than keeping it in memory.
To use the feature, admin should set up backing device via:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo /dev/sda5 &gt; /sys/block/zramX/backing_dev
</pre></div>
</div>
<p>before disksize setting. It supports only partition at this moment.
If admin wants to use incompressible page writeback, they could do via:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo huge &gt; /sys/block/zramX/writeback
</pre></div>
</div>
<p>To use idle page writeback, first, user need to declare zram pages
as idle:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo all &gt; /sys/block/zramX/idle
</pre></div>
</div>
<p>From now on, any pages on zram are idle pages. The idle mark
will be removed until someone requests access of the block.
IOW, unless there is access request, those pages are still idle pages.</p>
<p>Admin can request writeback of those idle pages at right timing via:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo idle &gt; /sys/block/zramX/writeback
</pre></div>
</div>
<p>With the command, zram writeback idle pages from memory to the storage.</p>
<p>If there are lots of write IO with flash device, potentially, it has
flash wearout problem so that admin needs to design write limitation
to guarantee storage health for entire product life.</p>
<p>To overcome the concern, zram supports “writeback_limit” feature.
The “writeback_limit_enable“‘s default value is 0 so that it doesn’t limit
any writeback. IOW, if admin wants to apply writeback budget, he should
enable writeback_limit_enable via:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 1 &gt; /sys/block/zramX/writeback_limit_enable
</pre></div>
</div>
<p>Once writeback_limit_enable is set, zram doesn’t allow any writeback
until admin sets the budget via /sys/block/zramX/writeback_limit.</p>
<p>(If admin doesn’t enable writeback_limit_enable, writeback_limit’s value
assigned via /sys/block/zramX/writeback_limit is meaningless.)</p>
<p>If admin want to limit writeback as per-day 400M, he could do it
like below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ MB_SHIFT=20
$ 4K_SHIFT=12
$ echo $((400&lt;&lt;MB_SHIFT&gt;&gt;4K_SHIFT)) &gt; \
        /sys/block/zram0/writeback_limit.
$ echo 1 &gt; /sys/block/zram0/writeback_limit_enable
</pre></div>
</div>
<p>If admins want to allow further write again once the bugdet is exhausted,
he could do it like below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo $((400&lt;&lt;MB_SHIFT&gt;&gt;4K_SHIFT)) &gt; \
        /sys/block/zram0/writeback_limit
</pre></div>
</div>
<p>If admin wants to see remaining writeback budget since last set:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat /sys/block/zramX/writeback_limit
</pre></div>
</div>
<p>If admin want to disable writeback limit, he could do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 0 &gt; /sys/block/zramX/writeback_limit_enable
</pre></div>
</div>
<p>The writeback_limit count will reset whenever you reset zram (e.g.,
system reboot, echo 1 &gt; /sys/block/zramX/reset) so keeping how many of
writeback happened until you reset the zram to allocate extra writeback
budget in next setting is user’s job.</p>
<p>If admin wants to measure writeback count in a certain period, he could
know it via /sys/block/zram0/bd_stat’s 3rd column.</p>
</div>
</div>
<div class="section" id="memory-tracking">
<h2>memory tracking<a class="headerlink" href="#memory-tracking" title="Permalink to this headline">¶</a></h2>
<p>With CONFIG_ZRAM_MEMORY_TRACKING, user can know information of the
zram block. It could be useful to catch cold or incompressible
pages of the process with*pagemap.</p>
<p>If you enable the feature, you could see block state via
/sys/kernel/debug/zram/zram0/block_state”. The output is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>300    75.033841 .wh.
301    63.806904 s...
302    63.806919 ..hi
</pre></div>
</div>
<dl>
<dt>First column</dt><dd><p>zram’s block index.</p>
</dd>
<dt>Second column</dt><dd><p>access time since the system was booted</p>
</dd>
<dt>Third column</dt><dd><p>state of the block:</p>
<dl class="simple">
<dt>s:</dt><dd><p>same page</p>
</dd>
<dt>w:</dt><dd><p>written page to backing store</p>
</dd>
<dt>h:</dt><dd><p>huge page</p>
</dd>
<dt>i:</dt><dd><p>idle page</p>
</dd>
</dl>
</dd>
</dl>
<p>First line of above example says 300th block is accessed at 75.033841sec
and the block’s state is huge so it is written back to the backing
storage. It’s a debugging feature so anyone shouldn’t rely on it to work
properly.</p>
<p>Nitin Gupta
<a class="reference external" href="mailto:ngupta&#37;&#52;&#48;vflare&#46;org">ngupta<span>&#64;</span>vflare<span>&#46;</span>org</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="drbd/index.html" class="btn btn-neutral float-right" title="Distributed Replicated Block Device - DRBD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ramdisk.html" class="btn btn-neutral float-left" title="Using the RAM disk block device with Linux" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>