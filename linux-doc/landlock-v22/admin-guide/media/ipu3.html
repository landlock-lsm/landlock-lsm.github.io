

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.9. Intel Image Processing Unit 3 (IPU3) Imaging Unit (ImgU) driver &mdash; The Linux Kernel 5.10.0-rc1+ documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.10. The ivtv driver" href="ivtv.html" />
    <link rel="prev" title="6.8. i.MX7 Video Capture Driver" href="imx7.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.10.0-rc1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pstore-blk.html">pstore block oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blockdev/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md.html">RAID arrays</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Media subsystem admin and user guide</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html#the-media-subsystem">The media subsystem</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="building.html">2. Building support for a media device</a></li>
<li class="toctree-l4"><a class="reference internal" href="remote-controller.html">3. Infrared remote control support in video4linux drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvb.html">4. Digital TV</a></li>
<li class="toctree-l4"><a class="reference internal" href="cardlist.html">5. Cards List</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="v4l-drivers.html">6. Video4Linux (V4L) driver-specific documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvb-drivers.html">7. Digital TV driver-specific documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="cec-drivers.html">8. CEC driver-specific documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
          <li><a href="index.html">Media subsystem admin and user guide</a> &raquo;</li>
        
          <li><a href="v4l-drivers.html"><span class="section-number">6. </span>Video4Linux (V4L) driver-specific documentation</a> &raquo;</li>
        
      <li><span class="section-number">6.9. </span>Intel Image Processing Unit 3 (IPU3) Imaging Unit (ImgU) driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/media/ipu3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="intel-image-processing-unit-3-ipu3-imaging-unit-imgu-driver">
<h1><span class="section-number">6.9. </span>Intel Image Processing Unit 3 (IPU3) Imaging Unit (ImgU) driver<a class="headerlink" href="#intel-image-processing-unit-3-ipu3-imaging-unit-imgu-driver" title="Permalink to this headline">¶</a></h1>
<p>Copyright © 2018 Intel Corporation</p>
<div class="section" id="introduction">
<h2><span class="section-number">6.9.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This file documents the Intel IPU3 (3rd generation Image Processing Unit)
Imaging Unit drivers located under drivers/media/pci/intel/ipu3 (CIO2) as well
as under drivers/staging/media/ipu3 (ImgU).</p>
<p>The Intel IPU3 found in certain Kaby Lake (as well as certain Sky Lake)
platforms (U/Y processor lines) is made up of two parts namely the Imaging Unit
(ImgU) and the CIO2 device (MIPI CSI2 receiver).</p>
<p>The CIO2 device receives the raw Bayer data from the sensors and outputs the
frames in a format that is specific to the IPU3 (for consumption by the IPU3
ImgU). The CIO2 driver is available as drivers/media/pci/intel/ipu3/ipu3-cio2*
and is enabled through the CONFIG_VIDEO_IPU3_CIO2 config option.</p>
<p>The Imaging Unit (ImgU) is responsible for processing images captured
by the IPU3 CIO2 device. The ImgU driver sources can be found under
drivers/staging/media/ipu3 directory. The driver is enabled through the
CONFIG_VIDEO_IPU3_IMGU config option.</p>
<p>The two driver modules are named ipu3_csi2 and ipu3_imgu, respectively.</p>
<p>The drivers has been tested on Kaby Lake platforms (U/Y processor lines).</p>
<p>Both of the drivers implement V4L2, Media Controller and V4L2 sub-device
interfaces. The IPU3 CIO2 driver supports camera sensors connected to the CIO2
MIPI CSI-2 interfaces through V4L2 sub-device sensor drivers.</p>
</div>
<div class="section" id="cio2">
<h2><span class="section-number">6.9.2. </span>CIO2<a class="headerlink" href="#cio2" title="Permalink to this headline">¶</a></h2>
<p>The CIO2 is represented as a single V4L2 subdev, which provides a V4L2 subdev
interface to the user space. There is a video node for each CSI-2 receiver,
with a single media controller interface for the entire device.</p>
<p>The CIO2 contains four independent capture channel, each with its own MIPI CSI-2
receiver and DMA engine. Each channel is modelled as a V4L2 sub-device exposed
to userspace as a V4L2 sub-device node and has two pads:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>pad</p></td>
<td><p>direction</p></td>
<td><p>purpose</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>sink</p></td>
<td><p>MIPI CSI-2 input, connected to the sensor subdev</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>source</p></td>
<td><p>Raw video capture, connected to the V4L2 video interface</p></td>
</tr>
</tbody>
</table>
<p>The V4L2 video interfaces model the DMA engines. They are exposed to userspace
as V4L2 video device nodes.</p>
<div class="section" id="capturing-frames-in-raw-bayer-format">
<h3><span class="section-number">6.9.2.1. </span>Capturing frames in raw Bayer format<a class="headerlink" href="#capturing-frames-in-raw-bayer-format" title="Permalink to this headline">¶</a></h3>
<p>CIO2 MIPI CSI2 receiver is used to capture frames (in packed raw Bayer format)
from the raw sensors connected to the CSI2 ports. The captured frames are used
as input to the ImgU driver.</p>
<p>Image processing using IPU3 ImgU requires tools such as raw2pnm <a class="footnote-reference brackets" href="#f1" id="id1">2</a>, and
yavta <a class="footnote-reference brackets" href="#f2" id="id2">3</a> due to the following unique requirements and / or features specific
to IPU3.</p>
<p>– The IPU3 CSI2 receiver outputs the captured frames from the sensor in packed
raw Bayer format that is specific to IPU3.</p>
<p>– Multiple video nodes have to be operated simultaneously.</p>
<p>Let us take the example of ov5670 sensor connected to CSI2 port 0, for a
2592x1944 image capture.</p>
<p>Using the media contorller APIs, the ov5670 sensor is configured to send
frames in packed raw Bayer format to IPU3 CSI2 receiver.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># This example assumes /dev/media0 as the CIO2 media device
export MDEV=/dev/media0

# and that ov5670 sensor is connected to i2c bus 10 with address 0x36
export SDEV=$(media-ctl -d $MDEV -e &quot;ov5670 10-0036&quot;)

# Establish the link for the media devices using media-ctl [#f3]_
media-ctl -d $MDEV -l &quot;ov5670:0 -&gt; ipu3-csi2 0:0[1]&quot;

# Set the format for the media devices
media-ctl -d $MDEV -V &quot;ov5670:0 [fmt:SGRBG10/2592x1944]&quot;
media-ctl -d $MDEV -V &quot;ipu3-csi2 0:0 [fmt:SGRBG10/2592x1944]&quot;
media-ctl -d $MDEV -V &quot;ipu3-csi2 0:1 [fmt:SGRBG10/2592x1944]&quot;
</pre></div>
</div>
<p>Once the media pipeline is configured, desired sensor specific settings
(such as exposure and gain settings) can be set, using the yavta tool.</p>
<p>e.g</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>yavta -w 0x009e0903 444 $SDEV
yavta -w 0x009e0913 1024 $SDEV
yavta -w 0x009e0911 2046 $SDEV
</pre></div>
</div>
<p>Once the desired sensor settings are set, frame captures can be done as below.</p>
<p>e.g</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>yavta --data-prefix -u -c10 -n5 -I -s2592x1944 --file=/tmp/frame-#.bin \
      -f IPU3_SGRBG10 $(media-ctl -d $MDEV -e &quot;ipu3-cio2 0&quot;)
</pre></div>
</div>
<p>With the above command, 10 frames are captured at 2592x1944 resolution, with
sGRBG10 format and output as IPU3_SGRBG10 format.</p>
<p>The captured frames are available as /tmp/frame-#.bin files.</p>
</div>
</div>
<div class="section" id="imgu">
<h2><span class="section-number">6.9.3. </span>ImgU<a class="headerlink" href="#imgu" title="Permalink to this headline">¶</a></h2>
<p>The ImgU is represented as two V4L2 subdevs, each of which provides a V4L2
subdev interface to the user space.</p>
<p>Each V4L2 subdev represents a pipe, which can support a maximum of 2 streams.
This helps to support advanced camera features like Continuous View Finder (CVF)
and Snapshot During Video(SDV).</p>
<p>The ImgU contains two independent pipes, each modelled as a V4L2 sub-device
exposed to userspace as a V4L2 sub-device node.</p>
<p>Each pipe has two sink pads and three source pads for the following purpose:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>pad</p></td>
<td><p>direction</p></td>
<td><p>purpose</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>sink</p></td>
<td><p>Input raw video stream</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>sink</p></td>
<td><p>Processing parameters</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>source</p></td>
<td><p>Output processed video stream</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>source</p></td>
<td><p>Output viewfinder video stream</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>source</p></td>
<td><p>3A statistics</p></td>
</tr>
</tbody>
</table>
<p>Each pad is connected to a corresponding V4L2 video interface, exposed to
userspace as a V4L2 video device node.</p>
<div class="section" id="device-operation">
<h3><span class="section-number">6.9.3.1. </span>Device operation<a class="headerlink" href="#device-operation" title="Permalink to this headline">¶</a></h3>
<p>With ImgU, once the input video node (“ipu3-imgu 0/1”:0, in
&lt;entity&gt;:&lt;pad-number&gt; format) is queued with buffer (in packed raw Bayer
format), ImgU starts processing the buffer and produces the video output in YUV
format and statistics output on respective output nodes. The driver is expected
to have buffers ready for all of parameter, output and statistics nodes, when
input video node is queued with buffer.</p>
<p>At a minimum, all of input, main output, 3A statistics and viewfinder
video nodes should be enabled for IPU3 to start image processing.</p>
<p>Each ImgU V4L2 subdev has the following set of video nodes.</p>
</div>
<div class="section" id="input-output-and-viewfinder-video-nodes">
<h3><span class="section-number">6.9.3.2. </span>input, output and viewfinder video nodes<a class="headerlink" href="#input-output-and-viewfinder-video-nodes" title="Permalink to this headline">¶</a></h3>
<p>The frames (in packed raw Bayer format specific to the IPU3) received by the
input video node is processed by the IPU3 Imaging Unit and are output to 2 video
nodes, with each targeting a different purpose (main output and viewfinder
output).</p>
<p>Details onand the Bayer format specific to the IPU3 can be found in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-srggb10-ipu3.html#v4l2-pix-fmt-ipu3-sbggr10"><span class="std std-ref">V4L2_PIX_FMT_IPU3_SBGGR10 (‘ip3b’), V4L2_PIX_FMT_IPU3_SGBRG10 (‘ip3g’), V4L2_PIX_FMT_IPU3_SGRBG10 (‘ip3G’), V4L2_PIX_FMT_IPU3_SRGGB10 (‘ip3r’)</span></a>.</p>
<p>The driver supports V4L2 Video Capture Interface as defined at <a class="reference internal" href="../../userspace-api/media/v4l/devices.html#devices"><span class="std std-ref">Interfaces</span></a>.</p>
<p>Only the multi-planar API is supported. More details can be found at
<a class="reference internal" href="../../userspace-api/media/v4l/planar-apis.html#planar-apis"><span class="std std-ref">Single- and multi-planar APIs</span></a>.</p>
</div>
<div class="section" id="parameters-video-node">
<h3><span class="section-number">6.9.3.3. </span>Parameters video node<a class="headerlink" href="#parameters-video-node" title="Permalink to this headline">¶</a></h3>
<p>The parameters video node receives the ImgU algorithm parameters that are used
to configure how the ImgU algorithms process the image.</p>
<p>Details on processing parameters specific to the IPU3 can be found in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#v4l2-meta-fmt-params"><span class="std std-ref">V4L2_META_FMT_IPU3_PARAMS (‘ip3p’), V4L2_META_FMT_IPU3_3A (‘ip3s’)</span></a>.</p>
</div>
<div class="section" id="a-statistics-video-node">
<h3><span class="section-number">6.9.3.4. </span>3A statistics video node<a class="headerlink" href="#a-statistics-video-node" title="Permalink to this headline">¶</a></h3>
<p>3A statistics video node is used by the ImgU driver to output the 3A (auto
focus, auto exposure and auto white balance) statistics for the frames that are
being processed by the ImgU to user space applications. User space applications
can use this statistics data to compute the desired algorithm parameters for
the ImgU.</p>
</div>
</div>
<div class="section" id="configuring-the-intel-ipu3">
<h2><span class="section-number">6.9.4. </span>Configuring the Intel IPU3<a class="headerlink" href="#configuring-the-intel-ipu3" title="Permalink to this headline">¶</a></h2>
<p>The IPU3 ImgU pipelines can be configured using the Media Controller, defined at
<a class="reference internal" href="../../userspace-api/media/mediactl/media-controller.html#media-controller"><span class="std std-ref">Part IV - Media Controller API</span></a>.</p>
<div class="section" id="running-mode-and-firmware-binary-selection">
<h3><span class="section-number">6.9.4.1. </span>Running mode and firmware binary selection<a class="headerlink" href="#running-mode-and-firmware-binary-selection" title="Permalink to this headline">¶</a></h3>
<p>ImgU works based on firmware, currently the ImgU firmware support run 2 pipes in
time-sharing with single input frame data. Each pipe can run at certain mode -
“VIDEO” or “STILL”, “VIDEO” mode is commonly used for video frames capture, and
“STILL” is used for still frame capture. However, you can also select “VIDEO” to
capture still frames if you want to capture images with less system load and
power. For “STILL” mode, ImgU will try to use smaller BDS factor and output
larger bayer frame for further YUV processing than “VIDEO” mode to get high
quality images. Besides, “STILL” mode need XNR3 to do noise reduction, hence
“STILL” mode will need more power and memory bandwidth than “VIDEO” mode. TNR
will be enabled in “VIDEO” mode and bypassed by “STILL” mode. ImgU is running at
“VIDEO” mode by default, the user can use v4l2 control V4L2_CID_INTEL_IPU3_MODE
(currently defined in drivers/staging/media/ipu3/include/intel-ipu3.h) to query
and set the running mode. For user, there is no difference for buffer queueing
between the “VIDEO” and “STILL” mode, mandatory input and main output node
should be enabled and buffers need be queued, the statistics and the view-finder
queues are optional.</p>
<p>The firmware binary will be selected according to current running mode, such log
“using binary if_to_osys_striped ” or “using binary if_to_osys_primary_striped”
could be observed if you enable the ImgU dynamic debug, the binary
if_to_osys_striped is selected for “VIDEO” and the binary
“if_to_osys_primary_striped” is selected for “STILL”.</p>
</div>
<div class="section" id="processing-the-image-in-raw-bayer-format">
<h3><span class="section-number">6.9.4.2. </span>Processing the image in raw Bayer format<a class="headerlink" href="#processing-the-image-in-raw-bayer-format" title="Permalink to this headline">¶</a></h3>
<div class="section" id="configuring-imgu-v4l2-subdev-for-image-processing">
<h4><span class="section-number">6.9.4.2.1. </span>Configuring ImgU V4L2 subdev for image processing<a class="headerlink" href="#configuring-imgu-v4l2-subdev-for-image-processing" title="Permalink to this headline">¶</a></h4>
<p>The ImgU V4L2 subdevs have to be configured with media controller APIs to have
all the video nodes setup correctly.</p>
<p>Let us take “ipu3-imgu 0” subdev as an example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>media-ctl -d $MDEV -r
media-ctl -d $MDEV -l &quot;ipu3-imgu 0 input&quot;:0 -&gt; &quot;ipu3-imgu 0&quot;:0[1]
media-ctl -d $MDEV -l &quot;ipu3-imgu 0&quot;:2 -&gt; &quot;ipu3-imgu 0 output&quot;:0[1]
media-ctl -d $MDEV -l &quot;ipu3-imgu 0&quot;:3 -&gt; &quot;ipu3-imgu 0 viewfinder&quot;:0[1]
media-ctl -d $MDEV -l &quot;ipu3-imgu 0&quot;:4 -&gt; &quot;ipu3-imgu 0 3a stat&quot;:0[1]
</pre></div>
</div>
<p>Also the pipe mode of the corresponding V4L2 subdev should be set as desired
(e.g 0 for video mode or 1 for still mode) through the control id 0x009819a1 as
below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>yavta -w &quot;0x009819A1 1&quot; /dev/v4l-subdev7
</pre></div>
</div>
<p>Certain hardware blocks in ImgU pipeline can change the frame resolution by
cropping or scaling, these hardware blocks include Input Feeder(IF), Bayer Down
Scaler (BDS) and Geometric Distortion Correction (GDC).
There is also a block which can change the frame resolution - YUV Scaler, it is
only applicable to the secondary output.</p>
<p>RAW Bayer frames go through these ImgU pipeline hardware blocks and the final
processed image output to the DDR memory.</p>
<div class="figure align-default" id="id6">
<img alt="ipu3 resolution blocks image" src="../../_images/ipu3_rcb.svg" /><p class="caption"><span class="caption-text">IPU3 resolution change hardware blocks</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p><strong>Input Feeder</strong></p>
<p>Input Feeder gets the Bayer frame data from the sensor, it can enable cropping
of lines and columns from the frame and then store pixels into device’s internal
pixel buffer which are ready to readout by following blocks.</p>
<p><strong>Bayer Down Scaler</strong></p>
<p>Bayer Down Scaler is capable of performing image scaling in Bayer domain, the
downscale factor can be configured from 1X to 1/4X in each axis with
configuration steps of 0.03125 (1/32).</p>
<p><strong>Geometric Distortion Correction</strong></p>
<p>Geometric Distortion Correction is used to performe correction of distortions
and image filtering. It needs some extra filter and envelop padding pixels to
work, so the input resolution of GDC should be larger than the output
resolution.</p>
<p><strong>YUV Scaler</strong></p>
<p>YUV Scaler which similar with BDS, but it is mainly do image down scaling in
YUV domain, it can support up to 1/12X down scaling, but it can not be applied
to the main output.</p>
<p>The ImgU V4L2 subdev has to be configured with the supported resolutions in all
the above hardware blocks, for a given input resolution.
For a given supported resolution for an input frame, the Input Feeder, Bayer
Down Scaler and GDC blocks should be configured with the supported resolutions
as each hardware block has its own alignment requirement.</p>
<p>You must configure the output resolution of the hardware blocks smartly to meet
the hardware requirement along with keeping the maximum field of view. The
intermediate resolutions can be generated by specific tool -</p>
<p><a class="reference external" href="https://github.com/intel/intel-ipu3-pipecfg">https://github.com/intel/intel-ipu3-pipecfg</a></p>
<p>This tool can be used to generate intermediate resolutions. More information can
be obtained by looking at the following IPU3 ImgU configuration table.</p>
<p><a class="reference external" href="https://chromium.googlesource.com/chromiumos/overlays/board-overlays/+/master">https://chromium.googlesource.com/chromiumos/overlays/board-overlays/+/master</a></p>
<p>Under baseboard-poppy/media-libs/cros-camera-hal-configs-poppy/files/gcss
directory, graph_settings_ov5670.xml can be used as an example.</p>
<p>The following steps prepare the ImgU pipeline for the image processing.</p>
<p>1. The ImgU V4L2 subdev data format should be set by using the
VIDIOC_SUBDEV_S_FMT on pad 0, using the GDC width and height obtained above.</p>
<p>2. The ImgU V4L2 subdev cropping should be set by using the
VIDIOC_SUBDEV_S_SELECTION on pad 0, with V4L2_SEL_TGT_CROP as the target,
using the input feeder height and width.</p>
<p>3. The ImgU V4L2 subdev composing should be set by using the
VIDIOC_SUBDEV_S_SELECTION on pad 0, with V4L2_SEL_TGT_COMPOSE as the target,
using the BDS height and width.</p>
<p>For the ov5670 example, for an input frame with a resolution of 2592x1944
(which is input to the ImgU subdev pad 0), the corresponding resolutions
for input feeder, BDS and GDC are 2592x1944, 2592x1944 and 2560x1920
respectively.</p>
<p>Once this is done, the received raw Bayer frames can be input to the ImgU
V4L2 subdev as below, using the open source application v4l2n <a class="footnote-reference brackets" href="#f1" id="id3">2</a>.</p>
<p>For an image captured with 2592x1944 <a class="footnote-reference brackets" href="#f4" id="id4">5</a> resolution, with desired output
resolution as 2560x1920 and viewfinder resolution as 2560x1920, the following
v4l2n command can be used. This helps process the raw Bayer frames and produces
the desired results for the main output image and the viewfinder output, in NV12
format.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>v4l2n --pipe=4 --load=/tmp/frame-#.bin --open=/dev/video4
      --fmt=type:VIDEO_OUTPUT_MPLANE,width=2592,height=1944,pixelformat=0X47337069 \
      --reqbufs=type:VIDEO_OUTPUT_MPLANE,count:1 --pipe=1 \
      --output=/tmp/frames.out --open=/dev/video5 \
      --fmt=type:VIDEO_CAPTURE_MPLANE,width=2560,height=1920,pixelformat=NV12 \
      --reqbufs=type:VIDEO_CAPTURE_MPLANE,count:1 --pipe=2 \
      --output=/tmp/frames.vf --open=/dev/video6 \
      --fmt=type:VIDEO_CAPTURE_MPLANE,width=2560,height=1920,pixelformat=NV12 \
      --reqbufs=type:VIDEO_CAPTURE_MPLANE,count:1 --pipe=3 --open=/dev/video7 \
      --output=/tmp/frames.3A --fmt=type:META_CAPTURE,? \
      --reqbufs=count:1,type:META_CAPTURE --pipe=1,2,3,4 --stream=5
</pre></div>
</div>
<p>You can also use yavta <a class="footnote-reference brackets" href="#f2" id="id5">3</a> command to do same thing as above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>yavta --data-prefix -Bcapture-mplane -c10 -n5 -I -s2592x1944 \
      --file=frame-#.out-f NV12 /dev/video5 &amp; \
yavta --data-prefix -Bcapture-mplane -c10 -n5 -I -s2592x1944 \
      --file=frame-#.vf -f NV12 /dev/video6 &amp; \
yavta --data-prefix -Bmeta-capture -c10 -n5 -I \
      --file=frame-#.3a /dev/video7 &amp; \
yavta --data-prefix -Boutput-mplane -c10 -n5 -I -s2592x1944 \
      --file=/tmp/frame-in.cio2 -f IPU3_SGRBG10 /dev/video4
</pre></div>
</div>
<p>where /dev/video4, /dev/video5, /dev/video6 and /dev/video7 devices point to
input, output, viewfinder and 3A statistics video nodes respectively.</p>
</div>
</div>
<div class="section" id="converting-the-raw-bayer-image-into-yuv-domain">
<h3><span class="section-number">6.9.4.3. </span>Converting the raw Bayer image into YUV domain<a class="headerlink" href="#converting-the-raw-bayer-image-into-yuv-domain" title="Permalink to this headline">¶</a></h3>
<p>The processed images after the above step, can be converted to YUV domain
as below.</p>
<div class="section" id="main-output-frames">
<h4><span class="section-number">6.9.4.3.1. </span>Main output frames<a class="headerlink" href="#main-output-frames" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>raw2pnm -x2560 -y1920 -fNV12 /tmp/frames.out /tmp/frames.out.ppm
</pre></div>
</div>
<p>where 2560x1920 is output resolution, NV12 is the video format, followed
by input frame and output PNM file.</p>
</div>
<div class="section" id="viewfinder-output-frames">
<h4><span class="section-number">6.9.4.3.2. </span>Viewfinder output frames<a class="headerlink" href="#viewfinder-output-frames" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>raw2pnm -x2560 -y1920 -fNV12 /tmp/frames.vf /tmp/frames.vf.ppm
</pre></div>
</div>
<p>where 2560x1920 is output resolution, NV12 is the video format, followed
by input frame and output PNM file.</p>
</div>
</div>
</div>
<div class="section" id="example-user-space-code-for-ipu3">
<h2><span class="section-number">6.9.5. </span>Example user space code for IPU3<a class="headerlink" href="#example-user-space-code-for-ipu3" title="Permalink to this headline">¶</a></h2>
<p>User space code that configures and uses IPU3 is available here.</p>
<p><a class="reference external" href="https://chromium.googlesource.com/chromiumos/platform/arc-camera/+/master/">https://chromium.googlesource.com/chromiumos/platform/arc-camera/+/master/</a></p>
<p>The source can be located under hal/intel directory.</p>
</div>
<div class="section" id="overview-of-ipu3-pipeline">
<h2><span class="section-number">6.9.6. </span>Overview of IPU3 pipeline<a class="headerlink" href="#overview-of-ipu3-pipeline" title="Permalink to this headline">¶</a></h2>
<p>IPU3 pipeline has a number of image processing stages, each of which takes a
set of parameters as input. The major stages of pipelines are shown here:</p>
<div class="figure align-default" id="id7">
<img alt="IPU3 ImgU Pipeline" src="../../_images/DOT-88d88d5f33c61693bbb55d0f9400235e792a0188.svg" /><p class="caption"><span class="caption-text">IPU3 ImgU Pipeline Diagram</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>The table below presents a description of the above algorithms.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Optical Black Correction</p></td>
<td><p>Optical Black Correction block subtracts a pre-defined
value from the respective pixel values to obtain better
image quality.
Defined in <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_obgrid_param" title="ipu3_uapi_obgrid_param"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_obgrid_param</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>Linearization</p></td>
<td><p>This algo block uses linearization parameters to
address non-linearity sensor effects. The Lookup table
table is defined in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_isp_lin_vmem_params" title="ipu3_uapi_isp_lin_vmem_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_isp_lin_vmem_params</span></code></a>.</p></td>
</tr>
<tr class="row-even"><td><p>SHD</p></td>
<td><p>Lens shading correction is used to correct spatial
non-uniformity of the pixel response due to optical
lens shading. This is done by applying a different gain
for each pixel. The gain, black level etc are
configured in <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_shd_config_static" title="ipu3_uapi_shd_config_static"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_shd_config_static</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>BNR</p></td>
<td><p>Bayer noise reduction block removes image noise by
applying a bilateral filter.
See <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_bnr_static_config" title="ipu3_uapi_bnr_static_config"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_bnr_static_config</span></code></a> for details.</p></td>
</tr>
<tr class="row-even"><td><p>ANR</p></td>
<td><p>Advanced Noise Reduction is a block based algorithm
that performs noise reduction in the Bayer domain. The
convolution matrix etc can be found in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_anr_config" title="ipu3_uapi_anr_config"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_anr_config</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>DM</p></td>
<td><p>Demosaicing converts raw sensor data in Bayer format
into RGB (Red, Green, Blue) presentation. Then add
outputs of estimation of Y channel for following stream
processing by Firmware. The struct is defined as
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_dm_config" title="ipu3_uapi_dm_config"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_dm_config</span></code></a>.</p></td>
</tr>
<tr class="row-even"><td><p>Color Correction</p></td>
<td><p>Color Correction algo transforms sensor specific color
space to the standard “sRGB” color space. This is done
by applying 3x3 matrix defined in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_ccm_mat_config" title="ipu3_uapi_ccm_mat_config"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_ccm_mat_config</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>Gamma correction</p></td>
<td><p>Gamma correction <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_gamma_config" title="ipu3_uapi_gamma_config"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_gamma_config</span></code></a> is a
basic non-linear tone mapping correction that is
applied per pixel for each pixel component.</p></td>
</tr>
<tr class="row-even"><td><p>CSC</p></td>
<td><p>Color space conversion transforms each pixel from the
RGB primary presentation to YUV (Y: brightness,
UV: Luminance) presentation. This is done by applying
a 3x3 matrix defined in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_csc_mat_config" title="ipu3_uapi_csc_mat_config"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_csc_mat_config</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>CDS</p></td>
<td><p>Chroma down sampling
After the CSC is performed, the Chroma Down Sampling
is applied for a UV plane down sampling by a factor
of 2 in each direction for YUV 4:2:0 using a 4x2
configurable filter <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_cds_params" title="ipu3_uapi_cds_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_cds_params</span></code></a>.</p></td>
</tr>
<tr class="row-even"><td><p>CHNR</p></td>
<td><p>Chroma noise reduction
This block processes only the chrominance pixels and
performs noise reduction by cleaning the high
frequency noise.
See struct struct ipu3_uapi_yuvp1_chnr_config.</p></td>
</tr>
<tr class="row-odd"><td><p>TCC</p></td>
<td><p>Total color correction as defined in struct
struct ipu3_uapi_yuvp2_tcc_static_config.</p></td>
</tr>
<tr class="row-even"><td><p>XNR3</p></td>
<td><p>eXtreme Noise Reduction V3 is the third revision of
noise reduction algorithm used to improve image
quality. This removes the low frequency noise in the
captured image. Two related structs are  being defined,
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_isp_xnr3_params" title="ipu3_uapi_isp_xnr3_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_isp_xnr3_params</span></code></a> for ISP data memory
and <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_isp_xnr3_vmem_params" title="ipu3_uapi_isp_xnr3_vmem_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_isp_xnr3_vmem_params</span></code></a> for vector
memory.</p></td>
</tr>
<tr class="row-odd"><td><p>TNR</p></td>
<td><p>Temporal Noise Reduction block compares successive
frames in time to remove anomalies / noise in pixel
values. <a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_isp_tnr3_vmem_params" title="ipu3_uapi_isp_tnr3_vmem_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_isp_tnr3_vmem_params</span></code></a> and
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_isp_tnr3_params" title="ipu3_uapi_isp_tnr3_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_isp_tnr3_params</span></code></a> are defined for ISP
vector and data memory respectively.</p></td>
</tr>
</tbody>
</table>
<p>Other often encountered acronyms not listed in above table:</p>
<blockquote>
<div><dl class="simple">
<dt>ACC</dt><dd><p>Accelerator cluster</p>
</dd>
<dt>AWB_FR</dt><dd><p>Auto white balance filter response statistics</p>
</dd>
<dt>BDS</dt><dd><p>Bayer downscaler parameters</p>
</dd>
<dt>CCM</dt><dd><p>Color correction matrix coefficients</p>
</dd>
<dt>IEFd</dt><dd><p>Image enhancement filter directed</p>
</dd>
<dt>Obgrid</dt><dd><p>Optical black level compensation</p>
</dd>
<dt>OSYS</dt><dd><p>Output system configuration</p>
</dd>
<dt>ROI</dt><dd><p>Region of interest</p>
</dd>
<dt>YDS</dt><dd><p>Y down sampling</p>
</dd>
<dt>YTM</dt><dd><p>Y-tone mapping</p>
</dd>
</dl>
</div></blockquote>
<p>A few stages of the pipeline will be executed by firmware running on the ISP
processor, while many others will use a set of fixed hardware blocks also
called accelerator cluster (ACC) to crunch pixel data and produce statistics.</p>
<p>ACC parameters of individual algorithms, as defined by
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_acc_param" title="ipu3_uapi_acc_param"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_acc_param</span></code></a>, can be chosen to be applied by the user
space through struct struct ipu3_uapi_flags embedded in
<a class="reference internal" href="../../userspace-api/media/v4l/pixfmt-meta-intel-ipu3.html#c.ipu3_uapi_params" title="ipu3_uapi_params"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ipu3_uapi_params</span></code></a> structure. For parameters that are configured as
not enabled by the user space, the corresponding structs are ignored by the
driver, in which case the existing configuration of the algorithm will be
preserved.</p>
</div>
<div class="section" id="references">
<h2><span class="section-number">6.9.7. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="f5"><span class="brackets">1</span></dt>
<dd><p>drivers/staging/media/ipu3/include/intel-ipu3.h</p>
</dd>
<dt class="label" id="f1"><span class="brackets">2</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://github.com/intel/nvt">https://github.com/intel/nvt</a></p>
</dd>
<dt class="label" id="f2"><span class="brackets">3</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p><a class="reference external" href="http://git.ideasonboard.org/yavta.git">http://git.ideasonboard.org/yavta.git</a></p>
</dd>
<dt class="label" id="f3"><span class="brackets">4</span></dt>
<dd><p><a class="reference external" href="http://git.ideasonboard.org/?p=media-ctl.git;a=summary">http://git.ideasonboard.org/?p=media-ctl.git;a=summary</a></p>
</dd>
<dt class="label" id="f4"><span class="brackets"><a class="fn-backref" href="#id4">5</a></span></dt>
<dd><p>ImgU limitation requires an additional 16x16 for all input resolutions</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ivtv.html" class="btn btn-neutral float-right" title="6.10. The ivtv driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="imx7.html" class="btn btn-neutral float-left" title="6.8. i.MX7 Video Capture Driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>