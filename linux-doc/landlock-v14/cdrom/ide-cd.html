

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IDE-CD driver documentation &mdash; The Linux Kernel 5.6.0-rc3+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Packet writing" href="packet-writing.html" />
    <link rel="prev" title="A Linux CD-ROM standard" href="cdrom-standard.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">cdrom</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cdrom-standard.html">A Linux CD-ROM standard</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">IDE-CD driver documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation">2. Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage">3. Basic usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-problems">4. Common problems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdchange-c">5. cdchange.c</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packet-writing.html">Packet writing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">cdrom</a> &raquo;</li>
        
      <li>IDE-CD driver documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cdrom/ide-cd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ide-cd-driver-documentation">
<h1>IDE-CD driver documentation<a class="headerlink" href="#ide-cd-driver-documentation" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Originally by:</th><td class="field-body">scott snyder  &lt;<a class="reference external" href="mailto:snyder&#37;&#52;&#48;fnald0&#46;fnal&#46;gov">snyder<span>&#64;</span>fnald0<span>&#46;</span>fnal<span>&#46;</span>gov</a>&gt; (19 May 1996)</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Carrying on the torch is:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">Erik Andersen &lt;<a class="reference external" href="mailto:andersee&#37;&#52;&#48;debian&#46;org">andersee<span>&#64;</span>debian<span>&#46;</span>org</a>&gt;</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">New maintainers (19 Oct 1998):</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">Jens Axboe &lt;<a class="reference external" href="mailto:axboe&#37;&#52;&#48;image&#46;dk">axboe<span>&#64;</span>image<span>&#46;</span>dk</a>&gt;</td>
</tr>
</tbody>
</table>
<div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The ide-cd driver should work with all ATAPI ver 1.2 to ATAPI 2.6 compliant
CDROM drives which attach to an IDE interface.  Note that some CDROM vendors
(including Mitsumi, Sony, Creative, Aztech, and Goldstar) have made
both ATAPI-compliant drives and drives which use a proprietary
interface.  If your drive uses one of those proprietary interfaces,
this driver will not work with it (but one of the other CDROM drivers
probably will).  This driver will not work with <cite>ATAPI</cite> drives which
attach to the parallel port.  In addition, there is at least one drive
(CyCDROM CR520ie) which attaches to the IDE port but is not ATAPI;
this driver will not work with drives like that either (but see the
aztcd driver).</p>
<p>This driver provides the following features:</p>
<blockquote>
<div><ul class="simple">
<li>Reading from data tracks, and mounting ISO 9660 filesystems.</li>
<li>Playing audio tracks.  Most of the CDROM player programs floating
around should work; I usually use Workman.</li>
<li>Multisession support.</li>
<li>On drives which support it, reading digital audio data directly
from audio tracks.  The program cdda2wav can be used for this.
Note, however, that only some drives actually support this.</li>
<li>There is now support for CDROM changers which comply with the
ATAPI 2.6 draft standard (such as the NEC CDR-251).  This additional
functionality includes a function call to query which slot is the
currently selected slot, a function call to query which slots contain
CDs, etc. A sample program which demonstrates this functionality is
appended to the end of this file.  The Sanyo 3-disc changer
(which does not conform to the standard) is also now supported.
Please note the driver refers to the first CD as slot # 0.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="installation">
<h2>2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic" start="0">
<li><p class="first">The ide-cd relies on the ide disk driver.  See
Documentation/ide/ide.rst for up-to-date information on the ide
driver.</p>
</li>
<li><p class="first">Make sure that the ide and ide-cd drivers are compiled into the
kernel you’re using.  When configuring the kernel, in the section
entitled “Floppy, IDE, and other block devices”, say either <cite>Y</cite>
(which will compile the support directly into the kernel) or <cite>M</cite>
(to compile support as a module which can be loaded and unloaded)
to the options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ATA/ATAPI/MFM/RLL support
Include IDE/ATAPI CDROM support
</pre></div>
</div>
<p>Depending on what type of IDE interface you have, you may need to
specify additional configuration options.  See
Documentation/ide/ide.rst.</p>
</li>
<li><p class="first">You should also ensure that the iso9660 filesystem is either
compiled into the kernel or available as a loadable module.  You
can see if a filesystem is known to the kernel by catting
/proc/filesystems.</p>
</li>
<li><p class="first">The CDROM drive should be connected to the host on an IDE
interface.  Each interface on a system is defined by an I/O port
address and an IRQ number, the standard assignments being
0x1f0 and 14 for the primary interface and 0x170 and 15 for the
secondary interface.  Each interface can control up to two devices,
where each device can be a hard drive, a CDROM drive, a floppy drive,
or a tape drive.  The two devices on an interface are called <cite>master</cite>
and <cite>slave</cite>; this is usually selectable via a jumper on the drive.</p>
<p>Linux names these devices as follows.  The master and slave devices
on the primary IDE interface are called <cite>hda</cite> and <cite>hdb</cite>,
respectively.  The drives on the secondary interface are called
<cite>hdc</cite> and <cite>hdd</cite>.  (Interfaces at other locations get other letters
in the third position; see Documentation/ide/ide.rst.)</p>
<p>If you want your CDROM drive to be found automatically by the
driver, you should make sure your IDE interface uses either the
primary or secondary addresses mentioned above.  In addition, if
the CDROM drive is the only device on the IDE interface, it should
be jumpered as <cite>master</cite>.  (If for some reason you cannot configure
your system in this manner, you can probably still use the driver.
You may have to pass extra configuration information to the kernel
when you boot, however.  See Documentation/ide/ide.rst for more
information.)</p>
</li>
<li><p class="first">Boot the system.  If the drive is recognized, you should see a
message which looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>hdb: NEC CD-ROM DRIVE:260, ATAPI CDROM drive
</pre></div>
</div>
<p>If you do not see this, see section 5 below.</p>
</li>
<li><p class="first">You may want to create a symbolic link /dev/cdrom pointing to the
actual device.  You can do this with the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ln -s  /dev/hdX  /dev/cdrom
</pre></div>
</div>
<p>where X should be replaced by the letter indicating where your
drive is installed.</p>
</li>
<li><p class="first">You should be able to see any error messages from the driver with
the <cite>dmesg</cite> command.</p>
</li>
</ol>
</div>
<div class="section" id="basic-usage">
<h2>3. Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>An ISO 9660 CDROM can be mounted by putting the disc in the drive and
typing (as root):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mount -t iso9660 /dev/cdrom /mnt/cdrom
</pre></div>
</div>
<p>where it is assumed that /dev/cdrom is a link pointing to the actual
device (as described in step 5 of the last section) and /mnt/cdrom is
an empty directory.  You should now be able to see the contents of the
CDROM under the /mnt/cdrom directory.  If you want to eject the CDROM,
you must first dismount it with a command like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>umount /mnt/cdrom
</pre></div>
</div>
<p>Note that audio CDs cannot be mounted.</p>
<p>Some distributions set up /etc/fstab to always try to mount a CDROM
filesystem on bootup.  It is not required to mount the CDROM in this
manner, though, and it may be a nuisance if you change CDROMs often.
You should feel free to remove the cdrom line from /etc/fstab and
mount CDROMs manually if that suits you better.</p>
<p>Multisession and photocd discs should work with no special handling.
The hpcdtoppm package (ftp.gwdg.de:/pub/linux/hpcdtoppm/) may be
useful for reading photocds.</p>
<p>To play an audio CD, you should first unmount and remove any data
CDROM.  Any of the CDROM player programs should then work (workman,
workbone, cdplayer, etc.).</p>
<p>On a few drives, you can read digital audio directly using a program
such as cdda2wav.  The only types of drive which I’ve heard support
this are Sony and Toshiba drives.  You will get errors if you try to
use this function on a drive which does not support it.</p>
<p>For supported changers, you can use the <cite>cdchange</cite> program (appended to
the end of this file) to switch between changer slots.  Note that the
drive should be unmounted before attempting this.  The program takes
two arguments:  the CDROM device, and the slot number to which you wish
to change.  If the slot number is -1, the drive is unloaded.</p>
</div>
<div class="section" id="common-problems">
<h2>4. Common problems<a class="headerlink" href="#common-problems" title="Permalink to this headline">¶</a></h2>
<p>This section discusses some common problems encountered when trying to
use the driver, and some possible solutions.  Note that if you are
experiencing problems, you should probably also review
Documentation/ide/ide.rst for current information about the underlying
IDE support code.  Some of these items apply only to earlier versions
of the driver, but are mentioned here for completeness.</p>
<p>In most cases, you should probably check with <cite>dmesg</cite> for any errors
from the driver.</p>
<ol class="loweralpha">
<li><p class="first">Drive is not detected during booting.</p>
<ul>
<li><p class="first">Review the configuration instructions above and in
Documentation/ide/ide.rst, and check how your hardware is
configured.</p>
</li>
<li><p class="first">If your drive is the only device on an IDE interface, it should
be jumpered as master, if at all possible.</p>
</li>
<li><p class="first">If your IDE interface is not at the standard addresses of 0x170
or 0x1f0, you’ll need to explicitly inform the driver using a
lilo option.  See Documentation/ide/ide.rst.  (This feature was
added around kernel version 1.3.30.)</p>
</li>
<li><p class="first">If the autoprobing is not finding your drive, you can tell the
driver to assume that one exists by using a lilo option of the
form <cite>hdX=cdrom</cite>, where X is the drive letter corresponding to
where your drive is installed.  Note that if you do this and you
see a boot message like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>hdX: ATAPI cdrom (?)
</pre></div>
</div>
<p>this does _not_ mean that the driver has successfully detected
the drive; rather, it means that the driver has not detected a
drive, but is assuming there’s one there anyway because you told
it so.  If you actually try to do I/O to a drive defined at a
nonexistent or nonresponding I/O address, you’ll probably get
errors with a status value of 0xff.</p>
</li>
<li><p class="first">Some IDE adapters require a nonstandard initialization sequence
before they’ll function properly.  (If this is the case, there
will often be a separate MS-DOS driver just for the controller.)
IDE interfaces on sound cards often fall into this category.</p>
<p>Support for some interfaces needing extra initialization is
provided in later 1.3.x kernels.  You may need to turn on
additional kernel configuration options to get them to work;
see Documentation/ide/ide.rst.</p>
<p>Even if support is not available for your interface, you may be
able to get it to work with the following procedure.  First boot
MS-DOS and load the appropriate drivers.  Then warm-boot linux
(i.e., without powering off).  If this works, it can be automated
by running loadlin from the MS-DOS autoexec.</p>
</li>
</ul>
</li>
<li><p class="first">Timeout/IRQ errors.</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>If you always get timeout errors, interrupts from the drive are
probably not making it to the host.</li>
<li>IRQ problems may also be indicated by the message
<cite>IRQ probe failed (&lt;n&gt;)</cite> while booting.  If &lt;n&gt; is zero, that
means that the system did not see an interrupt from the drive when
it was expecting one (on any feasible IRQ).  If &lt;n&gt; is negative,
that means the system saw interrupts on multiple IRQ lines, when
it was expecting to receive just one from the CDROM drive.</li>
<li>Double-check your hardware configuration to make sure that the IRQ
number of your IDE interface matches what the driver expects.
(The usual assignments are 14 for the primary (0x1f0) interface
and 15 for the secondary (0x170) interface.)  Also be sure that
you don’t have some other hardware which might be conflicting with
the IRQ you’re using.  Also check the BIOS setup for your system;
some have the ability to disable individual IRQ levels, and I’ve
had one report of a system which was shipped with IRQ 15 disabled
by default.</li>
<li>Note that many MS-DOS CDROM drivers will still function even if
there are hardware problems with the interrupt setup; they
apparently don’t use interrupts.</li>
<li>If you own a Pioneer DR-A24X, you _will_ get nasty error messages
on boot such as “irq timeout: status=0x50 { DriveReady SeekComplete }”
The Pioneer DR-A24X CDROM drives are fairly popular these days.
Unfortunately, these drives seem to become very confused when we perform
the standard Linux ATA disk drive probe. If you own one of these drives,
you can bypass the ATA probing which confuses these CDROM drives, by
adding <cite>append=”hdX=noprobe hdX=cdrom”</cite> to your lilo.conf file and running
lilo (again where X is the drive letter corresponding to where your drive
is installed.)</li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li>System hangups.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>If the system locks up when you try to access the CDROM, the most
likely cause is that you have a buggy IDE adapter which doesn’t
properly handle simultaneous transactions on multiple interfaces.
The most notorious of these is the CMD640B chip.  This problem can
be worked around by specifying the <cite>serialize</cite> option when
booting.  Recent kernels should be able to detect the need for
this automatically in most cases, but the detection is not
foolproof.  See Documentation/ide/ide.rst for more information
about the <cite>serialize</cite> option and the CMD640B.</li>
<li>Note that many MS-DOS CDROM drivers will work with such buggy
hardware, apparently because they never attempt to overlap CDROM
operations with other disk activity.</li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="4">
<li>Can’t mount a CDROM.</li>
</ol>
<blockquote>
<div><ul>
<li><p class="first">If you get errors from mount, it may help to check <cite>dmesg</cite> to see
if there are any more specific errors from the driver or from the
filesystem.</p>
</li>
<li><p class="first">Make sure there’s a CDROM loaded in the drive, and that’s it’s an
ISO 9660 disc.  You can’t mount an audio CD.</p>
</li>
<li><p class="first">With the CDROM in the drive and unmounted, try something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /dev/cdrom | od | more
</pre></div>
</div>
<p>If you see a dump, then the drive and driver are probably working
OK, and the problem is at the filesystem level (i.e., the CDROM is
not ISO 9660 or has errors in the filesystem structure).</p>
</li>
<li><p class="first">If you see <cite>not a block device</cite> errors, check that the definitions
of the device special files are correct.  They should be as
follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>brw-rw----   1 root     disk       3,   0 Nov 11 18:48 /dev/hda
brw-rw----   1 root     disk       3,  64 Nov 11 18:48 /dev/hdb
brw-rw----   1 root     disk      22,   0 Nov 11 18:48 /dev/hdc
brw-rw----   1 root     disk      22,  64 Nov 11 18:48 /dev/hdd
</pre></div>
</div>
<p>Some early Slackware releases had these defined incorrectly.  If
these are wrong, you can remake them by running the script
scripts/MAKEDEV.ide.  (You may have to make it executable
with chmod first.)</p>
<p>If you have a /dev/cdrom symbolic link, check that it is pointing
to the correct device file.</p>
<p>If you hear people talking of the devices <cite>hd1a</cite> and <cite>hd1b</cite>, these
were old names for what are now called hdc and hdd.  Those names
should be considered obsolete.</p>
</li>
<li><p class="first">If mount is complaining that the iso9660 filesystem is not
available, but you know it is (check /proc/filesystems), you
probably need a newer version of mount.  Early versions would not
always give meaningful error messages.</p>
</li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="5">
<li>Directory listings are unpredictably truncated, and <cite>dmesg</cite> shows
<cite>buffer botch</cite> error messages from the driver.</li>
</ol>
<blockquote>
<div><ul>
<li><p class="first">There was a bug in the version of the driver in 1.2.x kernels
which could cause this.  It was fixed in 1.3.0.  If you can’t
upgrade, you can probably work around the problem by specifying a
blocksize of 2048 when mounting.  (Note that you won’t be able to
directly execute binaries off the CDROM in that case.)</p>
<p>If you see this in kernels later than 1.3.0, please report it as a
bug.</p>
</li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="6">
<li>Data corruption.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Random data corruption was occasionally observed with the Hitachi
CDR-7730 CDROM. If you experience data corruption, using “hdx=slow”
as a command line parameter may work around the problem, at the
expense of low system performance.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="cdchange-c">
<h2>5. cdchange.c<a class="headerlink" href="#cdchange-c" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/*
 * cdchange.c  [-v]  &lt;device&gt;  [&lt;slot&gt;]
 *
 * This loads a CDROM from a specified slot in a changer, and displays
 * information about the changer status.  The drive should be unmounted before
 * using this program.
 *
 * Changer information is displayed if either the -v flag is specified
 * or no slot was specified.
 *
 * Based on code originally from Gerhard Zuber &lt;zuber@berlin.snafu.de&gt;.
 * Changer status information, and rewrite for the new Uniform CDROM driver
 * interface by Erik Andersen &lt;andersee@debian.org&gt;.
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;linux/cdrom.h&gt;


int
main (int argc, char **argv)
{
      char *program;
      char *device;
      int fd;           /* file descriptor for CD-ROM device */
      int status;       /* return status for system calls */
      int verbose = 0;
      int slot=-1, x_slot;
      int total_slots_available;

      program = argv[0];

      ++argv;
      --argc;

      if (argc &lt; 1 || argc &gt; 3) {
              fprintf (stderr, &quot;usage: %s [-v] &lt;device&gt; [&lt;slot&gt;]\n&quot;,
                       program);
              fprintf (stderr, &quot;       Slots are numbered 1 -- n.\n&quot;);
              exit (1);
      }

     if (strcmp (argv[0], &quot;-v&quot;) == 0) {
              verbose = 1;
              ++argv;
              --argc;
      }

      device = argv[0];

      if (argc == 2)
              slot = atoi (argv[1]) - 1;

      /* open device */
      fd = open(device, O_RDONLY | O_NONBLOCK);
      if (fd &lt; 0) {
              fprintf (stderr, &quot;%s: open failed for `%s`: %s\n&quot;,
                       program, device, strerror (errno));
              exit (1);
      }

      /* Check CD player status */
      total_slots_available = ioctl (fd, CDROM_CHANGER_NSLOTS);
      if (total_slots_available &lt;= 1 ) {
              fprintf (stderr, &quot;%s: Device `%s` is not an ATAPI &quot;
                      &quot;compliant CD changer.\n&quot;, program, device);
              exit (1);
      }

      if (slot &gt;= 0) {
              if (slot &gt;= total_slots_available) {
                      fprintf (stderr, &quot;Bad slot number.  &quot;
                               &quot;Should be 1 -- %d.\n&quot;,
                               total_slots_available);
                      exit (1);
              }

              /* load */
              slot=ioctl (fd, CDROM_SELECT_DISC, slot);
              if (slot&lt;0) {
                      fflush(stdout);
                              perror (&quot;CDROM_SELECT_DISC &quot;);
                      exit(1);
              }
      }

      if (slot &lt; 0 || verbose) {

              status=ioctl (fd, CDROM_SELECT_DISC, CDSL_CURRENT);
              if (status&lt;0) {
                      fflush(stdout);
                      perror (&quot; CDROM_SELECT_DISC&quot;);
                      exit(1);
              }
              slot=status;

              printf (&quot;Current slot: %d\n&quot;, slot+1);
              printf (&quot;Total slots available: %d\n&quot;,
                      total_slots_available);

              printf (&quot;Drive status: &quot;);
              status = ioctl (fd, CDROM_DRIVE_STATUS, CDSL_CURRENT);
              if (status&lt;0) {
                perror(&quot; CDROM_DRIVE_STATUS&quot;);
              } else switch(status) {
              case CDS_DISC_OK:
                      printf (&quot;Ready.\n&quot;);
                      break;
              case CDS_TRAY_OPEN:
                      printf (&quot;Tray Open.\n&quot;);
                      break;
              case CDS_DRIVE_NOT_READY:
                      printf (&quot;Drive Not Ready.\n&quot;);
                      break;
              default:
                      printf (&quot;This Should not happen!\n&quot;);
                      break;
              }

              for (x_slot=0; x_slot&lt;total_slots_available; x_slot++) {
                      printf (&quot;Slot %2d: &quot;, x_slot+1);
                      status = ioctl (fd, CDROM_DRIVE_STATUS, x_slot);
                      if (status&lt;0) {
                           perror(&quot; CDROM_DRIVE_STATUS&quot;);
                      } else switch(status) {
                      case CDS_DISC_OK:
                              printf (&quot;Disc present.&quot;);
                              break;
                      case CDS_NO_DISC:
                              printf (&quot;Empty slot.&quot;);
                              break;
                      case CDS_TRAY_OPEN:
                              printf (&quot;CD-ROM tray open.\n&quot;);
                              break;
                      case CDS_DRIVE_NOT_READY:
                              printf (&quot;CD-ROM drive not ready.\n&quot;);
                              break;
                      case CDS_NO_INFO:
                              printf (&quot;No Information available.&quot;);
                              break;
                      default:
                              printf (&quot;This Should not happen!\n&quot;);
                              break;
                      }
                if (slot == x_slot) {
                status = ioctl (fd, CDROM_DISC_STATUS);
                if (status&lt;0) {
                      perror(&quot; CDROM_DISC_STATUS&quot;);
                }
                switch (status) {
                      case CDS_AUDIO:
                              printf (&quot;\tAudio disc.\t&quot;);
                              break;
                      case CDS_DATA_1:
                      case CDS_DATA_2:
                              printf (&quot;\tData disc type %d.\t&quot;, status-CDS_DATA_1+1);
                              break;
                      case CDS_XA_2_1:
                      case CDS_XA_2_2:
                              printf (&quot;\tXA data disc type %d.\t&quot;, status-CDS_XA_2_1+1);
                              break;
                      default:
                              printf (&quot;\tUnknown disc type 0x%x!\t&quot;, status);
                              break;
                      }
                      }
                      status = ioctl (fd, CDROM_MEDIA_CHANGED, x_slot);
                      if (status&lt;0) {
                              perror(&quot; CDROM_MEDIA_CHANGED&quot;);
                      }
                      switch (status) {
                      case 1:
                              printf (&quot;Changed.\n&quot;);
                              break;
                      default:
                              printf (&quot;\n&quot;);
                              break;
                      }
              }
      }

      /* close device */
      status = close (fd);
      if (status != 0) {
              fprintf (stderr, &quot;%s: close failed for `%s`: %s\n&quot;,
                       program, device, strerror (errno));
              exit (1);
      }

      exit (0);
}
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="packet-writing.html" class="btn btn-neutral float-right" title="Packet writing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cdrom-standard.html" class="btn btn-neutral float-left" title="A Linux CD-ROM standard" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>