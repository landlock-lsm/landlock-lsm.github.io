

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11. The cx2341x driver &mdash; The Linux Kernel 4.13.0-rc5+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="The Linux Kernel 4.13.0-rc5+ documentation" href="../../index.html"/>
        <link rel="up" title="Video4Linux (V4L) driver-specific documentation" href="index.html"/>
        <link rel="next" title="12. The cx88 driver" href="cx88.html"/>
        <link rel="prev" title="10. The cx18 driver" href="cx18.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.13.0-rc5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Video4Linux (V4L)  driver-specific documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fourcc.html">1. Guidelines for Video4Linux pixel format 4CCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html">2. Infrared remote control support in video4linux drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-with-lircd">3. Using with lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-without-lircd">4. Using without lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuners.html">5. Tuner drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cardlist.html">6. Cards List</a></li>
<li class="toctree-l3"><a class="reference internal" href="bttv.html">7. The bttv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cafe_ccic.html">8. The cafe_ccic driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpia2.html">9. The cpia2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx18.html">10. The cx18 driver</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">11. The cx2341x driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#memory-at-cx2341x-chips">11.1. Memory at cx2341x chips</a></li>
<li class="toctree-l4"><a class="reference internal" href="#missing-documentation">11.2. Missing documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-cx2341x-firmware-upload">11.3. The cx2341x firmware upload</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-call-the-firmware-api">11.4. How to call the firmware API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#osd-firmware-api-description">11.5. OSD firmware API description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encoder-firmware-api-description">11.6. Encoder firmware API description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decoder-firmware-api-description">11.7. Decoder firmware API description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvr350-video-decoder-registers-0x02002800-0x02002b00">11.8. PVR350 Video decoder registers 0x02002800 -&gt; 0x02002B00</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-cx231xx-dma-engine">11.9. The cx231xx DMA engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-compressed-file-format">11.10. Non-compressed file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#format-of-embedded-v4l2-mpeg-stream-vbi-fmt-ivtv-vbi-data">11.11. Format of embedded V4L2_MPEG_STREAM_VBI_FMT_IVTV VBI data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cx88.html">12. The cx88 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="davinci-vpbe.html">13. The VPBE V4L2 driver design</a></li>
<li class="toctree-l3"><a class="reference internal" href="fimc.html">14. The Samsung S5P/EXYNOS4 FIMC driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="imx.html">15. i.MX Video Capture Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ivtv.html">16. The ivtv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="max2175.html">17. Maxim Integrated MAX2175 RF to bits tuner driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="meye.html">18. Vaio Picturebook Motion Eye Camera Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omap3isp.html">19. OMAP 3 Image Signal Processor (ISP) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omap4_camera.html">20. OMAP4 ISS Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="philips.html">21. Philips webcams (pwc driver)</a></li>
<li class="toctree-l3"><a class="reference internal" href="pvrusb2.html">22. The pvrusb2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="pxa_camera.html">23. PXA-Camera Host Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="radiotrack.html">24. The Radiotrack radio driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="rcar-fdp1.html">25. Renesas R-Car Fine Display Processor (FDP1) Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="saa7134.html">26. The saa7134 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sh_mobile_ceu_camera.html">27. Cropping and Scaling algorithm, used in the sh_mobile_ceu_camera driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si470x.html">28. The Silicon Labs Si470x FM Radio Receivers driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si4713.html">29. The Silicon Labs Si4713 FM Radio Transmitter Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si476x.html">30. The SI476x Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="soc-camera.html">31. The Soc-Camera Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="uvcvideo.html">32. The Linux USB Video Class (UVC) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="vivid.html">33. The Virtual Video Test Driver (vivid)</a></li>
<li class="toctree-l3"><a class="reference internal" href="zoran.html">34. The Zoran driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="zr364xx.html">35. Zoran 364xx based USB webcam module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ja_JP/index.html">Japanese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Video4Linux (V4L)  driver-specific documentation</a> &raquo;</li>
        
      <li>11. The cx2341x driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/media/v4l-drivers/cx2341x.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-cx2341x-driver">
<h1>11. The cx2341x driver<a class="headerlink" href="#the-cx2341x-driver" title="Permalink to this headline">¶</a></h1>
<div class="section" id="memory-at-cx2341x-chips">
<h2>11.1. Memory at cx2341x chips<a class="headerlink" href="#memory-at-cx2341x-chips" title="Permalink to this headline">¶</a></h2>
<p>This section describes the cx2341x memory map and documents some of the
register space.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the memory long words are little-endian (&#8216;intel format&#8217;).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>This information was figured out from searching through the memory
and registers, this information may not be correct and is certainly
not complete, and was not derived from anything more than searching
through the memory space with commands like:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>ivtvctl -O min=0x02000000,max=0x020000ff
</pre></div>
</div>
<p class="last">So take this as is, I&#8217;m always searching for more stuff, it&#8217;s a large
register space :-).</p>
</div>
<div class="section" id="memory-map">
<h3>11.1.1. Memory Map<a class="headerlink" href="#memory-map" title="Permalink to this headline">¶</a></h3>
<p>The cx2341x exposes its entire 64M memory space to the PCI host via the PCI BAR0
(Base Address Register 0). The addresses here are offsets relative to the
address held in BAR0.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>0x00000000-0x00ffffff Encoder memory space
0x00000000-0x0003ffff Encode.rom
???-???         MPEG buffer(s)
???-???         Raw video capture buffer(s)
???-???         Raw audio capture buffer(s)
???-???         Display buffers (6 or 9)

0x01000000-0x01ffffff Decoder memory space
0x01000000-0x0103ffff Decode.rom
???-???         MPEG buffers(s)
0x0114b000-0x0115afff Audio.rom (deprecated?)

0x02000000-0x0200ffff Register Space
</pre></div>
</div>
</div>
<div class="section" id="registers">
<h3>11.1.2. Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
<p>The registers occupy the 64k space starting at the 0x02000000 offset from BAR0.
All of these registers are 32 bits wide.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>DMA Registers 0x000-0xff:

0x00 - Control:
        0=reset/cancel, 1=read, 2=write, 4=stop
0x04 - DMA status:
        1=read busy, 2=write busy, 4=read error, 8=write error, 16=link list error
0x08 - pci DMA pointer for read link list
0x0c - pci DMA pointer for write link list
0x10 - read/write DMA enable:
        1=read enable, 2=write enable
0x14 - always 0xffffffff, if set any lower instability occurs, 0x00 crashes
0x18 - ??
0x1c - always 0x20 or 32, smaller values slow down DMA transactions
0x20 - always value of 0x780a010a
0x24-0x3c - usually just random values???
0x40 - Interrupt status
0x44 - Write a bit here and shows up in Interrupt status 0x40
0x48 - Interrupt Mask
0x4C - always value of 0xfffdffff,
        if changed to 0xffffffff DMA write interrupts break.
0x50 - always 0xffffffff
0x54 - always 0xffffffff (0x4c, 0x50, 0x54 seem like interrupt masks, are
        3 processors on chip, Java ones, VPU, SPU, APU, maybe these are the
        interrupt masks???).
0x60-0x7C - random values
0x80 - first write linked list reg, for Encoder Memory addr
0x84 - first write linked list reg, for pci memory addr
0x88 - first write linked list reg, for length of buffer in memory addr
        (|0x80000000 or this for last link)
0x8c-0xdc - rest of write linked list reg, 8 sets of 3 total, DMA goes here
        from linked list addr in reg 0x0c, firmware must push through or
        something.
0xe0 - first (and only) read linked list reg, for pci memory addr
0xe4 - first (and only) read linked list reg, for Decoder memory addr
0xe8 - first (and only) read linked list reg, for length of buffer
0xec-0xff - Nothing seems to be in these registers, 0xec-f4 are 0x00000000.
</pre></div>
</div>
<p>Memory locations for Encoder Buffers 0x700-0x7ff:</p>
<p>These registers show offsets of memory locations pertaining to each
buffer area used for encoding, have to shift them by &lt;&lt;1 first.</p>
<ul class="simple">
<li>0x07F8: Encoder SDRAM refresh</li>
<li>0x07FC: Encoder SDRAM pre-charge</li>
</ul>
<p>Memory locations for Decoder Buffers 0x800-0x8ff:</p>
<p>These registers show offsets of memory locations pertaining to each
buffer area used for decoding, have to shift them by &lt;&lt;1 first.</p>
<ul class="simple">
<li>0x08F8: Decoder SDRAM refresh</li>
<li>0x08FC: Decoder SDRAM pre-charge</li>
</ul>
<p>Other memory locations:</p>
<ul class="simple">
<li>0x2800: Video Display Module control</li>
<li>0x2D00: AO (audio output?) control</li>
<li>0x2D24: Bytes Flushed</li>
<li>0x7000: LSB I2C write clock bit (inverted)</li>
<li>0x7004: LSB I2C write data bit (inverted)</li>
<li>0x7008: LSB I2C read clock bit</li>
<li>0x700c: LSB I2C read data bit</li>
<li>0x9008: GPIO get input state</li>
<li>0x900c: GPIO set output state</li>
<li>0x9020: GPIO direction (Bit7 (GPIO 0..7) - 0:input, 1:output)</li>
<li>0x9050: SPU control</li>
<li>0x9054: Reset HW blocks</li>
<li>0x9058: VPU control</li>
<li>0xA018: Bit6: interrupt pending?</li>
<li>0xA064: APU command</li>
</ul>
</div>
<div class="section" id="interrupt-status-register">
<h3>11.1.3. Interrupt Status Register<a class="headerlink" href="#interrupt-status-register" title="Permalink to this headline">¶</a></h3>
<p>The definition of the bits in the interrupt status register 0x0040, and the
interrupt mask 0x0048. If a bit is cleared in the mask, then we want our ISR to
execute.</p>
<ul class="simple">
<li>bit 31 Encoder Start Capture</li>
<li>bit 30 Encoder EOS</li>
<li>bit 29 Encoder VBI capture</li>
<li>bit 28 Encoder Video Input Module reset event</li>
<li>bit 27 Encoder DMA complete</li>
<li>bit 24 Decoder audio mode change detection event (through event notification)</li>
<li>bit 22 Decoder data request</li>
<li>bit 20 Decoder DMA complete</li>
<li>bit 19 Decoder VBI re-insertion</li>
<li>bit 18 Decoder DMA err (linked-list bad)</li>
</ul>
</div>
</div>
<div class="section" id="missing-documentation">
<h2>11.2. Missing documentation<a class="headerlink" href="#missing-documentation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Encoder API post(?)</li>
<li>Decoder API post(?)</li>
<li>Decoder VTRACE event</li>
</ul>
</div>
<div class="section" id="the-cx2341x-firmware-upload">
<h2>11.3. The cx2341x firmware upload<a class="headerlink" href="#the-cx2341x-firmware-upload" title="Permalink to this headline">¶</a></h2>
<p>This document describes how to upload the cx2341x firmware to the card.</p>
<div class="section" id="how-to-find">
<h3>11.3.1. How to find<a class="headerlink" href="#how-to-find" title="Permalink to this headline">¶</a></h3>
<p>See the web pages of the various projects that uses this chip for information
on how to obtain the firmware.</p>
<p>The firmware stored in a Windows driver can be detected as follows:</p>
<ul class="simple">
<li>Each firmware image is 256k bytes.</li>
<li>The 1st 32-bit word of the Encoder image is 0x0000da7</li>
<li>The 1st 32-bit word of the Decoder image is 0x00003a7</li>
<li>The 2nd 32-bit word of both images is 0xaa55bb66</li>
</ul>
</div>
<div class="section" id="how-to-load">
<h3>11.3.2. How to load<a class="headerlink" href="#how-to-load" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Issue the FWapi command to stop the encoder if it is running. Wait for the
command to complete.</li>
<li>Issue the FWapi command to stop the decoder if it is running. Wait for the
command to complete.</li>
<li>Issue the I2C command to the digitizer to stop emitting VSYNC events.</li>
<li>Issue the FWapi command to halt the encoder&#8217;s firmware.</li>
<li>Sleep for 10ms.</li>
<li>Issue the FWapi command to halt the decoder&#8217;s firmware.</li>
<li>Sleep for 10ms.</li>
<li>Write 0x00000000 to register 0x2800 to stop the Video Display Module.</li>
<li>Write 0x00000005 to register 0x2D00 to stop the AO (audio output?).</li>
<li>Write 0x00000000 to register 0xA064 to ping? the APU.</li>
<li>Write 0xFFFFFFFE to register 0x9058 to stop the VPU.</li>
<li>Write 0xFFFFFFFF to register 0x9054 to reset the HW blocks.</li>
<li>Write 0x00000001 to register 0x9050 to stop the SPU.</li>
<li>Sleep for 10ms.</li>
<li>Write 0x0000001A to register 0x07FC to init the Encoder SDRAM&#8217;s pre-charge.</li>
<li>Write 0x80000640 to register 0x07F8 to init the Encoder SDRAM&#8217;s refresh to 1us.</li>
<li>Write 0x0000001A to register 0x08FC to init the Decoder SDRAM&#8217;s pre-charge.</li>
<li>Write 0x80000640 to register 0x08F8 to init the Decoder SDRAM&#8217;s refresh to 1us.</li>
<li>Sleep for 512ms. (600ms is recommended)</li>
<li>Transfer the encoder&#8217;s firmware image to offset 0 in Encoder memory space.</li>
<li>Transfer the decoder&#8217;s firmware image to offset 0 in Decoder memory space.</li>
<li>Use a read-modify-write operation to Clear bit 0 of register 0x9050 to
re-enable the SPU.</li>
<li>Sleep for 1 second.</li>
<li>Use a read-modify-write operation to Clear bits 3 and 0 of register 0x9058
to re-enable the VPU.</li>
<li>Sleep for 1 second.</li>
<li>Issue status API commands to both firmware images to verify.</li>
</ul>
</div>
</div>
<div class="section" id="how-to-call-the-firmware-api">
<h2>11.4. How to call the firmware API<a class="headerlink" href="#how-to-call-the-firmware-api" title="Permalink to this headline">¶</a></h2>
<p>The preferred calling convention is known as the firmware mailbox. The
mailboxes are basically a fixed length array that serves as the call-stack.</p>
<p>Firmware mailboxes can be located by searching the encoder and decoder memory
for a 16 byte signature. That signature will be located on a 256-byte boundary.</p>
<p>Signature:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>0x78, 0x56, 0x34, 0x12, 0x12, 0x78, 0x56, 0x34,
0x34, 0x12, 0x78, 0x56, 0x56, 0x34, 0x12, 0x78
</pre></div>
</div>
<p>The firmware implements 20 mailboxes of 20 32-bit words. The first 10 are
reserved for API calls. The second 10 are used by the firmware for event
notification.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Index</th>
<th class="head">Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>Flags</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Command</td>
</tr>
<tr class="row-even"><td>2</td>
<td>Return value</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Timeout</td>
</tr>
<tr class="row-even"><td>4-19</td>
<td>Parameter/Result</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The flags are defined in the following table. The direction is from the
perspective of the firmware.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="17%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bit</th>
<th class="head">Direction</th>
<th class="head">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2</td>
<td>O</td>
<td>Firmware has processed the command.</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>I</td>
<td>Driver has finished setting the parameters.</td>
</tr>
<tr class="row-even"><td>0</td>
<td>I</td>
<td>Driver is using this mailbox.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The command is a 32-bit enumerator. The API specifics may be found in this
chapter.</p>
<p>The return value is a 32-bit enumerator. Only two values are currently defined:</p>
<ul class="simple">
<li>0=success</li>
<li>-1=command undefined.</li>
</ul>
<p>There are 16 parameters/results 32-bit fields. The driver populates these fields
with values for all the parameters required by the call. The driver overwrites
these fields with result values returned by the call.</p>
<p>The timeout value protects the card from a hung driver thread. If the driver
doesn&#8217;t handle the completed call within the timeout specified, the firmware
will reset that mailbox.</p>
<p>To make an API call, the driver iterates over each mailbox looking for the
first one available (bit 0 has been cleared). The driver sets that bit, fills
in the command enumerator, the timeout value and any required parameters. The
driver then sets the parameter ready bit (bit 1). The firmware scans the
mailboxes for pending commands, processes them, sets the result code, populates
the result value array with that call&#8217;s return values and sets the call
complete bit (bit 2). Once bit 2 is set, the driver should retrieve the results
and clear all the flags. If the driver does not perform this task within the
time set in the timeout register, the firmware will reset that mailbox.</p>
<p>Event notifications are sent from the firmware to the host. The host tells the
firmware which events it is interested in via an API call. That call tells the
firmware which notification mailbox to use. The firmware signals the host via
an interrupt. Only the 16 Results fields are used, the Flags, Command, Return
value and Timeout words are not used.</p>
</div>
<div class="section" id="osd-firmware-api-description">
<h2>11.5. OSD firmware API description<a class="headerlink" href="#osd-firmware-api-description" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this API is part of the decoder firmware, so it&#8217;s cx23415 only.</p>
</div>
<div class="section" id="cx2341x-osd-get-framebuffer">
<h3>11.5.1. CX2341X_OSD_GET_FRAMEBUFFER<a class="headerlink" href="#cx2341x-osd-get-framebuffer" title="Permalink to this headline">¶</a></h3>
<p>Enum: 65/0x41</p>
<div class="section" id="description">
<h4>11.5.1.1. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>Return base and length of contiguous OSD memory.</p>
</div>
<div class="section" id="result-0">
<h4>11.5.1.2. Result[0]<a class="headerlink" href="#result-0" title="Permalink to this headline">¶</a></h4>
<p>OSD base address</p>
</div>
<div class="section" id="result-1">
<h4>11.5.1.3. Result[1]<a class="headerlink" href="#result-1" title="Permalink to this headline">¶</a></h4>
<p>OSD length</p>
</div>
</div>
<div class="section" id="cx2341x-osd-get-pixel-format">
<h3>11.5.2. CX2341X_OSD_GET_PIXEL_FORMAT<a class="headerlink" href="#cx2341x-osd-get-pixel-format" title="Permalink to this headline">¶</a></h3>
<p>Enum: 66/0x42</p>
<div class="section" id="id1">
<h4>11.5.2.1. Description<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Query OSD format</p>
</div>
<div class="section" id="id2">
<h4>11.5.2.2. Result[0]<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>0=8bit index
1=16bit RGB 5:6:5
2=16bit ARGB 1:5:5:5
3=16bit ARGB 1:4:4:4
4=32bit ARGB 8:8:8:8</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-pixel-format">
<h3>11.5.3. CX2341X_OSD_SET_PIXEL_FORMAT<a class="headerlink" href="#cx2341x-osd-set-pixel-format" title="Permalink to this headline">¶</a></h3>
<p>Enum: 67/0x43</p>
<div class="section" id="id3">
<h4>11.5.3.1. Description<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Assign pixel format</p>
</div>
<div class="section" id="param-0">
<h4>11.5.3.2. Param[0]<a class="headerlink" href="#param-0" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=8bit index</li>
<li>1=16bit RGB 5:6:5</li>
<li>2=16bit ARGB 1:5:5:5</li>
<li>3=16bit ARGB 1:4:4:4</li>
<li>4=32bit ARGB 8:8:8:8</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-osd-get-state">
<h3>11.5.4. CX2341X_OSD_GET_STATE<a class="headerlink" href="#cx2341x-osd-get-state" title="Permalink to this headline">¶</a></h3>
<p>Enum: 68/0x44</p>
<div class="section" id="id4">
<h4>11.5.4.1. Description<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Query OSD state</p>
</div>
<div class="section" id="id5">
<h4>11.5.4.2. Result[0]<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Bit  0   0=off, 1=on</li>
<li>Bits 1:2 alpha control</li>
<li>Bits 3:5 pixel format</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-osd-set-state">
<h3>11.5.5. CX2341X_OSD_SET_STATE<a class="headerlink" href="#cx2341x-osd-set-state" title="Permalink to this headline">¶</a></h3>
<p>Enum: 69/0x45</p>
<div class="section" id="id6">
<h4>11.5.5.1. Description<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>OSD switch</p>
</div>
<div class="section" id="id7">
<h4>11.5.5.2. Param[0]<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>0=off, 1=on</p>
</div>
</div>
<div class="section" id="cx2341x-osd-get-osd-coords">
<h3>11.5.6. CX2341X_OSD_GET_OSD_COORDS<a class="headerlink" href="#cx2341x-osd-get-osd-coords" title="Permalink to this headline">¶</a></h3>
<p>Enum: 70/0x46</p>
<div class="section" id="id8">
<h4>11.5.6.1. Description<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Retrieve coordinates of OSD area blended with video</p>
</div>
<div class="section" id="id9">
<h4>11.5.6.2. Result[0]<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>OSD buffer address</p>
</div>
<div class="section" id="id10">
<h4>11.5.6.3. Result[1]<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Stride in pixels</p>
</div>
<div class="section" id="result-2">
<h4>11.5.6.4. Result[2]<a class="headerlink" href="#result-2" title="Permalink to this headline">¶</a></h4>
<p>Lines in OSD buffer</p>
</div>
<div class="section" id="result-3">
<h4>11.5.6.5. Result[3]<a class="headerlink" href="#result-3" title="Permalink to this headline">¶</a></h4>
<p>Horizontal offset in buffer</p>
</div>
<div class="section" id="result-4">
<h4>11.5.6.6. Result[4]<a class="headerlink" href="#result-4" title="Permalink to this headline">¶</a></h4>
<p>Vertical offset in buffer</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-osd-coords">
<h3>11.5.7. CX2341X_OSD_SET_OSD_COORDS<a class="headerlink" href="#cx2341x-osd-set-osd-coords" title="Permalink to this headline">¶</a></h3>
<p>Enum: 71/0x47</p>
<div class="section" id="id11">
<h4>11.5.7.1. Description<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>Assign the coordinates of the OSD area to blend with video</p>
</div>
<div class="section" id="id12">
<h4>11.5.7.2. Param[0]<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>buffer address</p>
</div>
<div class="section" id="param-1">
<h4>11.5.7.3. Param[1]<a class="headerlink" href="#param-1" title="Permalink to this headline">¶</a></h4>
<p>buffer stride in pixels</p>
</div>
<div class="section" id="param-2">
<h4>11.5.7.4. Param[2]<a class="headerlink" href="#param-2" title="Permalink to this headline">¶</a></h4>
<p>lines in buffer</p>
</div>
<div class="section" id="param-3">
<h4>11.5.7.5. Param[3]<a class="headerlink" href="#param-3" title="Permalink to this headline">¶</a></h4>
<p>horizontal offset</p>
</div>
<div class="section" id="param-4">
<h4>11.5.7.6. Param[4]<a class="headerlink" href="#param-4" title="Permalink to this headline">¶</a></h4>
<p>vertical offset</p>
</div>
</div>
<div class="section" id="cx2341x-osd-get-screen-coords">
<h3>11.5.8. CX2341X_OSD_GET_SCREEN_COORDS<a class="headerlink" href="#cx2341x-osd-get-screen-coords" title="Permalink to this headline">¶</a></h3>
<p>Enum: 72/0x48</p>
<div class="section" id="id13">
<h4>11.5.8.1. Description<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>Retrieve OSD screen area coordinates</p>
</div>
<div class="section" id="id14">
<h4>11.5.8.2. Result[0]<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>top left horizontal offset</p>
</div>
<div class="section" id="id15">
<h4>11.5.8.3. Result[1]<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>top left vertical offset</p>
</div>
<div class="section" id="id16">
<h4>11.5.8.4. Result[2]<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>bottom right horizontal offset</p>
</div>
<div class="section" id="id17">
<h4>11.5.8.5. Result[3]<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>bottom right vertical offset</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-screen-coords">
<h3>11.5.9. CX2341X_OSD_SET_SCREEN_COORDS<a class="headerlink" href="#cx2341x-osd-set-screen-coords" title="Permalink to this headline">¶</a></h3>
<p>Enum: 73/0x49</p>
<div class="section" id="id18">
<h4>11.5.9.1. Description<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>Assign the coordinates of the screen area to blend with video</p>
</div>
<div class="section" id="id19">
<h4>11.5.9.2. Param[0]<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<p>top left horizontal offset</p>
</div>
<div class="section" id="id20">
<h4>11.5.9.3. Param[1]<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>top left vertical offset</p>
</div>
<div class="section" id="id21">
<h4>11.5.9.4. Param[2]<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>bottom left horizontal offset</p>
</div>
<div class="section" id="id22">
<h4>11.5.9.5. Param[3]<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p>bottom left vertical offset</p>
</div>
</div>
<div class="section" id="cx2341x-osd-get-global-alpha">
<h3>11.5.10. CX2341X_OSD_GET_GLOBAL_ALPHA<a class="headerlink" href="#cx2341x-osd-get-global-alpha" title="Permalink to this headline">¶</a></h3>
<p>Enum: 74/0x4A</p>
<div class="section" id="id23">
<h4>11.5.10.1. Description<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<p>Retrieve OSD global alpha</p>
</div>
<div class="section" id="id24">
<h4>11.5.10.2. Result[0]<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<p>global alpha: 0=off, 1=on</p>
</div>
<div class="section" id="id25">
<h4>11.5.10.3. Result[1]<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>bits 0:7 global alpha</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-global-alpha">
<h3>11.5.11. CX2341X_OSD_SET_GLOBAL_ALPHA<a class="headerlink" href="#cx2341x-osd-set-global-alpha" title="Permalink to this headline">¶</a></h3>
<p>Enum: 75/0x4B</p>
<div class="section" id="id26">
<h4>11.5.11.1. Description<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<p>Update global alpha</p>
</div>
<div class="section" id="id27">
<h4>11.5.11.2. Param[0]<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>global alpha: 0=off, 1=on</p>
</div>
<div class="section" id="id28">
<h4>11.5.11.3. Param[1]<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>global alpha (8 bits)</p>
</div>
<div class="section" id="id29">
<h4>11.5.11.4. Param[2]<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>local alpha: 0=on, 1=off</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-blend-coords">
<h3>11.5.12. CX2341X_OSD_SET_BLEND_COORDS<a class="headerlink" href="#cx2341x-osd-set-blend-coords" title="Permalink to this headline">¶</a></h3>
<p>Enum: 78/0x4C</p>
<div class="section" id="id30">
<h4>11.5.12.1. Description<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p>Move start of blending area within display buffer</p>
</div>
<div class="section" id="id31">
<h4>11.5.12.2. Param[0]<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<p>horizontal offset in buffer</p>
</div>
<div class="section" id="id32">
<h4>11.5.12.3. Param[1]<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<p>vertical offset in buffer</p>
</div>
</div>
<div class="section" id="cx2341x-osd-get-flicker-state">
<h3>11.5.13. CX2341X_OSD_GET_FLICKER_STATE<a class="headerlink" href="#cx2341x-osd-get-flicker-state" title="Permalink to this headline">¶</a></h3>
<p>Enum: 79/0x4F</p>
<div class="section" id="id33">
<h4>11.5.13.1. Description<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<p>Retrieve flicker reduction module state</p>
</div>
<div class="section" id="id34">
<h4>11.5.13.2. Result[0]<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p>flicker state: 0=off, 1=on</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-flicker-state">
<h3>11.5.14. CX2341X_OSD_SET_FLICKER_STATE<a class="headerlink" href="#cx2341x-osd-set-flicker-state" title="Permalink to this headline">¶</a></h3>
<p>Enum: 80/0x50</p>
<div class="section" id="id35">
<h4>11.5.14.1. Description<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>Set flicker reduction module state</p>
</div>
<div class="section" id="id36">
<h4>11.5.14.2. Param[0]<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<p>State: 0=off, 1=on</p>
</div>
</div>
<div class="section" id="cx2341x-osd-blt-copy">
<h3>11.5.15. CX2341X_OSD_BLT_COPY<a class="headerlink" href="#cx2341x-osd-blt-copy" title="Permalink to this headline">¶</a></h3>
<p>Enum: 82/0x52</p>
<div class="section" id="id37">
<h4>11.5.15.1. Description<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<p>BLT copy</p>
</div>
<div class="section" id="id38">
<h4>11.5.15.2. Param[0]<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>&#39;0000&#39;  zero
&#39;0001&#39; ~destination AND ~source
&#39;0010&#39; ~destination AND  source
&#39;0011&#39; ~destination
&#39;0100&#39;  destination AND ~source
&#39;0101&#39;                  ~source
&#39;0110&#39;  destination XOR  source
&#39;0111&#39; ~destination OR  ~source
&#39;1000&#39; ~destination AND ~source
&#39;1001&#39;  destination XNOR source
&#39;1010&#39;                   source
&#39;1011&#39; ~destination OR   source
&#39;1100&#39;  destination
&#39;1101&#39;  destination OR  ~source
&#39;1110&#39;  destination OR   source
&#39;1111&#39;  one
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h4>11.5.15.3. Param[1]<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h4>
<p>Resulting alpha blending</p>
<ul class="simple">
<li>&#8216;01&#8217; source_alpha</li>
<li>&#8216;10&#8217; destination_alpha</li>
<li>&#8216;11&#8217; source_alpha*destination_alpha+1
(zero if both source and destination alpha are zero)</li>
</ul>
</div>
<div class="section" id="id40">
<h4>11.5.15.4. Param[2]<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>&#39;00&#39; output_pixel = source_pixel

&#39;01&#39; if source_alpha=0:
         output_pixel = destination_pixel
     if 256 &gt; source_alpha &gt; 1:
         output_pixel = ((source_alpha + 1)*source_pixel +
                         (255 - source_alpha)*destination_pixel)/256

&#39;10&#39; if destination_alpha=0:
         output_pixel = source_pixel
      if 255 &gt; destination_alpha &gt; 0:
         output_pixel = ((255 - destination_alpha)*source_pixel +
                         (destination_alpha + 1)*destination_pixel)/256

&#39;11&#39; if source_alpha=0:
         source_temp = 0
     if source_alpha=255:
         source_temp = source_pixel*256
     if 255 &gt; source_alpha &gt; 0:
         source_temp = source_pixel*(source_alpha + 1)
     if destination_alpha=0:
         destination_temp = 0
     if destination_alpha=255:
         destination_temp = destination_pixel*256
     if 255 &gt; destination_alpha &gt; 0:
         destination_temp = destination_pixel*(destination_alpha + 1)
     output_pixel = (source_temp + destination_temp)/256
</pre></div>
</div>
</div>
<div class="section" id="id41">
<h4>11.5.15.5. Param[3]<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<p>width</p>
</div>
<div class="section" id="id42">
<h4>11.5.15.6. Param[4]<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<p>height</p>
</div>
<div class="section" id="param-5">
<h4>11.5.15.7. Param[5]<a class="headerlink" href="#param-5" title="Permalink to this headline">¶</a></h4>
<p>destination pixel mask</p>
</div>
<div class="section" id="param-6">
<h4>11.5.15.8. Param[6]<a class="headerlink" href="#param-6" title="Permalink to this headline">¶</a></h4>
<p>destination rectangle start address</p>
</div>
<div class="section" id="param-7">
<h4>11.5.15.9. Param[7]<a class="headerlink" href="#param-7" title="Permalink to this headline">¶</a></h4>
<p>destination stride in dwords</p>
</div>
<div class="section" id="param-8">
<h4>11.5.15.10. Param[8]<a class="headerlink" href="#param-8" title="Permalink to this headline">¶</a></h4>
<p>source stride in dwords</p>
</div>
<div class="section" id="param-9">
<h4>11.5.15.11. Param[9]<a class="headerlink" href="#param-9" title="Permalink to this headline">¶</a></h4>
<p>source rectangle start address</p>
</div>
</div>
<div class="section" id="cx2341x-osd-blt-fill">
<h3>11.5.16. CX2341X_OSD_BLT_FILL<a class="headerlink" href="#cx2341x-osd-blt-fill" title="Permalink to this headline">¶</a></h3>
<p>Enum: 83/0x53</p>
<div class="section" id="id43">
<h4>11.5.16.1. Description<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<p>BLT fill color</p>
</div>
<div class="section" id="id44">
<h4>11.5.16.2. Param[0]<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<p>Same as Param[0] on API 0x52</p>
</div>
<div class="section" id="id45">
<h4>11.5.16.3. Param[1]<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<p>Same as Param[1] on API 0x52</p>
</div>
<div class="section" id="id46">
<h4>11.5.16.4. Param[2]<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<p>Same as Param[2] on API 0x52</p>
</div>
<div class="section" id="id47">
<h4>11.5.16.5. Param[3]<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p>width</p>
</div>
<div class="section" id="id48">
<h4>11.5.16.6. Param[4]<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>height</p>
</div>
<div class="section" id="id49">
<h4>11.5.16.7. Param[5]<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h4>
<p>destination pixel mask</p>
</div>
<div class="section" id="id50">
<h4>11.5.16.8. Param[6]<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h4>
<p>destination rectangle start address</p>
</div>
<div class="section" id="id51">
<h4>11.5.16.9. Param[7]<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h4>
<p>destination stride in dwords</p>
</div>
<div class="section" id="id52">
<h4>11.5.16.10. Param[8]<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h4>
<p>color fill value</p>
</div>
</div>
<div class="section" id="cx2341x-osd-blt-text">
<h3>11.5.17. CX2341X_OSD_BLT_TEXT<a class="headerlink" href="#cx2341x-osd-blt-text" title="Permalink to this headline">¶</a></h3>
<p>Enum: 84/0x54</p>
<div class="section" id="id53">
<h4>11.5.17.1. Description<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h4>
<p>BLT for 8 bit alpha text source</p>
</div>
<div class="section" id="id54">
<h4>11.5.17.2. Param[0]<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h4>
<p>Same as Param[0] on API 0x52</p>
</div>
<div class="section" id="id55">
<h4>11.5.17.3. Param[1]<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h4>
<p>Same as Param[1] on API 0x52</p>
</div>
<div class="section" id="id56">
<h4>11.5.17.4. Param[2]<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h4>
<p>Same as Param[2] on API 0x52</p>
</div>
<div class="section" id="id57">
<h4>11.5.17.5. Param[3]<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h4>
<p>width</p>
</div>
<div class="section" id="id58">
<h4>11.5.17.6. Param[4]<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h4>
<p>height</p>
</div>
<div class="section" id="id59">
<h4>11.5.17.7. Param[5]<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h4>
<p>destination pixel mask</p>
</div>
<div class="section" id="id60">
<h4>11.5.17.8. Param[6]<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h4>
<p>destination rectangle start address</p>
</div>
<div class="section" id="id61">
<h4>11.5.17.9. Param[7]<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h4>
<p>destination stride in dwords</p>
</div>
<div class="section" id="id62">
<h4>11.5.17.10. Param[8]<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h4>
<p>source stride in dwords</p>
</div>
<div class="section" id="id63">
<h4>11.5.17.11. Param[9]<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h4>
<p>source rectangle start address</p>
</div>
<div class="section" id="param-10">
<h4>11.5.17.12. Param[10]<a class="headerlink" href="#param-10" title="Permalink to this headline">¶</a></h4>
<p>color fill value</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-framebuffer-window">
<h3>11.5.18. CX2341X_OSD_SET_FRAMEBUFFER_WINDOW<a class="headerlink" href="#cx2341x-osd-set-framebuffer-window" title="Permalink to this headline">¶</a></h3>
<p>Enum: 86/0x56</p>
<div class="section" id="id64">
<h4>11.5.18.1. Description<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h4>
<p>Positions the main output window on the screen. The coordinates must be
such that the entire window fits on the screen.</p>
</div>
<div class="section" id="id65">
<h4>11.5.18.2. Param[0]<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h4>
<p>window width</p>
</div>
<div class="section" id="id66">
<h4>11.5.18.3. Param[1]<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h4>
<p>window height</p>
</div>
<div class="section" id="id67">
<h4>11.5.18.4. Param[2]<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h4>
<p>top left window corner horizontal offset</p>
</div>
<div class="section" id="id68">
<h4>11.5.18.5. Param[3]<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h4>
<p>top left window corner vertical offset</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-chroma-key">
<h3>11.5.19. CX2341X_OSD_SET_CHROMA_KEY<a class="headerlink" href="#cx2341x-osd-set-chroma-key" title="Permalink to this headline">¶</a></h3>
<p>Enum: 96/0x60</p>
<div class="section" id="id69">
<h4>11.5.19.1. Description<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h4>
<p>Chroma key switch and color</p>
</div>
<div class="section" id="id70">
<h4>11.5.19.2. Param[0]<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>state: 0=off, 1=on</p>
</div>
<div class="section" id="id71">
<h4>11.5.19.3. Param[1]<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h4>
<p>color</p>
</div>
</div>
<div class="section" id="cx2341x-osd-get-alpha-content-index">
<h3>11.5.20. CX2341X_OSD_GET_ALPHA_CONTENT_INDEX<a class="headerlink" href="#cx2341x-osd-get-alpha-content-index" title="Permalink to this headline">¶</a></h3>
<p>Enum: 97/0x61</p>
<div class="section" id="id72">
<h4>11.5.20.1. Description<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h4>
<p>Retrieve alpha content index</p>
</div>
<div class="section" id="id73">
<h4>11.5.20.2. Result[0]<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h4>
<p>alpha content index, Range 0:15</p>
</div>
</div>
<div class="section" id="cx2341x-osd-set-alpha-content-index">
<h3>11.5.21. CX2341X_OSD_SET_ALPHA_CONTENT_INDEX<a class="headerlink" href="#cx2341x-osd-set-alpha-content-index" title="Permalink to this headline">¶</a></h3>
<p>Enum: 98/0x62</p>
<div class="section" id="id74">
<h4>11.5.21.1. Description<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h4>
<p>Assign alpha content index</p>
</div>
<div class="section" id="id75">
<h4>11.5.21.2. Param[0]<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h4>
<p>alpha content index, range 0:15</p>
</div>
</div>
</div>
<div class="section" id="encoder-firmware-api-description">
<h2>11.6. Encoder firmware API description<a class="headerlink" href="#encoder-firmware-api-description" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cx2341x-enc-ping-fw">
<h3>11.6.1. CX2341X_ENC_PING_FW<a class="headerlink" href="#cx2341x-enc-ping-fw" title="Permalink to this headline">¶</a></h3>
<p>Enum: 128/0x80</p>
<div class="section" id="id76">
<h4>11.6.1.1. Description<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h4>
<p>Does nothing. Can be used to check if the firmware is responding.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-start-capture">
<h3>11.6.2. CX2341X_ENC_START_CAPTURE<a class="headerlink" href="#cx2341x-enc-start-capture" title="Permalink to this headline">¶</a></h3>
<p>Enum: 129/0x81</p>
<div class="section" id="id77">
<h4>11.6.2.1. Description<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h4>
<p>Commences the capture of video, audio and/or VBI data. All encoding
parameters must be initialized prior to this API call. Captures frames
continuously or until a predefined number of frames have been captured.</p>
</div>
<div class="section" id="id78">
<h4>11.6.2.2. Param[0]<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h4>
<p>Capture stream type:</p>
<blockquote>
<div><ul class="simple">
<li>0=MPEG</li>
<li>1=Raw</li>
<li>2=Raw passthrough</li>
<li>3=VBI</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id79">
<h4>11.6.2.3. Param[1]<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h4>
<p>Bitmask:</p>
<blockquote>
<div><ul class="simple">
<li>Bit 0 when set, captures YUV</li>
<li>Bit 1 when set, captures PCM audio</li>
<li>Bit 2 when set, captures VBI (same as param[0]=3)</li>
<li>Bit 3 when set, the capture destination is the decoder
(same as param[0]=2)</li>
<li>Bit 4 when set, the capture destination is the host</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this parameter is only meaningful for RAW capture type.</p>
</div>
</div>
</div>
<div class="section" id="cx2341x-enc-stop-capture">
<h3>11.6.3. CX2341X_ENC_STOP_CAPTURE<a class="headerlink" href="#cx2341x-enc-stop-capture" title="Permalink to this headline">¶</a></h3>
<p>Enum: 130/0x82</p>
<div class="section" id="id80">
<h4>11.6.3.1. Description<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h4>
<p>Ends a capture in progress</p>
</div>
<div class="section" id="id81">
<h4>11.6.3.2. Param[0]<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=stop at end of GOP (generates IRQ)</li>
<li>1=stop immediate (no IRQ)</li>
</ul>
</div>
<div class="section" id="id82">
<h4>11.6.3.3. Param[1]<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h4>
<p>Stream type to stop, see param[0] of API 0x81</p>
</div>
<div class="section" id="id83">
<h4>11.6.3.4. Param[2]<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h4>
<p>Subtype, see param[1] of API 0x81</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-audio-id">
<h3>11.6.4. CX2341X_ENC_SET_AUDIO_ID<a class="headerlink" href="#cx2341x-enc-set-audio-id" title="Permalink to this headline">¶</a></h3>
<p>Enum: 137/0x89</p>
<div class="section" id="id84">
<h4>11.6.4.1. Description<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h4>
<p>Assigns the transport stream ID of the encoded audio stream</p>
</div>
<div class="section" id="id85">
<h4>11.6.4.2. Param[0]<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h4>
<p>Audio Stream ID</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-video-id">
<h3>11.6.5. CX2341X_ENC_SET_VIDEO_ID<a class="headerlink" href="#cx2341x-enc-set-video-id" title="Permalink to this headline">¶</a></h3>
<p>Enum: 139/0x8B</p>
<div class="section" id="id86">
<h4>11.6.5.1. Description<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h4>
<p>Set video transport stream ID</p>
</div>
<div class="section" id="id87">
<h4>11.6.5.2. Param[0]<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h4>
<p>Video stream ID</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-pcr-id">
<h3>11.6.6. CX2341X_ENC_SET_PCR_ID<a class="headerlink" href="#cx2341x-enc-set-pcr-id" title="Permalink to this headline">¶</a></h3>
<p>Enum: 141/0x8D</p>
<div class="section" id="id88">
<h4>11.6.6.1. Description<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h4>
<p>Assigns the transport stream ID for PCR packets</p>
</div>
<div class="section" id="id89">
<h4>11.6.6.2. Param[0]<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h4>
<p>PCR Stream ID</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-frame-rate">
<h3>11.6.7. CX2341X_ENC_SET_FRAME_RATE<a class="headerlink" href="#cx2341x-enc-set-frame-rate" title="Permalink to this headline">¶</a></h3>
<p>Enum: 143/0x8F</p>
<div class="section" id="id90">
<h4>11.6.7.1. Description<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h4>
<p>Set video frames per second. Change occurs at start of new GOP.</p>
</div>
<div class="section" id="id91">
<h4>11.6.7.2. Param[0]<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=30fps</li>
<li>1=25fps</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-frame-size">
<h3>11.6.8. CX2341X_ENC_SET_FRAME_SIZE<a class="headerlink" href="#cx2341x-enc-set-frame-size" title="Permalink to this headline">¶</a></h3>
<p>Enum: 145/0x91</p>
<div class="section" id="id92">
<h4>11.6.8.1. Description<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h4>
<p>Select video stream encoding resolution.</p>
</div>
<div class="section" id="id93">
<h4>11.6.8.2. Param[0]<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h4>
<p>Height in lines. Default 480</p>
</div>
<div class="section" id="id94">
<h4>11.6.8.3. Param[1]<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h4>
<p>Width in pixels. Default 720</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-bit-rate">
<h3>11.6.9. CX2341X_ENC_SET_BIT_RATE<a class="headerlink" href="#cx2341x-enc-set-bit-rate" title="Permalink to this headline">¶</a></h3>
<p>Enum: 149/0x95</p>
<div class="section" id="id95">
<h4>11.6.9.1. Description<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h4>
<p>Assign average video stream bitrate.</p>
</div>
<div class="section" id="id96">
<h4>11.6.9.2. Param[0]<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h4>
<p>0=variable bitrate, 1=constant bitrate</p>
</div>
<div class="section" id="id97">
<h4>11.6.9.3. Param[1]<a class="headerlink" href="#id97" title="Permalink to this headline">¶</a></h4>
<p>bitrate in bits per second</p>
</div>
<div class="section" id="id98">
<h4>11.6.9.4. Param[2]<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h4>
<p>peak bitrate in bits per second, divided by 400</p>
</div>
<div class="section" id="id99">
<h4>11.6.9.5. Param[3]<a class="headerlink" href="#id99" title="Permalink to this headline">¶</a></h4>
<p>Mux bitrate in bits per second, divided by 400. May be 0 (default).</p>
</div>
<div class="section" id="id100">
<h4>11.6.9.6. Param[4]<a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h4>
<p>Rate Control VBR Padding</p>
</div>
<div class="section" id="id101">
<h4>11.6.9.7. Param[5]<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h4>
<p>VBV Buffer used by encoder</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>Param[3] and Param[4] seem to be always 0</li>
<li>Param[5] doesn&#8217;t seem to be used.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="cx2341x-enc-set-gop-properties">
<h3>11.6.10. CX2341X_ENC_SET_GOP_PROPERTIES<a class="headerlink" href="#cx2341x-enc-set-gop-properties" title="Permalink to this headline">¶</a></h3>
<p>Enum: 151/0x97</p>
<div class="section" id="id102">
<h4>11.6.10.1. Description<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h4>
<p>Setup the GOP structure</p>
</div>
<div class="section" id="id103">
<h4>11.6.10.2. Param[0]<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h4>
<p>GOP size (maximum is 34)</p>
</div>
<div class="section" id="id104">
<h4>11.6.10.3. Param[1]<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h4>
<p>Number of B frames between the I and P frame, plus 1.
For example: IBBPBBPBBPBB &#8211;&gt; GOP size: 12, number of B frames: 2+1 = 3</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">GOP size must be a multiple of (B-frames + 1).</p>
</div>
</div>
</div>
<div class="section" id="cx2341x-enc-set-aspect-ratio">
<h3>11.6.11. CX2341X_ENC_SET_ASPECT_RATIO<a class="headerlink" href="#cx2341x-enc-set-aspect-ratio" title="Permalink to this headline">¶</a></h3>
<p>Enum: 153/0x99</p>
<div class="section" id="id105">
<h4>11.6.11.1. Description<a class="headerlink" href="#id105" title="Permalink to this headline">¶</a></h4>
<p>Sets the encoding aspect ratio. Changes in the aspect ratio take effect
at the start of the next GOP.</p>
</div>
<div class="section" id="id106">
<h4>11.6.11.2. Param[0]<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>&#8216;0000&#8217; forbidden</li>
<li>&#8216;0001&#8217; 1:1 square</li>
<li>&#8216;0010&#8217; 4:3</li>
<li>&#8216;0011&#8217; 16:9</li>
<li>&#8216;0100&#8217; 2.21:1</li>
<li>&#8216;0101&#8217; to &#8216;1111&#8217; reserved</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-dnr-filter-mode">
<h3>11.6.12. CX2341X_ENC_SET_DNR_FILTER_MODE<a class="headerlink" href="#cx2341x-enc-set-dnr-filter-mode" title="Permalink to this headline">¶</a></h3>
<p>Enum: 155/0x9B</p>
<div class="section" id="id107">
<h4>11.6.12.1. Description<a class="headerlink" href="#id107" title="Permalink to this headline">¶</a></h4>
<p>Assign Dynamic Noise Reduction operating mode</p>
</div>
<div class="section" id="id108">
<h4>11.6.12.2. Param[0]<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h4>
<p>Bit0: Spatial filter, set=auto, clear=manual
Bit1: Temporal filter, set=auto, clear=manual</p>
</div>
<div class="section" id="id109">
<h4>11.6.12.3. Param[1]<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h4>
<p>Median filter:</p>
<ul class="simple">
<li>0=Disabled</li>
<li>1=Horizontal</li>
<li>2=Vertical</li>
<li>3=Horiz/Vert</li>
<li>4=Diagonal</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-dnr-filter-props">
<h3>11.6.13. CX2341X_ENC_SET_DNR_FILTER_PROPS<a class="headerlink" href="#cx2341x-enc-set-dnr-filter-props" title="Permalink to this headline">¶</a></h3>
<p>Enum: 157/0x9D</p>
<div class="section" id="id110">
<h4>11.6.13.1. Description<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h4>
<p>These Dynamic Noise Reduction filter values are only meaningful when
the respective filter is set to &#8220;manual&#8221; (See API 0x9B)</p>
</div>
<div class="section" id="id111">
<h4>11.6.13.2. Param[0]<a class="headerlink" href="#id111" title="Permalink to this headline">¶</a></h4>
<p>Spatial filter: default 0, range 0:15</p>
</div>
<div class="section" id="id112">
<h4>11.6.13.3. Param[1]<a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h4>
<p>Temporal filter: default 0, range 0:31</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-coring-levels">
<h3>11.6.14. CX2341X_ENC_SET_CORING_LEVELS<a class="headerlink" href="#cx2341x-enc-set-coring-levels" title="Permalink to this headline">¶</a></h3>
<p>Enum: 159/0x9F</p>
<div class="section" id="id113">
<h4>11.6.14.1. Description<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h4>
<p>Assign Dynamic Noise Reduction median filter properties.</p>
</div>
<div class="section" id="id114">
<h4>11.6.14.2. Param[0]<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h4>
<p>Threshold above which the luminance median filter is enabled.
Default: 0, range 0:255</p>
</div>
<div class="section" id="id115">
<h4>11.6.14.3. Param[1]<a class="headerlink" href="#id115" title="Permalink to this headline">¶</a></h4>
<p>Threshold below which the luminance median filter is enabled.
Default: 255, range 0:255</p>
</div>
<div class="section" id="id116">
<h4>11.6.14.4. Param[2]<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h4>
<p>Threshold above which the chrominance median filter is enabled.
Default: 0, range 0:255</p>
</div>
<div class="section" id="id117">
<h4>11.6.14.5. Param[3]<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h4>
<p>Threshold below which the chrominance median filter is enabled.
Default: 255, range 0:255</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-spatial-filter-type">
<h3>11.6.15. CX2341X_ENC_SET_SPATIAL_FILTER_TYPE<a class="headerlink" href="#cx2341x-enc-set-spatial-filter-type" title="Permalink to this headline">¶</a></h3>
<p>Enum: 161/0xA1</p>
<div class="section" id="id118">
<h4>11.6.15.1. Description<a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h4>
<p>Assign spatial prefilter parameters</p>
</div>
<div class="section" id="id119">
<h4>11.6.15.2. Param[0]<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h4>
<p>Luminance filter</p>
<ul class="simple">
<li>0=Off</li>
<li>1=1D Horizontal</li>
<li>2=1D Vertical</li>
<li>3=2D H/V Separable (default)</li>
<li>4=2D Symmetric non-separable</li>
</ul>
</div>
<div class="section" id="id120">
<h4>11.6.15.3. Param[1]<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h4>
<p>Chrominance filter</p>
<ul class="simple">
<li>0=Off</li>
<li>1=1D Horizontal (default)</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-vbi-line">
<h3>11.6.16. CX2341X_ENC_SET_VBI_LINE<a class="headerlink" href="#cx2341x-enc-set-vbi-line" title="Permalink to this headline">¶</a></h3>
<p>Enum: 183/0xB7</p>
<div class="section" id="id121">
<h4>11.6.16.1. Description<a class="headerlink" href="#id121" title="Permalink to this headline">¶</a></h4>
<p>Selects VBI line number.</p>
</div>
<div class="section" id="id122">
<h4>11.6.16.2. Param[0]<a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Bits 0:4      line number</li>
<li>Bit  31               0=top_field, 1=bottom_field</li>
<li>Bits 0:31     all set specifies &#8220;all lines&#8221;</li>
</ul>
</div>
<div class="section" id="id123">
<h4>11.6.16.3. Param[1]<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h4>
<p>VBI line information features: 0=disabled, 1=enabled</p>
</div>
<div class="section" id="id124">
<h4>11.6.16.4. Param[2]<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h4>
<p>Slicing: 0=None, 1=Closed Caption
Almost certainly not implemented. Set to 0.</p>
</div>
<div class="section" id="id125">
<h4>11.6.16.5. Param[3]<a class="headerlink" href="#id125" title="Permalink to this headline">¶</a></h4>
<p>Luminance samples in this line.
Almost certainly not implemented. Set to 0.</p>
</div>
<div class="section" id="id126">
<h4>11.6.16.6. Param[4]<a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h4>
<p>Chrominance samples in this line
Almost certainly not implemented. Set to 0.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-stream-type">
<h3>11.6.17. CX2341X_ENC_SET_STREAM_TYPE<a class="headerlink" href="#cx2341x-enc-set-stream-type" title="Permalink to this headline">¶</a></h3>
<p>Enum: 185/0xB9</p>
<div class="section" id="id127">
<h4>11.6.17.1. Description<a class="headerlink" href="#id127" title="Permalink to this headline">¶</a></h4>
<p>Assign stream type</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Transport stream is not working in recent firmwares.
And in older firmwares the timestamps in the TS seem to be
unreliable.</p>
</div>
</div>
<div class="section" id="id128">
<h4>11.6.17.2. Param[0]<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=Program stream</li>
<li>1=Transport stream</li>
<li>2=MPEG1 stream</li>
<li>3=PES A/V stream</li>
<li>5=PES Video stream</li>
<li>7=PES Audio stream</li>
<li>10=DVD stream</li>
<li>11=VCD stream</li>
<li>12=SVCD stream</li>
<li>13=DVD_S1 stream</li>
<li>14=DVD_S2 stream</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-output-port">
<h3>11.6.18. CX2341X_ENC_SET_OUTPUT_PORT<a class="headerlink" href="#cx2341x-enc-set-output-port" title="Permalink to this headline">¶</a></h3>
<p>Enum: 187/0xBB</p>
<div class="section" id="id129">
<h4>11.6.18.1. Description<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h4>
<p>Assign stream output port. Normally 0 when the data is copied through
the PCI bus (DMA), and 1 when the data is streamed to another chip
(pvrusb and cx88-blackbird).</p>
</div>
<div class="section" id="id130">
<h4>11.6.18.2. Param[0]<a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=Memory (default)</li>
<li>1=Streaming</li>
<li>2=Serial</li>
</ul>
</div>
<div class="section" id="id131">
<h4>11.6.18.3. Param[1]<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h4>
<p>Unknown, but leaving this to 0 seems to work best. Indications are that
this might have to do with USB support, although passing anything but 0
only breaks things.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-audio-properties">
<h3>11.6.19. CX2341X_ENC_SET_AUDIO_PROPERTIES<a class="headerlink" href="#cx2341x-enc-set-audio-properties" title="Permalink to this headline">¶</a></h3>
<p>Enum: 189/0xBD</p>
<div class="section" id="id132">
<h4>11.6.19.1. Description<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h4>
<p>Set audio stream properties, may be called while encoding is in progress.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>All bitfields are consistent with ISO11172 documentation except
bits 2:3 which ISO docs define as:</p>
<ul class="simple">
<li>&#8216;11&#8217; Layer I</li>
<li>&#8216;10&#8217; Layer II</li>
<li>&#8216;01&#8217; Layer III</li>
<li>&#8216;00&#8217; Undefined</li>
</ul>
<p class="last">This discrepancy may indicate a possible error in the documentation.
Testing indicated that only Layer II is actually working, and that
the minimum bitrate should be 192 kbps.</p>
</div>
</div>
<div class="section" id="id133">
<h4>11.6.19.2. Param[0]<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h4>
<p>Bitmask:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span> 0:1  &#39;00&#39; 44.1Khz
      &#39;01&#39; 48Khz
      &#39;10&#39; 32Khz
      &#39;11&#39; reserved

 2:3  &#39;01&#39;=Layer I
      &#39;10&#39;=Layer II

 4:7  Bitrate:
           Index | Layer I     | Layer II
           ------+-------------+------------
          &#39;0000&#39; | free format | free format
          &#39;0001&#39; |  32 kbit/s  |  32 kbit/s
          &#39;0010&#39; |  64 kbit/s  |  48 kbit/s
          &#39;0011&#39; |  96 kbit/s  |  56 kbit/s
          &#39;0100&#39; | 128 kbit/s  |  64 kbit/s
          &#39;0101&#39; | 160 kbit/s  |  80 kbit/s
          &#39;0110&#39; | 192 kbit/s  |  96 kbit/s
          &#39;0111&#39; | 224 kbit/s  | 112 kbit/s
          &#39;1000&#39; | 256 kbit/s  | 128 kbit/s
          &#39;1001&#39; | 288 kbit/s  | 160 kbit/s
          &#39;1010&#39; | 320 kbit/s  | 192 kbit/s
          &#39;1011&#39; | 352 kbit/s  | 224 kbit/s
          &#39;1100&#39; | 384 kbit/s  | 256 kbit/s
          &#39;1101&#39; | 416 kbit/s  | 320 kbit/s
          &#39;1110&#39; | 448 kbit/s  | 384 kbit/s

      .. note::

              For Layer II, not all combinations of total bitrate
              and mode are allowed. See ISO11172-3 3-Annex B,
              Table 3-B.2

 8:9  &#39;00&#39;=Stereo
      &#39;01&#39;=JointStereo
      &#39;10&#39;=Dual
      &#39;11&#39;=Mono

      .. note::

              The cx23415 cannot decode Joint Stereo properly.

10:11 Mode Extension used in joint_stereo mode.
      In Layer I and II they indicate which subbands are in
      intensity_stereo. All other subbands are coded in stereo.
          &#39;00&#39; subbands 4-31 in intensity_stereo, bound==4
          &#39;01&#39; subbands 8-31 in intensity_stereo, bound==8
          &#39;10&#39; subbands 12-31 in intensity_stereo, bound==12
          &#39;11&#39; subbands 16-31 in intensity_stereo, bound==16

12:13 Emphasis:
          &#39;00&#39; None
          &#39;01&#39; 50/15uS
          &#39;10&#39; reserved
          &#39;11&#39; CCITT J.17

14    CRC:
          &#39;0&#39; off
          &#39;1&#39; on

15    Copyright:
          &#39;0&#39; off
          &#39;1&#39; on

16    Generation:
          &#39;0&#39; copy
          &#39;1&#39; original
</pre></div>
</div>
</div>
</div>
<div class="section" id="cx2341x-enc-halt-fw">
<h3>11.6.20. CX2341X_ENC_HALT_FW<a class="headerlink" href="#cx2341x-enc-halt-fw" title="Permalink to this headline">¶</a></h3>
<p>Enum: 195/0xC3</p>
<div class="section" id="id134">
<h4>11.6.20.1. Description<a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h4>
<p>The firmware is halted and no further API calls are serviced until the
firmware is uploaded again.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-get-version">
<h3>11.6.21. CX2341X_ENC_GET_VERSION<a class="headerlink" href="#cx2341x-enc-get-version" title="Permalink to this headline">¶</a></h3>
<p>Enum: 196/0xC4</p>
<div class="section" id="id135">
<h4>11.6.21.1. Description<a class="headerlink" href="#id135" title="Permalink to this headline">¶</a></h4>
<p>Returns the version of the encoder firmware.</p>
</div>
<div class="section" id="id136">
<h4>11.6.21.2. Result[0]<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h4>
<p>Version bitmask:
- Bits  0:15 build
- Bits 16:23 minor
- Bits 24:31 major</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-gop-closure">
<h3>11.6.22. CX2341X_ENC_SET_GOP_CLOSURE<a class="headerlink" href="#cx2341x-enc-set-gop-closure" title="Permalink to this headline">¶</a></h3>
<p>Enum: 197/0xC5</p>
<div class="section" id="id137">
<h4>11.6.22.1. Description<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h4>
<p>Assigns the GOP open/close property.</p>
</div>
<div class="section" id="id138">
<h4>11.6.22.2. Param[0]<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=Open</li>
<li>1=Closed</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-get-seq-end">
<h3>11.6.23. CX2341X_ENC_GET_SEQ_END<a class="headerlink" href="#cx2341x-enc-get-seq-end" title="Permalink to this headline">¶</a></h3>
<p>Enum: 198/0xC6</p>
<div class="section" id="id139">
<h4>11.6.23.1. Description<a class="headerlink" href="#id139" title="Permalink to this headline">¶</a></h4>
<p>Obtains the sequence end code of the encoder&#8217;s buffer. When a capture
is started a number of interrupts are still generated, the last of
which will have Result[0] set to 1 and Result[1] will contain the size
of the buffer.</p>
</div>
<div class="section" id="id140">
<h4>11.6.23.2. Result[0]<a class="headerlink" href="#id140" title="Permalink to this headline">¶</a></h4>
<p>State of the transfer (1 if last buffer)</p>
</div>
<div class="section" id="id141">
<h4>11.6.23.3. Result[1]<a class="headerlink" href="#id141" title="Permalink to this headline">¶</a></h4>
<p>If Result[0] is 1, this contains the size of the last buffer, undefined
otherwise.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-pgm-index-info">
<h3>11.6.24. CX2341X_ENC_SET_PGM_INDEX_INFO<a class="headerlink" href="#cx2341x-enc-set-pgm-index-info" title="Permalink to this headline">¶</a></h3>
<p>Enum: 199/0xC7</p>
<div class="section" id="id142">
<h4>11.6.24.1. Description<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h4>
<p>Sets the Program Index Information.
The information is stored as follows:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">info</span> <span class="p">{</span>
        <span class="n">u32</span> <span class="n">length</span><span class="p">;</span>             <span class="c1">// Length of this frame</span>
        <span class="n">u32</span> <span class="n">offset_low</span><span class="p">;</span>         <span class="c1">// Offset in the file of the</span>
        <span class="n">u32</span> <span class="n">offset_high</span><span class="p">;</span>        <span class="c1">// start of this frame</span>
        <span class="n">u32</span> <span class="n">mask1</span><span class="p">;</span>              <span class="c1">// Bits 0-2 are the type mask:</span>
                                <span class="c1">// 1=I, 2=P, 4=B</span>
                                <span class="c1">// 0=End of Program Index, other fields</span>
                                <span class="c1">//   are invalid.</span>
        <span class="n">u32</span> <span class="n">pts</span><span class="p">;</span>                <span class="c1">// The PTS of the frame</span>
        <span class="n">u32</span> <span class="n">mask2</span><span class="p">;</span>              <span class="c1">// Bit 0 is bit 32 of the pts.</span>
<span class="p">};</span>
<span class="n">u32</span> <span class="n">table_ptr</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">info</span> <span class="n">index</span><span class="p">[</span><span class="mi">400</span><span class="p">];</span>
</pre></div>
</div>
<p>The table_ptr is the encoder memory address in the table were
<em>new</em> entries will be written.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a ringbuffer, so the table_ptr will wraparound.</p>
</div>
</div>
<div class="section" id="id143">
<h4>11.6.24.2. Param[0]<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h4>
<p>Picture Mask:
- 0=No index capture
- 1=I frames
- 3=I,P frames
- 7=I,P,B frames</p>
<p>(Seems to be ignored, it always indexes I, P and B frames)</p>
</div>
<div class="section" id="id144">
<h4>11.6.24.3. Param[1]<a class="headerlink" href="#id144" title="Permalink to this headline">¶</a></h4>
<p>Elements requested (up to 400)</p>
</div>
<div class="section" id="id145">
<h4>11.6.24.4. Result[0]<a class="headerlink" href="#id145" title="Permalink to this headline">¶</a></h4>
<p>Offset in the encoder memory of the start of the table.</p>
</div>
<div class="section" id="id146">
<h4>11.6.24.5. Result[1]<a class="headerlink" href="#id146" title="Permalink to this headline">¶</a></h4>
<p>Number of allocated elements up to a maximum of Param[1]</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-vbi-config">
<h3>11.6.25. CX2341X_ENC_SET_VBI_CONFIG<a class="headerlink" href="#cx2341x-enc-set-vbi-config" title="Permalink to this headline">¶</a></h3>
<p>Enum: 200/0xC8</p>
<div class="section" id="id147">
<h4>11.6.25.1. Description<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h4>
<p>Configure VBI settings</p>
</div>
<div class="section" id="id148">
<h4>11.6.25.2. Param[0]<a class="headerlink" href="#id148" title="Permalink to this headline">¶</a></h4>
<p>Bitmap:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>0    Mode &#39;0&#39; Sliced, &#39;1&#39; Raw
1:3  Insertion:
         &#39;000&#39; insert in extension &amp; user data
         &#39;001&#39; insert in private packets
         &#39;010&#39; separate stream and user data
         &#39;111&#39; separate stream and private data
8:15 Stream ID (normally 0xBD)
</pre></div>
</div>
</div>
<div class="section" id="id149">
<h4>11.6.25.3. Param[1]<a class="headerlink" href="#id149" title="Permalink to this headline">¶</a></h4>
<p>Frames per interrupt (max 8). Only valid in raw mode.</p>
</div>
<div class="section" id="id150">
<h4>11.6.25.4. Param[2]<a class="headerlink" href="#id150" title="Permalink to this headline">¶</a></h4>
<p>Total raw VBI frames. Only valid in raw mode.</p>
</div>
<div class="section" id="id151">
<h4>11.6.25.5. Param[3]<a class="headerlink" href="#id151" title="Permalink to this headline">¶</a></h4>
<p>Start codes</p>
</div>
<div class="section" id="id152">
<h4>11.6.25.6. Param[4]<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h4>
<p>Stop codes</p>
</div>
<div class="section" id="id153">
<h4>11.6.25.7. Param[5]<a class="headerlink" href="#id153" title="Permalink to this headline">¶</a></h4>
<p>Lines per frame</p>
</div>
<div class="section" id="id154">
<h4>11.6.25.8. Param[6]<a class="headerlink" href="#id154" title="Permalink to this headline">¶</a></h4>
<p>Byte per line</p>
</div>
<div class="section" id="id155">
<h4>11.6.25.9. Result[0]<a class="headerlink" href="#id155" title="Permalink to this headline">¶</a></h4>
<p>Observed frames per interrupt in raw mode only. Rage 1 to Param[1]</p>
</div>
<div class="section" id="id156">
<h4>11.6.25.10. Result[1]<a class="headerlink" href="#id156" title="Permalink to this headline">¶</a></h4>
<p>Observed number of frames in raw mode. Range 1 to Param[2]</p>
</div>
<div class="section" id="id157">
<h4>11.6.25.11. Result[2]<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h4>
<p>Memory offset to start or raw VBI data</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-dma-block-size">
<h3>11.6.26. CX2341X_ENC_SET_DMA_BLOCK_SIZE<a class="headerlink" href="#cx2341x-enc-set-dma-block-size" title="Permalink to this headline">¶</a></h3>
<p>Enum: 201/0xC9</p>
<div class="section" id="id158">
<h4>11.6.26.1. Description<a class="headerlink" href="#id158" title="Permalink to this headline">¶</a></h4>
<p>Set DMA transfer block size</p>
</div>
<div class="section" id="id159">
<h4>11.6.26.2. Param[0]<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h4>
<p>DMA transfer block size in bytes or frames. When unit is bytes,
supported block sizes are 2^7, 2^8 and 2^9 bytes.</p>
</div>
<div class="section" id="id160">
<h4>11.6.26.3. Param[1]<a class="headerlink" href="#id160" title="Permalink to this headline">¶</a></h4>
<p>Unit: 0=bytes, 1=frames</p>
</div>
</div>
<div class="section" id="cx2341x-enc-get-prev-dma-info-mb-10">
<h3>11.6.27. CX2341X_ENC_GET_PREV_DMA_INFO_MB_10<a class="headerlink" href="#cx2341x-enc-get-prev-dma-info-mb-10" title="Permalink to this headline">¶</a></h3>
<p>Enum: 202/0xCA</p>
<div class="section" id="id161">
<h4>11.6.27.1. Description<a class="headerlink" href="#id161" title="Permalink to this headline">¶</a></h4>
<p>Returns information on the previous DMA transfer in conjunction with
bit 27 of the interrupt mask. Uses mailbox 10.</p>
</div>
<div class="section" id="id162">
<h4>11.6.27.2. Result[0]<a class="headerlink" href="#id162" title="Permalink to this headline">¶</a></h4>
<p>Type of stream</p>
</div>
<div class="section" id="id163">
<h4>11.6.27.3. Result[1]<a class="headerlink" href="#id163" title="Permalink to this headline">¶</a></h4>
<p>Address Offset</p>
</div>
<div class="section" id="id164">
<h4>11.6.27.4. Result[2]<a class="headerlink" href="#id164" title="Permalink to this headline">¶</a></h4>
<p>Maximum size of transfer</p>
</div>
</div>
<div class="section" id="cx2341x-enc-get-prev-dma-info-mb-9">
<h3>11.6.28. CX2341X_ENC_GET_PREV_DMA_INFO_MB_9<a class="headerlink" href="#cx2341x-enc-get-prev-dma-info-mb-9" title="Permalink to this headline">¶</a></h3>
<p>Enum: 203/0xCB</p>
<div class="section" id="id165">
<h4>11.6.28.1. Description<a class="headerlink" href="#id165" title="Permalink to this headline">¶</a></h4>
<p>Returns information on the previous DMA transfer in conjunction with
bit 27 or 18 of the interrupt mask. Uses mailbox 9.</p>
</div>
<div class="section" id="id166">
<h4>11.6.28.2. Result[0]<a class="headerlink" href="#id166" title="Permalink to this headline">¶</a></h4>
<p>Status bits:
- 0   read completed
- 1   write completed
- 2   DMA read error
- 3   DMA write error
- 4   Scatter-Gather array error</p>
</div>
<div class="section" id="id167">
<h4>11.6.28.3. Result[1]<a class="headerlink" href="#id167" title="Permalink to this headline">¶</a></h4>
<p>DMA type</p>
</div>
<div class="section" id="id168">
<h4>11.6.28.4. Result[2]<a class="headerlink" href="#id168" title="Permalink to this headline">¶</a></h4>
<p>Presentation Time Stamp bits 0..31</p>
</div>
<div class="section" id="id169">
<h4>11.6.28.5. Result[3]<a class="headerlink" href="#id169" title="Permalink to this headline">¶</a></h4>
<p>Presentation Time Stamp bit 32</p>
</div>
</div>
<div class="section" id="cx2341x-enc-sched-dma-to-host">
<h3>11.6.29. CX2341X_ENC_SCHED_DMA_TO_HOST<a class="headerlink" href="#cx2341x-enc-sched-dma-to-host" title="Permalink to this headline">¶</a></h3>
<p>Enum: 204/0xCC</p>
<div class="section" id="id170">
<h4>11.6.29.1. Description<a class="headerlink" href="#id170" title="Permalink to this headline">¶</a></h4>
<p>Setup DMA to host operation</p>
</div>
<div class="section" id="id171">
<h4>11.6.29.2. Param[0]<a class="headerlink" href="#id171" title="Permalink to this headline">¶</a></h4>
<p>Memory address of link list</p>
</div>
<div class="section" id="id172">
<h4>11.6.29.3. Param[1]<a class="headerlink" href="#id172" title="Permalink to this headline">¶</a></h4>
<p>Length of link list (wtf: what units ???)</p>
</div>
<div class="section" id="id173">
<h4>11.6.29.4. Param[2]<a class="headerlink" href="#id173" title="Permalink to this headline">¶</a></h4>
<p>DMA type (0=MPEG)</p>
</div>
</div>
<div class="section" id="cx2341x-enc-initialize-input">
<h3>11.6.30. CX2341X_ENC_INITIALIZE_INPUT<a class="headerlink" href="#cx2341x-enc-initialize-input" title="Permalink to this headline">¶</a></h3>
<p>Enum: 205/0xCD</p>
<div class="section" id="id174">
<h4>11.6.30.1. Description<a class="headerlink" href="#id174" title="Permalink to this headline">¶</a></h4>
<p>Initializes the video input</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-frame-drop-rate">
<h3>11.6.31. CX2341X_ENC_SET_FRAME_DROP_RATE<a class="headerlink" href="#cx2341x-enc-set-frame-drop-rate" title="Permalink to this headline">¶</a></h3>
<p>Enum: 208/0xD0</p>
<div class="section" id="id175">
<h4>11.6.31.1. Description<a class="headerlink" href="#id175" title="Permalink to this headline">¶</a></h4>
<p>For each frame captured, skip specified number of frames.</p>
</div>
<div class="section" id="id176">
<h4>11.6.31.2. Param[0]<a class="headerlink" href="#id176" title="Permalink to this headline">¶</a></h4>
<p>Number of frames to skip</p>
</div>
</div>
<div class="section" id="cx2341x-enc-pause-encoder">
<h3>11.6.32. CX2341X_ENC_PAUSE_ENCODER<a class="headerlink" href="#cx2341x-enc-pause-encoder" title="Permalink to this headline">¶</a></h3>
<p>Enum: 210/0xD2</p>
<div class="section" id="id177">
<h4>11.6.32.1. Description<a class="headerlink" href="#id177" title="Permalink to this headline">¶</a></h4>
<p>During a pause condition, all frames are dropped instead of being encoded.</p>
</div>
<div class="section" id="id178">
<h4>11.6.32.2. Param[0]<a class="headerlink" href="#id178" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=Pause encoding</li>
<li>1=Continue encoding</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-refresh-input">
<h3>11.6.33. CX2341X_ENC_REFRESH_INPUT<a class="headerlink" href="#cx2341x-enc-refresh-input" title="Permalink to this headline">¶</a></h3>
<p>Enum: 211/0xD3</p>
<div class="section" id="id179">
<h4>11.6.33.1. Description<a class="headerlink" href="#id179" title="Permalink to this headline">¶</a></h4>
<p>Refreshes the video input</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-copyright">
<h3>11.6.34. CX2341X_ENC_SET_COPYRIGHT<a class="headerlink" href="#cx2341x-enc-set-copyright" title="Permalink to this headline">¶</a></h3>
<p>Enum: 212/0xD4</p>
<div class="section" id="id180">
<h4>11.6.34.1. Description<a class="headerlink" href="#id180" title="Permalink to this headline">¶</a></h4>
<p>Sets stream copyright property</p>
</div>
<div class="section" id="id181">
<h4>11.6.34.2. Param[0]<a class="headerlink" href="#id181" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=Stream is not copyrighted</li>
<li>1=Stream is copyrighted</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-event-notification">
<h3>11.6.35. CX2341X_ENC_SET_EVENT_NOTIFICATION<a class="headerlink" href="#cx2341x-enc-set-event-notification" title="Permalink to this headline">¶</a></h3>
<p>Enum: 213/0xD5</p>
<div class="section" id="id182">
<h4>11.6.35.1. Description<a class="headerlink" href="#id182" title="Permalink to this headline">¶</a></h4>
<p>Setup firmware to notify the host about a particular event. Host must
unmask the interrupt bit.</p>
</div>
<div class="section" id="id183">
<h4>11.6.35.2. Param[0]<a class="headerlink" href="#id183" title="Permalink to this headline">¶</a></h4>
<p>Event (0=refresh encoder input)</p>
</div>
<div class="section" id="id184">
<h4>11.6.35.3. Param[1]<a class="headerlink" href="#id184" title="Permalink to this headline">¶</a></h4>
<p>Notification 0=disabled 1=enabled</p>
</div>
<div class="section" id="id185">
<h4>11.6.35.4. Param[2]<a class="headerlink" href="#id185" title="Permalink to this headline">¶</a></h4>
<p>Interrupt bit</p>
</div>
<div class="section" id="id186">
<h4>11.6.35.5. Param[3]<a class="headerlink" href="#id186" title="Permalink to this headline">¶</a></h4>
<p>Mailbox slot, -1 if no mailbox required.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-num-vsync-lines">
<h3>11.6.36. CX2341X_ENC_SET_NUM_VSYNC_LINES<a class="headerlink" href="#cx2341x-enc-set-num-vsync-lines" title="Permalink to this headline">¶</a></h3>
<p>Enum: 214/0xD6</p>
<div class="section" id="id187">
<h4>11.6.36.1. Description<a class="headerlink" href="#id187" title="Permalink to this headline">¶</a></h4>
<p>Depending on the analog video decoder used, this assigns the number
of lines for field 1 and 2.</p>
</div>
<div class="section" id="id188">
<h4>11.6.36.2. Param[0]<a class="headerlink" href="#id188" title="Permalink to this headline">¶</a></h4>
<p>Field 1 number of lines:
- 0x00EF for SAA7114
- 0x00F0 for SAA7115
- 0x0105 for Micronas</p>
</div>
<div class="section" id="id189">
<h4>11.6.36.3. Param[1]<a class="headerlink" href="#id189" title="Permalink to this headline">¶</a></h4>
<p>Field 2 number of lines:
- 0x00EF for SAA7114
- 0x00F0 for SAA7115
- 0x0106 for Micronas</p>
</div>
</div>
<div class="section" id="cx2341x-enc-set-placeholder">
<h3>11.6.37. CX2341X_ENC_SET_PLACEHOLDER<a class="headerlink" href="#cx2341x-enc-set-placeholder" title="Permalink to this headline">¶</a></h3>
<p>Enum: 215/0xD7</p>
<div class="section" id="id190">
<h4>11.6.37.1. Description<a class="headerlink" href="#id190" title="Permalink to this headline">¶</a></h4>
<p>Provides a mechanism of inserting custom user data in the MPEG stream.</p>
</div>
<div class="section" id="id191">
<h4>11.6.37.2. Param[0]<a class="headerlink" href="#id191" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=extension &amp; user data</li>
<li>1=private packet with stream ID 0xBD</li>
</ul>
</div>
<div class="section" id="id192">
<h4>11.6.37.3. Param[1]<a class="headerlink" href="#id192" title="Permalink to this headline">¶</a></h4>
<p>Rate at which to insert data, in units of frames (for private packet)
or GOPs (for ext. &amp; user data)</p>
</div>
<div class="section" id="id193">
<h4>11.6.37.4. Param[2]<a class="headerlink" href="#id193" title="Permalink to this headline">¶</a></h4>
<p>Number of data DWORDs (below) to insert</p>
</div>
<div class="section" id="id194">
<h4>11.6.37.5. Param[3]<a class="headerlink" href="#id194" title="Permalink to this headline">¶</a></h4>
<p>Custom data 0</p>
</div>
<div class="section" id="id195">
<h4>11.6.37.6. Param[4]<a class="headerlink" href="#id195" title="Permalink to this headline">¶</a></h4>
<p>Custom data 1</p>
</div>
<div class="section" id="id196">
<h4>11.6.37.7. Param[5]<a class="headerlink" href="#id196" title="Permalink to this headline">¶</a></h4>
<p>Custom data 2</p>
</div>
<div class="section" id="id197">
<h4>11.6.37.8. Param[6]<a class="headerlink" href="#id197" title="Permalink to this headline">¶</a></h4>
<p>Custom data 3</p>
</div>
<div class="section" id="id198">
<h4>11.6.37.9. Param[7]<a class="headerlink" href="#id198" title="Permalink to this headline">¶</a></h4>
<p>Custom data 4</p>
</div>
<div class="section" id="id199">
<h4>11.6.37.10. Param[8]<a class="headerlink" href="#id199" title="Permalink to this headline">¶</a></h4>
<p>Custom data 5</p>
</div>
<div class="section" id="id200">
<h4>11.6.37.11. Param[9]<a class="headerlink" href="#id200" title="Permalink to this headline">¶</a></h4>
<p>Custom data 6</p>
</div>
<div class="section" id="id201">
<h4>11.6.37.12. Param[10]<a class="headerlink" href="#id201" title="Permalink to this headline">¶</a></h4>
<p>Custom data 7</p>
</div>
<div class="section" id="param-11">
<h4>11.6.37.13. Param[11]<a class="headerlink" href="#param-11" title="Permalink to this headline">¶</a></h4>
<p>Custom data 8</p>
</div>
</div>
<div class="section" id="cx2341x-enc-mute-video">
<h3>11.6.38. CX2341X_ENC_MUTE_VIDEO<a class="headerlink" href="#cx2341x-enc-mute-video" title="Permalink to this headline">¶</a></h3>
<p>Enum: 217/0xD9</p>
<div class="section" id="id202">
<h4>11.6.38.1. Description<a class="headerlink" href="#id202" title="Permalink to this headline">¶</a></h4>
<p>Video muting</p>
</div>
<div class="section" id="id203">
<h4>11.6.38.2. Param[0]<a class="headerlink" href="#id203" title="Permalink to this headline">¶</a></h4>
<p>Bit usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span> 0      &#39;0&#39;=video not muted
        &#39;1&#39;=video muted, creates frames with the YUV color defined below
 1:7    Unused
 8:15   V chrominance information
16:23   U chrominance information
24:31   Y luminance information
</pre></div>
</div>
</div>
</div>
<div class="section" id="cx2341x-enc-mute-audio">
<h3>11.6.39. CX2341X_ENC_MUTE_AUDIO<a class="headerlink" href="#cx2341x-enc-mute-audio" title="Permalink to this headline">¶</a></h3>
<p>Enum: 218/0xDA</p>
<div class="section" id="id204">
<h4>11.6.39.1. Description<a class="headerlink" href="#id204" title="Permalink to this headline">¶</a></h4>
<p>Audio muting</p>
</div>
<div class="section" id="id205">
<h4>11.6.39.2. Param[0]<a class="headerlink" href="#id205" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>0=audio not muted</li>
<li>1=audio muted (produces silent mpeg audio stream)</li>
</ul>
</div>
</div>
<div class="section" id="cx2341x-enc-set-vert-crop-line">
<h3>11.6.40. CX2341X_ENC_SET_VERT_CROP_LINE<a class="headerlink" href="#cx2341x-enc-set-vert-crop-line" title="Permalink to this headline">¶</a></h3>
<p>Enum: 219/0xDB</p>
<div class="section" id="id206">
<h4>11.6.40.1. Description<a class="headerlink" href="#id206" title="Permalink to this headline">¶</a></h4>
<p>Something to do with &#8216;Vertical Crop Line&#8217;</p>
</div>
<div class="section" id="id207">
<h4>11.6.40.2. Param[0]<a class="headerlink" href="#id207" title="Permalink to this headline">¶</a></h4>
<p>If saa7114 and raw VBI capture and 60 Hz, then set to 10001.
Else 0.</p>
</div>
</div>
<div class="section" id="cx2341x-enc-misc">
<h3>11.6.41. CX2341X_ENC_MISC<a class="headerlink" href="#cx2341x-enc-misc" title="Permalink to this headline">¶</a></h3>
<p>Enum: 220/0xDC</p>
<div class="section" id="id208">
<h4>11.6.41.1. Description<a class="headerlink" href="#id208" title="Permalink to this headline">¶</a></h4>
<p>Miscellaneous actions. Not known for 100% what it does. It&#8217;s really a
sort of ioctl call. The first parameter is a command number, the second
the value.</p>
</div>
<div class="section" id="id209">
<h4>11.6.41.2. Param[0]<a class="headerlink" href="#id209" title="Permalink to this headline">¶</a></h4>
<p>Command number:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span> 1=set initial SCR value when starting encoding (works).
 2=set quality mode (apparently some test setting).
 3=setup advanced VIM protection handling.
   Always 1 for the cx23416 and 0 for cx23415.
 4=generate DVD compatible PTS timestamps
 5=USB flush mode
 6=something to do with the quantization matrix
 7=set navigation pack insertion for DVD: adds 0xbf (private stream 2)
   packets to the MPEG. The size of these packets is 2048 bytes (including
   the header of 6 bytes: 0x000001bf + length). The payload is zeroed and
   it is up to the application to fill them in. These packets are apparently
   inserted every four frames.
 8=enable scene change detection (seems to be a failure)
 9=set history parameters of the video input module
10=set input field order of VIM
11=set quantization matrix
12=reset audio interface after channel change or input switch (has no argument).
   Needed for the cx2584x, not needed for the mspx4xx, but it doesn&#39;t seem to
   do any harm calling it regardless.
13=set audio volume delay
14=set audio delay
</pre></div>
</div>
</div>
<div class="section" id="id210">
<h4>11.6.41.3. Param[1]<a class="headerlink" href="#id210" title="Permalink to this headline">¶</a></h4>
<p>Command value.</p>
</div>
</div>
</div>
<div class="section" id="decoder-firmware-api-description">
<h2>11.7. Decoder firmware API description<a class="headerlink" href="#decoder-firmware-api-description" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this API is part of the decoder firmware, so it&#8217;s cx23415 only.</p>
</div>
<div class="section" id="cx2341x-dec-ping-fw">
<h3>11.7.1. CX2341X_DEC_PING_FW<a class="headerlink" href="#cx2341x-dec-ping-fw" title="Permalink to this headline">¶</a></h3>
<p>Enum: 0/0x00</p>
<div class="section" id="id211">
<h4>11.7.1.1. Description<a class="headerlink" href="#id211" title="Permalink to this headline">¶</a></h4>
<p>This API call does nothing. It may be used to check if the firmware
is responding.</p>
</div>
</div>
<div class="section" id="cx2341x-dec-start-playback">
<h3>11.7.2. CX2341X_DEC_START_PLAYBACK<a class="headerlink" href="#cx2341x-dec-start-playback" title="Permalink to this headline">¶</a></h3>
<p>Enum: 1/0x01</p>
<div class="section" id="id212">
<h4>11.7.2.1. Description<a class="headerlink" href="#id212" title="Permalink to this headline">¶</a></h4>
<p>Begin or resume playback.</p>
</div>
<div class="section" id="id213">
<h4>11.7.2.2. Param[0]<a class="headerlink" href="#id213" title="Permalink to this headline">¶</a></h4>
<p>0 based frame number in GOP to begin playback from.</p>
</div>
<div class="section" id="id214">
<h4>11.7.2.3. Param[1]<a class="headerlink" href="#id214" title="Permalink to this headline">¶</a></h4>
<p>Specifies the number of muted audio frames to play before normal
audio resumes. (This is not implemented in the firmware, leave at 0)</p>
</div>
</div>
<div class="section" id="cx2341x-dec-stop-playback">
<h3>11.7.3. CX2341X_DEC_STOP_PLAYBACK<a class="headerlink" href="#cx2341x-dec-stop-playback" title="Permalink to this headline">¶</a></h3>
<p>Enum: 2/0x02</p>
<div class="section" id="id215">
<h4>11.7.3.1. Description<a class="headerlink" href="#id215" title="Permalink to this headline">¶</a></h4>
<p>Ends playback and clears all decoder buffers. If PTS is not zero,
playback stops at specified PTS.</p>
</div>
<div class="section" id="id216">
<h4>11.7.3.2. Param[0]<a class="headerlink" href="#id216" title="Permalink to this headline">¶</a></h4>
<p>Display 0=last frame, 1=black</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this takes effect immediately, so if you want to wait for a PTS,
then use &#8216;0&#8217;, otherwise the screen goes to black at once.
You can call this later (even if there is no playback) with a 1 value
to set the screen to black.</p>
</div>
</div>
<div class="section" id="id217">
<h4>11.7.3.3. Param[1]<a class="headerlink" href="#id217" title="Permalink to this headline">¶</a></h4>
<p>PTS low</p>
</div>
<div class="section" id="id218">
<h4>11.7.3.4. Param[2]<a class="headerlink" href="#id218" title="Permalink to this headline">¶</a></h4>
<p>PTS high</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-playback-speed">
<h3>11.7.4. CX2341X_DEC_SET_PLAYBACK_SPEED<a class="headerlink" href="#cx2341x-dec-set-playback-speed" title="Permalink to this headline">¶</a></h3>
<p>Enum: 3/0x03</p>
<div class="section" id="id219">
<h4>11.7.4.1. Description<a class="headerlink" href="#id219" title="Permalink to this headline">¶</a></h4>
<p>Playback stream at speed other than normal. There are two modes of
operation:</p>
<blockquote>
<div><ul class="simple">
<li>Smooth: host transfers entire stream and firmware drops unused
frames.</li>
<li>Coarse: host drops frames based on indexing as required to achieve
desired speed.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id220">
<h4>11.7.4.2. Param[0]<a class="headerlink" href="#id220" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>Bitmap:
    0:7  0 normal
         1 fast only &quot;1.5 times&quot;
         n nX fast, 1/nX slow
    30   Framedrop:
             &#39;0&#39; during 1.5 times play, every other B frame is dropped
             &#39;1&#39; during 1.5 times play, stream is unchanged (bitrate
                 must not exceed 8mbps)
    31   Speed:
             &#39;0&#39; slow
             &#39;1&#39; fast
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">n is limited to 2. Anything higher does not result in
faster playback. Instead the host should start dropping frames.</p>
</div>
</div>
<div class="section" id="id221">
<h4>11.7.4.3. Param[1]<a class="headerlink" href="#id221" title="Permalink to this headline">¶</a></h4>
<p>Direction: 0=forward, 1=reverse</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">to make reverse playback work you have to write full GOPs in
reverse order.</p>
</div>
</div>
<div class="section" id="id222">
<h4>11.7.4.4. Param[2]<a class="headerlink" href="#id222" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>Picture mask:
    1=I frames
    3=I, P frames
    7=I, P, B frames
</pre></div>
</div>
</div>
<div class="section" id="id223">
<h4>11.7.4.5. Param[3]<a class="headerlink" href="#id223" title="Permalink to this headline">¶</a></h4>
<p>B frames per GOP (for reverse play only)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">for reverse playback the Picture Mask should be set to I or I, P.
Adding B frames to the mask will result in corrupt video. This field
has to be set to the correct value in order to keep the timing correct.</p>
</div>
</div>
<div class="section" id="id224">
<h4>11.7.4.6. Param[4]<a class="headerlink" href="#id224" title="Permalink to this headline">¶</a></h4>
<p>Mute audio: 0=disable, 1=enable</p>
</div>
<div class="section" id="id225">
<h4>11.7.4.7. Param[5]<a class="headerlink" href="#id225" title="Permalink to this headline">¶</a></h4>
<p>Display 0=frame, 1=field</p>
</div>
<div class="section" id="id226">
<h4>11.7.4.8. Param[6]<a class="headerlink" href="#id226" title="Permalink to this headline">¶</a></h4>
<p>Specifies the number of muted audio frames to play before normal audio
resumes. (Not implemented in the firmware, leave at 0)</p>
</div>
</div>
<div class="section" id="cx2341x-dec-step-video">
<h3>11.7.5. CX2341X_DEC_STEP_VIDEO<a class="headerlink" href="#cx2341x-dec-step-video" title="Permalink to this headline">¶</a></h3>
<p>Enum: 5/0x05</p>
<div class="section" id="id227">
<h4>11.7.5.1. Description<a class="headerlink" href="#id227" title="Permalink to this headline">¶</a></h4>
<p>Each call to this API steps the playback to the next unit defined below
in the current playback direction.</p>
</div>
<div class="section" id="id228">
<h4>11.7.5.2. Param[0]<a class="headerlink" href="#id228" title="Permalink to this headline">¶</a></h4>
<p>0=frame, 1=top field, 2=bottom field</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-dma-block-size">
<h3>11.7.6. CX2341X_DEC_SET_DMA_BLOCK_SIZE<a class="headerlink" href="#cx2341x-dec-set-dma-block-size" title="Permalink to this headline">¶</a></h3>
<p>Enum: 8/0x08</p>
<div class="section" id="id229">
<h4>11.7.6.1. Description<a class="headerlink" href="#id229" title="Permalink to this headline">¶</a></h4>
<p>Set DMA transfer block size. Counterpart to API 0xC9</p>
</div>
<div class="section" id="id230">
<h4>11.7.6.2. Param[0]<a class="headerlink" href="#id230" title="Permalink to this headline">¶</a></h4>
<p>DMA transfer block size in bytes. A different size may be specified
when issuing the DMA transfer command.</p>
</div>
</div>
<div class="section" id="cx2341x-dec-get-xfer-info">
<h3>11.7.7. CX2341X_DEC_GET_XFER_INFO<a class="headerlink" href="#cx2341x-dec-get-xfer-info" title="Permalink to this headline">¶</a></h3>
<p>Enum: 9/0x09</p>
<div class="section" id="id231">
<h4>11.7.7.1. Description<a class="headerlink" href="#id231" title="Permalink to this headline">¶</a></h4>
<p>This API call may be used to detect an end of stream condition.</p>
</div>
<div class="section" id="id232">
<h4>11.7.7.2. Result[0]<a class="headerlink" href="#id232" title="Permalink to this headline">¶</a></h4>
<p>Stream type</p>
</div>
<div class="section" id="id233">
<h4>11.7.7.3. Result[1]<a class="headerlink" href="#id233" title="Permalink to this headline">¶</a></h4>
<p>Address offset</p>
</div>
<div class="section" id="id234">
<h4>11.7.7.4. Result[2]<a class="headerlink" href="#id234" title="Permalink to this headline">¶</a></h4>
<p>Maximum bytes to transfer</p>
</div>
<div class="section" id="id235">
<h4>11.7.7.5. Result[3]<a class="headerlink" href="#id235" title="Permalink to this headline">¶</a></h4>
<p>Buffer fullness</p>
</div>
</div>
<div class="section" id="cx2341x-dec-get-dma-status">
<h3>11.7.8. CX2341X_DEC_GET_DMA_STATUS<a class="headerlink" href="#cx2341x-dec-get-dma-status" title="Permalink to this headline">¶</a></h3>
<p>Enum: 10/0x0A</p>
<div class="section" id="id236">
<h4>11.7.8.1. Description<a class="headerlink" href="#id236" title="Permalink to this headline">¶</a></h4>
<p>Status of the last DMA transfer</p>
</div>
<div class="section" id="id237">
<h4>11.7.8.2. Result[0]<a class="headerlink" href="#id237" title="Permalink to this headline">¶</a></h4>
<p>Bit 1 set means transfer complete
Bit 2 set means DMA error
Bit 3 set means linked list error</p>
</div>
<div class="section" id="id238">
<h4>11.7.8.3. Result[1]<a class="headerlink" href="#id238" title="Permalink to this headline">¶</a></h4>
<p>DMA type: 0=MPEG, 1=OSD, 2=YUV</p>
</div>
</div>
<div class="section" id="cx2341x-dec-sched-dma-from-host">
<h3>11.7.9. CX2341X_DEC_SCHED_DMA_FROM_HOST<a class="headerlink" href="#cx2341x-dec-sched-dma-from-host" title="Permalink to this headline">¶</a></h3>
<p>Enum: 11/0x0B</p>
<div class="section" id="id239">
<h4>11.7.9.1. Description<a class="headerlink" href="#id239" title="Permalink to this headline">¶</a></h4>
<p>Setup DMA from host operation. Counterpart to API 0xCC</p>
</div>
<div class="section" id="id240">
<h4>11.7.9.2. Param[0]<a class="headerlink" href="#id240" title="Permalink to this headline">¶</a></h4>
<p>Memory address of link list</p>
</div>
<div class="section" id="id241">
<h4>11.7.9.3. Param[1]<a class="headerlink" href="#id241" title="Permalink to this headline">¶</a></h4>
<p>Total # of bytes to transfer</p>
</div>
<div class="section" id="id242">
<h4>11.7.9.4. Param[2]<a class="headerlink" href="#id242" title="Permalink to this headline">¶</a></h4>
<p>DMA type (0=MPEG, 1=OSD, 2=YUV)</p>
</div>
</div>
<div class="section" id="cx2341x-dec-pause-playback">
<h3>11.7.10. CX2341X_DEC_PAUSE_PLAYBACK<a class="headerlink" href="#cx2341x-dec-pause-playback" title="Permalink to this headline">¶</a></h3>
<p>Enum: 13/0x0D</p>
<div class="section" id="id243">
<h4>11.7.10.1. Description<a class="headerlink" href="#id243" title="Permalink to this headline">¶</a></h4>
<p>Freeze playback immediately. In this mode, when internal buffers are
full, no more data will be accepted and data request IRQs will be
masked.</p>
</div>
<div class="section" id="id244">
<h4>11.7.10.2. Param[0]<a class="headerlink" href="#id244" title="Permalink to this headline">¶</a></h4>
<p>Display: 0=last frame, 1=black</p>
</div>
</div>
<div class="section" id="cx2341x-dec-halt-fw">
<h3>11.7.11. CX2341X_DEC_HALT_FW<a class="headerlink" href="#cx2341x-dec-halt-fw" title="Permalink to this headline">¶</a></h3>
<p>Enum: 14/0x0E</p>
<div class="section" id="id245">
<h4>11.7.11.1. Description<a class="headerlink" href="#id245" title="Permalink to this headline">¶</a></h4>
<p>The firmware is halted and no further API calls are serviced until
the firmware is uploaded again.</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-standard">
<h3>11.7.12. CX2341X_DEC_SET_STANDARD<a class="headerlink" href="#cx2341x-dec-set-standard" title="Permalink to this headline">¶</a></h3>
<p>Enum: 16/0x10</p>
<div class="section" id="id246">
<h4>11.7.12.1. Description<a class="headerlink" href="#id246" title="Permalink to this headline">¶</a></h4>
<p>Selects display standard</p>
</div>
<div class="section" id="id247">
<h4>11.7.12.2. Param[0]<a class="headerlink" href="#id247" title="Permalink to this headline">¶</a></h4>
<p>0=NTSC, 1=PAL</p>
</div>
</div>
<div class="section" id="cx2341x-dec-get-version">
<h3>11.7.13. CX2341X_DEC_GET_VERSION<a class="headerlink" href="#cx2341x-dec-get-version" title="Permalink to this headline">¶</a></h3>
<p>Enum: 17/0x11</p>
<div class="section" id="id248">
<h4>11.7.13.1. Description<a class="headerlink" href="#id248" title="Permalink to this headline">¶</a></h4>
<p>Returns decoder firmware version information</p>
</div>
<div class="section" id="id249">
<h4>11.7.13.2. Result[0]<a class="headerlink" href="#id249" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Version bitmask:</dt>
<dd><ul class="first last simple">
<li>Bits  0:15 build</li>
<li>Bits 16:23 minor</li>
<li>Bits 24:31 major</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="cx2341x-dec-set-stream-input">
<h3>11.7.14. CX2341X_DEC_SET_STREAM_INPUT<a class="headerlink" href="#cx2341x-dec-set-stream-input" title="Permalink to this headline">¶</a></h3>
<p>Enum: 20/0x14</p>
<div class="section" id="id250">
<h4>11.7.14.1. Description<a class="headerlink" href="#id250" title="Permalink to this headline">¶</a></h4>
<p>Select decoder stream input port</p>
</div>
<div class="section" id="id251">
<h4>11.7.14.2. Param[0]<a class="headerlink" href="#id251" title="Permalink to this headline">¶</a></h4>
<p>0=memory (default), 1=streaming</p>
</div>
</div>
<div class="section" id="cx2341x-dec-get-timing-info">
<h3>11.7.15. CX2341X_DEC_GET_TIMING_INFO<a class="headerlink" href="#cx2341x-dec-get-timing-info" title="Permalink to this headline">¶</a></h3>
<p>Enum: 21/0x15</p>
<div class="section" id="id252">
<h4>11.7.15.1. Description<a class="headerlink" href="#id252" title="Permalink to this headline">¶</a></h4>
<p>Returns timing information from start of playback</p>
</div>
<div class="section" id="id253">
<h4>11.7.15.2. Result[0]<a class="headerlink" href="#id253" title="Permalink to this headline">¶</a></h4>
<p>Frame count by decode order</p>
</div>
<div class="section" id="id254">
<h4>11.7.15.3. Result[1]<a class="headerlink" href="#id254" title="Permalink to this headline">¶</a></h4>
<p>Video PTS bits 0:31 by display order</p>
</div>
<div class="section" id="id255">
<h4>11.7.15.4. Result[2]<a class="headerlink" href="#id255" title="Permalink to this headline">¶</a></h4>
<p>Video PTS bit 32 by display order</p>
</div>
<div class="section" id="id256">
<h4>11.7.15.5. Result[3]<a class="headerlink" href="#id256" title="Permalink to this headline">¶</a></h4>
<p>SCR bits 0:31 by display order</p>
</div>
<div class="section" id="id257">
<h4>11.7.15.6. Result[4]<a class="headerlink" href="#id257" title="Permalink to this headline">¶</a></h4>
<p>SCR bit 32 by display order</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-audio-mode">
<h3>11.7.16. CX2341X_DEC_SET_AUDIO_MODE<a class="headerlink" href="#cx2341x-dec-set-audio-mode" title="Permalink to this headline">¶</a></h3>
<p>Enum: 22/0x16</p>
<div class="section" id="id258">
<h4>11.7.16.1. Description<a class="headerlink" href="#id258" title="Permalink to this headline">¶</a></h4>
<p>Select audio mode</p>
</div>
<div class="section" id="id259">
<h4>11.7.16.2. Param[0]<a class="headerlink" href="#id259" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Dual mono mode action</dt>
<dd>0=Stereo, 1=Left, 2=Right, 3=Mono, 4=Swap, -1=Unchanged</dd>
</dl>
</div>
<div class="section" id="id260">
<h4>11.7.16.3. Param[1]<a class="headerlink" href="#id260" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Stereo mode action:</dt>
<dd>0=Stereo, 1=Left, 2=Right, 3=Mono, 4=Swap, -1=Unchanged</dd>
</dl>
</div>
</div>
<div class="section" id="cx2341x-dec-set-event-notification">
<h3>11.7.17. CX2341X_DEC_SET_EVENT_NOTIFICATION<a class="headerlink" href="#cx2341x-dec-set-event-notification" title="Permalink to this headline">¶</a></h3>
<p>Enum: 23/0x17</p>
<div class="section" id="id261">
<h4>11.7.17.1. Description<a class="headerlink" href="#id261" title="Permalink to this headline">¶</a></h4>
<p>Setup firmware to notify the host about a particular event.
Counterpart to API 0xD5</p>
</div>
<div class="section" id="id262">
<h4>11.7.17.2. Param[0]<a class="headerlink" href="#id262" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Event:</dt>
<dd><ul class="first last simple">
<li>0=Audio mode change between mono, (joint) stereo and dual channel.</li>
<li>3=Decoder started</li>
<li>4=Unknown: goes off 10-15 times per second while decoding.</li>
<li>5=Some sync event: goes off once per frame.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id263">
<h4>11.7.17.3. Param[1]<a class="headerlink" href="#id263" title="Permalink to this headline">¶</a></h4>
<p>Notification 0=disabled, 1=enabled</p>
</div>
<div class="section" id="id264">
<h4>11.7.17.4. Param[2]<a class="headerlink" href="#id264" title="Permalink to this headline">¶</a></h4>
<p>Interrupt bit</p>
</div>
<div class="section" id="id265">
<h4>11.7.17.5. Param[3]<a class="headerlink" href="#id265" title="Permalink to this headline">¶</a></h4>
<p>Mailbox slot, -1 if no mailbox required.</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-display-buffers">
<h3>11.7.18. CX2341X_DEC_SET_DISPLAY_BUFFERS<a class="headerlink" href="#cx2341x-dec-set-display-buffers" title="Permalink to this headline">¶</a></h3>
<p>Enum: 24/0x18</p>
<div class="section" id="id266">
<h4>11.7.18.1. Description<a class="headerlink" href="#id266" title="Permalink to this headline">¶</a></h4>
<p>Number of display buffers. To decode all frames in reverse playback you
must use nine buffers.</p>
</div>
<div class="section" id="id267">
<h4>11.7.18.2. Param[0]<a class="headerlink" href="#id267" title="Permalink to this headline">¶</a></h4>
<p>0=six buffers, 1=nine buffers</p>
</div>
</div>
<div class="section" id="cx2341x-dec-extract-vbi">
<h3>11.7.19. CX2341X_DEC_EXTRACT_VBI<a class="headerlink" href="#cx2341x-dec-extract-vbi" title="Permalink to this headline">¶</a></h3>
<p>Enum: 25/0x19</p>
<div class="section" id="id268">
<h4>11.7.19.1. Description<a class="headerlink" href="#id268" title="Permalink to this headline">¶</a></h4>
<p>Extracts VBI data</p>
</div>
<div class="section" id="id269">
<h4>11.7.19.2. Param[0]<a class="headerlink" href="#id269" title="Permalink to this headline">¶</a></h4>
<p>0=extract from extension &amp; user data, 1=extract from private packets</p>
</div>
<div class="section" id="id270">
<h4>11.7.19.3. Result[0]<a class="headerlink" href="#id270" title="Permalink to this headline">¶</a></h4>
<p>VBI table location</p>
</div>
<div class="section" id="id271">
<h4>11.7.19.4. Result[1]<a class="headerlink" href="#id271" title="Permalink to this headline">¶</a></h4>
<p>VBI table size</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-decoder-source">
<h3>11.7.20. CX2341X_DEC_SET_DECODER_SOURCE<a class="headerlink" href="#cx2341x-dec-set-decoder-source" title="Permalink to this headline">¶</a></h3>
<p>Enum: 26/0x1A</p>
<div class="section" id="id272">
<h4>11.7.20.1. Description<a class="headerlink" href="#id272" title="Permalink to this headline">¶</a></h4>
<p>Selects decoder source. Ensure that the parameters passed to this
API match the encoder settings.</p>
</div>
<div class="section" id="id273">
<h4>11.7.20.2. Param[0]<a class="headerlink" href="#id273" title="Permalink to this headline">¶</a></h4>
<p>Mode: 0=MPEG from host, 1=YUV from encoder, 2=YUV from host</p>
</div>
<div class="section" id="id274">
<h4>11.7.20.3. Param[1]<a class="headerlink" href="#id274" title="Permalink to this headline">¶</a></h4>
<p>YUV picture width</p>
</div>
<div class="section" id="id275">
<h4>11.7.20.4. Param[2]<a class="headerlink" href="#id275" title="Permalink to this headline">¶</a></h4>
<p>YUV picture height</p>
</div>
<div class="section" id="id276">
<h4>11.7.20.5. Param[3]<a class="headerlink" href="#id276" title="Permalink to this headline">¶</a></h4>
<p>Bitmap: see Param[0] of API 0xBD</p>
</div>
</div>
<div class="section" id="cx2341x-dec-set-prebuffering">
<h3>11.7.21. CX2341X_DEC_SET_PREBUFFERING<a class="headerlink" href="#cx2341x-dec-set-prebuffering" title="Permalink to this headline">¶</a></h3>
<p>Enum: 30/0x1E</p>
<div class="section" id="id277">
<h4>11.7.21.1. Description<a class="headerlink" href="#id277" title="Permalink to this headline">¶</a></h4>
<p>Decoder prebuffering, when enabled up to 128KB are buffered for
streams &lt;8mpbs or 640KB for streams &gt;8mbps</p>
</div>
<div class="section" id="id278">
<h4>11.7.21.2. Param[0]<a class="headerlink" href="#id278" title="Permalink to this headline">¶</a></h4>
<p>0=off, 1=on</p>
</div>
</div>
</div>
<div class="section" id="pvr350-video-decoder-registers-0x02002800-0x02002b00">
<h2>11.8. PVR350 Video decoder registers 0x02002800 -&gt; 0x02002B00<a class="headerlink" href="#pvr350-video-decoder-registers-0x02002800-0x02002b00" title="Permalink to this headline">¶</a></h2>
<p>Author: Ian Armstrong &lt;<a class="reference external" href="mailto:ian&#37;&#52;&#48;iarmst&#46;demon&#46;co&#46;uk">ian<span>&#64;</span>iarmst<span>&#46;</span>demon<span>&#46;</span>co<span>&#46;</span>uk</a>&gt;</p>
<p>Version: v0.4</p>
<p>Date: 12 March 2007</p>
<p>This list has been worked out through trial and error. There will be mistakes
and omissions. Some registers have no obvious effect so it&#8217;s hard to say what
they do, while others interact with each other, or require a certain load
sequence. Horizontal filter setup is one example, with six registers working
in unison and requiring a certain load sequence to correctly configure. The
indexed colour palette is much easier to set at just two registers, but again
it requires a certain load sequence.</p>
<p>Some registers are fussy about what they are set to. Load in a bad value &amp; the
decoder will fail. A firmware reload will often recover, but sometimes a reset
is required. For registers containing size information, setting them to 0 is
generally a bad idea. For other control registers i.e. 2878, you&#8217;ll only find
out what values are bad when it hangs.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>--------------------------------------------------------------------------------
2800
bit 0
        Decoder enable
        0 = disable
        1 = enable
--------------------------------------------------------------------------------
2804
bits 0:31
        Decoder horizontal Y alias register 1
---------------
2808
bits 0:31
        Decoder horizontal Y alias register 2
---------------
280C
bits 0:31
        Decoder horizontal Y alias register 3
---------------
2810
bits 0:31
        Decoder horizontal Y alias register 4
---------------
2814
bits 0:31
        Decoder horizontal Y alias register 5
---------------
2818
bits 0:31
        Decoder horizontal Y alias trigger

These six registers control the horizontal aliasing filter for the Y plane.
The first five registers must all be loaded before accessing the trigger
(2818), as this register actually clocks the data through for the first
five.

To correctly program set the filter, this whole procedure must be done 16
times. The actual register contents are copied from a lookup-table in the
firmware which contains 4 different filter settings.

--------------------------------------------------------------------------------
281C
bits 0:31
        Decoder horizontal UV alias register 1
---------------
2820
bits 0:31
        Decoder horizontal UV alias register 2
---------------
2824
bits 0:31
        Decoder horizontal UV alias register 3
---------------
2828
bits 0:31
        Decoder horizontal UV alias register 4
---------------
282C
bits 0:31
        Decoder horizontal UV alias register 5
---------------
2830
bits 0:31
        Decoder horizontal UV alias trigger

These six registers control the horizontal aliasing for the UV plane.
Operation is the same as the Y filter, with 2830 being the trigger
register.

--------------------------------------------------------------------------------
2834
bits 0:15
        Decoder Y source width in pixels

bits 16:31
        Decoder Y destination width in pixels
---------------
2838
bits 0:15
        Decoder UV source width in pixels

bits 16:31
        Decoder UV destination width in pixels

NOTE: For both registers, the resulting image must be fully visible on
screen. If the image exceeds the right edge both the source and destination
size must be adjusted to reflect the visible portion. For the source width,
you must take into account the scaling when calculating the new value.
--------------------------------------------------------------------------------

283C
bits 0:31
        Decoder Y horizontal scaling
                Normally = Reg 2854 &gt;&gt; 2
---------------
2840
bits 0:31
        Decoder ?? unknown - horizontal scaling
        Usually 0x00080514
---------------
2844
bits 0:31
        Decoder UV horizontal scaling
        Normally = Reg 2854 &gt;&gt; 2
---------------
2848
bits 0:31
        Decoder ?? unknown - horizontal scaling
        Usually 0x00100514
---------------
284C
bits 0:31
        Decoder ?? unknown - Y plane
        Usually 0x00200020
---------------
2850
bits 0:31
        Decoder ?? unknown - UV plane
        Usually 0x00200020
---------------
2854
bits 0:31
        Decoder &#39;master&#39; value for horizontal scaling
---------------
2858
bits 0:31
        Decoder ?? unknown
        Usually 0
---------------
285C
bits 0:31
        Decoder ?? unknown
        Normally = Reg 2854 &gt;&gt; 1
---------------
2860
bits 0:31
        Decoder ?? unknown
        Usually 0
---------------
2864
bits 0:31
        Decoder ?? unknown
        Normally = Reg 2854 &gt;&gt; 1
---------------
2868
bits 0:31
        Decoder ?? unknown
        Usually 0

Most of these registers either control horizontal scaling, or appear linked
to it in some way. Register 2854 contains the &#39;master&#39; value &amp; the other
registers can be calculated from that one. You must also remember to
correctly set the divider in Reg 2874.

To enlarge:
        Reg 2854 = (source_width * 0x00200000) / destination_width
        Reg 2874 = No divide

To reduce from full size down to half size:
        Reg 2854 = (source_width/2 * 0x00200000) / destination width
        Reg 2874 = Divide by 2

To reduce from half size down to quarter size:
        Reg 2854 = (source_width/4 * 0x00200000) / destination width
        Reg 2874 = Divide by 4

The result is always rounded up.

--------------------------------------------------------------------------------
286C
bits 0:15
        Decoder horizontal Y buffer offset

bits 15:31
        Decoder horizontal UV buffer offset

Offset into the video image buffer. If the offset is gradually incremented,
the on screen image will move left &amp; wrap around higher up on the right.

--------------------------------------------------------------------------------
2870
bits 0:15
        Decoder horizontal Y output offset

bits 16:31
        Decoder horizontal UV output offset

Offsets the actual video output. Controls output alignment of the Y &amp; UV
planes. The higher the value, the greater the shift to the left. Use
reg 2890 to move the image right.

--------------------------------------------------------------------------------
2874
bits 0:1
        Decoder horizontal Y output size divider
        00 = No divide
        01 = Divide by 2
        10 = Divide by 3

bits 4:5
        Decoder horizontal UV output size divider
        00 = No divide
        01 = Divide by 2
        10 = Divide by 3

bit 8
        Decoder ?? unknown
        0 = Normal
        1 = Affects video output levels

bit 16
        Decoder ?? unknown
        0 = Normal
        1 = Disable horizontal filter

--------------------------------------------------------------------------------
2878
bit 0
        ?? unknown

bit 1
        osd on/off
        0 = osd off
        1 = osd on

bit 2
        Decoder + osd video timing
        0 = NTSC
        1 = PAL

bits 3:4
        ?? unknown

bit 5
        Decoder + osd
        Swaps upper &amp; lower fields

--------------------------------------------------------------------------------
287C
bits 0:10
        Decoder &amp; osd ?? unknown
        Moves entire screen horizontally. Starts at 0x005 with the screen
        shifted heavily to the right. Incrementing in steps of 0x004 will
        gradually shift the screen to the left.

bits 11:31
        ?? unknown

Normally contents are 0x00101111 (NTSC) or 0x1010111d (PAL)

--------------------------------------------------------------------------------
2880  --------    ?? unknown
2884  --------    ?? unknown
--------------------------------------------------------------------------------
2888
bit 0
        Decoder + osd ?? unknown
        0 = Normal
        1 = Misaligned fields (Correctable through 289C &amp; 28A4)

bit 4
        ?? unknown

bit 8
        ?? unknown

Warning: Bad values will require a firmware reload to recover.
                Known to be bad are 0x000,0x011,0x100,0x111
--------------------------------------------------------------------------------
288C
bits 0:15
        osd ?? unknown
        Appears to affect the osd position stability. The higher the value the
        more unstable it becomes. Decoder output remains stable.

bits 16:31
        osd ?? unknown
        Same as bits 0:15

--------------------------------------------------------------------------------
2890
bits 0:11
        Decoder output horizontal offset.

Horizontal offset moves the video image right. A small left shift is
possible, but it&#39;s better to use reg 2870 for that due to its greater
range.

NOTE: Video corruption will occur if video window is shifted off the right
edge. To avoid this read the notes for 2834 &amp; 2838.
--------------------------------------------------------------------------------
2894
bits 0:23
        Decoder output video surround colour.

Contains the colour (in yuv) used to fill the screen when the video is
running in a window.
--------------------------------------------------------------------------------
2898
bits 0:23
        Decoder video window colour
        Contains the colour (in yuv) used to fill the video window when the
        video is turned off.

bit 24
        Decoder video output
        0 = Video on
        1 = Video off

bit 28
        Decoder plane order
        0 = Y,UV
        1 = UV,Y

bit 29
        Decoder second plane byte order
        0 = Normal (UV)
        1 = Swapped (VU)

In normal usage, the first plane is Y &amp; the second plane is UV. Though the
order of the planes can be swapped, only the byte order of the second plane
can be swapped. This isn&#39;t much use for the Y plane, but can be useful for
the UV plane.

--------------------------------------------------------------------------------
289C
bits 0:15
        Decoder vertical field offset 1

bits 16:31
        Decoder vertical field offset 2

Controls field output vertical alignment. The higher the number, the lower
the image on screen. Known starting values are 0x011E0017 (NTSC) &amp;
0x01500017 (PAL)
--------------------------------------------------------------------------------
28A0
bits 0:15
        Decoder &amp; osd width in pixels

bits 16:31
        Decoder &amp; osd height in pixels

All output from the decoder &amp; osd are disabled beyond this area. Decoder
output will simply go black outside of this region. If the osd tries to
exceed this area it will become corrupt.
--------------------------------------------------------------------------------
28A4
bits 0:11
        osd left shift.

Has a range of 0x770-&gt;0x7FF. With the exception of 0, any value outside of
this range corrupts the osd.
--------------------------------------------------------------------------------
28A8
bits 0:15
        osd vertical field offset 1

bits 16:31
        osd vertical field offset 2

Controls field output vertical alignment. The higher the number, the lower
the image on screen. Known starting values are 0x011E0017 (NTSC) &amp;
0x01500017 (PAL)
--------------------------------------------------------------------------------
28AC  --------    ?? unknown
|
V
28BC  --------    ?? unknown
--------------------------------------------------------------------------------
28C0
bit 0
        Current output field
        0 = first field
        1 = second field

bits 16:31
        Current scanline
        The scanline counts from the top line of the first field
        through to the last line of the second field.
--------------------------------------------------------------------------------
28C4  --------    ?? unknown
|
V
28F8  --------    ?? unknown
--------------------------------------------------------------------------------
28FC
bit 0
        ?? unknown
        0 = Normal
        1 = Breaks decoder &amp; osd output
--------------------------------------------------------------------------------
2900
bits 0:31
        Decoder vertical Y alias register 1
---------------
2904
bits 0:31
        Decoder vertical Y alias register 2
---------------
2908
bits 0:31
        Decoder vertical Y alias trigger

These three registers control the vertical aliasing filter for the Y plane.
Operation is similar to the horizontal Y filter (2804). The only real
difference is that there are only two registers to set before accessing
the trigger register (2908). As for the horizontal filter, the values are
taken from a lookup table in the firmware, and the procedure must be
repeated 16 times to fully program the filter.
--------------------------------------------------------------------------------
290C
bits 0:31
        Decoder vertical UV alias register 1
---------------
2910
bits 0:31
        Decoder vertical UV alias register 2
---------------
2914
bits 0:31
        Decoder vertical UV alias trigger

These three registers control the vertical aliasing filter for the UV
plane. Operation is the same as the Y filter, with 2914 being the trigger.
--------------------------------------------------------------------------------
2918
bits 0:15
        Decoder Y source height in pixels

bits 16:31
        Decoder Y destination height in pixels
---------------
291C
bits 0:15
        Decoder UV source height in pixels divided by 2

bits 16:31
        Decoder UV destination height in pixels

NOTE: For both registers, the resulting image must be fully visible on
screen. If the image exceeds the bottom edge both the source and
destination size must be adjusted to reflect the visible portion. For the
source height, you must take into account the scaling when calculating the
new value.
--------------------------------------------------------------------------------
2920
bits 0:31
        Decoder Y vertical scaling
        Normally = Reg 2930 &gt;&gt; 2
---------------
2924
bits 0:31
        Decoder Y vertical scaling
        Normally = Reg 2920 + 0x514
---------------
2928
bits 0:31
        Decoder UV vertical scaling
        When enlarging = Reg 2930 &gt;&gt; 2
        When reducing = Reg 2930 &gt;&gt; 3
---------------
292C
bits 0:31
        Decoder UV vertical scaling
        Normally = Reg 2928 + 0x514
---------------
2930
bits 0:31
        Decoder &#39;master&#39; value for vertical scaling
---------------
2934
bits 0:31
        Decoder ?? unknown - Y vertical scaling
---------------
2938
bits 0:31
        Decoder Y vertical scaling
        Normally = Reg 2930
---------------
293C
bits 0:31
        Decoder ?? unknown - Y vertical scaling
---------------
2940
bits 0:31
        Decoder UV vertical scaling
        When enlarging = Reg 2930 &gt;&gt; 1
        When reducing = Reg 2930
---------------
2944
bits 0:31
        Decoder ?? unknown - UV vertical scaling
---------------
2948
bits 0:31
        Decoder UV vertical scaling
        Normally = Reg 2940
---------------
294C
bits 0:31
        Decoder ?? unknown - UV vertical scaling

Most of these registers either control vertical scaling, or appear linked
to it in some way. Register 2930 contains the &#39;master&#39; value &amp; all other
registers can be calculated from that one. You must also remember to
correctly set the divider in Reg 296C

To enlarge:
        Reg 2930 = (source_height * 0x00200000) / destination_height
        Reg 296C = No divide

To reduce from full size down to half size:
        Reg 2930 = (source_height/2 * 0x00200000) / destination height
        Reg 296C = Divide by 2

To reduce from half down to quarter.
        Reg 2930 = (source_height/4 * 0x00200000) / destination height
        Reg 296C = Divide by 4

--------------------------------------------------------------------------------
2950
bits 0:15
        Decoder Y line index into display buffer, first field

bits 16:31
        Decoder Y vertical line skip, first field
--------------------------------------------------------------------------------
2954
bits 0:15
        Decoder Y line index into display buffer, second field

bits 16:31
        Decoder Y vertical line skip, second field
--------------------------------------------------------------------------------
2958
bits 0:15
        Decoder UV line index into display buffer, first field

bits 16:31
        Decoder UV vertical line skip, first field
--------------------------------------------------------------------------------
295C
bits 0:15
        Decoder UV line index into display buffer, second field

bits 16:31
        Decoder UV vertical line skip, second field
--------------------------------------------------------------------------------
2960
bits 0:15
        Decoder destination height minus 1

bits 16:31
        Decoder destination height divided by 2
--------------------------------------------------------------------------------
2964
bits 0:15
        Decoder Y vertical offset, second field

bits 16:31
        Decoder Y vertical offset, first field

These two registers shift the Y plane up. The higher the number, the
greater the shift.
--------------------------------------------------------------------------------
2968
bits 0:15
        Decoder UV vertical offset, second field

bits 16:31
        Decoder UV vertical offset, first field

These two registers shift the UV plane up. The higher the number, the
greater the shift.
--------------------------------------------------------------------------------
296C
bits 0:1
        Decoder vertical Y output size divider
        00 = No divide
        01 = Divide by 2
        10 = Divide by 4

bits 8:9
        Decoder vertical UV output size divider
        00 = No divide
        01 = Divide by 2
        10 = Divide by 4
--------------------------------------------------------------------------------
2970
bit 0
        Decoder ?? unknown
        0 = Normal
        1 = Affect video output levels

bit 16
        Decoder ?? unknown
        0 = Normal
        1 = Disable vertical filter

--------------------------------------------------------------------------------
2974  --------   ?? unknown
|
V
29EF  --------   ?? unknown
--------------------------------------------------------------------------------
2A00
bits 0:2
        osd colour mode
        000 = 8 bit indexed
        001 = 16 bit (565)
        010 = 15 bit (555)
        011 = 12 bit (444)
        100 = 32 bit (8888)

bits 4:5
        osd display bpp
        01 = 8 bit
        10 = 16 bit
        11 = 32 bit

bit 8
        osd global alpha
        0 = Off
        1 = On

bit 9
        osd local alpha
        0 = Off
        1 = On

bit 10
        osd colour key
        0 = Off
        1 = On

bit 11
        osd ?? unknown
        Must be 1

bit 13
        osd colour space
        0 = ARGB
        1 = AYVU

bits 16:31
        osd ?? unknown
        Must be 0x001B (some kind of buffer pointer ?)

When the bits-per-pixel is set to 8, the colour mode is ignored and
assumed to be 8 bit indexed. For 16 &amp; 32 bits-per-pixel the colour depth
is honoured, and when using a colour depth that requires fewer bytes than
allocated the extra bytes are used as padding. So for a 32 bpp with 8 bit
index colour, there are 3 padding bytes per pixel. It&#39;s also possible to
select 16bpp with a 32 bit colour mode. This results in the pixel width
being doubled, but the color key will not work as expected in this mode.

Colour key is as it suggests. You designate a colour which will become
completely transparent. When using 565, 555 or 444 colour modes, the
colour key is always 16 bits wide. The colour to key on is set in Reg 2A18.

Local alpha works differently depending on the colour mode. For 32bpp &amp; 8
bit indexed, local alpha is a per-pixel 256 step transparency, with 0 being
transparent and 255 being solid. For the 16bpp modes 555 &amp; 444, the unused
bit(s) act as a simple transparency switch, with 0 being solid &amp; 1 being
fully transparent. There is no local alpha support for 16bit 565.

Global alpha is a 256 step transparency that applies to the entire osd,
with 0 being transparent &amp; 255 being solid.

It&#39;s possible to combine colour key, local alpha &amp; global alpha.
--------------------------------------------------------------------------------
2A04
bits 0:15
        osd x coord for left edge

bits 16:31
        osd y coord for top edge
---------------
2A08
bits 0:15
        osd x coord for right edge

bits 16:31
        osd y coord for bottom edge

For both registers, (0,0) = top left corner of the display area. These
registers do not control the osd size, only where it&#39;s positioned &amp; how
much is visible. The visible osd area cannot exceed the right edge of the
display, otherwise the osd will become corrupt. See reg 2A10 for
setting osd width.
--------------------------------------------------------------------------------
2A0C
bits 0:31
        osd buffer index

An index into the osd buffer. Slowly incrementing this moves the osd left,
wrapping around onto the right edge
--------------------------------------------------------------------------------
2A10
bits 0:11
        osd buffer 32 bit word width

Contains the width of the osd measured in 32 bit words. This means that all
colour modes are restricted to a byte width which is divisible by 4.
--------------------------------------------------------------------------------
2A14
bits 0:15
        osd height in pixels

bits 16:32
        osd line index into buffer
        osd will start displaying from this line.
--------------------------------------------------------------------------------
2A18
bits 0:31
        osd colour key

Contains the colour value which will be transparent.
--------------------------------------------------------------------------------
2A1C
bits 0:7
        osd global alpha

Contains the global alpha value (equiv ivtvfbctl --alpha XX)
--------------------------------------------------------------------------------
2A20  --------    ?? unknown
|
V
2A2C  --------    ?? unknown
--------------------------------------------------------------------------------
2A30
bits 0:7
        osd colour to change in indexed palette
---------------
2A34
bits 0:31
        osd colour for indexed palette

To set the new palette, first load the index of the colour to change into
2A30, then load the new colour into 2A34. The full palette is 256 colours,
so the index range is 0x00-0xFF
--------------------------------------------------------------------------------
2A38  --------    ?? unknown
2A3C  --------    ?? unknown
--------------------------------------------------------------------------------
2A40
bits 0:31
        osd ?? unknown

Affects overall brightness, wrapping around to black
--------------------------------------------------------------------------------
2A44
bits 0:31
        osd ?? unknown

Green tint
--------------------------------------------------------------------------------
2A48
bits 0:31
        osd ?? unknown

Red tint
--------------------------------------------------------------------------------
2A4C
bits 0:31
        osd ?? unknown

Affects overall brightness, wrapping around to black
--------------------------------------------------------------------------------
2A50
bits 0:31
        osd ?? unknown

Colour shift
--------------------------------------------------------------------------------
2A54
bits 0:31
        osd ?? unknown

Colour shift
--------------------------------------------------------------------------------
2A58  --------    ?? unknown
|
V
2AFC  --------    ?? unknown
--------------------------------------------------------------------------------
2B00
bit 0
        osd filter control
        0 = filter off
        1 = filter on

bits 1:4
        osd ?? unknown

--------------------------------------------------------------------------------
</pre></div>
</div>
</div>
<div class="section" id="the-cx231xx-dma-engine">
<h2>11.9. The cx231xx DMA engine<a class="headerlink" href="#the-cx231xx-dma-engine" title="Permalink to this headline">¶</a></h2>
<p>This page describes the structures and procedures used by the cx2341x DMA
engine.</p>
<div class="section" id="introduction">
<h3>11.9.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>The cx2341x PCI interface is busmaster capable. This means it has a DMA
engine to efficiently transfer large volumes of data between the card and main
memory without requiring help from a CPU. Like most hardware, it must operate
on contiguous physical memory. This is difficult to come by in large quantities
on virtual memory machines.</p>
<p>Therefore, it also supports a technique called &#8220;scatter-gather&#8221;. The card can
transfer multiple buffers in one operation. Instead of allocating one large
contiguous buffer, the driver can allocate several smaller buffers.</p>
<p>In practice, I&#8217;ve seen the average transfer to be roughly 80K, but transfers
above 128K were not uncommon, particularly at startup. The 128K figure is
important, because that is the largest block that the kernel can normally
allocate. Even still, 128K blocks are hard to come by, so the driver writer is
urged to choose a smaller block size and learn the scatter-gather technique.</p>
<p>Mailbox #10 is reserved for DMA transfer information.</p>
<p>Note: the hardware expects little-endian data (&#8216;intel format&#8217;).</p>
</div>
<div class="section" id="flow">
<h3>11.9.2. Flow<a class="headerlink" href="#flow" title="Permalink to this headline">¶</a></h3>
<p>This section describes, in general, the order of events when handling DMA
transfers. Detailed information follows this section.</p>
<ul class="simple">
<li>The card raises the Encoder interrupt.</li>
<li>The driver reads the transfer type, offset and size from Mailbox #10.</li>
<li>The driver constructs the scatter-gather array from enough free dma buffers
to cover the size.</li>
<li>The driver schedules the DMA transfer via the ScheduleDMAtoHost API call.</li>
<li>The card raises the DMA Complete interrupt.</li>
<li>The driver checks the DMA status register for any errors.</li>
<li>The driver post-processes the newly transferred buffers.</li>
</ul>
<p>NOTE! It is possible that the Encoder and DMA Complete interrupts get raised
simultaneously. (End of the last, start of the next, etc.)</p>
</div>
<div class="section" id="mailbox-10">
<h3>11.9.3. Mailbox #10<a class="headerlink" href="#mailbox-10" title="Permalink to this headline">¶</a></h3>
<p>The Flags, Command, Return Value and Timeout fields are ignored.</p>
<ul class="simple">
<li>Name:       Mailbox #10</li>
<li>Results[0]: Type: 0: MPEG.</li>
<li>Results[1]: Offset: The position relative to the card&#8217;s memory space.</li>
<li>Results[2]: Size: The exact number of bytes to transfer.</li>
</ul>
<p>My speculation is that since the StartCapture API has a capture type of &#8220;RAW&#8221;
available, that the type field will have other values that correspond to YUV
and PCM data.</p>
</div>
<div class="section" id="scatter-gather-array">
<h3>11.9.4. Scatter-Gather Array<a class="headerlink" href="#scatter-gather-array" title="Permalink to this headline">¶</a></h3>
<p>The scatter-gather array is a contiguously allocated block of memory that
tells the card the source and destination of each data-block to transfer.
Card &#8220;addresses&#8221; are derived from the offset supplied by Mailbox #10. Host
addresses are the physical memory location of the target DMA buffer.</p>
<p>Each S-G array element is a struct of three 32-bit words. The first word is
the source address, the second is the destination address. Both take up the
entire 32 bits. The lowest 18 bits of the third word is the transfer byte
count. The high-bit of the third word is the &#8220;last&#8221; flag. The last-flag tells
the card to raise the DMA_DONE interrupt. From hard personal experience, if
you forget to set this bit, the card will still &#8220;work&#8221; but the stream will
most likely get corrupted.</p>
<p>The transfer count must be a multiple of 256. Therefore, the driver will need
to track how much data in the target buffer is valid and deal with it
accordingly.</p>
<p>Array Element:</p>
<ul class="simple">
<li>32-bit Source Address</li>
<li>32-bit Destination Address</li>
<li>14-bit reserved (high bit is the last flag)</li>
<li>18-bit byte count</li>
</ul>
</div>
<div class="section" id="dma-transfer-status">
<h3>11.9.5. DMA Transfer Status<a class="headerlink" href="#dma-transfer-status" title="Permalink to this headline">¶</a></h3>
<p>Register 0x0004 holds the DMA Transfer Status:</p>
<ul class="simple">
<li>bit 0:   read completed</li>
<li>bit 1:   write completed</li>
<li>bit 2:   DMA read error</li>
<li>bit 3:   DMA write error</li>
<li>bit 4:   Scatter-Gather array error</li>
</ul>
</div>
</div>
<div class="section" id="non-compressed-file-format">
<h2>11.10. Non-compressed file format<a class="headerlink" href="#non-compressed-file-format" title="Permalink to this headline">¶</a></h2>
<p>The cx23416 can produce (and the cx23415 can also read) raw YUV output. The
format of a YUV frame is specific to this chip and is called HM12. &#8216;HM&#8217; stands
for &#8216;Hauppauge Macroblock&#8217;, which is a misnomer as &#8216;Conexant Macroblock&#8217; would
be more accurate.</p>
<p>The format is YUV 4:2:0 which uses 1 Y byte per pixel and 1 U and V byte per
four pixels.</p>
<p>The data is encoded as two macroblock planes, the first containing the Y
values, the second containing UV macroblocks.</p>
<p>The Y plane is divided into blocks of 16x16 pixels from left to right
and from top to bottom. Each block is transmitted in turn, line-by-line.</p>
<p>So the first 16 bytes are the first line of the top-left block, the
second 16 bytes are the second line of the top-left block, etc. After
transmitting this block the first line of the block on the right to the
first block is transmitted, etc.</p>
<p>The UV plane is divided into blocks of 16x8 UV values going from left
to right, top to bottom. Each block is transmitted in turn, line-by-line.</p>
<p>So the first 16 bytes are the first line of the top-left block and
contain 8 UV value pairs (16 bytes in total). The second 16 bytes are the
second line of 8 UV pairs of the top-left block, etc. After transmitting
this block the first line of the block on the right to the first block is
transmitted, etc.</p>
<p>The code below is given as an example on how to convert HM12 to separate
Y, U and V planes. This code assumes frames of 720x576 (PAL) pixels.</p>
<p>The width of a frame is always 720 pixels, regardless of the actual specified
width.</p>
<p>If the height is not a multiple of 32 lines, then the captured video is
missing macroblocks at the end and is unusable. So the height must be a
multiple of 32.</p>
<div class="section" id="raw-format-c-example">
<h3>11.10.1. Raw format c example<a class="headerlink" href="#raw-format-c-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">frame</span><span class="p">[</span><span class="mi">576</span><span class="o">*</span><span class="mi">720</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">];</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">framey</span><span class="p">[</span><span class="mi">576</span><span class="o">*</span><span class="mi">720</span><span class="p">];</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">frameu</span><span class="p">[</span><span class="mi">576</span><span class="o">*</span><span class="mi">720</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">framev</span><span class="p">[</span><span class="mi">576</span><span class="o">*</span><span class="mi">720</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">de_macro_y</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstride</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

<span class="c1">// descramble Y plane</span>
<span class="c1">// dstride = 720 = w</span>
<span class="c1">// The Y plane is divided into blocks of 16x16 pixels</span>
<span class="c1">// Each block in transmitted in turn, line-by-line.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">y</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">memcpy</span><span class="p">(</span><span class="n">dst</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">dstride</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
                <span class="n">src</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">de_macro_uv</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dstu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dstv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstride</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

<span class="c1">// descramble U/V plane</span>
<span class="c1">// dstride = 720 / 2 = w</span>
<span class="c1">// The U/V values are interlaced (UVUV...).</span>
<span class="c1">// Again, the UV plane is divided into blocks of 16x16 UV values.</span>
<span class="c1">// Each block in transmitted in turn, line-by-line.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">y</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">dstride</span><span class="p">;</span>

                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>  <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>  <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>  <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>  <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span> <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
                <span class="n">dstu</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span> <span class="n">dstv</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
                <span class="n">src</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*************************************************************************/</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">FILE</span> <span class="o">*</span><span class="n">fin</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">fin</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">;</span>
<span class="k">else</span> <span class="n">fin</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">fin</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;cannot open input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">while</span> <span class="p">(</span><span class="n">fread</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">frame</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">de_macro_y</span><span class="p">(</span><span class="n">framey</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">);</span>
        <span class="n">de_macro_uv</span><span class="p">(</span><span class="n">frameu</span><span class="p">,</span> <span class="n">framev</span><span class="p">,</span> <span class="n">frame</span> <span class="o">+</span> <span class="mi">720</span> <span class="o">*</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">720</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">720</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">576</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">framey</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">framey</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">framev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">framev</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">frameu</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">frameu</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">fin</span><span class="p">);</span>
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="format-of-embedded-v4l2-mpeg-stream-vbi-fmt-ivtv-vbi-data">
<h2>11.11. Format of embedded V4L2_MPEG_STREAM_VBI_FMT_IVTV VBI data<a class="headerlink" href="#format-of-embedded-v4l2-mpeg-stream-vbi-fmt-ivtv-vbi-data" title="Permalink to this headline">¶</a></h2>
<p>Author: Hans Verkuil &lt;<a class="reference external" href="mailto:hverkuil&#37;&#52;&#48;xs4all&#46;nl">hverkuil<span>&#64;</span>xs4all<span>&#46;</span>nl</a>&gt;</p>
<p>This section describes the V4L2_MPEG_STREAM_VBI_FMT_IVTV format of the VBI data
embedded in an MPEG-2 program stream. This format is in part dictated by some
hardware limitations of the ivtv driver (the driver for the Conexant cx23415/6
chips), in particular a maximum size for the VBI data. Anything longer is cut
off when the MPEG stream is played back through the cx23415.</p>
<p>The advantage of this format is it is very compact and that all VBI data for
all lines can be stored while still fitting within the maximum allowed size.</p>
<p>The stream ID of the VBI data is 0xBD. The maximum size of the embedded data is
4 + 43 * 36, which is 4 bytes for a header and 2 * 18 VBI lines with a 1 byte
header and a 42 bytes payload each. Anything beyond this limit is cut off by
the cx23415/6 firmware. Besides the data for the VBI lines we also need 36 bits
for a bitmask determining which lines are captured and 4 bytes for a magic cookie,
signifying that this data package contains V4L2_MPEG_STREAM_VBI_FMT_IVTV VBI data.
If all lines are used, then there is no longer room for the bitmask. To solve this
two different magic numbers were introduced:</p>
<p>&#8216;itv0&#8217;: After this magic number two unsigned longs follow. Bits 0-17 of the first
unsigned long denote which lines of the first field are captured. Bits 18-31 of
the first unsigned long and bits 0-3 of the second unsigned long are used for the
second field.</p>
<p>&#8216;ITV0&#8217;: This magic number assumes all VBI lines are captured, i.e. it implicitly
implies that the bitmasks are 0xffffffff and 0xf.</p>
<p>After these magic cookies (and the 8 byte bitmask in case of cookie &#8216;itv0&#8217;) the
captured VBI lines start:</p>
<p>For each line the least significant 4 bits of the first byte contain the data type.
Possible values are shown in the table below. The payload is in the following 42
bytes.</p>
<p>Here is the list of possible data types:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define IVTV_SLICED_TYPE_TELETEXT       0x1     </span><span class="c1">// Teletext (uses lines 6-22 for PAL)</span>
<span class="cp">#define IVTV_SLICED_TYPE_CC             0x4     </span><span class="c1">// Closed Captions (line 21 NTSC)</span>
<span class="cp">#define IVTV_SLICED_TYPE_WSS            0x5     </span><span class="c1">// Wide Screen Signal (line 23 PAL)</span>
<span class="cp">#define IVTV_SLICED_TYPE_VPS            0x7     </span><span class="c1">// Video Programming System (PAL) (line 16)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cx88.html" class="btn btn-neutral float-right" title="12. The cx88 driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cx18.html" class="btn btn-neutral" title="10. The cx18 driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'4.13.0-rc5+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>