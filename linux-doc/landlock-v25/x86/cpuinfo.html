

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. x86 Feature Flags &mdash; The Linux Kernel 5.10.0-rc6+ documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. x86 Topology" href="topology.html" />
    <link rel="prev" title="2. DeviceTree Booting" href="booting-dt.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.10.0-rc6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">x86-specific Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="boot.html">1. The Linux/x86 Boot Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="booting-dt.html">2. DeviceTree Booting</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3. x86 Feature Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">3.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-are-feature-flags-created">3.2. How are feature flags created?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-feature-flags-can-be-derived-from-the-contents-of-cpuid-leaves">3.2.1. a: Feature flags can be derived from the contents of CPUID leaves.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#b-flags-can-be-from-scattered-cpuid-based-features">3.2.2. b: Flags can be from scattered CPUID-based features.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-flags-can-be-created-synthetically-under-certain-conditions-for-hardware-features">3.2.3. c: Flags can be created synthetically under certain conditions for hardware features.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d-flags-can-represent-purely-software-features">3.2.4. d: Flags can represent purely software features.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#naming-of-flags">3.3. Naming of Flags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-the-name-of-the-flag-is-from-the-string-in-x86-feature-name-by-default">3.3.1. a: The name of the flag is from the string in X86_FEATURE_&lt;name&gt; by default.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#b-the-naming-can-be-overridden">3.3.2. b: The naming can be overridden.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-the-naming-override-can-be-which-means-it-will-not-appear-in-proc-cpuinfo">3.3.3. c: The naming override can be “”, which means it will not appear in /proc/cpuinfo.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flags-are-missing-when-one-or-more-of-these-happen">3.4. Flags are missing when one or more of these happen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-the-hardware-does-not-enumerate-support-for-it">3.4.1. a: The hardware does not enumerate support for it.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#b-the-kernel-does-not-know-about-the-flag">3.4.2. b: The kernel does not know about the flag.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c-the-kernel-disabled-support-for-it-at-compile-time">3.4.3. c: The kernel disabled support for it at compile-time.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d-the-feature-is-disabled-at-boot-time">3.4.4. d: The feature is disabled at boot-time.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#e-the-feature-was-known-to-be-non-functional">3.4.5. e: The feature was known to be non-functional.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="topology.html">4. x86 Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="exception-tables.html">5. Kernel level exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-stacks.html">6. Kernel Stacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="entry_64.html">7. Kernel Entries</a></li>
<li class="toctree-l2"><a class="reference internal" href="earlyprintk.html">8. Early Printk</a></li>
<li class="toctree-l2"><a class="reference internal" href="orc-unwinder.html">9. ORC unwinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="zero-page.html">10. Zero Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="tlb.html">11. The TLB</a></li>
<li class="toctree-l2"><a class="reference internal" href="mtrr.html">12. MTRR (Memory Type Range Register) control</a></li>
<li class="toctree-l2"><a class="reference internal" href="pat.html">13. PAT (Page Attribute Table)</a></li>
<li class="toctree-l2"><a class="reference internal" href="intel-iommu.html">14. Linux IOMMU Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intel_txt.html">15. Intel(R) TXT Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="amd-memory-encryption.html">16. AMD Memory Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="pti.html">17. Page Table Isolation (PTI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mds.html">18. Microarchitectural Data Sampling (MDS) mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="microcode.html">19. The Linux Microcode Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="resctrl_ui.html">20. User Interface for Resource Control feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="tsx_async_abort.html">21. TSX Async Abort (TAA) mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb-legacy-support.html">22. USB Legacy support</a></li>
<li class="toctree-l2"><a class="reference internal" href="i386/index.html">23. i386 Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="x86_64/index.html">24. x86_64 Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="sva.html">25. Shared Virtual Addressing (SVA) with ENQCMD</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">x86-specific Documentation</a> &raquo;</li>
        
      <li><span class="section-number">3. </span>x86 Feature Flags</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/x86/cpuinfo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="x86-feature-flags">
<h1><span class="section-number">3. </span>x86 Feature Flags<a class="headerlink" href="#x86-feature-flags" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">3.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>On x86, flags appearing in /proc/cpuinfo have an X86_FEATURE definition
in arch/x86/include/asm/cpufeatures.h. If the kernel cares about a feature
or KVM want to expose the feature to a KVM guest, it can and should have
an X86_FEATURE_* defined. These flags represent hardware features as
well as software features.</p>
<p>If users want to know if a feature is available on a given system, they
try to find the flag in /proc/cpuinfo. If a given flag is present, it
means that the kernel supports it and is currently making it available.
If such flag represents a hardware feature, it also means that the
hardware supports it.</p>
<p>If the expected flag does not appear in /proc/cpuinfo, things are murkier.
Users need to find out the reason why the flag is missing and find the way
how to enable it, which is not always easy. There are several factors that
can explain missing flags: the expected feature failed to enable, the feature
is missing in hardware, platform firmware did not enable it, the feature is
disabled at build or run time, an old kernel is in use, or the kernel does
not support the feature and thus has not enabled it. In general, /proc/cpuinfo
shows features which the kernel supports. For a full list of CPUID flags
which the CPU supports, use tools/arch/x86/kcpuid.</p>
</div>
<div class="section" id="how-are-feature-flags-created">
<h2><span class="section-number">3.2. </span>How are feature flags created?<a class="headerlink" href="#how-are-feature-flags-created" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-feature-flags-can-be-derived-from-the-contents-of-cpuid-leaves">
<h3><span class="section-number">3.2.1. </span>a: Feature flags can be derived from the contents of CPUID leaves.<a class="headerlink" href="#a-feature-flags-can-be-derived-from-the-contents-of-cpuid-leaves" title="Permalink to this headline">¶</a></h3>
<p>These feature definitions are organized mirroring the layout of CPUID
leaves and grouped in words with offsets as mapped in enum cpuid_leafs
in cpufeatures.h (see arch/x86/include/asm/cpufeatures.h for details).
If a feature is defined with a X86_FEATURE_&lt;name&gt; definition in
cpufeatures.h, and if it is detected at run time, the flags will be
displayed accordingly in /proc/cpuinfo. For example, the flag “avx2”
comes from X86_FEATURE_AVX2 in cpufeatures.h.</p>
</div>
<div class="section" id="b-flags-can-be-from-scattered-cpuid-based-features">
<h3><span class="section-number">3.2.2. </span>b: Flags can be from scattered CPUID-based features.<a class="headerlink" href="#b-flags-can-be-from-scattered-cpuid-based-features" title="Permalink to this headline">¶</a></h3>
<p>Hardware features enumerated in sparsely populated CPUID leaves get
software-defined values. Still, CPUID needs to be queried to determine
if a given feature is present. This is done in init_scattered_cpuid_features().
For instance, X86_FEATURE_CQM_LLC is defined as 11*32 + 0 and its presence is
checked at runtime in the respective CPUID leaf [EAX=f, ECX=0] bit EDX[1].</p>
<p>The intent of scattering CPUID leaves is to not bloat struct
cpuinfo_x86.x86_capability[] unnecessarily. For instance, the CPUID leaf
[EAX=7, ECX=0] has 30 features and is dense, but the CPUID leaf [EAX=7, EAX=1]
has only one feature and would waste 31 bits of space in the x86_capability[]
array. Since there is a struct cpuinfo_x86 for each possible CPU, the wasted
memory is not trivial.</p>
</div>
<div class="section" id="c-flags-can-be-created-synthetically-under-certain-conditions-for-hardware-features">
<h3><span class="section-number">3.2.3. </span>c: Flags can be created synthetically under certain conditions for hardware features.<a class="headerlink" href="#c-flags-can-be-created-synthetically-under-certain-conditions-for-hardware-features" title="Permalink to this headline">¶</a></h3>
<p>Examples of conditions include whether certain features are present in
MSR_IA32_CORE_CAPS or specific CPU models are identified. If the needed
conditions are met, the features are enabled by the set_cpu_cap or
setup_force_cpu_cap macros. For example, if bit 5 is set in MSR_IA32_CORE_CAPS,
the feature X86_FEATURE_SPLIT_LOCK_DETECT will be enabled and
“split_lock_detect” will be displayed. The flag “ring3mwait” will be
displayed only when running on INTEL_FAM6_XEON_PHI_[KNL|KNM] processors.</p>
</div>
<div class="section" id="d-flags-can-represent-purely-software-features">
<h3><span class="section-number">3.2.4. </span>d: Flags can represent purely software features.<a class="headerlink" href="#d-flags-can-represent-purely-software-features" title="Permalink to this headline">¶</a></h3>
<p>These flags do not represent hardware features. Instead, they represent a
software feature implemented in the kernel. For example, Kernel Page Table
Isolation is purely software feature and its feature flag X86_FEATURE_PTI is
also defined in cpufeatures.h.</p>
</div>
</div>
<div class="section" id="naming-of-flags">
<h2><span class="section-number">3.3. </span>Naming of Flags<a class="headerlink" href="#naming-of-flags" title="Permalink to this headline">¶</a></h2>
<p>The script arch/x86/kernel/cpu/mkcapflags.sh processes the
#define X86_FEATURE_&lt;name&gt; from cpufeatures.h and generates the
x86_cap/bug_flags[] arrays in kernel/cpu/capflags.c. The names in the
resulting x86_cap/bug_flags[] are used to populate /proc/cpuinfo. The naming
of flags in the x86_cap/bug_flags[] are as follows:</p>
<div class="section" id="a-the-name-of-the-flag-is-from-the-string-in-x86-feature-name-by-default">
<h3><span class="section-number">3.3.1. </span>a: The name of the flag is from the string in X86_FEATURE_&lt;name&gt; by default.<a class="headerlink" href="#a-the-name-of-the-flag-is-from-the-string-in-x86-feature-name-by-default" title="Permalink to this headline">¶</a></h3>
<p>By default, the flag &lt;name&gt; in /proc/cpuinfo is extracted from the respective
X86_FEATURE_&lt;name&gt; in cpufeatures.h. For example, the flag “avx2” is from
X86_FEATURE_AVX2.</p>
</div>
<div class="section" id="b-the-naming-can-be-overridden">
<h3><span class="section-number">3.3.2. </span>b: The naming can be overridden.<a class="headerlink" href="#b-the-naming-can-be-overridden" title="Permalink to this headline">¶</a></h3>
<p>If the comment on the line for the #define X86_FEATURE_* starts with a
double-quote character (“”), the string inside the double-quote characters
will be the name of the flags. For example, the flag “sse4_1” comes from
the comment “sse4_1” following the X86_FEATURE_XMM4_1 definition.</p>
<p>There are situations in which overriding the displayed name of the flag is
needed. For instance, /proc/cpuinfo is a userspace interface and must remain
constant. If, for some reason, the naming of X86_FEATURE_&lt;name&gt; changes, one
shall override the new naming with the name already used in /proc/cpuinfo.</p>
</div>
<div class="section" id="c-the-naming-override-can-be-which-means-it-will-not-appear-in-proc-cpuinfo">
<h3><span class="section-number">3.3.3. </span>c: The naming override can be “”, which means it will not appear in /proc/cpuinfo.<a class="headerlink" href="#c-the-naming-override-can-be-which-means-it-will-not-appear-in-proc-cpuinfo" title="Permalink to this headline">¶</a></h3>
<p>The feature shall be omitted from /proc/cpuinfo if it does not make sense for
the feature to be exposed to userspace. For example, X86_FEATURE_ALWAYS is
defined in cpufeatures.h but that flag is an internal kernel feature used
in the alternative runtime patching functionality. So, its name is overridden
with “”. Its flag will not appear in /proc/cpuinfo.</p>
</div>
</div>
<div class="section" id="flags-are-missing-when-one-or-more-of-these-happen">
<h2><span class="section-number">3.4. </span>Flags are missing when one or more of these happen<a class="headerlink" href="#flags-are-missing-when-one-or-more-of-these-happen" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-the-hardware-does-not-enumerate-support-for-it">
<h3><span class="section-number">3.4.1. </span>a: The hardware does not enumerate support for it.<a class="headerlink" href="#a-the-hardware-does-not-enumerate-support-for-it" title="Permalink to this headline">¶</a></h3>
<p>For example, when a new kernel is running on old hardware or the feature is
not enabled by boot firmware. Even if the hardware is new, there might be a
problem enabling the feature at run time, the flag will not be displayed.</p>
</div>
<div class="section" id="b-the-kernel-does-not-know-about-the-flag">
<h3><span class="section-number">3.4.2. </span>b: The kernel does not know about the flag.<a class="headerlink" href="#b-the-kernel-does-not-know-about-the-flag" title="Permalink to this headline">¶</a></h3>
<p>For example, when an old kernel is running on new hardware.</p>
</div>
<div class="section" id="c-the-kernel-disabled-support-for-it-at-compile-time">
<h3><span class="section-number">3.4.3. </span>c: The kernel disabled support for it at compile-time.<a class="headerlink" href="#c-the-kernel-disabled-support-for-it-at-compile-time" title="Permalink to this headline">¶</a></h3>
<p>For example, if 5-level-paging is not enabled when building (i.e.,
CONFIG_X86_5LEVEL is not selected) the flag “la57” will not show up <a class="footnote-reference brackets" href="#f1" id="id1">1</a>.
Even though the feature will still be detected via CPUID, the kernel disables
it by clearing via setup_clear_cpu_cap(X86_FEATURE_LA57).</p>
</div>
<div class="section" id="d-the-feature-is-disabled-at-boot-time">
<h3><span class="section-number">3.4.4. </span>d: The feature is disabled at boot-time.<a class="headerlink" href="#d-the-feature-is-disabled-at-boot-time" title="Permalink to this headline">¶</a></h3>
<p>A feature can be disabled either using a command-line parameter or because
it failed to be enabled. The command-line parameter clearcpuid= can be used
to disable features using the feature number as defined in
/arch/x86/include/asm/cpufeatures.h. For instance, User Mode Instruction
Protection can be disabled using clearcpuid=514. The number 514 is calculated
from #define X86_FEATURE_UMIP (16*32 + 2).</p>
<p>In addition, there exists a variety of custom command-line parameters that
disable specific features. The list of parameters includes, but is not limited
to, nofsgsbase, nosmap, and nosmep. 5-level paging can also be disabled using
“no5lvl”. SMAP and SMEP are disabled with the aforementioned parameters,
respectively.</p>
</div>
<div class="section" id="e-the-feature-was-known-to-be-non-functional">
<h3><span class="section-number">3.4.5. </span>e: The feature was known to be non-functional.<a class="headerlink" href="#e-the-feature-was-known-to-be-non-functional" title="Permalink to this headline">¶</a></h3>
<p>The feature was known to be non-functional because a dependency was
missing at runtime. For example, AVX flags will not show up if XSAVE feature
is disabled since they depend on XSAVE feature. Another example would be broken
CPUs and them missing microcode patches. Due to that, the kernel decides not to
enable a feature.</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>5-level paging uses linear address of 57 bits.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="topology.html" class="btn btn-neutral float-right" title="4. x86 Topology" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="booting-dt.html" class="btn btn-neutral float-left" title="2. DeviceTree Booting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>