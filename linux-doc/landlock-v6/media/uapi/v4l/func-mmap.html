

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.63. V4L2 mmap() &mdash; The Linux Kernel 4.11.0-rc3+ documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="The Linux Kernel 4.11.0-rc3+ documentation" href="../../../index.html"/>
        <link rel="up" title="8. Function Reference" href="user-func.html"/>
        <link rel="next" title="8.64. V4L2 munmap()" href="func-munmap.html"/>
        <link rel="prev" title="8.62. ioctl VIDIOC_SUBSCRIBE_EVENT, VIDIOC_UNSUBSCRIBE_EVENT" href="vidioc-subscribe-event.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.11.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../media_uapi.html">Linux Media Infrastructure userspace API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="v4l2.html">Part I - Video for Linux API</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common.html">1. Common API Elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="pixfmt.html">2. Image Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html">3. Input/Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="devices.html">4. Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="driver.html">5. V4L2 Driver Programming</a></li>
<li class="toctree-l4"><a class="reference internal" href="libv4l.html">6. Libv4l Userspace Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="compat.html">7. Changes</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="user-func.html">8. Function Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-defs.html">9. Common definitions for V4L2 and V4L2 subdev interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="videodev.html">10. Video For Linux Two Header File</a></li>
<li class="toctree-l4"><a class="reference internal" href="capture-example.html">11. Video Capture Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2grab-example.html">12. Video Grabber example using libv4l</a></li>
<li class="toctree-l4"><a class="reference internal" href="biblio.html">13. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2.html#revision-and-copyright">Revision and Copyright</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2.html#revision-history">Revision History</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dvb/dvbapi.html">Part II - Digital TV API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rc/remote_controllers.html">Part III - Remote Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mediactl/media-controller.html">Part IV - Media Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cec/cec-api.html">Part V - Consumer Electronics Control API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gen-errors.html">Generic Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fdl-appendix.html">GNU Free Documentation License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
      
          <li><a href="../../media_uapi.html">Linux Media Infrastructure userspace API</a> &raquo;</li>
      
          <li><a href="v4l2.html">Part I - Video for Linux API</a> &raquo;</li>
      
          <li><a href="user-func.html">8. Function Reference</a> &raquo;</li>
      
    <li>8.63. V4L2 mmap()</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/media/uapi/v4l/func-mmap.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="v4l2-mmap">
<span id="func-mmap"></span><h1>8.63. V4L2 mmap()<a class="headerlink" href="#v4l2-mmap" title="Permalink to this headline">¶</a></h1>
<div class="section" id="name">
<h2>8.63.1. Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<p>v4l2-mmap - Map device memory into application address space</p>
</div>
<div class="section" id="synopsis">
<h2>8.63.2. Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<dl class="function">
<dt id="c.v4l2-mmap">
void *<code class="descname">mmap</code><span class="sig-paren">(</span>void<em>&nbsp;*start</em>, size_t<em>&nbsp;length</em>, int<em>&nbsp;prot</em>, int<em>&nbsp;flags</em>, int<em>&nbsp;fd</em>, off_t<em>&nbsp;offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2-mmap" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="arguments">
<h2>8.63.3. Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">start</span></code></dt>
<dd>Map the buffer to this address in the application&#8217;s address space.
When the <code class="docutils literal"><span class="pre">MAP_FIXED</span></code> flag is specified, <code class="docutils literal"><span class="pre">start</span></code> must be a
multiple of the pagesize and mmap will fail when the specified
address cannot be used. Use of this option is discouraged;
applications should just specify a <code class="docutils literal"><span class="pre">NULL</span></code> pointer here.</dd>
<dt><code class="docutils literal"><span class="pre">length</span></code></dt>
<dd>Length of the memory area to map. This must be the same value as
returned by the driver in the struct
<a class="reference internal" href="buffer.html#c.v4l2_buffer" title="v4l2_buffer"><code class="xref c c-type docutils literal"><span class="pre">v4l2_buffer</span></code></a> <code class="docutils literal"><span class="pre">length</span></code> field for the
single-planar API, and the same value as returned by the driver in
the struct <a class="reference internal" href="buffer.html#c.v4l2_plane" title="v4l2_plane"><code class="xref c c-type docutils literal"><span class="pre">v4l2_plane</span></code></a> <code class="docutils literal"><span class="pre">length</span></code> field for
the multi-planar API.</dd>
<dt><code class="docutils literal"><span class="pre">prot</span></code></dt>
<dd><p class="first">The <code class="docutils literal"><span class="pre">prot</span></code> argument describes the desired memory protection.
Regardless of the device type and the direction of data exchange it
should be set to <code class="docutils literal"><span class="pre">PROT_READ</span></code> | <code class="docutils literal"><span class="pre">PROT_WRITE</span></code>, permitting read
and write access to image buffers. Drivers should support at least
this combination of flags.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>The Linux <code class="docutils literal"><span class="pre">videobuf</span></code> kernel module, which is used by some
drivers supports only <code class="docutils literal"><span class="pre">PROT_READ</span></code> | <code class="docutils literal"><span class="pre">PROT_WRITE</span></code>. When the
driver does not support the desired protection, the
<a class="reference internal" href="#func-mmap"><span class="std std-ref">mmap()</span></a> function fails.</li>
<li>Device memory accesses (e. g. the memory on a graphics card
with video capturing hardware) may incur a performance penalty
compared to main memory accesses, or reads may be significantly
slower than writes or vice versa. Other I/O methods may be more
efficient in such case.</li>
</ol>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">flags</span></code></dt>
<dd><p class="first">The <code class="docutils literal"><span class="pre">flags</span></code> parameter specifies the type of the mapped object,
mapping options and whether modifications made to the mapped copy of
the page are private to the process or are to be shared with other
references.</p>
<p><code class="docutils literal"><span class="pre">MAP_FIXED</span></code> requests that the driver selects no other address than
the one specified. If the specified address cannot be used,
<a class="reference internal" href="#func-mmap"><span class="std std-ref">mmap()</span></a> will fail. If <code class="docutils literal"><span class="pre">MAP_FIXED</span></code> is specified,
<code class="docutils literal"><span class="pre">start</span></code> must be a multiple of the pagesize. Use of this option is
discouraged.</p>
<p>One of the <code class="docutils literal"><span class="pre">MAP_SHARED</span></code> or <code class="docutils literal"><span class="pre">MAP_PRIVATE</span></code> flags must be set.
<code class="docutils literal"><span class="pre">MAP_SHARED</span></code> allows applications to share the mapped memory with
other (e. g. child-) processes.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Linux <code class="docutils literal"><span class="pre">videobuf</span></code> module  which is used by some
drivers supports only <code class="docutils literal"><span class="pre">MAP_SHARED</span></code>. <code class="docutils literal"><span class="pre">MAP_PRIVATE</span></code> requests
copy-on-write semantics. V4L2 applications should not set the
<code class="docutils literal"><span class="pre">MAP_PRIVATE</span></code>, <code class="docutils literal"><span class="pre">MAP_DENYWRITE</span></code>, <code class="docutils literal"><span class="pre">MAP_EXECUTABLE</span></code> or <code class="docutils literal"><span class="pre">MAP_ANON</span></code>
flags.</p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">fd</span></code></dt>
<dd>File descriptor returned by <a class="reference internal" href="func-open.html#func-open"><span class="std std-ref">open()</span></a>.</dd>
<dt><code class="docutils literal"><span class="pre">offset</span></code></dt>
<dd>Offset of the buffer in device memory. This must be the same value
as returned by the driver in the struct
<a class="reference internal" href="buffer.html#c.v4l2_buffer" title="v4l2_buffer"><code class="xref c c-type docutils literal"><span class="pre">v4l2_buffer</span></code></a> <code class="docutils literal"><span class="pre">m</span></code> union <code class="docutils literal"><span class="pre">offset</span></code> field for
the single-planar API, and the same value as returned by the driver
in the struct <a class="reference internal" href="buffer.html#c.v4l2_plane" title="v4l2_plane"><code class="xref c c-type docutils literal"><span class="pre">v4l2_plane</span></code></a> <code class="docutils literal"><span class="pre">m</span></code> union
<code class="docutils literal"><span class="pre">mem_offset</span></code> field for the multi-planar API.</dd>
</dl>
</div>
<div class="section" id="description">
<h2>8.63.4. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#func-mmap"><span class="std std-ref">mmap()</span></a> function asks to map <code class="docutils literal"><span class="pre">length</span></code> bytes starting at
<code class="docutils literal"><span class="pre">offset</span></code> in the memory of the device specified by <code class="docutils literal"><span class="pre">fd</span></code> into the
application address space, preferably at address <code class="docutils literal"><span class="pre">start</span></code>. This latter
address is a hint only, and is usually specified as 0.</p>
<p>Suitable length and offset parameters are queried with the
<a class="reference internal" href="vidioc-querybuf.html#vidioc-querybuf"><span class="std std-ref">ioctl VIDIOC_QUERYBUF</span></a> ioctl. Buffers must be
allocated with the <a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span class="std std-ref">ioctl VIDIOC_REQBUFS</span></a> ioctl
before they can be queried.</p>
<p>To unmap buffers the <a class="reference internal" href="func-munmap.html#func-munmap"><span class="std std-ref">munmap()</span></a> function is used.</p>
</div>
<div class="section" id="return-value">
<h2>8.63.5. Return Value<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p>On success <a class="reference internal" href="#func-mmap"><span class="std std-ref">mmap()</span></a> returns a pointer to the mapped buffer. On
error <code class="docutils literal"><span class="pre">MAP_FAILED</span></code> (-1) is returned, and the <code class="docutils literal"><span class="pre">errno</span></code> variable is set
appropriately. Possible error codes are:</p>
<dl class="docutils">
<dt>EBADF</dt>
<dd><code class="docutils literal"><span class="pre">fd</span></code> is not a valid file descriptor.</dd>
<dt>EACCES</dt>
<dd><code class="docutils literal"><span class="pre">fd</span></code> is not open for reading and writing.</dd>
<dt>EINVAL</dt>
<dd><p class="first">The <code class="docutils literal"><span class="pre">start</span></code> or <code class="docutils literal"><span class="pre">length</span></code> or <code class="docutils literal"><span class="pre">offset</span></code> are not suitable. (E. g.
they are too large, or not aligned on a <code class="docutils literal"><span class="pre">PAGESIZE</span></code> boundary.)</p>
<p>The <code class="docutils literal"><span class="pre">flags</span></code> or <code class="docutils literal"><span class="pre">prot</span></code> value is not supported.</p>
<p class="last">No buffers have been allocated with the
<a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span class="std std-ref">ioctl VIDIOC_REQBUFS</span></a> ioctl.</p>
</dd>
<dt>ENOMEM</dt>
<dd>Not enough physical or virtual memory was available to complete the
request.</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="func-munmap.html" class="btn btn-neutral float-right" title="8.64. V4L2 munmap()" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="vidioc-subscribe-event.html" class="btn btn-neutral" title="8.62. ioctl VIDIOC_SUBSCRIBE_EVENT, VIDIOC_UNSUBSCRIBE_EVENT" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'4.11.0-rc3+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>