

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Suspend/Hibernation Notifiers &mdash; The Linux Kernel 4.11.0-rc3+ documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="The Linux Kernel 4.11.0-rc3+ documentation" href="../../index.html"/>
        <link rel="up" title="Device Power Management" href="index.html"/>
        <link rel="next" title="Device Power Management Data Types" href="types.html"/>
        <link rel="prev" title="Device Power Management Basics" href="devices.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.11.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux driver implementer&#8217;s API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Device Power Management</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="devices.html">Device Power Management Basics</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Suspend/Hibernation Notifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="types.html">Device Power Management Data Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dma-buf.html">Buffer Sharing and Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound.html">Sound Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb.html">The Linux-USB Host Side API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">The Linux driver implementer&#8217;s API guide</a> &raquo;</li>
      
          <li><a href="index.html">Device Power Management</a> &raquo;</li>
      
    <li>Suspend/Hibernation Notifiers</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/driver-api/pm/notifiers.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="suspend-hibernation-notifiers">
<h1>Suspend/Hibernation Notifiers<a class="headerlink" href="#suspend-hibernation-notifiers" title="Permalink to this headline">Â¶</a></h1>
<div class="highlight-none"><div class="highlight"><pre><span></span>Copyright (c) 2016 Intel Corp., Rafael J. Wysocki &lt;rafael.j.wysocki@intel.com&gt;
</pre></div>
</div>
<p>There are some operations that subsystems or drivers may want to carry out
before hibernation/suspend or after restore/resume, but they require the system
to be fully functional, so the drivers&#8217; and subsystems&#8217; <code class="docutils literal"><span class="pre">-&gt;suspend()</span></code> and
<code class="docutils literal"><span class="pre">-&gt;resume()</span></code> or even <code class="docutils literal"><span class="pre">-&gt;prepare()</span></code> and <code class="docutils literal"><span class="pre">-&gt;complete()</span></code> callbacks are not
suitable for this purpose.</p>
<p>For example, device drivers may want to upload firmware to their devices after
resume/restore, but they cannot do it by calling <a class="reference internal" href="../infrastructure.html#c.request_firmware" title="request_firmware"><code class="xref c c-func docutils literal"><span class="pre">request_firmware()</span></code></a>
from their <code class="docutils literal"><span class="pre">-&gt;resume()</span></code> or <code class="docutils literal"><span class="pre">-&gt;complete()</span></code> callback routines (user land
processes are frozen at these points).  The solution may be to load the firmware
into memory before processes are frozen and upload it from there in the
<code class="docutils literal"><span class="pre">-&gt;resume()</span></code> routine.  A suspend/hibernation notifier may be used for that.</p>
<p>Subsystems or drivers having such needs can register suspend notifiers that
will be called upon the following events by the PM core:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">PM_HIBERNATION_PREPARE</span></code></dt>
<dd>The system is going to hibernate, tasks will be frozen immediately. This
is different from <code class="docutils literal"><span class="pre">PM_SUSPEND_PREPARE</span></code> below, because in this case
additional work is done between the notifiers and the invocation of PM
callbacks for the &#8220;freeze&#8221; transition.</dd>
<dt><code class="docutils literal"><span class="pre">PM_POST_HIBERNATION</span></code></dt>
<dd>The system memory state has been restored from a hibernation image or an
error occurred during hibernation.  Device restore callbacks have been
executed and tasks have been thawed.</dd>
<dt><code class="docutils literal"><span class="pre">PM_RESTORE_PREPARE</span></code></dt>
<dd>The system is going to restore a hibernation image.  If all goes well,
the restored image kernel will issue a <code class="docutils literal"><span class="pre">PM_POST_HIBERNATION</span></code>
notification.</dd>
<dt><code class="docutils literal"><span class="pre">PM_POST_RESTORE</span></code></dt>
<dd>An error occurred during restore from hibernation.  Device restore
callbacks have been executed and tasks have been thawed.</dd>
<dt><code class="docutils literal"><span class="pre">PM_SUSPEND_PREPARE</span></code></dt>
<dd>The system is preparing for suspend.</dd>
<dt><code class="docutils literal"><span class="pre">PM_POST_SUSPEND</span></code></dt>
<dd>The system has just resumed or an error occurred during suspend.  Device
resume callbacks have been executed and tasks have been thawed.</dd>
</dl>
<p>It is generally assumed that whatever the notifiers do for
<code class="docutils literal"><span class="pre">PM_HIBERNATION_PREPARE</span></code>, should be undone for <code class="docutils literal"><span class="pre">PM_POST_HIBERNATION</span></code>.
Analogously, operations carried out for <code class="docutils literal"><span class="pre">PM_SUSPEND_PREPARE</span></code> should be
reversed for <code class="docutils literal"><span class="pre">PM_POST_SUSPEND</span></code>.</p>
<p>Moreover, if one of the notifiers fails for the <code class="docutils literal"><span class="pre">PM_HIBERNATION_PREPARE</span></code> or
<code class="docutils literal"><span class="pre">PM_SUSPEND_PREPARE</span></code> event, the notifiers that have already succeeded for that
event will be called for <code class="docutils literal"><span class="pre">PM_POST_HIBERNATION</span></code> or <code class="docutils literal"><span class="pre">PM_POST_SUSPEND</span></code>,
respectively.</p>
<p>The hibernation and suspend notifiers are called with <code class="xref c c-data docutils literal"><span class="pre">pm_mutex</span></code> held.
They are defined in the usual way, but their last argument is meaningless (it is
always NULL).</p>
<p>To register and/or unregister a suspend notifier use
<code class="xref c c-func docutils literal"><span class="pre">register_pm_notifier()</span></code> and <code class="xref c c-func docutils literal"><span class="pre">unregister_pm_notifier()</span></code>,
respectively (both defined in <code class="file docutils literal"><span class="pre">include/linux/suspend.h</span></code>).  If you don&#8217;t
need to unregister the notifier, you can also use the <code class="xref c c-func docutils literal"><span class="pre">pm_notifier()</span></code>
macro defined in <code class="file docutils literal"><span class="pre">include/linux/suspend.h</span></code>.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="types.html" class="btn btn-neutral float-right" title="Device Power Management Data Types" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="devices.html" class="btn btn-neutral" title="Device Power Management Basics" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'4.11.0-rc3+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>