

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>drm/tinydrm Driver library &mdash; The Linux Kernel 4.11.0-rc3+ documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 4.11.0-rc3+ documentation" href="../index.html"/>
        <link rel="up" title="Linux GPU Driver Developer’s Guide" href="index.html"/>
        <link rel="next" title="VGA Switcheroo" href="vga-switcheroo.html"/>
        <link rel="prev" title="drm/i915 Intel GFX Driver" href="i915.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.11.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux GPU Driver Developer&#8217;s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-internals.html">DRM Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-mm.html">DRM Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms.html">Kernel Mode Setting (KMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms-helpers.html">Mode Setting Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-uapi.html">Userland interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="i915.html">drm/i915 Intel GFX Driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">drm/tinydrm Driver library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#core-functionality">Core functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-helpers">Additional helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mipi-dbi-compatible-controllers">MIPI DBI Compatible Controllers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="vga-switcheroo.html">VGA Switcheroo</a></li>
<li class="toctree-l2"><a class="reference internal" href="vgaarbiter.html">VGA Arbiter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Linux GPU Driver Developer&#8217;s Guide</a> &raquo;</li>
      
    <li>drm/tinydrm Driver library</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/gpu/tinydrm.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drm-tinydrm-driver-library">
<h1>drm/tinydrm Driver library<a class="headerlink" href="#drm-tinydrm-driver-library" title="Permalink to this headline">¶</a></h1>
<p>This library provides driver helpers for very simple display hardware.</p>
<p>It is based on <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe" title="drm_simple_display_pipe"><code class="xref c c-type docutils literal"><span class="pre">drm_simple_display_pipe</span></code></a> coupled with a <a class="reference internal" href="drm-kms.html#c.drm_connector" title="drm_connector"><code class="xref c c-type docutils literal"><span class="pre">drm_connector</span></code></a> which
has only one fixed <a class="reference internal" href="drm-kms.html#c.drm_display_mode" title="drm_display_mode"><code class="xref c c-type docutils literal"><span class="pre">drm_display_mode</span></code></a>. The framebuffers are backed by the
cma helper and have support for framebuffer flushing (dirty).
fbdev support is also included.</p>
<div class="section" id="core-functionality">
<h2>Core functionality<a class="headerlink" href="#core-functionality" title="Permalink to this headline">¶</a></h2>
<p>The driver allocates <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device"><code class="xref c c-type docutils literal"><span class="pre">tinydrm_device</span></code></a>, initializes it using
<a class="reference internal" href="#c.devm_tinydrm_init" title="devm_tinydrm_init"><code class="xref c c-func docutils literal"><span class="pre">devm_tinydrm_init()</span></code></a>, sets up the pipeline using <a class="reference internal" href="#c.tinydrm_display_pipe_init" title="tinydrm_display_pipe_init"><code class="xref c c-func docutils literal"><span class="pre">tinydrm_display_pipe_init()</span></code></a>
and registers the DRM device using <a class="reference internal" href="#c.devm_tinydrm_register" title="devm_tinydrm_register"><code class="xref c c-func docutils literal"><span class="pre">devm_tinydrm_register()</span></code></a>.</p>
<dl class="type">
<dt id="c.tinydrm_device">
struct <code class="descname">tinydrm_device</code><a class="headerlink" href="#c.tinydrm_device" title="Permalink to this definition">¶</a></dt>
<dd><p>tinydrm device</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>struct tinydrm_device {
  struct drm_device * drm;
  struct drm_simple_display_pipe pipe;
  struct mutex dirty_lock;
  struct drm_fbdev_cma * fbdev_cma;
  struct drm_atomic_state * suspend_state;
  const struct drm_framebuffer_funcs * fb_funcs;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">drm</span></code></dt>
<dd>DRM device</dd>
<dt><code class="docutils literal"><span class="pre">pipe</span></code></dt>
<dd>Display pipe structure</dd>
<dt><code class="docutils literal"><span class="pre">dirty_lock</span></code></dt>
<dd>Serializes framebuffer flushing</dd>
<dt><code class="docutils literal"><span class="pre">fbdev_cma</span></code></dt>
<dd>CMA fbdev structure</dd>
<dt><code class="docutils literal"><span class="pre">suspend_state</span></code></dt>
<dd>Atomic state when suspended</dd>
<dt><code class="docutils literal"><span class="pre">fb_funcs</span></code></dt>
<dd>Framebuffer functions used when creating framebuffers</dd>
</dl>
<dl class="function">
<dt id="c.TINYDRM_GEM_DRIVER_OPS">
<code class="descname">TINYDRM_GEM_DRIVER_OPS</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.TINYDRM_GEM_DRIVER_OPS" title="Permalink to this definition">¶</a></dt>
<dd><p>default tinydrm gem operations</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<p><strong>Description</strong></p>
<p>This macro provides a shortcut for setting the tinydrm GEM operations in
the <a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal"><span class="pre">drm_driver</span></code></a> structure.</p>
<dl class="function">
<dt id="c.TINYDRM_MODE">
<code class="descname">TINYDRM_MODE</code><span class="sig-paren">(</span><em>hd</em>, <em>vd</em>, <em>hd_mm</em>, <em>vd_mm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TINYDRM_MODE" title="Permalink to this definition">¶</a></dt>
<dd><p>tinydrm display mode</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">hd</span></code></dt>
<dd>Horizontal resolution, width</dd>
<dt><code class="docutils literal"><span class="pre">vd</span></code></dt>
<dd>Vertical resolution, height</dd>
<dt><code class="docutils literal"><span class="pre">hd_mm</span></code></dt>
<dd>Display width in millimeters</dd>
<dt><code class="docutils literal"><span class="pre">vd_mm</span></code></dt>
<dd>Display height in millimeters</dd>
</dl>
<p><strong>Description</strong></p>
<p>This macro creates a <a class="reference internal" href="drm-kms.html#c.drm_display_mode" title="drm_display_mode"><code class="xref c c-type docutils literal"><span class="pre">drm_display_mode</span></code></a> for use with tinydrm.</p>
<dl class="function">
<dt id="c.tinydrm_lastclose">
void <code class="descname">tinydrm_lastclose</code><span class="sig-paren">(</span>struct drm_device *<em>&nbsp;drm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_lastclose" title="Permalink to this definition">¶</a></dt>
<dd><p>DRM lastclose helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*</span> <span class="pre">drm</span></code></dt>
<dd>DRM device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function ensures that fbdev is restored when <code class="xref c c-func docutils literal"><span class="pre">drm_lastclose()</span></code> is called
on the last <a class="reference internal" href="drm-internals.html#c.drm_release" title="drm_release"><code class="xref c c-func docutils literal"><span class="pre">drm_release()</span></code></a>. Drivers can use this as their
<a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal"><span class="pre">drm_driver-&gt;lastclose</span></code></a> callback.</p>
<dl class="function">
<dt id="c.tinydrm_gem_cma_prime_import_sg_table">
struct <a class="reference internal" href="drm-mm.html#c.drm_gem_object" title="drm_gem_object">drm_gem_object</a> * <code class="descname">tinydrm_gem_cma_prime_import_sg_table</code><span class="sig-paren">(</span>struct drm_device *<em>&nbsp;drm</em>, struct <a class="reference internal" href="../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a> *<em>&nbsp;attach</em>, struct sg_table *<em>&nbsp;sgt</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_gem_cma_prime_import_sg_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a CMA GEM object from another driver&#8217;s scatter/gather table of pinned pages</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*</span> <span class="pre">drm</span></code></dt>
<dd>DRM device to import into</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*</span> <span class="pre">attach</span></code></dt>
<dd>DMA-BUF attachment</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">sg_table</span> <span class="pre">*</span> <span class="pre">sgt</span></code></dt>
<dd>Scatter/gather table of pinned pages</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function imports a scatter/gather table exported via DMA-BUF by
another driver using <a class="reference internal" href="drm-mm.html#c.drm_gem_cma_prime_import_sg_table" title="drm_gem_cma_prime_import_sg_table"><code class="xref c c-func docutils literal"><span class="pre">drm_gem_cma_prime_import_sg_table()</span></code></a>. It sets the
kernel virtual address on the CMA object. Drivers should use this as their
<a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal"><span class="pre">drm_driver-&gt;gem_prime_import_sg_table</span></code></a> callback if they need the virtual
address. <a class="reference internal" href="#c.tinydrm_gem_cma_free_object" title="tinydrm_gem_cma_free_object"><code class="xref c c-func docutils literal"><span class="pre">tinydrm_gem_cma_free_object()</span></code></a> should be used in combination with
this function.</p>
<p><strong>Return</strong></p>
<p>A pointer to a newly created GEM object or an ERR_PTR-encoded negative
error code on failure.</p>
<dl class="function">
<dt id="c.tinydrm_gem_cma_free_object">
void <code class="descname">tinydrm_gem_cma_free_object</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-mm.html#c.drm_gem_object" title="drm_gem_object">drm_gem_object</a> *<em>&nbsp;gem_obj</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_gem_cma_free_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Free resources associated with a CMA GEM object</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_gem_object</span> <span class="pre">*</span> <span class="pre">gem_obj</span></code></dt>
<dd>GEM object to free</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function frees the backing memory of the CMA GEM object, cleans up the
GEM object state and frees the memory used to store the object itself using
<a class="reference internal" href="drm-mm.html#c.drm_gem_cma_free_object" title="drm_gem_cma_free_object"><code class="xref c c-func docutils literal"><span class="pre">drm_gem_cma_free_object()</span></code></a>. It also handles PRIME buffers which has the kernel
virtual address set by <a class="reference internal" href="#c.tinydrm_gem_cma_prime_import_sg_table" title="tinydrm_gem_cma_prime_import_sg_table"><code class="xref c c-func docutils literal"><span class="pre">tinydrm_gem_cma_prime_import_sg_table()</span></code></a>. Drivers
can use this as their <a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal"><span class="pre">drm_driver-&gt;gem_free_object</span></code></a> callback.</p>
<dl class="function">
<dt id="c.devm_tinydrm_init">
int <code class="descname">devm_tinydrm_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;parent</em>, struct <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device">tinydrm_device</a> *<em>&nbsp;tdev</em>, const struct <a class="reference internal" href="drm-kms.html#c.drm_framebuffer_funcs" title="drm_framebuffer_funcs">drm_framebuffer_funcs</a> *<em>&nbsp;fb_funcs</em>, struct <a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver">drm_driver</a> *<em>&nbsp;driver</em><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_tinydrm_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize tinydrm device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">parent</span></code></dt>
<dd>Parent device object</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">tinydrm_device</span> <span class="pre">*</span> <span class="pre">tdev</span></code></dt>
<dd>tinydrm device</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_framebuffer_funcs</span> <span class="pre">*</span> <span class="pre">fb_funcs</span></code></dt>
<dd>Framebuffer functions</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_driver</span> <span class="pre">*</span> <span class="pre">driver</span></code></dt>
<dd>DRM driver</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function initializes <strong>tdev</strong>, the underlying DRM device and it&#8217;s
mode_config. Resources will be automatically freed on driver detach (devres)
using <a class="reference internal" href="drm-kms.html#c.drm_mode_config_cleanup" title="drm_mode_config_cleanup"><code class="xref c c-func docutils literal"><span class="pre">drm_mode_config_cleanup()</span></code></a> and <a class="reference internal" href="drm-internals.html#c.drm_dev_unref" title="drm_dev_unref"><code class="xref c c-func docutils literal"><span class="pre">drm_dev_unref()</span></code></a>.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.devm_tinydrm_register">
int <code class="descname">devm_tinydrm_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device">tinydrm_device</a> *<em>&nbsp;tdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_tinydrm_register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register tinydrm device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">tinydrm_device</span> <span class="pre">*</span> <span class="pre">tdev</span></code></dt>
<dd>tinydrm device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function registers the underlying DRM device and fbdev.
These resources will be automatically unregistered on driver detach (devres)
and the display pipeline will be disabled.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.tinydrm_shutdown">
void <code class="descname">tinydrm_shutdown</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device">tinydrm_device</a> *<em>&nbsp;tdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shutdown tinydrm</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">tinydrm_device</span> <span class="pre">*</span> <span class="pre">tdev</span></code></dt>
<dd>tinydrm device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function makes sure that the display pipeline is disabled.
Used by drivers in their shutdown callback to turn off the display
on machine shutdown and reboot.</p>
<dl class="function">
<dt id="c.tinydrm_suspend">
int <code class="descname">tinydrm_suspend</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device">tinydrm_device</a> *<em>&nbsp;tdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_suspend" title="Permalink to this definition">¶</a></dt>
<dd><p>Suspend tinydrm</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">tinydrm_device</span> <span class="pre">*</span> <span class="pre">tdev</span></code></dt>
<dd>tinydrm device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Used in driver PM operations to suspend tinydrm.
Suspends fbdev and DRM.
Resume with <a class="reference internal" href="#c.tinydrm_resume" title="tinydrm_resume"><code class="xref c c-func docutils literal"><span class="pre">tinydrm_resume()</span></code></a>.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.tinydrm_resume">
int <code class="descname">tinydrm_resume</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device">tinydrm_device</a> *<em>&nbsp;tdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume tinydrm</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">tinydrm_device</span> <span class="pre">*</span> <span class="pre">tdev</span></code></dt>
<dd>tinydrm device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Used in driver PM operations to resume tinydrm.
Suspend with <a class="reference internal" href="#c.tinydrm_suspend" title="tinydrm_suspend"><code class="xref c c-func docutils literal"><span class="pre">tinydrm_suspend()</span></code></a>.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.tinydrm_display_pipe_update">
void <code class="descname">tinydrm_display_pipe_update</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe" title="drm_simple_display_pipe">drm_simple_display_pipe</a> *<em>&nbsp;pipe</em>, struct <a class="reference internal" href="drm-kms.html#c.drm_plane_state" title="drm_plane_state">drm_plane_state</a> *<em>&nbsp;old_state</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_display_pipe_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Display pipe update helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_simple_display_pipe</span> <span class="pre">*</span> <span class="pre">pipe</span></code></dt>
<dd>Simple display pipe</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_plane_state</span> <span class="pre">*</span> <span class="pre">old_state</span></code></dt>
<dd>Old plane state</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function does a full framebuffer flush if the plane framebuffer
has changed. It also handles vblank events. Drivers can use this as their
<a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs"><code class="xref c c-type docutils literal"><span class="pre">drm_simple_display_pipe_funcs-&gt;update</span></code></a> callback.</p>
<dl class="function">
<dt id="c.tinydrm_display_pipe_prepare_fb">
int <code class="descname">tinydrm_display_pipe_prepare_fb</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe" title="drm_simple_display_pipe">drm_simple_display_pipe</a> *<em>&nbsp;pipe</em>, struct <a class="reference internal" href="drm-kms.html#c.drm_plane_state" title="drm_plane_state">drm_plane_state</a> *<em>&nbsp;plane_state</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_display_pipe_prepare_fb" title="Permalink to this definition">¶</a></dt>
<dd><p>Display pipe prepare_fb helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_simple_display_pipe</span> <span class="pre">*</span> <span class="pre">pipe</span></code></dt>
<dd>Simple display pipe</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_plane_state</span> <span class="pre">*</span> <span class="pre">plane_state</span></code></dt>
<dd>Plane state</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function uses <a class="reference internal" href="drm-kms-helpers.html#c.drm_fb_cma_prepare_fb" title="drm_fb_cma_prepare_fb"><code class="xref c c-func docutils literal"><span class="pre">drm_fb_cma_prepare_fb()</span></code></a> to check if the plane FB has an
dma-buf attached, extracts the exclusive fence and attaches it to plane
state for the atomic helper to wait on. Drivers can use this as their
<a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs"><code class="xref c c-type docutils literal"><span class="pre">drm_simple_display_pipe_funcs-&gt;prepare_fb</span></code></a> callback.</p>
<dl class="function">
<dt id="c.tinydrm_display_pipe_init">
int <code class="descname">tinydrm_display_pipe_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tinydrm_device" title="tinydrm_device">tinydrm_device</a> *<em>&nbsp;tdev</em>, const struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs">drm_simple_display_pipe_funcs</a> *<em>&nbsp;funcs</em>, int<em>&nbsp;connector_type</em>, const uint32_t *<em>&nbsp;formats</em>, unsigned int<em>&nbsp;format_count</em>, const struct <a class="reference internal" href="drm-kms.html#c.drm_display_mode" title="drm_display_mode">drm_display_mode</a> *<em>&nbsp;mode</em>, unsigned int<em>&nbsp;rotation</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_display_pipe_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize display pipe</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">tinydrm_device</span> <span class="pre">*</span> <span class="pre">tdev</span></code></dt>
<dd>tinydrm device</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_simple_display_pipe_funcs</span> <span class="pre">*</span> <span class="pre">funcs</span></code></dt>
<dd>Display pipe functions</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">connector_type</span></code></dt>
<dd>Connector type</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">uint32_t</span> <span class="pre">*</span> <span class="pre">formats</span></code></dt>
<dd>Array of supported formats (DRM_FORMAT_*)</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">format_count</span></code></dt>
<dd>Number of elements in <strong>formats</strong></dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_display_mode</span> <span class="pre">*</span> <span class="pre">mode</span></code></dt>
<dd>Supported mode</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">rotation</span></code></dt>
<dd>Initial <strong>mode</strong> rotation in degrees Counter Clock Wise</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function sets up a <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe" title="drm_simple_display_pipe"><code class="xref c c-type docutils literal"><span class="pre">drm_simple_display_pipe</span></code></a> with a <a class="reference internal" href="drm-kms.html#c.drm_connector" title="drm_connector"><code class="xref c c-type docutils literal"><span class="pre">drm_connector</span></code></a> that
has one fixed <a class="reference internal" href="drm-kms.html#c.drm_display_mode" title="drm_display_mode"><code class="xref c c-type docutils literal"><span class="pre">drm_display_mode</span></code></a> which is rotated according to <strong>rotation</strong>.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
</div>
<div class="section" id="additional-helpers">
<h2>Additional helpers<a class="headerlink" href="#additional-helpers" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tinydrm_machine_little_endian">
bool <code class="descname">tinydrm_machine_little_endian</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_machine_little_endian" title="Permalink to this definition">¶</a></dt>
<dd><p>Machine is little endian</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">void</span></code></dt>
<dd>no arguments</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if <em>defined(__LITTLE_ENDIAN)</em>, false otherwise</p>
<dl class="function">
<dt id="c.tinydrm_dbg_spi_message">
void <code class="descname">tinydrm_dbg_spi_message</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/spi.html#c.spi_device" title="spi_device">spi_device</a> *<em>&nbsp;spi</em>, struct <a class="reference internal" href="../driver-api/spi.html#c.spi_message" title="spi_message">spi_message</a> *<em>&nbsp;m</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_dbg_spi_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump SPI message</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_device</span> <span class="pre">*</span> <span class="pre">spi</span></code></dt>
<dd>SPI device</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_message</span> <span class="pre">*</span> <span class="pre">m</span></code></dt>
<dd>SPI message</dd>
</dl>
<p><strong>Description</strong></p>
<p>Dumps info about the transfers in a SPI message including buffer content.
DEBUG has to be defined for this function to be enabled alongside setting
the DRM_UT_DRIVER bit of <code class="xref c c-type docutils literal"><span class="pre">drm_debug</span></code>.</p>
<dl class="function">
<dt id="c.tinydrm_merge_clips">
bool <code class="descname">tinydrm_merge_clips</code><span class="sig-paren">(</span>struct drm_clip_rect *<em>&nbsp;dst</em>, struct drm_clip_rect *<em>&nbsp;src</em>, unsigned int<em>&nbsp;num_clips</em>, unsigned int<em>&nbsp;flags</em>, u32<em>&nbsp;max_width</em>, u32<em>&nbsp;max_height</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_merge_clips" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge clip rectangles</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_clip_rect</span> <span class="pre">*</span> <span class="pre">dst</span></code></dt>
<dd>Destination clip rectangle</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_clip_rect</span> <span class="pre">*</span> <span class="pre">src</span></code></dt>
<dd>Source clip rectangle(s)</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">num_clips</span></code></dt>
<dd>Number of <strong>src</strong> clip rectangles</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">flags</span></code></dt>
<dd>Dirty fb ioctl flags</dd>
<dt><code class="docutils literal"><span class="pre">u32</span> <span class="pre">max_width</span></code></dt>
<dd>Maximum width of <strong>dst</strong></dd>
<dt><code class="docutils literal"><span class="pre">u32</span> <span class="pre">max_height</span></code></dt>
<dd>Maximum height of <strong>dst</strong></dd>
</dl>
<p><strong>Description</strong></p>
<p>This function merges <strong>src</strong> clip rectangle(s) into <strong>dst</strong>. If <strong>src</strong> is NULL,
<strong>max_width</strong> and <strong>min_width</strong> is used to set a full <strong>dst</strong> clip rectangle.</p>
<p><strong>Return</strong></p>
<p>true if it&#8217;s a full clip, false otherwise</p>
<dl class="function">
<dt id="c.tinydrm_memcpy">
void <code class="descname">tinydrm_memcpy</code><span class="sig-paren">(</span>void *<em>&nbsp;dst</em>, void *<em>&nbsp;vaddr</em>, struct <a class="reference internal" href="drm-kms.html#c.drm_framebuffer" title="drm_framebuffer">drm_framebuffer</a> *<em>&nbsp;fb</em>, struct drm_clip_rect *<em>&nbsp;clip</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_memcpy" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy clip buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">dst</span></code></dt>
<dd>Destination buffer</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">vaddr</span></code></dt>
<dd>Source buffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_framebuffer</span> <span class="pre">*</span> <span class="pre">fb</span></code></dt>
<dd>DRM framebuffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_clip_rect</span> <span class="pre">*</span> <span class="pre">clip</span></code></dt>
<dd>Clip rectangle area to copy</dd>
</dl>
<dl class="function">
<dt id="c.tinydrm_swab16">
void <code class="descname">tinydrm_swab16</code><span class="sig-paren">(</span>u16 *<em>&nbsp;dst</em>, void *<em>&nbsp;vaddr</em>, struct <a class="reference internal" href="drm-kms.html#c.drm_framebuffer" title="drm_framebuffer">drm_framebuffer</a> *<em>&nbsp;fb</em>, struct drm_clip_rect *<em>&nbsp;clip</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_swab16" title="Permalink to this definition">¶</a></dt>
<dd><p>Swap bytes into clip buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">u16</span> <span class="pre">*</span> <span class="pre">dst</span></code></dt>
<dd>RGB565 destination buffer</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">vaddr</span></code></dt>
<dd>RGB565 source buffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_framebuffer</span> <span class="pre">*</span> <span class="pre">fb</span></code></dt>
<dd>DRM framebuffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_clip_rect</span> <span class="pre">*</span> <span class="pre">clip</span></code></dt>
<dd>Clip rectangle area to copy</dd>
</dl>
<dl class="function">
<dt id="c.tinydrm_xrgb8888_to_rgb565">
void <code class="descname">tinydrm_xrgb8888_to_rgb565</code><span class="sig-paren">(</span>u16 *<em>&nbsp;dst</em>, void *<em>&nbsp;vaddr</em>, struct <a class="reference internal" href="drm-kms.html#c.drm_framebuffer" title="drm_framebuffer">drm_framebuffer</a> *<em>&nbsp;fb</em>, struct drm_clip_rect *<em>&nbsp;clip</em>, bool<em>&nbsp;swap</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_xrgb8888_to_rgb565" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert XRGB8888 to RGB565 clip buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">u16</span> <span class="pre">*</span> <span class="pre">dst</span></code></dt>
<dd>RGB565 destination buffer</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">vaddr</span></code></dt>
<dd>XRGB8888 source buffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_framebuffer</span> <span class="pre">*</span> <span class="pre">fb</span></code></dt>
<dd>DRM framebuffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_clip_rect</span> <span class="pre">*</span> <span class="pre">clip</span></code></dt>
<dd>Clip rectangle area to copy</dd>
<dt><code class="docutils literal"><span class="pre">bool</span> <span class="pre">swap</span></code></dt>
<dd>Swap bytes</dd>
</dl>
<p><strong>Description</strong></p>
<p>Drivers can use this function for RGB565 devices that don&#8217;t natively
support XRGB8888.</p>
<dl class="function">
<dt id="c.tinydrm_of_find_backlight">
struct backlight_device * <code class="descname">tinydrm_of_find_backlight</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_of_find_backlight" title="Permalink to this definition">¶</a></dt>
<dd><p>Find backlight device in device-tree</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>Device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function looks for a DT node pointed to by a property named &#8216;backlight&#8217;
and uses <code class="xref c c-func docutils literal"><span class="pre">of_find_backlight_by_node()</span></code> to get the backlight device.
Additionally if the brightness property is zero, it is set to
max_brightness.</p>
<p><strong>Return</strong></p>
<p>NULL if there&#8217;s no backlight property.
Error pointer -EPROBE_DEFER if the DT node is found, but no backlight device
is found.
If the backlight device is found, a pointer to the structure is returned.</p>
<dl class="function">
<dt id="c.tinydrm_enable_backlight">
int <code class="descname">tinydrm_enable_backlight</code><span class="sig-paren">(</span>struct backlight_device *<em>&nbsp;backlight</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_enable_backlight" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable backlight helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*</span> <span class="pre">backlight</span></code></dt>
<dd>Backlight device</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.tinydrm_disable_backlight">
int <code class="descname">tinydrm_disable_backlight</code><span class="sig-paren">(</span>struct backlight_device *<em>&nbsp;backlight</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_disable_backlight" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable backlight helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*</span> <span class="pre">backlight</span></code></dt>
<dd>Backlight device</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.tinydrm_spi_max_transfer_size">
size_t <code class="descname">tinydrm_spi_max_transfer_size</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/spi.html#c.spi_device" title="spi_device">spi_device</a> *<em>&nbsp;spi</em>, size_t<em>&nbsp;max_len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_spi_max_transfer_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine max SPI transfer size</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_device</span> <span class="pre">*</span> <span class="pre">spi</span></code></dt>
<dd>SPI device</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">max_len</span></code></dt>
<dd>Maximum buffer size needed (optional)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns the maximum size to use for SPI transfers. It checks
the SPI master, the optional <strong>max_len</strong> and the module parameter spi_max and
returns the smallest.</p>
<p><strong>Return</strong></p>
<p>Maximum size for SPI transfers</p>
<dl class="function">
<dt id="c.tinydrm_spi_bpw_supported">
bool <code class="descname">tinydrm_spi_bpw_supported</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/spi.html#c.spi_device" title="spi_device">spi_device</a> *<em>&nbsp;spi</em>, u8<em>&nbsp;bpw</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_spi_bpw_supported" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if bits per word is supported</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_device</span> <span class="pre">*</span> <span class="pre">spi</span></code></dt>
<dd>SPI device</dd>
<dt><code class="docutils literal"><span class="pre">u8</span> <span class="pre">bpw</span></code></dt>
<dd>Bits per word</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function checks to see if the SPI master driver supports <strong>bpw</strong>.</p>
<p><strong>Return</strong></p>
<p>True if <strong>bpw</strong> is supported, false otherwise.</p>
<dl class="function">
<dt id="c.tinydrm_spi_transfer">
int <code class="descname">tinydrm_spi_transfer</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/spi.html#c.spi_device" title="spi_device">spi_device</a> *<em>&nbsp;spi</em>, u32<em>&nbsp;speed_hz</em>, struct <a class="reference internal" href="../driver-api/spi.html#c.spi_transfer" title="spi_transfer">spi_transfer</a> *<em>&nbsp;header</em>, u8<em>&nbsp;bpw</em>, const void *<em>&nbsp;buf</em>, size_t<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tinydrm_spi_transfer" title="Permalink to this definition">¶</a></dt>
<dd><p>SPI transfer helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_device</span> <span class="pre">*</span> <span class="pre">spi</span></code></dt>
<dd>SPI device</dd>
<dt><code class="docutils literal"><span class="pre">u32</span> <span class="pre">speed_hz</span></code></dt>
<dd>Override speed (optional)</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_transfer</span> <span class="pre">*</span> <span class="pre">header</span></code></dt>
<dd>Optional header transfer</dd>
<dt><code class="docutils literal"><span class="pre">u8</span> <span class="pre">bpw</span></code></dt>
<dd>Bits per word</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">void</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>Buffer to transfer</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">len</span></code></dt>
<dd>Buffer length</dd>
</dl>
<p><strong>Description</strong></p>
<p>This SPI transfer helper breaks up the transfer of <strong>buf</strong> into chunks which
the SPI master driver can handle. If the machine is Little Endian and the
SPI master driver doesn&#8217;t support 16 bits per word, it swaps the bytes and
does a 8-bit transfer.
If <strong>header</strong> is set, it is prepended to each SPI message.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
</div>
<div class="section" id="mipi-dbi-compatible-controllers">
<h2>MIPI DBI Compatible Controllers<a class="headerlink" href="#mipi-dbi-compatible-controllers" title="Permalink to this headline">¶</a></h2>
<p>This library provides helpers for MIPI Display Bus Interface (DBI)
compatible display controllers.</p>
<p>Many controllers for tiny lcd displays are MIPI compliant and can use this
library. If a controller uses registers 0x2A and 0x2B to set the area to
update and uses register 0x2C to write to frame memory, it is most likely
MIPI compliant.</p>
<p>Only MIPI Type 1 displays are supported since a full frame memory is needed.</p>
<p>There are 3 MIPI DBI implementation types:</p>
<ol class="upperalpha simple">
<li>Motorola 6800 type parallel bus</li>
<li>Intel 8080 type parallel bus</li>
<li>SPI type with 3 options:<ol class="arabic">
<li>9-bit with the Data/Command signal as the ninth bit</li>
<li>Same as above except it&#8217;s sent as 16 bits</li>
<li>8-bit with the Data/Command signal as a separate D/CX pin</li>
</ol>
</li>
</ol>
<p>Currently mipi_dbi only supports Type C options 1 and 3 with
<a class="reference internal" href="#c.mipi_dbi_spi_init" title="mipi_dbi_spi_init"><code class="xref c c-func docutils literal"><span class="pre">mipi_dbi_spi_init()</span></code></a>.</p>
<dl class="type">
<dt id="c.mipi_dbi">
struct <code class="descname">mipi_dbi</code><a class="headerlink" href="#c.mipi_dbi" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DBI controller</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>struct mipi_dbi {
  struct tinydrm_device tinydrm;
  struct spi_device * spi;
  bool enabled;
  struct mutex cmdlock;
  int (* command) (struct mipi_dbi *mipi, u8 cmd, u8 *param, size_t num);
  const u8 * read_commands;
  struct gpio_desc * dc;
  u16 * tx_buf;
  void * tx_buf9;
  size_t tx_buf9_len;
  bool swap_bytes;
  struct gpio_desc * reset;
  unsigned int rotation;
  struct backlight_device * backlight;
  struct regulator * regulator;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">tinydrm</span></code></dt>
<dd>tinydrm base</dd>
<dt><code class="docutils literal"><span class="pre">spi</span></code></dt>
<dd>SPI device</dd>
<dt><code class="docutils literal"><span class="pre">enabled</span></code></dt>
<dd>Pipeline is enabled</dd>
<dt><code class="docutils literal"><span class="pre">cmdlock</span></code></dt>
<dd>Command lock</dd>
<dt><code class="docutils literal"><span class="pre">command</span></code></dt>
<dd>Bus specific callback executing commands.</dd>
<dt><code class="docutils literal"><span class="pre">read_commands</span></code></dt>
<dd>Array of read commands terminated by a zero entry.
Reading is disabled if this is NULL.</dd>
<dt><code class="docutils literal"><span class="pre">dc</span></code></dt>
<dd>Optional D/C gpio.</dd>
<dt><code class="docutils literal"><span class="pre">tx_buf</span></code></dt>
<dd>Buffer used for transfer (copy clip rect area)</dd>
<dt><code class="docutils literal"><span class="pre">tx_buf9</span></code></dt>
<dd>Buffer used for Option 1 9-bit conversion</dd>
<dt><code class="docutils literal"><span class="pre">tx_buf9_len</span></code></dt>
<dd>Size of tx_buf9.</dd>
<dt><code class="docutils literal"><span class="pre">swap_bytes</span></code></dt>
<dd>Swap bytes in buffer before transfer</dd>
<dt><code class="docutils literal"><span class="pre">reset</span></code></dt>
<dd>Optional reset gpio</dd>
<dt><code class="docutils literal"><span class="pre">rotation</span></code></dt>
<dd>initial rotation in degrees Counter Clock Wise</dd>
<dt><code class="docutils literal"><span class="pre">backlight</span></code></dt>
<dd>backlight device (optional)</dd>
<dt><code class="docutils literal"><span class="pre">regulator</span></code></dt>
<dd>power regulator (optional)</dd>
</dl>
<dl class="function">
<dt id="c.mipi_dbi_command">
<code class="descname">mipi_dbi_command</code><span class="sig-paren">(</span><em>mipi</em>, <em>cmd</em>, <em>seq...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_command" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DCS command with optional parameter(s)</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">mipi</span></code></dt>
<dd>MIPI structure</dd>
<dt><code class="docutils literal"><span class="pre">cmd</span></code></dt>
<dd>Command</dd>
<dt><code class="docutils literal"><span class="pre">seq...</span></code></dt>
<dd>Optional parameter(s)</dd>
</dl>
<p><strong>Description</strong></p>
<p>Send MIPI DCS command to the controller. Use <a class="reference internal" href="#c.mipi_dbi_command_read" title="mipi_dbi_command_read"><code class="xref c c-func docutils literal"><span class="pre">mipi_dbi_command_read()</span></code></a> for
get/read.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.mipi_dbi_command_read">
int <code class="descname">mipi_dbi_command_read</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi">mipi_dbi</a> *<em>&nbsp;mipi</em>, u8<em>&nbsp;cmd</em>, u8 *<em>&nbsp;val</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_command_read" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DCS read command</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">mipi_dbi</span> <span class="pre">*</span> <span class="pre">mipi</span></code></dt>
<dd>MIPI structure</dd>
<dt><code class="docutils literal"><span class="pre">u8</span> <span class="pre">cmd</span></code></dt>
<dd>Command</dd>
<dt><code class="docutils literal"><span class="pre">u8</span> <span class="pre">*</span> <span class="pre">val</span></code></dt>
<dd>Value read</dd>
</dl>
<p><strong>Description</strong></p>
<p>Send MIPI DCS read command to the controller.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.mipi_dbi_command_buf">
int <code class="descname">mipi_dbi_command_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi">mipi_dbi</a> *<em>&nbsp;mipi</em>, u8<em>&nbsp;cmd</em>, u8 *<em>&nbsp;data</em>, size_t<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_command_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DCS command with parameter(s) in an array</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">mipi_dbi</span> <span class="pre">*</span> <span class="pre">mipi</span></code></dt>
<dd>MIPI structure</dd>
<dt><code class="docutils literal"><span class="pre">u8</span> <span class="pre">cmd</span></code></dt>
<dd>Command</dd>
<dt><code class="docutils literal"><span class="pre">u8</span> <span class="pre">*</span> <span class="pre">data</span></code></dt>
<dd>Parameter buffer</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">len</span></code></dt>
<dd>Buffer length</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.mipi_dbi_pipe_enable">
void <code class="descname">mipi_dbi_pipe_enable</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe" title="drm_simple_display_pipe">drm_simple_display_pipe</a> *<em>&nbsp;pipe</em>, struct <a class="reference internal" href="drm-kms.html#c.drm_crtc_state" title="drm_crtc_state">drm_crtc_state</a> *<em>&nbsp;crtc_state</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_pipe_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DBI pipe enable helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_simple_display_pipe</span> <span class="pre">*</span> <span class="pre">pipe</span></code></dt>
<dd>Display pipe</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_crtc_state</span> <span class="pre">*</span> <span class="pre">crtc_state</span></code></dt>
<dd>CRTC state</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function enables backlight. Drivers can use this as their
<a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs"><code class="xref c c-type docutils literal"><span class="pre">drm_simple_display_pipe_funcs-&gt;enable</span></code></a> callback.</p>
<dl class="function">
<dt id="c.mipi_dbi_pipe_disable">
void <code class="descname">mipi_dbi_pipe_disable</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe" title="drm_simple_display_pipe">drm_simple_display_pipe</a> *<em>&nbsp;pipe</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_pipe_disable" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DBI pipe disable helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_simple_display_pipe</span> <span class="pre">*</span> <span class="pre">pipe</span></code></dt>
<dd>Display pipe</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function disables backlight if present or if not the
display memory is blanked. Drivers can use this as their
<a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs"><code class="xref c c-type docutils literal"><span class="pre">drm_simple_display_pipe_funcs-&gt;disable</span></code></a> callback.</p>
<dl class="function">
<dt id="c.mipi_dbi_init">
int <code class="descname">mipi_dbi_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, struct <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi">mipi_dbi</a> *<em>&nbsp;mipi</em>, const struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs">drm_simple_display_pipe_funcs</a> *<em>&nbsp;pipe_funcs</em>, struct <a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver">drm_driver</a> *<em>&nbsp;driver</em>, const struct <a class="reference internal" href="drm-kms.html#c.drm_display_mode" title="drm_display_mode">drm_display_mode</a> *<em>&nbsp;mode</em>, unsigned int<em>&nbsp;rotation</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_init" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI DBI initialization</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>Parent device</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">mipi_dbi</span> <span class="pre">*</span> <span class="pre">mipi</span></code></dt>
<dd><a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi"><code class="xref c c-type docutils literal"><span class="pre">mipi_dbi</span></code></a> structure to initialize</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_simple_display_pipe_funcs</span> <span class="pre">*</span> <span class="pre">pipe_funcs</span></code></dt>
<dd>Display pipe functions</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_driver</span> <span class="pre">*</span> <span class="pre">driver</span></code></dt>
<dd>DRM driver</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_display_mode</span> <span class="pre">*</span> <span class="pre">mode</span></code></dt>
<dd>Display mode</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">rotation</span></code></dt>
<dd>Initial rotation in degrees Counter Clock Wise</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function initializes a <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi"><code class="xref c c-type docutils literal"><span class="pre">mipi_dbi</span></code></a> structure and it&#8217;s underlying
<strong>tinydrm_device</strong>. It also sets up the display pipeline.</p>
<p>Supported formats: Native RGB565 and emulated XRGB8888.</p>
<p>Objects created by this function will be automatically freed on driver
detach (devres).</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.mipi_dbi_hw_reset">
void <code class="descname">mipi_dbi_hw_reset</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi">mipi_dbi</a> *<em>&nbsp;mipi</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_hw_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Hardware reset of controller</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">mipi_dbi</span> <span class="pre">*</span> <span class="pre">mipi</span></code></dt>
<dd>MIPI DBI structure</dd>
</dl>
<p><strong>Description</strong></p>
<p>Reset controller if the <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi"><code class="xref c c-type docutils literal"><span class="pre">mipi_dbi-&gt;reset</span></code></a> gpio is set.</p>
<dl class="function">
<dt id="c.mipi_dbi_display_is_on">
bool <code class="descname">mipi_dbi_display_is_on</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi">mipi_dbi</a> *<em>&nbsp;mipi</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_display_is_on" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if display is on</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">mipi_dbi</span> <span class="pre">*</span> <span class="pre">mipi</span></code></dt>
<dd>MIPI DBI structure</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function checks the Power Mode register (if readable) to see if
display output is turned on. This can be used to see if the bootloader
has already turned on the display avoiding flicker when the pipeline is
enabled.</p>
<p><strong>Return</strong></p>
<p>true if the display can be verified to be on, false otherwise.</p>
<dl class="function">
<dt id="c.mipi_dbi_spi_init">
int <code class="descname">mipi_dbi_spi_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/spi.html#c.spi_device" title="spi_device">spi_device</a> *<em>&nbsp;spi</em>, struct <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi">mipi_dbi</a> *<em>&nbsp;mipi</em>, struct gpio_desc *<em>&nbsp;dc</em>, const struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_simple_display_pipe_funcs" title="drm_simple_display_pipe_funcs">drm_simple_display_pipe_funcs</a> *<em>&nbsp;pipe_funcs</em>, struct <a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver">drm_driver</a> *<em>&nbsp;driver</em>, const struct <a class="reference internal" href="drm-kms.html#c.drm_display_mode" title="drm_display_mode">drm_display_mode</a> *<em>&nbsp;mode</em>, unsigned int<em>&nbsp;rotation</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_spi_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize MIPI DBI SPI interfaced controller</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">spi_device</span> <span class="pre">*</span> <span class="pre">spi</span></code></dt>
<dd>SPI device</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">mipi_dbi</span> <span class="pre">*</span> <span class="pre">mipi</span></code></dt>
<dd><a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi"><code class="xref c c-type docutils literal"><span class="pre">mipi_dbi</span></code></a> structure to initialize</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gpio_desc</span> <span class="pre">*</span> <span class="pre">dc</span></code></dt>
<dd>D/C gpio (optional)</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_simple_display_pipe_funcs</span> <span class="pre">*</span> <span class="pre">pipe_funcs</span></code></dt>
<dd>Display pipe functions</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_driver</span> <span class="pre">*</span> <span class="pre">driver</span></code></dt>
<dd>DRM driver</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_display_mode</span> <span class="pre">*</span> <span class="pre">mode</span></code></dt>
<dd>Display mode</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">rotation</span></code></dt>
<dd>Initial rotation in degrees Counter Clock Wise</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function sets <a class="reference internal" href="#c.mipi_dbi" title="mipi_dbi"><code class="xref c c-type docutils literal"><span class="pre">mipi_dbi-&gt;command</span></code></a>, enables <code class="xref c c-type docutils literal"><span class="pre">mipi-&gt;read_commands</span></code> for the
usual read commands and initializes <strong>mipi</strong> using <a class="reference internal" href="#c.mipi_dbi_init" title="mipi_dbi_init"><code class="xref c c-func docutils literal"><span class="pre">mipi_dbi_init()</span></code></a>.</p>
<p>If <strong>dc</strong> is set, a Type C Option 3 interface is assumed, if not
Type C Option 1.</p>
<p>If the SPI master driver doesn&#8217;t support the necessary bits per word,
the following transformation is used:</p>
<ul class="simple">
<li>9-bit: reorder buffer as 9x 8-bit words, padded with no-op command.</li>
<li>16-bit: if big endian send as 8-bit, if little endian swap bytes</li>
</ul>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
<dl class="function">
<dt id="c.mipi_dbi_debugfs_init">
int <code class="descname">mipi_dbi_debugfs_init</code><span class="sig-paren">(</span>struct drm_minor *<em>&nbsp;minor</em><span class="sig-paren">)</span><a class="headerlink" href="#c.mipi_dbi_debugfs_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Create debugfs entries</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">drm_minor</span> <span class="pre">*</span> <span class="pre">minor</span></code></dt>
<dd>DRM minor</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function creates a &#8216;command&#8217; debugfs file for sending commands to the
controller or getting the read command values.
Drivers can use this as their <a class="reference internal" href="drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal"><span class="pre">drm_driver-&gt;debugfs_init</span></code></a> callback.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code on failure.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vga-switcheroo.html" class="btn btn-neutral float-right" title="VGA Switcheroo" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="i915.html" class="btn btn-neutral" title="drm/i915 Intel GFX Driver" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.11.0-rc3+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>