

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Secure Encrypted Virtualization (SEV) &mdash; The Linux Kernel 5.12.0-rc3+ documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="KVM CPUID bits" href="cpuid.html" />
    <link rel="prev" title="The Definitive KVM (Kernel-based Virtual Machine) API Documentation" href="api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.12.0-rc3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Virtualization Support</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">KVM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api.html">The Definitive KVM (Kernel-based Virtual Machine) API Documentation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Secure Encrypted Virtualization (SEV)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sev-key-management">SEV Key Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cpuid.html">KVM CPUID bits</a></li>
<li class="toctree-l3"><a class="reference internal" href="halt-polling.html">The KVM halt polling system</a></li>
<li class="toctree-l3"><a class="reference internal" href="hypercalls.html">Linux KVM Hypercall</a></li>
<li class="toctree-l3"><a class="reference internal" href="locking.html">KVM Lock Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmu.html">The x86 kvm shadow mmu</a></li>
<li class="toctree-l3"><a class="reference internal" href="msr.html">KVM-specific MSRs</a></li>
<li class="toctree-l3"><a class="reference internal" href="nested-vmx.html">Nested VMX</a></li>
<li class="toctree-l3"><a class="reference internal" href="ppc-pv.html">The PPC KVM paravirtual interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-diag.html">The s390 DIAGNOSE call on KVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-pv.html">s390 (IBM Z) Ultravisor and Protected VMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-pv-boot.html">s390 (IBM Z) Boot/IPL of Protected VMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="timekeeping.html">Timekeeping Virtualization for X86-Based Architectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="vcpu-requests.html">KVM VCPU Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="review-checklist.html">Review checklist for kvm patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="arm/index.html">ARM</a></li>
<li class="toctree-l3"><a class="reference internal" href="devices/index.html">Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="running-nested-guests.html">Running nested guests with KVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../uml/user_mode_linux_howto_v2.html">UML HowTo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paravirt_ops.html">Paravirt_ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guest-halt-polling.html">Guest halt polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ne_overview.html">Nitro Enclaves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acrn/index.html">ACRN Hypervisor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/index.html">Nios II Specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Linux Virtualization Support</a> &raquo;</li>
        
          <li><a href="index.html">KVM</a> &raquo;</li>
        
      <li>Secure Encrypted Virtualization (SEV)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/virt/kvm/amd-memory-encryption.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="secure-encrypted-virtualization-sev">
<h1>Secure Encrypted Virtualization (SEV)<a class="headerlink" href="#secure-encrypted-virtualization-sev" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Secure Encrypted Virtualization (SEV) is a feature found on AMD processors.</p>
<p>SEV is an extension to the AMD-V architecture which supports running
virtual machines (VMs) under the control of a hypervisor. When enabled,
the memory contents of a VM will be transparently encrypted with a key
unique to that VM.</p>
<p>The hypervisor can determine the SEV support through the CPUID
instruction. The CPUID function 0x8000001f reports information related
to SEV:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x8000001f[eax]:
                Bit[1]  indicates support for SEV
    ...
          [ecx]:
                Bits[31:0]  Number of encrypted guests supported simultaneously
</pre></div>
</div>
<p>If support for SEV is present, MSR 0xc001_0010 (MSR_K8_SYSCFG) and MSR 0xc001_0015
(MSR_K7_HWCR) can be used to determine if it can be enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xc001_0010:
        Bit[23]    1 = memory encryption can be enabled
                   0 = memory encryption can not be enabled

0xc001_0015:
        Bit[0]     1 = memory encryption can be enabled
                   0 = memory encryption can not be enabled
</pre></div>
</div>
<p>When SEV support is available, it can be enabled in a specific VM by
setting the SEV bit before executing VMRUN.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>VMCB[0x90]:
        Bit[1]      1 = SEV is enabled
                    0 = SEV is disabled
</pre></div>
</div>
<p>SEV hardware uses ASIDs to associate a memory encryption key with a VM.
Hence, the ASID for the SEV-enabled guests must be from 1 to a maximum value
defined in the CPUID 0x8000001f[ecx] field.</p>
</div>
<div class="section" id="sev-key-management">
<h2>SEV Key Management<a class="headerlink" href="#sev-key-management" title="Permalink to this headline">¶</a></h2>
<p>The SEV guest key management is handled by a separate processor called the AMD
Secure Processor (AMD-SP). Firmware running inside the AMD-SP provides a secure
key management interface to perform common hypervisor activities such as
encrypting bootstrap code, snapshot, migrating and debugging the guest. For more
information, see the SEV Key Management spec <a class="reference internal" href="#api-spec" id="id1"><span>[api-spec]</span></a></p>
<p>The main ioctl to access SEV is KVM_MEMORY_ENCRYPT_OP.  If the argument
to KVM_MEMORY_ENCRYPT_OP is NULL, the ioctl returns 0 if SEV is enabled
and <code class="docutils literal notranslate"><span class="pre">ENOTTY`</span> <span class="pre">if</span> <span class="pre">it</span> <span class="pre">is</span> <span class="pre">disabled</span> <span class="pre">(on</span> <span class="pre">some</span> <span class="pre">older</span> <span class="pre">versions</span> <span class="pre">of</span> <span class="pre">Linux,</span>
<span class="pre">the</span> <span class="pre">ioctl</span> <span class="pre">runs</span> <span class="pre">normally</span> <span class="pre">even</span> <span class="pre">with</span> <span class="pre">a</span> <span class="pre">NULL</span> <span class="pre">argument,</span> <span class="pre">and</span> <span class="pre">therefore</span> <span class="pre">will</span>
<span class="pre">likely</span> <span class="pre">return</span> <span class="pre">``EFAULT</span></code>).  If non-NULL, the argument to KVM_MEMORY_ENCRYPT_OP
must be a struct kvm_sev_cmd:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_cmd {
        __u32 id;
        __u64 data;
        __u32 error;
        __u32 sev_fd;
};
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> field contains the subcommand, and the <code class="docutils literal notranslate"><span class="pre">data</span></code> field points to
another struct containing arguments specific to command.  The <code class="docutils literal notranslate"><span class="pre">sev_fd</span></code>
should point to a file descriptor that is opened on the <code class="docutils literal notranslate"><span class="pre">/dev/sev</span></code>
device, if needed (see individual commands).</p>
<p>On output, <code class="docutils literal notranslate"><span class="pre">error</span></code> is zero on success, or an error code.  Error codes
are defined in <code class="docutils literal notranslate"><span class="pre">&lt;linux/psp-dev.h&gt;</span></code>.</p>
<p>KVM implements the following commands to support common lifecycle events of SEV
guests, such as launching, running, snapshotting, migrating and decommissioning.</p>
<div class="section" id="kvm-sev-init">
<h3>1. KVM_SEV_INIT<a class="headerlink" href="#kvm-sev-init" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_INIT command is used by the hypervisor to initialize the SEV platform
context. In a typical workflow, this command should be the first command issued.</p>
<p>Returns: 0 on success, -negative on error</p>
</div>
<div class="section" id="kvm-sev-launch-start">
<h3>2. KVM_SEV_LAUNCH_START<a class="headerlink" href="#kvm-sev-launch-start" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_LAUNCH_START command is used for creating the memory encryption
context. To create the encryption context, user must provide a guest policy,
the owner’s public Diffie-Hellman (PDH) key and session information.</p>
<p>Parameters: struct  kvm_sev_launch_start (in/out)</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_launch_start {
        __u32 handle;           /* if zero then firmware creates a new handle */
        __u32 policy;           /* guest&#39;s policy */

        __u64 dh_uaddr;         /* userspace address pointing to the guest owner&#39;s PDH key */
        __u32 dh_len;

        __u64 session_addr;     /* userspace address which points to the guest session information */
        __u32 session_len;
};
</pre></div>
</div>
<p>On success, the ‘handle’ field contains a new handle and on error, a negative value.</p>
<p>KVM_SEV_LAUNCH_START requires the <code class="docutils literal notranslate"><span class="pre">sev_fd</span></code> field to be valid.</p>
<p>For more details, see SEV spec Section 6.2.</p>
</div>
<div class="section" id="kvm-sev-launch-update-data">
<h3>3. KVM_SEV_LAUNCH_UPDATE_DATA<a class="headerlink" href="#kvm-sev-launch-update-data" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_LAUNCH_UPDATE_DATA is used for encrypting a memory region. It also
calculates a measurement of the memory contents. The measurement is a signature
of the memory contents that can be sent to the guest owner as an attestation
that the memory was encrypted correctly by the firmware.</p>
<p>Parameters (in): struct  kvm_sev_launch_update_data</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_launch_update {
        __u64 uaddr;    /* userspace address to be encrypted (must be 16-byte aligned) */
        __u32 len;      /* length of the data to be encrypted (must be 16-byte aligned) */
};
</pre></div>
</div>
<p>For more details, see SEV spec Section 6.3.</p>
</div>
<div class="section" id="kvm-sev-launch-measure">
<h3>4. KVM_SEV_LAUNCH_MEASURE<a class="headerlink" href="#kvm-sev-launch-measure" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_LAUNCH_MEASURE command is used to retrieve the measurement of the
data encrypted by the KVM_SEV_LAUNCH_UPDATE_DATA command. The guest owner may
wait to provide the guest with confidential information until it can verify the
measurement. Since the guest owner knows the initial contents of the guest at
boot, the measurement can be verified by comparing it to what the guest owner
expects.</p>
<p>Parameters (in): struct  kvm_sev_launch_measure</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_launch_measure {
        __u64 uaddr;    /* where to copy the measurement */
        __u32 len;      /* length of measurement blob */
};
</pre></div>
</div>
<p>For more details on the measurement verification flow, see SEV spec Section 6.4.</p>
</div>
<div class="section" id="kvm-sev-launch-finish">
<h3>5. KVM_SEV_LAUNCH_FINISH<a class="headerlink" href="#kvm-sev-launch-finish" title="Permalink to this headline">¶</a></h3>
<p>After completion of the launch flow, the KVM_SEV_LAUNCH_FINISH command can be
issued to make the guest ready for the execution.</p>
<p>Returns: 0 on success, -negative on error</p>
</div>
<div class="section" id="kvm-sev-guest-status">
<h3>6. KVM_SEV_GUEST_STATUS<a class="headerlink" href="#kvm-sev-guest-status" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_GUEST_STATUS command is used to retrieve status information about a
SEV-enabled guest.</p>
<p>Parameters (out): struct kvm_sev_guest_status</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_guest_status {
        __u32 handle;   /* guest handle */
        __u32 policy;   /* guest policy */
        __u8 state;     /* guest state (see enum below) */
};
</pre></div>
</div>
<p>SEV guest state:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>enum {
SEV_STATE_INVALID = 0;
SEV_STATE_LAUNCHING,    /* guest is currently being launched */
SEV_STATE_SECRET,       /* guest is being launched and ready to accept the ciphertext data */
SEV_STATE_RUNNING,      /* guest is fully launched and running */
SEV_STATE_RECEIVING,    /* guest is being migrated in from another SEV machine */
SEV_STATE_SENDING       /* guest is getting migrated out to another SEV machine */
};
</pre></div>
</div>
</div>
<div class="section" id="kvm-sev-dbg-decrypt">
<h3>7. KVM_SEV_DBG_DECRYPT<a class="headerlink" href="#kvm-sev-dbg-decrypt" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_DEBUG_DECRYPT command can be used by the hypervisor to request the
firmware to decrypt the data at the given memory region.</p>
<p>Parameters (in): struct kvm_sev_dbg</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_dbg {
        __u64 src_uaddr;        /* userspace address of data to decrypt */
        __u64 dst_uaddr;        /* userspace address of destination */
        __u32 len;              /* length of memory region to decrypt */
};
</pre></div>
</div>
<p>The command returns an error if the guest policy does not allow debugging.</p>
</div>
<div class="section" id="kvm-sev-dbg-encrypt">
<h3>8. KVM_SEV_DBG_ENCRYPT<a class="headerlink" href="#kvm-sev-dbg-encrypt" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_DEBUG_ENCRYPT command can be used by the hypervisor to request the
firmware to encrypt the data at the given memory region.</p>
<p>Parameters (in): struct kvm_sev_dbg</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_dbg {
        __u64 src_uaddr;        /* userspace address of data to encrypt */
        __u64 dst_uaddr;        /* userspace address of destination */
        __u32 len;              /* length of memory region to encrypt */
};
</pre></div>
</div>
<p>The command returns an error if the guest policy does not allow debugging.</p>
</div>
<div class="section" id="kvm-sev-launch-secret">
<h3>9. KVM_SEV_LAUNCH_SECRET<a class="headerlink" href="#kvm-sev-launch-secret" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_LAUNCH_SECRET command can be used by the hypervisor to inject secret
data after the measurement has been validated by the guest owner.</p>
<p>Parameters (in): struct kvm_sev_launch_secret</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_launch_secret {
        __u64 hdr_uaddr;        /* userspace address containing the packet header */
        __u32 hdr_len;

        __u64 guest_uaddr;      /* the guest memory region where the secret should be injected */
        __u32 guest_len;

        __u64 trans_uaddr;      /* the hypervisor memory region which contains the secret */
        __u32 trans_len;
};
</pre></div>
</div>
</div>
<div class="section" id="kvm-sev-get-attestation-report">
<h3>10. KVM_SEV_GET_ATTESTATION_REPORT<a class="headerlink" href="#kvm-sev-get-attestation-report" title="Permalink to this headline">¶</a></h3>
<p>The KVM_SEV_GET_ATTESTATION_REPORT command can be used by the hypervisor to query the attestation
report containing the SHA-256 digest of the guest memory and VMSA passed through the KVM_SEV_LAUNCH
commands and signed with the PEK. The digest returned by the command should match the digest
used by the guest owner with the KVM_SEV_LAUNCH_MEASURE.</p>
<p>Parameters (in): struct kvm_sev_attestation</p>
<p>Returns: 0 on success, -negative on error</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_sev_attestation_report {
        __u8 mnonce[16];        /* A random mnonce that will be placed in the report */

        __u64 uaddr;            /* userspace address where the report should be copied */
        __u32 len;
};
</pre></div>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="#white-paper" id="id2"><span>[white-paper]</span></a>, <a class="reference internal" href="#api-spec" id="id3"><span>[api-spec]</span></a>, <a class="reference internal" href="#amd-apm" id="id4"><span>[amd-apm]</span></a> and <a class="reference internal" href="#kvm-forum" id="id5"><span>[kvm-forum]</span></a> for more info.</p>
<dl class="citation">
<dt class="label" id="white-paper"><span class="brackets"><a class="fn-backref" href="#id2">white-paper</a></span></dt>
<dd><p><a class="reference external" href="http://amd-dev.wpengine.netdna-cdn.com/wordpress/media/2013/12/AMD_Memory_Encryption_Whitepaper_v7-Public.pdf">http://amd-dev.wpengine.netdna-cdn.com/wordpress/media/2013/12/AMD_Memory_Encryption_Whitepaper_v7-Public.pdf</a></p>
</dd>
<dt class="label" id="api-spec"><span class="brackets">api-spec</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://support.amd.com/TechDocs/55766_SEV-KM_API_Specification.pdf">https://support.amd.com/TechDocs/55766_SEV-KM_API_Specification.pdf</a></p>
</dd>
<dt class="label" id="amd-apm"><span class="brackets"><a class="fn-backref" href="#id4">amd-apm</a></span></dt>
<dd><p><a class="reference external" href="https://support.amd.com/TechDocs/24593.pdf">https://support.amd.com/TechDocs/24593.pdf</a> (section 15.34)</p>
</dd>
<dt class="label" id="kvm-forum"><span class="brackets"><a class="fn-backref" href="#id5">kvm-forum</a></span></dt>
<dd><p><a class="reference external" href="https://www.linux-kvm.org/images/7/74/02x08A-Thomas_Lendacky-AMDs_Virtualizatoin_Memory_Encryption_Technology.pdf">https://www.linux-kvm.org/images/7/74/02x08A-Thomas_Lendacky-AMDs_Virtualizatoin_Memory_Encryption_Technology.pdf</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="cpuid.html" class="btn btn-neutral float-right" title="KVM CPUID bits" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="api.html" class="btn btn-neutral float-left" title="The Definitive KVM (Kernel-based Virtual Machine) API Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright The kernel development community.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>