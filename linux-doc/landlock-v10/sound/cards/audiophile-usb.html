

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Guide to using M-Audio Audiophile USB with ALSA and Jack &mdash; The Linux Kernel 5.2.0+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Alsa driver for Digigram miXart8 and miXart8AES/EBU soundcards" href="mixart.html" />
    <link rel="prev" title="VIA82xx mixer" href="via82xx-mixer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Sound Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../kernel-api/index.html">ALSA Kernel API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../designs/index.html">Designs and Implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../soc/index.html">ALSA SoC Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alsa-configuration.html">Advanced Linux Sound Architecture - Driver Configuration guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hd-audio/index.html">HD-Audio</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Card-Specific Information</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="joystick.html">Analog Joystick Support on ALSA Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmipci.html">Brief Notes on C-Media 8338/8738/8768/8770 Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sb-live-mixer.html">Sound Blaster Live mixer / default DSP code</a></li>
<li class="toctree-l3"><a class="reference internal" href="audigy-mixer.html">Sound Blaster Audigy mixer / default DSP code</a></li>
<li class="toctree-l3"><a class="reference internal" href="emu10k1-jack.html">Low latency, multichannel audio with JACK and the emu10k1/emu10k2</a></li>
<li class="toctree-l3"><a class="reference internal" href="via82xx-mixer.html">VIA82xx mixer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Guide to using M-Audio Audiophile USB with ALSA and Jack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#history">History</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audiophile-usb-specs-and-correct-usage">Audiophile USB Specs and correct usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audiophile-usb-midi-support-in-alsa">Audiophile USB MIDI support in ALSA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audiophile-usb-audio-support-in-alsa">Audiophile USB Audio support in ALSA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audiophile-usb-and-jack-support">Audiophile USB and Jack support</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mixart.html">Alsa driver for Digigram miXart8 and miXart8AES/EBU soundcards</a></li>
<li class="toctree-l3"><a class="reference internal" href="bt87x.html">ALSA BT87x Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="maya44.html">Notes on Maya44 USB Audio Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="hdspm.html">Software Interface ALSA-DSP MADI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="serial-u16550.html">Serial UART 16450/16550 MIDI driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="img-spdif-in.html">Imagination Technologies SPDIF Input Controllers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Sound Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Card-Specific Information</a> &raquo;</li>
        
      <li>Guide to using M-Audio Audiophile USB with ALSA and Jack</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/sound/cards/audiophile-usb.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="guide-to-using-m-audio-audiophile-usb-with-alsa-and-jack">
<h1>Guide to using M-Audio Audiophile USB with ALSA and Jack<a class="headerlink" href="#guide-to-using-m-audio-audiophile-usb-with-alsa-and-jack" title="Permalink to this headline">¶</a></h1>
<p>v1.5</p>
<p>Thibault Le Meur &lt;<a class="reference external" href="mailto:Thibault&#46;LeMeur&#37;&#52;&#48;supelec&#46;fr">Thibault<span>&#46;</span>LeMeur<span>&#64;</span>supelec<span>&#46;</span>fr</a>&gt;</p>
<p>This document is a guide to using the M-Audio Audiophile USB (tm) device with
ALSA and JACK.</p>
<div class="section" id="history">
<h2>History<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>v1.4 - Thibault Le Meur (2007-07-11)<ul>
<li>Added Low Endianness nature of 16bits-modes
found by Hakan Lennestal &lt;<a class="reference external" href="mailto:Hakan&#46;Lennestal&#37;&#52;&#48;brfsodrahamn&#46;se">Hakan<span>&#46;</span>Lennestal<span>&#64;</span>brfsodrahamn<span>&#46;</span>se</a>&gt;</li>
<li>Modifying document structure</li>
</ul>
</li>
<li>v1.5 - Thibault Le Meur (2007-07-12)
- Added AC3/DTS passthru info</li>
</ul>
</div>
<div class="section" id="audiophile-usb-specs-and-correct-usage">
<h2>Audiophile USB Specs and correct usage<a class="headerlink" href="#audiophile-usb-specs-and-correct-usage" title="Permalink to this headline">¶</a></h2>
<p>This part is a reminder of important facts about the functions and limitations
of the device.</p>
<p>The device has 4 audio interfaces, and 2 MIDI ports:</p>
<blockquote>
<div><ul class="simple">
<li>Analog Stereo Input (Ai)<ul>
<li>This port supports 2 pairs of line-level audio inputs (1/4” TS and RCA)</li>
<li>When the 1/4” TS (jack) connectors are connected, the RCA connectors
are disabled</li>
</ul>
</li>
<li>Analog Stereo Output (Ao)</li>
<li>Digital Stereo Input (Di)</li>
<li>Digital Stereo Output (Do)</li>
<li>Midi In (Mi)</li>
<li>Midi Out (Mo)</li>
</ul>
</div></blockquote>
<p>The internal DAC/ADC has the following characteristics:</p>
<ul class="simple">
<li>sample depth of 16 or 24 bits</li>
<li>sample rate from 8kHz to 96kHz</li>
<li>Two interfaces can’t use different sample depths at the same time.</li>
</ul>
<dl class="docutils">
<dt>Moreover, the Audiophile USB documentation gives the following Warning:</dt>
<dd>Please exit any audio application running before switching between bit depths</dd>
</dl>
<p>Due to the USB 1.1 bandwidth limitation, a limited number of interfaces can be
activated at the same time depending on the audio mode selected:</p>
<blockquote>
<div><ul class="simple">
<li>16-bit/48kHz ==&gt; 4 channels in + 4 channels out<ul>
<li>Ai+Ao+Di+Do</li>
</ul>
</li>
<li>24-bit/48kHz ==&gt; 4 channels in + 2 channels out,
or 2 channels in + 4 channels out<ul>
<li>Ai+Ao+Do or Ai+Di+Ao or Ai+Di+Do or Di+Ao+Do</li>
</ul>
</li>
<li>24-bit/96kHz ==&gt; 2 channels in _or_ 2 channels out (half duplex only)<ul>
<li>Ai or Ao or Di or Do</li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="section" id="important-facts-about-the-digital-interface">
<h3>Important facts about the Digital interface:<a class="headerlink" href="#important-facts-about-the-digital-interface" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>The Do port additionally supports surround-encoded AC-3 and DTS passthrough,
though I haven’t tested it under Linux<ul>
<li>Note that in this setup only the Do interface can be enabled</li>
</ul>
</li>
<li>Apart from recording an audio digital stream, enabling the Di port is a way
to synchronize the device to an external sample clock<ul>
<li>As a consequence, the Di port must be enable only if an active Digital
source is connected</li>
<li>Enabling Di when no digital source is connected can result in a
synchronization error (for instance sound played at an odd sample rate)</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="audiophile-usb-midi-support-in-alsa">
<h2>Audiophile USB MIDI support in ALSA<a class="headerlink" href="#audiophile-usb-midi-support-in-alsa" title="Permalink to this headline">¶</a></h2>
<p>The Audiophile USB MIDI ports will be automatically supported once the
following modules have been loaded:</p>
<blockquote>
<div><ul class="simple">
<li>snd-usb-audio</li>
<li>snd-seq-midi</li>
</ul>
</div></blockquote>
<p>No additional setting is required.</p>
</div>
<div class="section" id="audiophile-usb-audio-support-in-alsa">
<h2>Audiophile USB Audio support in ALSA<a class="headerlink" href="#audiophile-usb-audio-support-in-alsa" title="Permalink to this headline">¶</a></h2>
<p>Audio functions of the Audiophile USB device are handled by the snd-usb-audio
module. This module can work in a default mode (without any device-specific
parameter), or in an “advanced” mode with the device-specific parameter called
<code class="docutils literal notranslate"><span class="pre">device_setup</span></code>.</p>
<div class="section" id="default-alsa-driver-mode">
<h3>Default Alsa driver mode<a class="headerlink" href="#default-alsa-driver-mode" title="Permalink to this headline">¶</a></h3>
<p>The default behavior of the snd-usb-audio driver is to list the device
capabilities at startup and activate the required mode when required
by the applications: for instance if the user is recording in a
24bit-depth-mode and immediately after wants to switch to a 16bit-depth mode,
the snd-usb-audio module will reconfigure the device on the fly.</p>
<p>This approach has the advantage to let the driver automatically switch from sample
rates/depths automatically according to the user’s needs. However, those who
are using the device under windows know that this is not how the device is meant to
work: under windows applications must be closed before using the m-audio control
panel to switch the device working mode. Thus as we’ll see in next section, this
Default Alsa driver mode can lead to device misconfigurations.</p>
<p>Let’s get back to the Default Alsa driver mode for now.  In this case the
Audiophile interfaces are mapped to alsa pcm devices in the following
way (I suppose the device’s index is 1):</p>
<blockquote>
<div><ul class="simple">
<li>hw:1,0 is Ao in playback and Di in capture</li>
<li>hw:1,1 is Do in playback and Ai in capture</li>
<li>hw:1,2 is Do in AC3/DTS passthrough mode</li>
</ul>
</div></blockquote>
<p>In this mode, the device uses Big Endian byte-encoding so that
supported audio format are S16_BE for 16-bit depth modes and S24_3BE for
24-bits depth mode.</p>
<p>One exception is the hw:1,2 port which was reported to be Little Endian
compliant (supposedly supporting S16_LE) but processes in fact only S16_BE streams.
This has been fixed in kernel 2.6.23 and above and now the hw:1,2 interface
is reported to be big endian in this default driver mode.</p>
<p>Examples:</p>
<blockquote>
<div><ul>
<li><p class="first">playing a S24_3BE encoded raw file to the Ao port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% aplay -D hw:1,0 -c2 -t raw -r48000 -fS24_3BE test.raw
</pre></div>
</div>
</li>
<li><p class="first">recording a  S24_3BE encoded raw file from the Ai port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% arecord -D hw:1,1 -c2  -t raw -r48000 -fS24_3BE test.raw
</pre></div>
</div>
</li>
<li><p class="first">playing a S16_BE encoded raw file to the Do port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% aplay -D hw:1,1 -c2 -t raw -r48000 -fS16_BE test.raw
</pre></div>
</div>
</li>
<li><p class="first">playing an ac3 sample file to the Do port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% aplay -D hw:1,2 --channels=6 ac3_S16_BE_encoded_file.raw
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>If you’re happy with the default Alsa driver mode and don’t experience any
issue with this mode, then you can skip the following chapter.</p>
</div>
<div class="section" id="advanced-module-setup">
<h3>Advanced module setup<a class="headerlink" href="#advanced-module-setup" title="Permalink to this headline">¶</a></h3>
<p>Due to the hardware constraints described above, the device initialization made
by the Alsa driver in default mode may result in a corrupted state of the
device. For instance, a particularly annoying issue is that the sound captured
from the Ai interface sounds distorted (as if boosted with an excessive high
volume gain).</p>
<p>For people having this problem, the snd-usb-audio module has a new module
parameter called <code class="docutils literal notranslate"><span class="pre">device_setup</span></code> (this parameter was introduced in kernel
release 2.6.17)</p>
<div class="section" id="initializing-the-working-mode-of-the-audiophile-usb">
<h4>Initializing the working mode of the Audiophile USB<a class="headerlink" href="#initializing-the-working-mode-of-the-audiophile-usb" title="Permalink to this headline">¶</a></h4>
<p>As far as the Audiophile USB device is concerned, this value let the user
specify:</p>
<blockquote>
<div><ul class="simple">
<li>the sample depth</li>
<li>the sample rate</li>
<li>whether the Di port is used or not</li>
</ul>
</div></blockquote>
<p>When initialized with <code class="docutils literal notranslate"><span class="pre">device_setup=0x00</span></code>, the snd-usb-audio module has
the same behaviour as when the parameter is omitted (see paragraph “Default
Alsa driver mode” above)</p>
<p>Others modes are described in the following subsections.</p>
</div>
<div class="section" id="bit-modes">
<h4>16-bit modes<a class="headerlink" href="#bit-modes" title="Permalink to this headline">¶</a></h4>
<p>The two supported modes are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">device_setup=0x01</span></code><ul>
<li>16bits 48kHz mode with Di disabled</li>
<li>Ai,Ao,Do can be used at the same time</li>
<li>hw:1,0 is not available in capture mode</li>
<li>hw:1,2 is not available</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">device_setup=0x11</span></code><ul>
<li>16bits 48kHz mode with Di enabled</li>
<li>Ai,Ao,Di,Do can be used at the same time</li>
<li>hw:1,0 is available in capture mode</li>
<li>hw:1,2 is not available</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>In this modes the device operates only at 16bits-modes. Before kernel 2.6.23,
the devices where reported to be Big-Endian when in fact they were Little-Endian
so that playing a file was a matter of using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% aplay -D hw:1,1 -c2 -t raw -r48000 -fS16_BE test_S16_LE.raw
</pre></div>
</div>
<p>where “test_S16_LE.raw” was in fact a little-endian sample file.</p>
<p>Thanks to Hakan Lennestal (who discovered the Little-Endiannes of the device in
these modes) a fix has been committed (expected in kernel 2.6.23) and
Alsa now reports Little-Endian interfaces. Thus playing a file now is as simple as
using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% aplay -D hw:1,1 -c2 -t raw -r48000 -fS16_LE test_S16_LE.raw
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>24-bit modes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The three supported modes are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">device_setup=0x09</span></code><ul>
<li>24bits 48kHz mode with Di disabled</li>
<li>Ai,Ao,Do can be used at the same time</li>
<li>hw:1,0 is not available in capture mode</li>
<li>hw:1,2 is not available</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">device_setup=0x19</span></code><ul>
<li>24bits 48kHz mode with Di enabled</li>
<li>3 ports from {Ai,Ao,Di,Do} can be used at the same time</li>
<li>hw:1,0 is available in capture mode and an active digital source must be
connected to Di</li>
<li>hw:1,2 is not available</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">device_setup=0x0D</span></code> or <code class="docutils literal notranslate"><span class="pre">0x10</span></code><ul>
<li>24bits 96kHz mode</li>
<li>Di is enabled by default for this mode but does not need to be connected
to an active source</li>
<li>Only 1 port from {Ai,Ao,Di,Do} can be used at the same time</li>
<li>hw:1,0 is available in captured mode</li>
<li>hw:1,2 is not available</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>In these modes the device is only Big-Endian compliant (see “Default Alsa driver
mode” above for an aplay command example)</p>
</div>
<div class="section" id="ac3-w-dts-passthru-mode">
<h4>AC3 w/ DTS passthru mode<a class="headerlink" href="#ac3-w-dts-passthru-mode" title="Permalink to this headline">¶</a></h4>
<p>Thanks to Hakan Lennestal, I now have a report saying that this mode works.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">device_setup=0x03</span></code><ul>
<li>16bits 48kHz mode with only the Do port enabled</li>
<li>AC3 with DTS passthru</li>
<li>Caution with this setup the Do port is mapped to the pcm device hw:1,0</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>The command line used to playback the AC3/DTS encoded .wav-files in this mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% aplay -D hw:1,0 --channels=6 ac3_S16_LE_encoded_file.raw
</pre></div>
</div>
</div>
<div class="section" id="how-to-use-the-device-setup-parameter">
<h4>How to use the <code class="docutils literal notranslate"><span class="pre">device_setup</span></code> parameter<a class="headerlink" href="#how-to-use-the-device-setup-parameter" title="Permalink to this headline">¶</a></h4>
<p>The parameter can be given:</p>
<blockquote>
<div><ul>
<li><p class="first">By manually probing the device (as root)::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># modprobe -r snd-usb-audio
# modprobe snd-usb-audio index=1 device_setup=0x09
</pre></div>
</div>
</li>
<li><p class="first">Or while configuring the modules options in your modules configuration file
(typically a .conf file in /etc/modprobe.d/ directory::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>alias snd-card-1 snd-usb-audio
options snd-usb-audio index=1 device_setup=0x09
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="caution-when-initializing-the-device">
<h3>CAUTION when initializing the device<a class="headerlink" href="#caution-when-initializing-the-device" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Correct initialization on the device requires that device_setup is given to
the module BEFORE the device is turned on. So, if you use the “manual probing”
method described above, take care to power-on the device AFTER this initialization.</li>
<li>Failing to respect this will lead to a misconfiguration of the device. In this case
turn off the device, unprobe the snd-usb-audio module, then probe it again with
correct device_setup parameter and then (and only then) turn on the device again.</li>
<li>If you’ve correctly initialized the device in a valid mode and then want to switch
to  another mode (possibly with another sample-depth), please use also the following
procedure:<ul>
<li>first turn off the device</li>
<li>de-register the snd-usb-audio module (modprobe -r)</li>
<li>change the device_setup parameter by changing the device_setup
option in <code class="docutils literal notranslate"><span class="pre">/etc/modprobe.d/*.conf</span></code></li>
<li>turn on the device</li>
</ul>
</li>
<li>A workaround for this last issue has been applied to kernel 2.6.23, but it may not
be enough to ensure the ‘stability’ of the device initialization.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="technical-details-for-hackers">
<h3>Technical details for hackers<a class="headerlink" href="#technical-details-for-hackers" title="Permalink to this headline">¶</a></h3>
<p>This section is for hackers, wanting to understand details about the device
internals and how Alsa supports it.</p>
<div class="section" id="audiophile-usb-s-device-setup-structure">
<h4>Audiophile USB’s <code class="docutils literal notranslate"><span class="pre">device_setup</span></code> structure<a class="headerlink" href="#audiophile-usb-s-device-setup-structure" title="Permalink to this headline">¶</a></h4>
<p>If you want to understand the device_setup magic numbers for the Audiophile
USB, you need some very basic understanding of binary computation. However,
this is not required to use the parameter and you may skip this section.</p>
<p>The device_setup is one byte long and its structure is the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+---+---+---+---+---+---+---+---+
| b7| b6| b5| b4| b3| b2| b1| b0|
+---+---+---+---+---+---+---+---+
| 0 | 0 | 0 | Di|24B|96K|DTS|SET|
+---+---+---+---+---+---+---+---+
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li>b0 is the <code class="docutils literal notranslate"><span class="pre">SET</span></code> bit<ul>
<li>it MUST be set if device_setup is initialized</li>
</ul>
</li>
<li>b1 is the <code class="docutils literal notranslate"><span class="pre">DTS</span></code> bit<ul>
<li>it is set only for Digital output with DTS/AC3</li>
<li>this setup is not tested</li>
</ul>
</li>
<li>b2 is the Rate selection flag<ul>
<li>When set to <code class="docutils literal notranslate"><span class="pre">1</span></code> the rate range is 48.1-96kHz</li>
<li>Otherwise the sample rate range is 8-48kHz</li>
</ul>
</li>
<li>b3 is the bit depth selection flag<ul>
<li>When set to <code class="docutils literal notranslate"><span class="pre">1</span></code> samples are 24bits long</li>
<li>Otherwise they are 16bits long</li>
<li>Note that b2 implies b3 as the 96kHz mode is only supported for 24 bits
samples</li>
</ul>
</li>
<li>b4 is the Digital input flag<ul>
<li>When set to <code class="docutils literal notranslate"><span class="pre">1</span></code> the device assumes that an active digital source is
connected</li>
<li>You shouldn’t enable Di if no source is seen on the port (this leads to
synchronization issues)</li>
<li>b4 is implied by b2 (since only one port is enabled at a time no synch
error can occur)</li>
</ul>
</li>
<li>b5 to b7 are reserved for future uses, and must be set to <code class="docutils literal notranslate"><span class="pre">0</span></code><ul>
<li>might become Ao, Do, Ai, for b7, b6, b4 respectively</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>Caution:</p>
<blockquote>
<div><ul class="simple">
<li>there is no check on the value you will give to device_setup<ul>
<li>for instance choosing 0x05 (16bits 96kHz) will fail back to 0x09 since
b2 implies b3. But _there_will_be_no_warning_ in /var/log/messages</li>
</ul>
</li>
<li>Hardware constraints due to the USB bus limitation aren’t checked<ul>
<li>choosing b2 will prepare all interfaces for 24bits/96kHz but you’ll
only be able to use one at the same time</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="usb-implementation-details-for-this-device">
<h4>USB implementation details for this device<a class="headerlink" href="#usb-implementation-details-for-this-device" title="Permalink to this headline">¶</a></h4>
<p>You may safely skip this section if you’re not interested in driver
hacking.</p>
<p>This section describes some internal aspects of the device and summarizes the
data I got by usb-snooping the windows and Linux drivers.</p>
<p>The M-Audio Audiophile USB has 7 USB Interfaces:
a “USB interface”:</p>
<blockquote>
<div><ul class="simple">
<li>USB Interface nb.0</li>
<li>USB Interface nb.1<ul>
<li>Audio Control function</li>
</ul>
</li>
<li>USB Interface nb.2<ul>
<li>Analog Output</li>
</ul>
</li>
<li>USB Interface nb.3<ul>
<li>Digital Output</li>
</ul>
</li>
<li>USB Interface nb.4<ul>
<li>Analog Input</li>
</ul>
</li>
<li>USB Interface nb.5<ul>
<li>Digital Input</li>
</ul>
</li>
<li>USB Interface nb.6<ul>
<li>MIDI interface compliant with the MIDIMAN quirk</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>Each interface has 5 altsettings (AltSet 1,2,3,4,5) except:</p>
<blockquote>
<div><ul class="simple">
<li>Interface 3 (Digital Out) has an extra Alset nb.6</li>
<li>Interface 5 (Digital In) does not have Alset nb.3 and 5</li>
</ul>
</div></blockquote>
<p>Here is a short description of the AltSettings capabilities:</p>
<ul class="simple">
<li>AltSettings 1 corresponds to<ul>
<li>24-bit depth, 48.1-96kHz sample mode</li>
<li>Adaptive playback (Ao and Do), Synch capture (Ai), or Asynch capture (Di)</li>
</ul>
</li>
<li>AltSettings 2 corresponds to<ul>
<li>24-bit depth, 8-48kHz sample mode</li>
<li>Asynch capture and playback  (Ao,Ai,Do,Di)</li>
</ul>
</li>
<li>AltSettings 3 corresponds to<ul>
<li>24-bit depth, 8-48kHz sample mode</li>
<li>Synch capture (Ai) and Adaptive playback (Ao,Do)</li>
</ul>
</li>
<li>AltSettings 4 corresponds to<ul>
<li>16-bit depth, 8-48kHz sample mode</li>
<li>Asynch capture and playback  (Ao,Ai,Do,Di)</li>
</ul>
</li>
<li>AltSettings 5 corresponds to<ul>
<li>16-bit depth, 8-48kHz sample mode</li>
<li>Synch capture (Ai) and Adaptive playback (Ao,Do)</li>
</ul>
</li>
<li>AltSettings 6 corresponds to<ul>
<li>16-bit depth, 8-48kHz sample mode</li>
<li>Synch playback (Do), audio format type III IEC1937_AC-3</li>
</ul>
</li>
</ul>
<p>In order to ensure a correct initialization of the device, the driver
<em>must</em> <em>know</em> how the device will be used:</p>
<blockquote>
<div><ul class="simple">
<li>if DTS is chosen, only Interface 2 with AltSet nb.6 must be
registered</li>
<li>if 96KHz only AltSets nb.1 of each interface must be selected</li>
<li>if samples are using 24bits/48KHz then AltSet 2 must me used if
Digital input is connected, and only AltSet nb.3 if Digital input
is not connected</li>
<li>if samples are using 16bits/48KHz then AltSet 4 must me used if
Digital input is connected, and only AltSet nb.5 if Digital input
is not connected</li>
</ul>
</div></blockquote>
<p>When device_setup is given as a parameter to the snd-usb-audio module, the
parse_audio_endpoints function uses a quirk called
<code class="docutils literal notranslate"><span class="pre">audiophile_skip_setting_quirk</span></code> in order to prevent AltSettings not
corresponding to device_setup from being registered in the driver.</p>
</div>
</div>
</div>
<div class="section" id="audiophile-usb-and-jack-support">
<h2>Audiophile USB and Jack support<a class="headerlink" href="#audiophile-usb-and-jack-support" title="Permalink to this headline">¶</a></h2>
<p>This section deals with support of the Audiophile USB device in Jack.</p>
<p>There are 2 main potential issues when using Jackd with the device:</p>
<ul class="simple">
<li>support for Big-Endian devices in 24-bit modes</li>
<li>support for 4-in / 4-out channels</li>
</ul>
<div class="section" id="direct-support-in-jackd">
<h3>Direct support in Jackd<a class="headerlink" href="#direct-support-in-jackd" title="Permalink to this headline">¶</a></h3>
<p>Jack supports big endian devices only in recent versions (thanks to
Andreas Steinmetz for his first big-endian patch). I can’t remember
exactly when this support was released into jackd, let’s just say that
with jackd version 0.103.0 it’s almost ok (just a small bug is affecting
16bits Big-Endian devices, but since you’ve read carefully the above
paragraphs, you’re now using kernel &gt;= 2.6.23 and your 16bits devices
are now Little Endians ;-) ).</p>
<p>You can run jackd with the following command for playback with Ao and
record with Ai:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% jackd -R -dalsa -Phw:1,0 -r48000 -p128 -n2 -D -Chw:1,1
</pre></div>
</div>
</div>
<div class="section" id="using-alsa-plughw">
<h3>Using Alsa plughw<a class="headerlink" href="#using-alsa-plughw" title="Permalink to this headline">¶</a></h3>
<p>If you don’t have a recent Jackd installed, you can downgrade to using
the Alsa <code class="docutils literal notranslate"><span class="pre">plug</span></code> converter.</p>
<p>For instance here is one way to run Jack with 2 playback channels on Ao and 2
capture channels from Ai:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% jackd -R -dalsa -dplughw:1 -r48000 -p256 -n2 -D -Cplughw:1,1
</pre></div>
</div>
<dl class="docutils">
<dt>However you may see the following warning message:</dt>
<dd>You appear to be using the ALSA software “plug” layer, probably a result of
using the “default” ALSA device. This is less efficient than it could be.
Consider using a hardware device instead rather than using the plug layer.</dd>
</dl>
</div>
<div class="section" id="getting-2-input-and-or-output-interfaces-in-jack">
<h3>Getting 2 input and/or output interfaces in Jack<a class="headerlink" href="#getting-2-input-and-or-output-interfaces-in-jack" title="Permalink to this headline">¶</a></h3>
<p>As you can see, starting the Jack server this way will only enable 1 stereo
input (Di or Ai) and 1 stereo output (Ao or Do).</p>
<p>This is due to the following restrictions:</p>
<ul class="simple">
<li>Jack can only open one capture device and one playback device at a time</li>
<li>The Audiophile USB is seen as 2 (or three) Alsa devices: hw:1,0, hw:1,1
(and optionally hw:1,2)</li>
</ul>
<p>If you want to get Ai+Di and/or Ao+Do support with Jack, you would need to
combine the Alsa devices into one logical “complex” device.</p>
<p>If you want to give it a try, I recommend reading the information from
this page: <a class="reference external" href="http://www.sound-man.co.uk/linuxaudio/ice1712multi.html">http://www.sound-man.co.uk/linuxaudio/ice1712multi.html</a>
It is related to another device (ice1712) but can be adapted to suit
the Audiophile USB.</p>
<p>Enabling multiple Audiophile USB interfaces for Jackd will certainly require:</p>
<ul class="simple">
<li>Making sure your Jackd version has the MMAP_COMPLEX patch (see the ice1712 page)</li>
<li>(maybe) patching the alsa-lib/src/pcm/pcm_multi.c file (see the ice1712 page)</li>
<li>define a multi device (combination of hw:1,0 and hw:1,1) in your .asoundrc
file</li>
<li>start jackd with this device</li>
</ul>
<p>I had no success in testing this for now, if you have any success with this kind
of setup, please drop me an email.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mixart.html" class="btn btn-neutral float-right" title="Alsa driver for Digigram miXart8 and miXart8AES/EBU soundcards" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="via82xx-mixer.html" class="btn btn-neutral float-left" title="VIA82xx mixer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>