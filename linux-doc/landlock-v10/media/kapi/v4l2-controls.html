

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.12. V4L2 Controls &mdash; The Linux Kernel 5.2.0+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.13. Videobuf Framework" href="v4l2-videobuf.html" />
    <link rel="prev" title="1.11. V4L2 events" href="v4l2-event.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="v4l2-core.html">1. Video4Linux devices</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html">1.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-a-v4l-driver">1.2. Structure of a V4L driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-the-v4l2-framework">1.3. Structure of the V4L2 framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dev.html">1.4. Video device’ s internal representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-device.html">1.5. V4L2 device instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fh.html">1.6. V4L2 File handlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html">1.7. V4L2 sub-devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-userspace-api">1.8. V4L2 sub-device userspace API</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#i2c-sub-device-drivers">1.9. I2C sub-device drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-functions-and-data-structures">1.10. V4L2 sub-device functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-event.html">1.11. V4L2 events</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">1.12. V4L2 Controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf.html">1.13. Videobuf Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf2.html">1.14. V4L2 videobuf2 functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-clocks.html">1.15. V4L2 clocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dv-timings.html">1.16. V4L2 DV Timings functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-flash-led-class.html">1.17. V4L2 flash functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mc.html">1.18. V4L2 Media Controller functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mediabus.html">1.19. V4L2 Media Bus functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mem2mem.html">1.20. V4L2 Memory to Memory functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-async.html">1.21. V4L2 async kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fwnode.html">1.22. V4L2 fwnode kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-rect.html">1.23. V4L2 rect helper functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tuner.html">1.24. Tuner functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-common.html">1.25. V4L2 common functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tveeprom.html">1.26. Hauppauge TV EEPROM functions and data structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dtv-core.html">2. Digital TV (DVB) devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="rc-core.html">3. Remote Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc-core.html">4. Media Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="cec-core.html">5. CEC Kernel Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="csi2.html">6. MIPI CSI-2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="../media_kapi.html">Media subsystem kernel internal API</a> &raquo;</li>
        
          <li><a href="v4l2-core.html">1. Video4Linux devices</a> &raquo;</li>
        
      <li>1.12. V4L2 Controls</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/media/kapi/v4l2-controls.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="v4l2-controls">
<h1>1.12. V4L2 Controls<a class="headerlink" href="#v4l2-controls" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>1.12.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The V4L2 control API seems simple enough, but quickly becomes very hard to
implement correctly in drivers. But much of the code needed to handle controls
is actually not driver specific and can be moved to the V4L core framework.</p>
<p>After all, the only part that a driver developer is interested in is:</p>
<ol class="arabic simple">
<li>How do I add a control?</li>
<li>How do I set the control’s value? (i.e. s_ctrl)</li>
</ol>
<p>And occasionally:</p>
<ol class="arabic simple" start="3">
<li>How do I get the control’s value? (i.e. g_volatile_ctrl)</li>
<li>How do I validate the user’s proposed control value? (i.e. try_ctrl)</li>
</ol>
<p>All the rest is something that can be done centrally.</p>
<p>The control framework was created in order to implement all the rules of the
V4L2 specification with respect to controls in a central place. And to make
life as easy as possible for the driver developer.</p>
<p>Note that the control framework relies on the presence of a struct
<a class="reference internal" href="v4l2-device.html#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> for V4L2 drivers and struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_subdev</span></code></a> for
sub-device drivers.</p>
</div>
<div class="section" id="objects-in-the-framework">
<h2>1.12.2. Objects in the framework<a class="headerlink" href="#objects-in-the-framework" title="Permalink to this headline">¶</a></h2>
<p>There are two main objects:</p>
<p>The <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl</span></code></a> object describes the control properties and keeps
track of the control’s value (both the current value and the proposed new
value).</p>
<p><a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_handler</span></code></a> is the object that keeps track of controls. It
maintains a list of v4l2_ctrl objects that it owns and another list of
references to controls, possibly to controls owned by other handlers.</p>
</div>
<div class="section" id="basic-usage-for-v4l2-and-sub-device-drivers">
<h2>1.12.3. Basic usage for V4L2 and sub-device drivers<a class="headerlink" href="#basic-usage-for-v4l2-and-sub-device-drivers" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Prepare the driver:</li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;media/v4l2-ctrls.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>1.1) Add the handler to your driver’s top-level struct:</p>
<p>For V4L2 drivers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">foo_dev</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">struct</span> <span class="n">v4l2_device</span> <span class="n">v4l2_dev</span><span class="p">;</span>
        <span class="p">...</span>
        <span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="n">ctrl_handler</span><span class="p">;</span>
        <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>For sub-device drivers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">foo_dev</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="n">sd</span><span class="p">;</span>
        <span class="p">...</span>
        <span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="n">ctrl_handler</span><span class="p">;</span>
        <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>1.2) Initialize the handler:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">v4l2_ctrl_handler_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="n">nr_of_controls</span><span class="p">);</span>
</pre></div>
</div>
<p>The second argument is a hint telling the function how many controls this
handler is expected to handle. It will allocate a hashtable based on this
information. It is a hint only.</p>
<p>1.3) Hook the control handler into the driver:</p>
<p>For V4L2 drivers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">.</span><span class="n">ctrl_handler</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">;</span>
</pre></div>
</div>
<p>For sub-device drivers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">sd</span><span class="p">.</span><span class="n">ctrl_handler</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">;</span>
</pre></div>
</div>
<p>1.4) Clean up the handler at the end:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">v4l2_ctrl_handler_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Add controls:</li>
</ol>
<p>You add non-menu controls by calling <a class="reference internal" href="#c.v4l2_ctrl_new_std" title="v4l2_ctrl_new_std"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">v4l2_ctrl_new_std</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">,</span>
                <span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">min</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">u32</span> <span class="n">step</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">);</span>
</pre></div>
</div>
<p>Menu and integer menu controls are added by calling
<a class="reference internal" href="#c.v4l2_ctrl_new_std_menu" title="v4l2_ctrl_new_std_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">v4l2_ctrl_new_std_menu</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">,</span>
                <span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">skip_mask</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">);</span>
</pre></div>
</div>
<p>Menu controls with a driver specific menu are added by calling
<a class="reference internal" href="#c.v4l2_ctrl_new_std_menu_items" title="v4l2_ctrl_new_std_menu_items"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu_items()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">v4l2_ctrl_new_std_menu_items</span><span class="p">(</span>
                <span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">,</span> <span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span>
                <span class="n">s32</span> <span class="n">skip_mask</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">qmenu</span><span class="p">);</span>
</pre></div>
</div>
<p>Integer menu controls with a driver specific menu can be added by calling
<a class="reference internal" href="#c.v4l2_ctrl_new_int_menu" title="v4l2_ctrl_new_int_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_int_menu()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">v4l2_ctrl_new_int_menu</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">,</span>
                <span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">,</span> <span class="k">const</span> <span class="n">s64</span> <span class="o">*</span><span class="n">qmenu_int</span><span class="p">);</span>
</pre></div>
</div>
<p>These functions are typically called right after the
<a class="reference internal" href="#c.v4l2_ctrl_handler_init" title="v4l2_ctrl_handler_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_init()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="n">s64</span> <span class="n">exp_bias_qmenu</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
       <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">test_pattern</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;Disabled&quot;</span><span class="p">,</span>
        <span class="s">&quot;Vertical Bars&quot;</span><span class="p">,</span>
        <span class="s">&quot;Solid Black&quot;</span><span class="p">,</span>
        <span class="s">&quot;Solid White&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">v4l2_ctrl_handler_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="n">nr_of_controls</span><span class="p">);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_ctrl_ops</span><span class="p">,</span>
                <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_ctrl_ops</span><span class="p">,</span>
                <span class="n">V4L2_CID_CONTRAST</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
<span class="n">v4l2_ctrl_new_std_menu</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_ctrl_ops</span><span class="p">,</span>
                <span class="n">V4L2_CID_POWER_LINE_FREQUENCY</span><span class="p">,</span>
                <span class="n">V4L2_CID_POWER_LINE_FREQUENCY_60HZ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">V4L2_CID_POWER_LINE_FREQUENCY_DISABLED</span><span class="p">);</span>
<span class="n">v4l2_ctrl_new_int_menu</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_ctrl_ops</span><span class="p">,</span>
                <span class="n">V4L2_CID_EXPOSURE_BIAS</span><span class="p">,</span>
                <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exp_bias_qmenu</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exp_bias_qmenu</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">exp_bias_qmenu</span><span class="p">);</span>
<span class="n">v4l2_ctrl_new_std_menu_items</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo_ctrl_ops</span><span class="p">,</span>
                <span class="n">V4L2_CID_TEST_PATTERN</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">test_pattern</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">test_pattern</span><span class="p">);</span>
<span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">.</span><span class="n">error</span><span class="p">;</span>

        <span class="n">v4l2_ctrl_handler_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#c.v4l2_ctrl_new_std" title="v4l2_ctrl_new_std"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std()</span></code></a> function returns the v4l2_ctrl pointer to
the new control, but if you do not need to access the pointer outside the
control ops, then there is no need to store it.</p>
<p>The <a class="reference internal" href="#c.v4l2_ctrl_new_std" title="v4l2_ctrl_new_std"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std()</span></code></a> function will fill in most fields based on
the control ID except for the min, max, step and default values. These are
passed in the last four arguments. These values are driver specific while
control attributes like type, name, flags are all global. The control’s
current value will be set to the default value.</p>
<p>The <a class="reference internal" href="#c.v4l2_ctrl_new_std_menu" title="v4l2_ctrl_new_std_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu()</span></code></a> function is very similar but it is
used for menu controls. There is no min argument since that is always 0 for
menu controls, and instead of a step there is a skip_mask argument: if bit
X is 1, then menu item X is skipped.</p>
<p>The <a class="reference internal" href="#c.v4l2_ctrl_new_int_menu" title="v4l2_ctrl_new_int_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_int_menu()</span></code></a> function creates a new standard
integer menu control with driver-specific items in the menu. It differs
from v4l2_ctrl_new_std_menu in that it doesn’t have the mask argument and
takes as the last argument an array of signed 64-bit integers that form an
exact menu item list.</p>
<p>The <a class="reference internal" href="#c.v4l2_ctrl_new_std_menu_items" title="v4l2_ctrl_new_std_menu_items"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu_items()</span></code></a> function is very similar to
v4l2_ctrl_new_std_menu but takes an extra parameter qmenu, which is the
driver specific menu for an otherwise standard menu control. A good example
for this control is the test pattern control for capture/display/sensors
devices that have the capability to generate test patterns. These test
patterns are hardware specific, so the contents of the menu will vary from
device to device.</p>
<p>Note that if something fails, the function will return NULL or an error and
set ctrl_handler-&gt;error to the error code. If ctrl_handler-&gt;error was already
set, then it will just return and do nothing. This is also true for
v4l2_ctrl_handler_init if it cannot allocate the internal data structure.</p>
<p>This makes it easy to init the handler and just add all controls and only check
the error code at the end. Saves a lot of repetitive error checking.</p>
<p>It is recommended to add controls in ascending control ID order: it will be
a bit faster that way.</p>
<ol class="arabic simple" start="3">
<li>Optionally force initial control setup:</li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">v4l2_ctrl_handler_setup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">);</span>
</pre></div>
</div>
<p>This will call s_ctrl for all controls unconditionally. Effectively this
initializes the hardware to the default control values. It is recommended
that you do this as this ensures that both the internal data structures and
the hardware are in sync.</p>
<ol class="arabic simple" start="4">
<li>Finally: implement the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_ops</span> <span class="n">foo_ctrl_ops</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">s_ctrl</span> <span class="o">=</span> <span class="n">foo_s_ctrl</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Usually all you need is s_ctrl:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">foo_s_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">foo</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">handler</span><span class="p">,</span> <span class="k">struct</span> <span class="n">foo</span><span class="p">,</span> <span class="n">ctrl_handler</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">V4L2_CID_BRIGHTNESS</span><span class="p">:</span>
                <span class="n">write_reg</span><span class="p">(</span><span class="mh">0x123</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">V4L2_CID_CONTRAST</span><span class="p">:</span>
                <span class="n">write_reg</span><span class="p">(</span><span class="mh">0x456</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The control ops are called with the v4l2_ctrl pointer as argument.
The new control value has already been validated, so all you need to do is
to actually update the hardware registers.</p>
<p>You’re done! And this is sufficient for most of the drivers we have. No need
to do any validation of control values, or implement QUERYCTRL, QUERY_EXT_CTRL
and QUERYMENU. And G/S_CTRL as well as G/TRY/S_EXT_CTRLS are automatically supported.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The remainder sections deal with more advanced controls topics and scenarios.
In practice the basic usage as described above is sufficient for most drivers.</p>
</div>
</div>
<div class="section" id="inheriting-controls">
<h2>1.12.4. Inheriting Controls<a class="headerlink" href="#inheriting-controls" title="Permalink to this headline">¶</a></h2>
<p>When a sub-device is registered with a V4L2 driver by calling
<a class="reference internal" href="v4l2-device.html#c.v4l2_device_register_subdev" title="v4l2_device_register_subdev"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_register_subdev()</span></code></a> and the ctrl_handler fields of both v4l2_subdev
and v4l2_device are set, then the controls of the subdev will become
automatically available in the V4L2 driver as well. If the subdev driver
contains controls that already exist in the V4L2 driver, then those will be
skipped (so a V4L2 driver can always override a subdev control).</p>
<p>What happens here is that <a class="reference internal" href="v4l2-device.html#c.v4l2_device_register_subdev" title="v4l2_device_register_subdev"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_register_subdev()</span></code></a> calls
<a class="reference internal" href="#c.v4l2_ctrl_add_handler" title="v4l2_ctrl_add_handler"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_add_handler()</span></code></a> adding the controls of the subdev to the controls
of v4l2_device.</p>
</div>
<div class="section" id="accessing-control-values">
<h2>1.12.5. Accessing Control Values<a class="headerlink" href="#accessing-control-values" title="Permalink to this headline">¶</a></h2>
<p>The following union is used inside the control framework to access control
values:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">union</span> <span class="n">v4l2_ctrl_ptr</span> <span class="p">{</span>
        <span class="n">s32</span> <span class="o">*</span><span class="n">p_s32</span><span class="p">;</span>
        <span class="n">s64</span> <span class="o">*</span><span class="n">p_s64</span><span class="p">;</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">p_char</span><span class="p">;</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The v4l2_ctrl struct contains these fields that can be used to access both
current and new values:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">s32</span> <span class="n">val</span><span class="p">;</span>
<span class="k">struct</span> <span class="p">{</span>
        <span class="n">s32</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cur</span><span class="p">;</span>


<span class="k">union</span> <span class="n">v4l2_ctrl_ptr</span> <span class="n">p_new</span><span class="p">;</span>
<span class="k">union</span> <span class="n">v4l2_ctrl_ptr</span> <span class="n">p_cur</span><span class="p">;</span>
</pre></div>
</div>
<p>If the control has a simple s32 type type, then:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">p_new</span><span class="p">.</span><span class="n">p_s32</span>
<span class="o">&amp;</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">cur</span><span class="p">.</span><span class="n">val</span> <span class="o">==</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">p_cur</span><span class="p">.</span><span class="n">p_s32</span>
</pre></div>
</div>
<p>For all other types use ctrl-&gt;p_cur.p&lt;something&gt;. Basically the val
and cur.val fields can be considered an alias since these are used so often.</p>
<p>Within the control ops you can freely use these. The val and cur.val speak for
themselves. The p_char pointers point to character buffers of length
ctrl-&gt;maximum + 1, and are always 0-terminated.</p>
<p>Unless the control is marked volatile the p_cur field points to the the
current cached control value. When you create a new control this value is made
identical to the default value. After calling <a class="reference internal" href="#c.v4l2_ctrl_handler_setup" title="v4l2_ctrl_handler_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_setup()</span></code></a> this
value is passed to the hardware. It is generally a good idea to call this
function.</p>
<p>Whenever a new value is set that new value is automatically cached. This means
that most drivers do not need to implement the g_volatile_ctrl() op. The
exception is for controls that return a volatile register such as a signal
strength read-out that changes continuously. In that case you will need to
implement g_volatile_ctrl like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">foo_g_volatile_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">V4L2_CID_BRIGHTNESS</span><span class="p">:</span>
                <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">read_reg</span><span class="p">(</span><span class="mh">0x123</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that you use the ‘new value’ union as well in g_volatile_ctrl. In general
controls that need to implement g_volatile_ctrl are read-only controls. If they
are not, a V4L2_EVENT_CTRL_CH_VALUE will not be generated when the control
changes.</p>
<p>To mark a control as volatile you have to set V4L2_CTRL_FLAG_VOLATILE:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_VOLATILE</span><span class="p">;</span>
</pre></div>
</div>
<p>For try/s_ctrl the new values (i.e. as passed by the user) are filled in and
you can modify them in try_ctrl or set them in s_ctrl. The ‘cur’ union
contains the current value, which you can use (but not change!) as well.</p>
<p>If s_ctrl returns 0 (OK), then the control framework will copy the new final
values to the ‘cur’ union.</p>
<p>While in g_volatile/s/try_ctrl you can access the value of all controls owned
by the same handler since the handler’s lock is held. If you need to access
the value of controls owned by other handlers, then you have to be very careful
not to introduce deadlocks.</p>
<p>Outside of the control ops you have to go through to helper functions to get
or set a single control value safely in your driver:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">s32</span> <span class="nf">v4l2_ctrl_g_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">v4l2_ctrl_s_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">s32</span> <span class="n">val</span><span class="p">);</span>
</pre></div>
</div>
<p>These functions go through the control framework just as VIDIOC_G/S_CTRL ioctls
do. Don’t use these inside the control ops g_volatile/s/try_ctrl, though, that
will result in a deadlock since these helpers lock the handler as well.</p>
<p>You can also take the handler lock yourself:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>
<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;String value is &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ctrl1</span><span class="o">-&gt;</span><span class="n">p_cur</span><span class="p">.</span><span class="n">p_char</span><span class="p">);</span>
<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;Integer value is &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ctrl2</span><span class="o">-&gt;</span><span class="n">cur</span><span class="p">.</span><span class="n">val</span><span class="p">);</span>
<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="menu-controls">
<h2>1.12.6. Menu Controls<a class="headerlink" href="#menu-controls" title="Permalink to this headline">¶</a></h2>
<p>The v4l2_ctrl struct contains this union:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">union</span> <span class="p">{</span>
        <span class="n">u32</span> <span class="n">step</span><span class="p">;</span>
        <span class="n">u32</span> <span class="n">menu_skip_mask</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>For menu controls menu_skip_mask is used. What it does is that it allows you
to easily exclude certain menu items. This is used in the VIDIOC_QUERYMENU
implementation where you can return -EINVAL if a certain menu item is not
present. Note that VIDIOC_QUERYCTRL always returns a step value of 1 for
menu controls.</p>
<p>A good example is the MPEG Audio Layer II Bitrate menu control where the
menu is a list of standardized possible bitrates. But in practice hardware
implementations will only support a subset of those. By setting the skip
mask you can tell the framework which menu items should be skipped. Setting
it to 0 means that all menu items are supported.</p>
<p>You set this mask either through the v4l2_ctrl_config struct for a custom
control, or by calling <a class="reference internal" href="#c.v4l2_ctrl_new_std_menu" title="v4l2_ctrl_new_std_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu()</span></code></a>.</p>
</div>
<div class="section" id="custom-controls">
<h2>1.12.7. Custom Controls<a class="headerlink" href="#custom-controls" title="Permalink to this headline">¶</a></h2>
<p>Driver specific controls can be created using <a class="reference internal" href="#c.v4l2_ctrl_new_custom" title="v4l2_ctrl_new_custom"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_custom()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_config</span> <span class="n">ctrl_filter</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ctrl_custom_ops</span><span class="p">,</span>
        <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span><span class="p">,</span>
        <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Spatial Filter&quot;</span><span class="p">,</span>
        <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
        <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">,</span>
        <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">ctrl</span> <span class="o">=</span> <span class="n">v4l2_ctrl_new_custom</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctrl_filter</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>The last argument is the priv pointer which can be set to driver-specific
private data.</p>
<p>The v4l2_ctrl_config struct also has a field to set the is_private flag.</p>
<p>If the name field is not set, then the framework will assume this is a standard
control and will fill in the name, type and flags fields accordingly.</p>
</div>
<div class="section" id="active-and-grabbed-controls">
<h2>1.12.8. Active and Grabbed Controls<a class="headerlink" href="#active-and-grabbed-controls" title="Permalink to this headline">¶</a></h2>
<p>If you get more complex relationships between controls, then you may have to
activate and deactivate controls. For example, if the Chroma AGC control is
on, then the Chroma Gain control is inactive. That is, you may set it, but
the value will not be used by the hardware as long as the automatic gain
control is on. Typically user interfaces can disable such input fields.</p>
<p>You can set the ‘active’ status using <a class="reference internal" href="#c.v4l2_ctrl_activate" title="v4l2_ctrl_activate"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_activate()</span></code></a>. By default all
controls are active. Note that the framework does not check for this flag.
It is meant purely for GUIs. The function is typically called from within
s_ctrl.</p>
<p>The other flag is the ‘grabbed’ flag. A grabbed control means that you cannot
change it because it is in use by some resource. Typical examples are MPEG
bitrate controls that cannot be changed while capturing is in progress.</p>
<p>If a control is set to ‘grabbed’ using <a class="reference internal" href="#c.v4l2_ctrl_grab" title="v4l2_ctrl_grab"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_grab()</span></code></a>, then the framework
will return -EBUSY if an attempt is made to set this control. The
<a class="reference internal" href="#c.v4l2_ctrl_grab" title="v4l2_ctrl_grab"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_grab()</span></code></a> function is typically called from the driver when it
starts or stops streaming.</p>
</div>
<div class="section" id="control-clusters">
<h2>1.12.9. Control Clusters<a class="headerlink" href="#control-clusters" title="Permalink to this headline">¶</a></h2>
<p>By default all controls are independent from the others. But in more
complex scenarios you can get dependencies from one control to another.
In that case you need to ‘cluster’ them:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">foo</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="n">ctrl_handler</span><span class="p">;</span>
<span class="cp">#define AUDIO_CL_VOLUME (0)</span>
<span class="cp">#define AUDIO_CL_MUTE   (1)</span>
        <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">audio_cluster</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="p">...</span>
<span class="p">};</span>

<span class="n">state</span><span class="o">-&gt;</span><span class="n">audio_cluster</span><span class="p">[</span><span class="n">AUDIO_CL_VOLUME</span><span class="p">]</span> <span class="o">=</span>
        <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">state</span><span class="o">-&gt;</span><span class="n">audio_cluster</span><span class="p">[</span><span class="n">AUDIO_CL_MUTE</span><span class="p">]</span> <span class="o">=</span>
        <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">audio_cluster</span><span class="p">),</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">audio_cluster</span><span class="p">);</span>
</pre></div>
</div>
<p>From now on whenever one or more of the controls belonging to the same
cluster is set (or ‘gotten’, or ‘tried’), only the control ops of the first
control (‘volume’ in this example) is called. You effectively create a new
composite control. Similar to how a ‘struct’ works in C.</p>
<p>So when s_ctrl is called with V4L2_CID_AUDIO_VOLUME as argument, you should set
all two controls belonging to the audio_cluster:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">foo_s_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">foo</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">handler</span><span class="p">,</span> <span class="k">struct</span> <span class="n">foo</span><span class="p">,</span> <span class="n">ctrl_handler</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">V4L2_CID_AUDIO_VOLUME</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">mute</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">cluster</span><span class="p">[</span><span class="n">AUDIO_CL_MUTE</span><span class="p">];</span>

                <span class="n">write_reg</span><span class="p">(</span><span class="mh">0x123</span><span class="p">,</span> <span class="n">mute</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">case</span> <span class="nl">V4L2_CID_CONTRAST</span><span class="p">:</span>
                <span class="n">write_reg</span><span class="p">(</span><span class="mh">0x456</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the example above the following are equivalent for the VOLUME case:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ctrl</span> <span class="o">==</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">cluster</span><span class="p">[</span><span class="n">AUDIO_CL_VOLUME</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">audio_cluster</span><span class="p">[</span><span class="n">AUDIO_CL_VOLUME</span><span class="p">]</span>
<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">cluster</span><span class="p">[</span><span class="n">AUDIO_CL_MUTE</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">audio_cluster</span><span class="p">[</span><span class="n">AUDIO_CL_MUTE</span><span class="p">]</span>
</pre></div>
</div>
<p>In practice using cluster arrays like this becomes very tiresome. So instead
the following equivalent method is used:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
        <span class="cm">/* audio cluster */</span>
        <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">volume</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">mute</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The anonymous struct is used to clearly ‘cluster’ these two control pointers,
but it serves no other purpose. The effect is the same as creating an
array with two control pointers. So you can just do:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="o">-&gt;</span><span class="n">volume</span> <span class="o">=</span> <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">state</span><span class="o">-&gt;</span><span class="n">mute</span> <span class="o">=</span> <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">volume</span><span class="p">);</span>
</pre></div>
</div>
<p>And in foo_s_ctrl you can use these pointers directly: state-&gt;mute-&gt;val.</p>
<p>Note that controls in a cluster may be NULL. For example, if for some
reason mute was never added (because the hardware doesn’t support that
particular feature), then mute will be NULL. So in that case we have a
cluster of 2 controls, of which only 1 is actually instantiated. The
only restriction is that the first control of the cluster must always be
present, since that is the ‘master’ control of the cluster. The master
control is the one that identifies the cluster and that provides the
pointer to the v4l2_ctrl_ops struct that is used for that cluster.</p>
<p>Obviously, all controls in the cluster array must be initialized to either
a valid control or to NULL.</p>
<p>In rare cases you might want to know which controls of a cluster actually
were set explicitly by the user. For this you can check the ‘is_new’ flag of
each control. For example, in the case of a volume/mute cluster the ‘is_new’
flag of the mute control would be set if the user called VIDIOC_S_CTRL for
mute only. If the user would call VIDIOC_S_EXT_CTRLS for both mute and volume
controls, then the ‘is_new’ flag would be 1 for both controls.</p>
<p>The ‘is_new’ flag is always 1 when called from <a class="reference internal" href="#c.v4l2_ctrl_handler_setup" title="v4l2_ctrl_handler_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_setup()</span></code></a>.</p>
</div>
<div class="section" id="handling-autogain-gain-type-controls-with-auto-clusters">
<h2>1.12.10. Handling autogain/gain-type Controls with Auto Clusters<a class="headerlink" href="#handling-autogain-gain-type-controls-with-auto-clusters" title="Permalink to this headline">¶</a></h2>
<p>A common type of control cluster is one that handles ‘auto-foo/foo’-type
controls. Typical examples are autogain/gain, autoexposure/exposure,
autowhitebalance/red balance/blue balance. In all cases you have one control
that determines whether another control is handled automatically by the hardware,
or whether it is under manual control from the user.</p>
<p>If the cluster is in automatic mode, then the manual controls should be
marked inactive and volatile. When the volatile controls are read the
g_volatile_ctrl operation should return the value that the hardware’s automatic
mode set up automatically.</p>
<p>If the cluster is put in manual mode, then the manual controls should become
active again and the volatile flag is cleared (so g_volatile_ctrl is no longer
called while in manual mode). In addition just before switching to manual mode
the current values as determined by the auto mode are copied as the new manual
values.</p>
<p>Finally the V4L2_CTRL_FLAG_UPDATE should be set for the auto control since
changing that control affects the control flags of the manual controls.</p>
<p>In order to simplify this a special variation of v4l2_ctrl_cluster was
introduced:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">v4l2_ctrl_auto_cluster</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">ncontrols</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">**</span><span class="n">controls</span><span class="p">,</span>
                            <span class="n">u8</span> <span class="n">manual_val</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">set_volatile</span><span class="p">);</span>
</pre></div>
</div>
<p>The first two arguments are identical to v4l2_ctrl_cluster. The third argument
tells the framework which value switches the cluster into manual mode. The
last argument will optionally set V4L2_CTRL_FLAG_VOLATILE for the non-auto controls.
If it is false, then the manual controls are never volatile. You would typically
use that if the hardware does not give you the option to read back to values as
determined by the auto mode (e.g. if autogain is on, the hardware doesn’t allow
you to obtain the current gain value).</p>
<p>The first control of the cluster is assumed to be the ‘auto’ control.</p>
<p>Using this function will ensure that you don’t need to handle all the complex
flag and volatile handling.</p>
</div>
<div class="section" id="vidioc-log-status-support">
<h2>1.12.11. VIDIOC_LOG_STATUS Support<a class="headerlink" href="#vidioc-log-status-support" title="Permalink to this headline">¶</a></h2>
<p>This ioctl allow you to dump the current status of a driver to the kernel log.
The v4l2_ctrl_handler_log_status(ctrl_handler, prefix) can be used to dump the
value of the controls owned by the given handler to the log. You can supply a
prefix as well. If the prefix didn’t end with a space, then ‘: ‘ will be added
for you.</p>
</div>
<div class="section" id="different-handlers-for-different-video-nodes">
<h2>1.12.12. Different Handlers for Different Video Nodes<a class="headerlink" href="#different-handlers-for-different-video-nodes" title="Permalink to this headline">¶</a></h2>
<p>Usually the V4L2 driver has just one control handler that is global for
all video nodes. But you can also specify different control handlers for
different video nodes. You can do that by manually setting the ctrl_handler
field of struct video_device.</p>
<p>That is no problem if there are no subdevs involved but if there are, then
you need to block the automatic merging of subdev controls to the global
control handler. You do that by simply setting the ctrl_handler field in
struct v4l2_device to NULL. Now <a class="reference internal" href="v4l2-device.html#c.v4l2_device_register_subdev" title="v4l2_device_register_subdev"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_register_subdev()</span></code></a> will no longer
merge subdev controls.</p>
<p>After each subdev was added, you will then have to call v4l2_ctrl_add_handler
manually to add the subdev’s control handler (sd-&gt;ctrl_handler) to the desired
control handler. This control handler may be specific to the video_device or
for a subset of video_device’s. For example: the radio device nodes only have
audio controls, while the video and vbi device nodes share the same control
handler for the audio and video controls.</p>
<p>If you want to have one handler (e.g. for a radio device node) have a subset
of another handler (e.g. for a video device node), then you should first add
the controls to the first handler, add the other controls to the second
handler and finally add the first handler to the second. For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">radio_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">radio_ops</span><span class="p">,</span> <span class="n">V4L2_CID_AUDIO_VOLUME</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">radio_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">radio_ops</span><span class="p">,</span> <span class="n">V4L2_CID_AUDIO_MUTE</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">video_ops</span><span class="p">,</span> <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">video_ops</span><span class="p">,</span> <span class="n">V4L2_CID_CONTRAST</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_add_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">radio_ctrl_handler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>The last argument to <a class="reference internal" href="#c.v4l2_ctrl_add_handler" title="v4l2_ctrl_add_handler"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_add_handler()</span></code></a> is a filter function that allows
you to filter which controls will be added. Set it to NULL if you want to add
all controls.</p>
<p>Or you can add specific controls to a handler:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">volume</span> <span class="o">=</span> <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ops</span><span class="p">,</span> <span class="n">V4L2_CID_AUDIO_VOLUME</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ops</span><span class="p">,</span> <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ops</span><span class="p">,</span> <span class="n">V4L2_CID_CONTRAST</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>
</div>
<p>What you should not do is make two identical controls for two handlers.
For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">radio_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">radio_ops</span><span class="p">,</span> <span class="n">V4L2_CID_AUDIO_MUTE</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">video_ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">video_ops</span><span class="p">,</span> <span class="n">V4L2_CID_AUDIO_MUTE</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>
</div>
<p>This would be bad since muting the radio would not change the video mute
control. The rule is to have one control for each hardware ‘knob’ that you
can twiddle.</p>
</div>
<div class="section" id="finding-controls">
<h2>1.12.13. Finding Controls<a class="headerlink" href="#finding-controls" title="Permalink to this headline">¶</a></h2>
<p>Normally you have created the controls yourself and you can store the struct
v4l2_ctrl pointer into your own struct.</p>
<p>But sometimes you need to find a control from another handler that you do
not own. For example, if you have to find a volume control from a subdev.</p>
<p>You can do that by calling v4l2_ctrl_find:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">volume</span><span class="p">;</span>

<span class="n">volume</span> <span class="o">=</span> <span class="n">v4l2_ctrl_find</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="n">V4L2_CID_AUDIO_VOLUME</span><span class="p">);</span>
</pre></div>
</div>
<p>Since v4l2_ctrl_find will lock the handler you have to be careful where you
use it. For example, this is not a good idea:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="n">ctrl_handler</span><span class="p">;</span>

<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">video_ops</span><span class="p">,</span> <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">video_ops</span><span class="p">,</span> <span class="n">V4L2_CID_CONTRAST</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>
</div>
<p>…and in video_ops.s_ctrl:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nl">V4L2_CID_BRIGHTNESS</span><span class="p">:</span>
        <span class="n">contrast</span> <span class="o">=</span> <span class="n">v4l2_find_ctrl</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="n">V4L2_CID_CONTRAST</span><span class="p">);</span>
        <span class="p">...</span>
</pre></div>
</div>
<p>When s_ctrl is called by the framework the ctrl_handler.lock is already taken, so
attempting to find another control from the same handler will deadlock.</p>
<p>It is recommended not to use this function from inside the control ops.</p>
</div>
<div class="section" id="id1">
<h2>1.12.14. Inheriting Controls<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>When one control handler is added to another using v4l2_ctrl_add_handler, then
by default all controls from one are merged to the other. But a subdev might
have low-level controls that make sense for some advanced embedded system, but
not when it is used in consumer-level hardware. In that case you want to keep
those low-level controls local to the subdev. You can do this by simply
setting the ‘is_private’ flag of the control to 1:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_config</span> <span class="n">ctrl_private</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ctrl_custom_ops</span><span class="p">,</span>
        <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_</span><span class="p">...,</span>
        <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Some Private Control&quot;</span><span class="p">,</span>
        <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
        <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">.</span><span class="n">is_private</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">ctrl</span> <span class="o">=</span> <span class="n">v4l2_ctrl_new_custom</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">ctrl_handler</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctrl_private</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>These controls will now be skipped when v4l2_ctrl_add_handler is called.</p>
</div>
<div class="section" id="v4l2-ctrl-type-ctrl-class-controls">
<h2>1.12.15. V4L2_CTRL_TYPE_CTRL_CLASS Controls<a class="headerlink" href="#v4l2-ctrl-type-ctrl-class-controls" title="Permalink to this headline">¶</a></h2>
<p>Controls of this type can be used by GUIs to get the name of the control class.
A fully featured GUI can make a dialog with multiple tabs with each tab
containing the controls belonging to a particular control class. The name of
each tab can be found by querying a special control with ID &lt;control class | 1&gt;.</p>
<p>Drivers do not have to care about this. The framework will automatically add
a control of this type whenever the first control belonging to a new control
class is added.</p>
</div>
<div class="section" id="adding-notify-callbacks">
<h2>1.12.16. Adding Notify Callbacks<a class="headerlink" href="#adding-notify-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Sometimes the platform or bridge driver needs to be notified when a control
from a sub-device driver changes. You can set a notify callback by calling
this function:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">v4l2_ctrl_notify</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">,</span>
        <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">notify</span><span class="p">)(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">),</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>
</pre></div>
</div>
<p>Whenever the give control changes value the notify callback will be called
with a pointer to the control and the priv pointer that was passed with
v4l2_ctrl_notify. Note that the control’s handler lock is held when the
notify function is called.</p>
<p>There can be only one notify function per control handler. Any attempt
to set another notify function will cause a WARN_ON.</p>
</div>
<div class="section" id="v4l2-ctrl-functions-and-data-structures">
<h2>1.12.17. v4l2_ctrl functions and data structures<a class="headerlink" href="#v4l2-ctrl-functions-and-data-structures" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="c.v4l2_ctrl_ptr">
union <code class="descname">v4l2_ctrl_ptr</code><a class="headerlink" href="#c.v4l2_ctrl_ptr" title="Permalink to this definition">¶</a></dt>
<dd><p>A pointer to a control value.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>union v4l2_ctrl_ptr {
  s32 *p_s32;
  s64 *p_s64;
  u8 *p_u8;
  u16 *p_u16;
  u32 *p_u32;
  char *p_char;
  struct v4l2_ctrl_mpeg2_slice_params *p_mpeg2_slice_params;
  struct v4l2_ctrl_mpeg2_quantization *p_mpeg2_quantization;
  struct v4l2_ctrl_fwht_params *p_fwht_params;
  struct v4l2_ctrl_h264_sps *p_h264_sps;
  struct v4l2_ctrl_h264_pps *p_h264_pps;
  struct v4l2_ctrl_h264_scaling_matrix *p_h264_scaling_matrix;
  struct v4l2_ctrl_h264_slice_params *p_h264_slice_params;
  struct v4l2_ctrl_h264_decode_params *p_h264_decode_params;
  void *p;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">p_s32</span></code></dt>
<dd>Pointer to a 32-bit signed value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_s64</span></code></dt>
<dd>Pointer to a 64-bit signed value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_u8</span></code></dt>
<dd>Pointer to a 8-bit unsigned value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_u16</span></code></dt>
<dd>Pointer to a 16-bit unsigned value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_u32</span></code></dt>
<dd>Pointer to a 32-bit unsigned value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_char</span></code></dt>
<dd>Pointer to a string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_mpeg2_slice_params</span></code></dt>
<dd>Pointer to a MPEG2 slice parameters structure.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_mpeg2_quantization</span></code></dt>
<dd>Pointer to a MPEG2 quantization data structure.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_fwht_params</span></code></dt>
<dd>Pointer to a FWHT stateless parameters structure.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_h264_sps</span></code></dt>
<dd>Pointer to a struct v4l2_ctrl_h264_sps.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_h264_pps</span></code></dt>
<dd>Pointer to a struct v4l2_ctrl_h264_pps.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_h264_scaling_matrix</span></code></dt>
<dd>Pointer to a struct v4l2_ctrl_h264_scaling_matrix.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_h264_slice_params</span></code></dt>
<dd>Pointer to a struct v4l2_ctrl_h264_slice_params.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_h264_decode_params</span></code></dt>
<dd>Pointer to a struct v4l2_ctrl_h264_decode_params.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p</span></code></dt>
<dd>Pointer to a compound value.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_ctrl_ops">
struct <code class="descname">v4l2_ctrl_ops</code><a class="headerlink" href="#c.v4l2_ctrl_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>The control operations that the driver has to provide.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_ctrl_ops {
  int (*g_volatile_ctrl)(struct v4l2_ctrl *ctrl);
  int (*try_ctrl)(struct v4l2_ctrl *ctrl);
  int (*s_ctrl)(struct v4l2_ctrl *ctrl);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">g_volatile_ctrl</span></code></dt>
<dd>Get a new value for this control. Generally only relevant
for volatile (and usually read-only) controls such as a control
that returns the current signal strength which changes
continuously.
If not set, then the currently cached value will be returned.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">try_ctrl</span></code></dt>
<dd>Test whether the control’s value is valid. Only relevant when
the usual min/max/step checks are not sufficient.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s_ctrl</span></code></dt>
<dd>Actually set the new control value. s_ctrl is compulsory. The
ctrl-&gt;handler-&gt;lock is held when these ops are called, so no
one else can access controls owned by that handler.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_ctrl_type_ops">
struct <code class="descname">v4l2_ctrl_type_ops</code><a class="headerlink" href="#c.v4l2_ctrl_type_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>The control type operations that the driver has to provide.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_ctrl_type_ops {
  bool (*equal)(const struct v4l2_ctrl *ctrl, u32 idx,union v4l2_ctrl_ptr ptr1, union v4l2_ctrl_ptr ptr2);
  void (*init)(const struct v4l2_ctrl *ctrl, u32 idx, union v4l2_ctrl_ptr ptr);
  void (*log)(const struct v4l2_ctrl *ctrl);
  int (*validate)(const struct v4l2_ctrl *ctrl, u32 idx, union v4l2_ctrl_ptr ptr);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">equal</span></code></dt>
<dd>return true if both values are equal.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">init</span></code></dt>
<dd>initialize the value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">log</span></code></dt>
<dd>log the value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">validate</span></code></dt>
<dd>validate the value. Return 0 on success and a negative value
otherwise.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_ctrl_notify_fnc">
<code class="descname">v4l2_ctrl_notify_fnc</code><a class="headerlink" href="#c.v4l2_ctrl_notify_fnc" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Typedef</strong>: typedef for a notify argument with a function that should be called when a control value has changed.</p>
</dd></dl>

<p><strong>Syntax</strong></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">v4l2_ctrl_notify_fnc</span> <span class="pre">(struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl,</span> <span class="pre">void</span> <span class="pre">*</span> <span class="pre">priv);</span></code></div></blockquote>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">priv</span></code></dt>
<dd>control private data</dd>
</dl>
<p><strong>Description</strong></p>
<p>This typedef definition is used as an argument to <a class="reference internal" href="#c.v4l2_ctrl_notify" title="v4l2_ctrl_notify"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_notify()</span></code></a>
and as an argument at struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_handler</span></code></a>.</p>
<dl class="type">
<dt id="c.v4l2_ctrl">
struct <code class="descname">v4l2_ctrl</code><a class="headerlink" href="#c.v4l2_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>The control structure.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_ctrl {
  struct list_head node;
  struct list_head ev_subs;
  struct v4l2_ctrl_handler *handler;
  struct v4l2_ctrl **cluster;
  unsigned int ncontrols;
  unsigned int done:1;
  unsigned int is_new:1;
  unsigned int has_changed:1;
  unsigned int is_private:1;
  unsigned int is_auto:1;
  unsigned int is_int:1;
  unsigned int is_string:1;
  unsigned int is_ptr:1;
  unsigned int is_array:1;
  unsigned int has_volatiles:1;
  unsigned int call_notify:1;
  unsigned int manual_mode_value:8;
  const struct v4l2_ctrl_ops *ops;
  const struct v4l2_ctrl_type_ops *type_ops;
  u32 id;
  const char *name;
  enum v4l2_ctrl_type type;
  s64 minimum, maximum, default_value;
  u32 elems;
  u32 elem_size;
  u32 dims[V4L2_CTRL_MAX_DIMS];
  u32 nr_of_dims;
  union {
    u64 step;
    u64 menu_skip_mask;
  };
  union {
    const char * const *qmenu;
    const s64 *qmenu_int;
  };
  unsigned long flags;
  void *priv;
  s32 val;
  struct {
    s32 val;
  } cur;
  union v4l2_ctrl_ptr p_new;
  union v4l2_ctrl_ptr p_cur;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">node</span></code></dt>
<dd>The list node.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ev_subs</span></code></dt>
<dd>The list of control event subscriptions.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">handler</span></code></dt>
<dd>The handler that owns the control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cluster</span></code></dt>
<dd>Point to start of cluster array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ncontrols</span></code></dt>
<dd>Number of controls in cluster array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">done</span></code></dt>
<dd>Internal flag: set for each processed control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_new</span></code></dt>
<dd>Set when the user specified a new value for this control. It
is also set when called from <a class="reference internal" href="#c.v4l2_ctrl_handler_setup" title="v4l2_ctrl_handler_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_setup()</span></code></a>. Drivers
should never set this flag.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">has_changed</span></code></dt>
<dd>Set when the current value differs from the new value. Drivers
should never use this flag.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_private</span></code></dt>
<dd>If set, then this control is private to its handler and it
will not be added to any other handlers. Drivers can set
this flag.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_auto</span></code></dt>
<dd>If set, then this control selects whether the other cluster
members are in ‘automatic’ mode or ‘manual’ mode. This is
used for autogain/gain type clusters. Drivers should never
set this flag directly.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_int</span></code></dt>
<dd>If set, then this control has a simple integer value (i.e. it
uses ctrl-&gt;val).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_string</span></code></dt>
<dd>If set, then this control has type <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_TYPE_STRING</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_ptr</span></code></dt>
<dd>If set, then this control is an array and/or has type &gt;=
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_COMPOUND_TYPES</span></code>
and/or has type <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_TYPE_STRING</span></code>. In other words, <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_control" title="v4l2_ext_control"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">v4l2_ext_control</span></code></a> uses field p to point to the data.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_array</span></code></dt>
<dd>If set, then this control contains an N-dimensional array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">has_volatiles</span></code></dt>
<dd>If set, then one or more members of the cluster are volatile.
Drivers should never touch this flag.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">call_notify</span></code></dt>
<dd>If set, then call the handler’s notify function whenever the
control’s value changes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">manual_mode_value</span></code></dt>
<dd>If the is_auto flag is set, then this is the value
of the auto control that determines if that control is in
manual mode. So if the value of the auto control equals this
value, then the whole cluster is in manual mode. Drivers should
never set this flag directly.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt>
<dd>The control ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type_ops</span></code></dt>
<dd>The control type ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>The control name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt>
<dd>The control type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">minimum</span></code></dt>
<dd>The control’s minimum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maximum</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">default_value</span></code></dt>
<dd>The control’s default value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">elems</span></code></dt>
<dd>The number of elements in the N-dimensional array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">elem_size</span></code></dt>
<dd>The size in bytes of the control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dims</span></code></dt>
<dd>The size of each dimension.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nr_of_dims</span></code></dt>
<dd>The number of dimensions in <strong>dims</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_union}</span></code></dt>
<dd>anonymous</dd>
<dt><code class="docutils literal notranslate"><span class="pre">step</span></code></dt>
<dd>The control’s step value for non-menu controls.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">menu_skip_mask</span></code></dt>
<dd>The control’s skip mask for menu controls. This makes it
easy to skip menu items that are not valid. If bit X is set,
then menu item X is skipped. Of course, this only works for
menus with &lt;= 32 menu items. There are no menus that come
close to that number, so this is OK. Should we ever need more,
then this will have to be extended to a u64 or a bit array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_union}</span></code></dt>
<dd>anonymous</dd>
<dt><code class="docutils literal notranslate"><span class="pre">qmenu</span></code></dt>
<dd>A const char * array for all menu items. Array entries that are
empty strings (“”) correspond to non-existing menu items (this
is in addition to the menu_skip_mask above). The last entry
must be NULL.
Used only if the <strong>type</strong> is <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_TYPE_MENU</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">qmenu_int</span></code></dt>
<dd>A 64-bit integer array for with integer menu items.
The size of array must be equal to the menu size, e. g.:
<img class="math" src="../../_images/math/240f8488bde443c2f34f2b319917bcc646717775.png" alt="ceil(\frac{maximum - minimum}{step}) + 1"/>.
Used only if the <strong>type</strong> is <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_TYPE_INTEGER_MENU</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt>
<dd>The control’s flags.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priv</span></code></dt>
<dd>The control’s private pointer. For use by the driver. It is
untouched by the control framework. Note that this pointer is
not freed when the control is deleted. Should this be needed
then a new internal bitfield can be added to tell the framework
to free this pointer.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">val</span></code></dt>
<dd>The control’s new s32 value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cur</span></code></dt>
<dd>Structure to store the current value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cur.val</span></code></dt>
<dd>The control’s current value, if the <strong>type</strong> is represented via
a u32 integer (see <a class="reference internal" href="../uapi/v4l/vidioc-queryctrl.html#c.v4l2_ctrl_type" title="v4l2_ctrl_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_ctrl_type</span></code></a>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_new</span></code></dt>
<dd>The control’s new value represented via a union which provides
a standard way of accessing control types
through a pointer.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_cur</span></code></dt>
<dd>The control’s current value represented via a union which
provides a standard way of accessing control types
through a pointer.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_ctrl_ref">
struct <code class="descname">v4l2_ctrl_ref</code><a class="headerlink" href="#c.v4l2_ctrl_ref" title="Permalink to this definition">¶</a></dt>
<dd><p>The control reference.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_ctrl_ref {
  struct list_head node;
  struct v4l2_ctrl_ref *next;
  struct v4l2_ctrl *ctrl;
  struct v4l2_ctrl_helper *helper;
  bool from_other_dev;
  bool req_done;
  struct v4l2_ctrl_ref *req;
  union v4l2_ctrl_ptr p_req;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">node</span></code></dt>
<dd>List node for the sorted list.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">next</span></code></dt>
<dd>Single-link list node for the hash.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl</span></code></dt>
<dd>The actual control information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">helper</span></code></dt>
<dd>Pointer to helper struct. Used internally in
<code class="docutils literal notranslate"><span class="pre">prepare_ext_ctrls</span></code> function at <code class="docutils literal notranslate"><span class="pre">v4l2-ctrl.c</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">from_other_dev</span></code></dt>
<dd>If true, then <strong>ctrl</strong> was defined in another
device than the <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req_done</span></code></dt>
<dd>Internal flag: if the control handler containing this control
reference is bound to a media request, then this is set when
the control has been applied. This prevents applying controls
from a cluster with multiple controls twice (when the first
control of a cluster is applied, they all are).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req</span></code></dt>
<dd>If set, this refers to another request that sets this control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p_req</span></code></dt>
<dd>If the control handler containing this control reference
is bound to a media request, then this points to the
value of the control that should be applied when the request
is executed, or to the value of the control at the time
that the request was completed.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Each control handler has a list of these refs. The list_head is used to
keep a sorted-by-control-ID list of all controls, while the next pointer
is used to link the control in the hash’s bucket.</p>
<dl class="type">
<dt id="c.v4l2_ctrl_handler">
struct <code class="descname">v4l2_ctrl_handler</code><a class="headerlink" href="#c.v4l2_ctrl_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>The control handler keeps track of all the controls: both the controls owned by the handler and those inherited from other handlers.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_ctrl_handler {
  struct mutex _lock;
  struct mutex *lock;
  struct list_head ctrls;
  struct list_head ctrl_refs;
  struct v4l2_ctrl_ref *cached;
  struct v4l2_ctrl_ref **buckets;
  v4l2_ctrl_notify_fnc notify;
  void *notify_priv;
  u16 nr_of_buckets;
  int error;
  bool request_is_queued;
  struct list_head requests;
  struct list_head requests_queued;
  struct media_request_object req_obj;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">_lock</span></code></dt>
<dd>Default for “lock”.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt>
<dd>Lock to control access to this handler and its controls.
May be replaced by the user right after init.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrls</span></code></dt>
<dd>The list of controls owned by this handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl_refs</span></code></dt>
<dd>The list of control references.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cached</span></code></dt>
<dd>The last found control reference. It is common that the same
control is needed multiple times, so this is a simple
optimization.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buckets</span></code></dt>
<dd>Buckets for the hashing. Allows for quick control lookup.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notify</span></code></dt>
<dd>A notify callback that is called whenever the control changes
value.
Note that the handler’s lock is held when the notify function
is called!</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notify_priv</span></code></dt>
<dd>Passed as argument to the v4l2_ctrl notify callback.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nr_of_buckets</span></code></dt>
<dd>Total number of buckets in the array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">error</span></code></dt>
<dd>The error code of the first failed control addition.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">request_is_queued</span></code></dt>
<dd>True if the request was queued.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">requests</span></code></dt>
<dd>List to keep track of open control handler request objects.
For the parent control handler (<strong>req_obj.req</strong> == NULL) this
is the list header. When the parent control handler is
removed, it has to unbind and put all these requests since
they refer to the parent.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">requests_queued</span></code></dt>
<dd>List of the queued requests. This determines the order
in which these controls are applied. Once the request is
completed it is removed from this list.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req_obj</span></code></dt>
<dd>The <a class="reference internal" href="mc-core.html#c.media_request_object" title="media_request_object"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_request_object</span></code></a>, used to link into a
<a class="reference internal" href="mc-core.html#c.media_request" title="media_request"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_request</span></code></a>. This request object has a refcount.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_ctrl_config">
struct <code class="descname">v4l2_ctrl_config</code><a class="headerlink" href="#c.v4l2_ctrl_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Control configuration structure.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_ctrl_config {
  const struct v4l2_ctrl_ops *ops;
  const struct v4l2_ctrl_type_ops *type_ops;
  u32 id;
  const char *name;
  enum v4l2_ctrl_type type;
  s64 min;
  s64 max;
  u64 step;
  s64 def;
  u32 dims[V4L2_CTRL_MAX_DIMS];
  u32 elem_size;
  u32 flags;
  u64 menu_skip_mask;
  const char * const *qmenu;
  const s64 *qmenu_int;
  unsigned int is_private:1;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt>
<dd>The control ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type_ops</span></code></dt>
<dd>The control type ops. Only needed for compound controls.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>The control name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt>
<dd>The control type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">min</span></code></dt>
<dd>The control’s minimum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">step</span></code></dt>
<dd>The control’s step value for non-menu controls.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dims</span></code></dt>
<dd>The size of each dimension.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">elem_size</span></code></dt>
<dd>The size in bytes of the control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt>
<dd>The control’s flags.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">menu_skip_mask</span></code></dt>
<dd>The control’s skip mask for menu controls. This makes it
easy to skip menu items that are not valid. If bit X is set,
then menu item X is skipped. Of course, this only works for
menus with &lt;= 64 menu items. There are no menus that come
close to that number, so this is OK. Should we ever need more,
then this will have to be extended to a bit array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">qmenu</span></code></dt>
<dd>A const char * array for all menu items. Array entries that are
empty strings (“”) correspond to non-existing menu items (this
is in addition to the menu_skip_mask above). The last entry
must be NULL.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">qmenu_int</span></code></dt>
<dd>A const s64 integer array for all menu items of the type
V4L2_CTRL_TYPE_INTEGER_MENU.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_private</span></code></dt>
<dd>If set, then this control is private to its handler and it
will not be added to any other handlers.</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_fill">
void <code class="descname">v4l2_ctrl_fill</code><span class="sig-paren">(</span>u32<em>&nbsp;id</em>, const char **<em>&nbsp;name</em>, enum <a class="reference internal" href="../uapi/v4l/vidioc-queryctrl.html#c.v4l2_ctrl_type" title="v4l2_ctrl_type">v4l2_ctrl_type</a> *<em>&nbsp;type</em>, s64 *<em>&nbsp;min</em>, s64 *<em>&nbsp;max</em>, u64 *<em>&nbsp;step</em>, s64 *<em>&nbsp;def</em>, u32 *<em>&nbsp;flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_fill" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill in the control fields based on the control ID.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>ID of the control</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">**</span> <span class="pre">name</span></code></dt>
<dd>pointer to be filled with a string with the name of the control</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_ctrl_type</span> <span class="pre">*</span> <span class="pre">type</span></code></dt>
<dd>pointer for storing the type of the control</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">*</span> <span class="pre">min</span></code></dt>
<dd>pointer for storing the minimum value for the control</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">*</span> <span class="pre">max</span></code></dt>
<dd>pointer for storing the maximum value for the control</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">*</span> <span class="pre">step</span></code></dt>
<dd>pointer for storing the control step</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">*</span> <span class="pre">def</span></code></dt>
<dd>pointer for storing the default value for the control</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">*</span> <span class="pre">flags</span></code></dt>
<dd>pointer for storing the flags to be used on the control</dd>
</dl>
<p><strong>Description</strong></p>
<p>This works for all standard V4L2 controls.
For non-standard controls it will only fill in the given arguments
and <strong>name</strong> content will be set to <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>This function will overwrite the contents of <strong>name</strong>, <strong>type</strong> and <strong>flags</strong>.
The contents of <strong>min</strong>, <strong>max</strong>, <strong>step</strong> and <strong>def</strong> may be modified depending on
the type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do not use in drivers! It is used internally for backwards compatibility
control handling only. Once all drivers are converted to use the new
control framework this function will no longer be exported.</p>
</div>
<dl class="function">
<dt id="c.v4l2_ctrl_handler_init_class">
int <code class="descname">v4l2_ctrl_handler_init_class</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, unsigned int<em>&nbsp;nr_of_controls_hint</em>, struct lock_class_key *<em>&nbsp;key</em>, const char *<em>&nbsp;name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_handler_init_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the control handler.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">nr_of_controls_hint</span></code></dt>
<dd>A hint of how many controls this handler is
expected to refer to. This is the total number, so including
any inherited controls. It doesn’t have to be precise, but if
it is way off, then you either waste memory (too many buckets
are allocated) or the control lookup becomes slower (not enough
buckets are allocated, so there are more slow list lookups).
It will always work, though.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">lock_class_key</span> <span class="pre">*</span> <span class="pre">key</span></code></dt>
<dd>Used by the lock validator if CONFIG_LOCKDEP is set.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">name</span></code></dt>
<dd>Used by the lock validator if CONFIG_LOCKDEP is set.</dd>
</dl>
<p><strong>Description</strong></p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Never use this call directly, always use the <a class="reference internal" href="#c.v4l2_ctrl_handler_init" title="v4l2_ctrl_handler_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_init()</span></code></a>
macro that hides the <strong>key</strong> and <strong>name</strong> arguments.</p>
</div>
<p><strong>Return</strong></p>
<p>returns an error if the buckets could not be allocated. This
error will also be stored in <strong>hdl-&gt;error</strong>.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_handler_init">
<code class="descname">v4l2_ctrl_handler_init</code><span class="sig-paren">(</span><em>hdl</em>, <em>nr_of_controls_hint</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_handler_init" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function to create a static struct <code class="xref c c-type docutils literal notranslate"><span class="pre">lock_class_key</span></code> and calls <a class="reference internal" href="#c.v4l2_ctrl_handler_init_class" title="v4l2_ctrl_handler_init_class"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_init_class()</span></code></a></p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nr_of_controls_hint</span></code></dt>
<dd>A hint of how many controls this handler is
expected to refer to. This is the total number, so including
any inherited controls. It doesn’t have to be precise, but if
it is way off, then you either waste memory (too many buckets
are allocated) or the control lookup becomes slower (not enough
buckets are allocated, so there are more slow list lookups).
It will always work, though.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This helper function creates a static struct <code class="xref c c-type docutils literal notranslate"><span class="pre">lock_class_key</span></code> and
calls <a class="reference internal" href="#c.v4l2_ctrl_handler_init_class" title="v4l2_ctrl_handler_init_class"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_handler_init_class()</span></code></a>, providing a proper name for the lock
validador.</p>
<p>Use this helper function to initialize a control handler.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_handler_free">
void <code class="descname">v4l2_ctrl_handler_free</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_handler_free" title="Permalink to this definition">¶</a></dt>
<dd><p>Free all controls owned by the handler and free the control list.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Does nothing if <strong>hdl</strong> == NULL.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_lock">
void <code class="descname">v4l2_ctrl_lock</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to lock the handler associated with the control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to lock.</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_unlock">
void <code class="descname">v4l2_ctrl_unlock</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_unlock" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to unlock the handler associated with the control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to unlock.</dd>
</dl>
<dl class="function">
<dt id="c.__v4l2_ctrl_handler_setup">
int <code class="descname">__v4l2_ctrl_handler_setup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_ctrl_handler_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Call the s_ctrl op for all controls belonging to the handler to initialize the hardware to the current control values. The caller is responsible for acquiring the control handler mutex on behalf of <a class="reference internal" href="#c.__v4l2_ctrl_handler_setup" title="__v4l2_ctrl_handler_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">__v4l2_ctrl_handler_setup()</span></code></a>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Button controls will be skipped, as are read-only controls.</p>
<p>If <strong>hdl</strong> == NULL, then this just returns 0.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_handler_setup">
int <code class="descname">v4l2_ctrl_handler_setup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_handler_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Call the s_ctrl op for all controls belonging to the handler to initialize the hardware to the current control values.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Button controls will be skipped, as are read-only controls.</p>
<p>If <strong>hdl</strong> == NULL, then this just returns 0.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_handler_log_status">
void <code class="descname">v4l2_ctrl_handler_log_status</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, const char *<em>&nbsp;prefix</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_handler_log_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Log all controls owned by the handler.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">prefix</span></code></dt>
<dd>The prefix to use when logging the control values. If the
prefix does not end with a space, then “: ” will be added
after the prefix. If <strong>prefix</strong> == NULL, then no prefix will be
used.</dd>
</dl>
<p><strong>Description</strong></p>
<p>For use with VIDIOC_LOG_STATUS.</p>
<p>Does nothing if <strong>hdl</strong> == NULL.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_new_custom">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_new_custom</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, const struct <a class="reference internal" href="#c.v4l2_ctrl_config" title="v4l2_ctrl_config">v4l2_ctrl_config</a> *<em>&nbsp;cfg</em>, void *<em>&nbsp;priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_new_custom" title="Permalink to this definition">¶</a></dt>
<dd><p>Allocate and initialize a new custom V4L2 control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl_config</span> <span class="pre">*</span> <span class="pre">cfg</span></code></dt>
<dd>The control’s configuration data.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">priv</span></code></dt>
<dd>The control’s driver-specific private data.</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl</span></code></a> struct could not be allocated then NULL is returned
and <strong>hdl-&gt;error</strong> is set to the error code (if it wasn’t set already).</p>
<dl class="function">
<dt id="c.v4l2_ctrl_new_std">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_new_std</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, const struct <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops">v4l2_ctrl_ops</a> *<em>&nbsp;ops</em>, u32<em>&nbsp;id</em>, s64<em>&nbsp;min</em>, s64<em>&nbsp;max</em>, u64<em>&nbsp;step</em>, s64<em>&nbsp;def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_new_std" title="Permalink to this definition">¶</a></dt>
<dd><p>Allocate and initialize a new standard V4L2 non-menu control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl_ops</span> <span class="pre">*</span> <span class="pre">ops</span></code></dt>
<dd>The control ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">min</span></code></dt>
<dd>The control’s minimum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">step</span></code></dt>
<dd>The control’s step value</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl</span></code></a> struct could not be allocated, or the control
ID is not known, then NULL is returned and <strong>hdl-&gt;error</strong> is set to the
appropriate error code (if it wasn’t set already).</p>
<p>If <strong>id</strong> refers to a menu control, then this function will return NULL.</p>
<p>Use <a class="reference internal" href="#c.v4l2_ctrl_new_std_menu" title="v4l2_ctrl_new_std_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu()</span></code></a> when adding menu controls.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_new_std_menu">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_new_std_menu</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, const struct <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops">v4l2_ctrl_ops</a> *<em>&nbsp;ops</em>, u32<em>&nbsp;id</em>, u8<em>&nbsp;max</em>, u64<em>&nbsp;mask</em>, u8<em>&nbsp;def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_new_std_menu" title="Permalink to this definition">¶</a></dt>
<dd><p>Allocate and initialize a new standard V4L2 menu control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl_ops</span> <span class="pre">*</span> <span class="pre">ops</span></code></dt>
<dd>The control ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">mask</span></code></dt>
<dd>The control’s skip mask for menu controls. This makes it
easy to skip menu items that are not valid. If bit X is set,
then menu item X is skipped. Of course, this only works for
menus with &lt;= 64 menu items. There are no menus that come
close to that number, so this is OK. Should we ever need more,
then this will have to be extended to a bit array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Same as <a class="reference internal" href="#c.v4l2_ctrl_new_std" title="v4l2_ctrl_new_std"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std()</span></code></a>, but <strong>min</strong> is set to 0 and the <strong>mask</strong> value
determines which menu items are to be skipped.</p>
<p>If <strong>id</strong> refers to a non-menu control, then this function will return NULL.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_new_std_menu_items">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_new_std_menu_items</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, const struct <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops">v4l2_ctrl_ops</a> *<em>&nbsp;ops</em>, u32<em>&nbsp;id</em>, u8<em>&nbsp;max</em>, u64<em>&nbsp;mask</em>, u8<em>&nbsp;def</em>, const char *const *<em>&nbsp;qmenu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_new_std_menu_items" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new standard V4L2 menu control with driver specific menu.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl_ops</span> <span class="pre">*</span> <span class="pre">ops</span></code></dt>
<dd>The control ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">mask</span></code></dt>
<dd>The control’s skip mask for menu controls. This makes it
easy to skip menu items that are not valid. If bit X is set,
then menu item X is skipped. Of course, this only works for
menus with &lt;= 64 menu items. There are no menus that come
close to that number, so this is OK. Should we ever need more,
then this will have to be extended to a bit array.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*const</span> <span class="pre">*</span> <span class="pre">qmenu</span></code></dt>
<dd>The new menu.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Same as <a class="reference internal" href="#c.v4l2_ctrl_new_std_menu" title="v4l2_ctrl_new_std_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu()</span></code></a>, but <strong>qmenu</strong> will be the driver specific
menu of this control.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_new_int_menu">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_new_int_menu</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, const struct <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops">v4l2_ctrl_ops</a> *<em>&nbsp;ops</em>, u32<em>&nbsp;id</em>, u8<em>&nbsp;max</em>, u8<em>&nbsp;def</em>, const s64 *<em>&nbsp;qmenu_int</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_new_int_menu" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new standard V4L2 integer menu control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl_ops</span> <span class="pre">*</span> <span class="pre">ops</span></code></dt>
<dd>The control ops.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">s64</span> <span class="pre">*</span> <span class="pre">qmenu_int</span></code></dt>
<dd>The control’s menu entries.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Same as <a class="reference internal" href="#c.v4l2_ctrl_new_std_menu" title="v4l2_ctrl_new_std_menu"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_new_std_menu()</span></code></a>, but <strong>mask</strong> is set to 0 and it additionally
takes as an argument an array of integers determining the menu items.</p>
<p>If <strong>id</strong> refers to a non-integer-menu control, then this function will
return <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<dl class="type">
<dt id="c.v4l2_ctrl_filter">
<code class="descname">v4l2_ctrl_filter</code><a class="headerlink" href="#c.v4l2_ctrl_filter" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Typedef</strong>: Typedef to define the filter function to be used when adding a control handler.</p>
</dd></dl>

<p><strong>Syntax</strong></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">v4l2_ctrl_filter</span> <span class="pre">(const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl);</span></code></div></blockquote>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl</span></code></a>.</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_add_handler">
int <code class="descname">v4l2_ctrl_add_handler</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;add</em>, <a class="reference internal" href="#c.v4l2_ctrl_filter" title="v4l2_ctrl_filter">v4l2_ctrl_filter</a><em>&nbsp;filter</em>, bool<em>&nbsp;from_other_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_add_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Add all controls from handler <strong>add</strong> to handler <strong>hdl</strong>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">add</span></code></dt>
<dd>The control handler whose controls you want to add to
the <strong>hdl</strong> control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_ctrl_filter</span> <span class="pre">filter</span></code></dt>
<dd>This function will filter which controls should be added.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">from_other_dev</span></code></dt>
<dd>If true, then the controls in <strong>add</strong> were defined in another
device than <strong>hdl</strong>.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Does nothing if either of the two handlers is a NULL pointer.
If <strong>filter</strong> is NULL, then all controls are added. Otherwise only those
controls for which <strong>filter</strong> returns true will be added.
In case of an error <strong>hdl-&gt;error</strong> will be set to the error code (if it
wasn’t set already).</p>
<dl class="function">
<dt id="c.v4l2_ctrl_radio_filter">
bool <code class="descname">v4l2_ctrl_radio_filter</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_radio_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard filter for radio controls.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control that is filtered.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This will return true for any controls that are valid for radio device
nodes. Those are all of the V4L2_CID_AUDIO_* user controls and all FM
transmitter class controls.</p>
<p>This function is to be used with <a class="reference internal" href="#c.v4l2_ctrl_add_handler" title="v4l2_ctrl_add_handler"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_add_handler()</span></code></a>.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_cluster">
void <code class="descname">v4l2_ctrl_cluster</code><span class="sig-paren">(</span>unsigned int<em>&nbsp;ncontrols</em>, struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> **<em>&nbsp;controls</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark all controls in the cluster as belonging to that cluster.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">ncontrols</span></code></dt>
<dd>The number of controls in this cluster.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">**</span> <span class="pre">controls</span></code></dt>
<dd>The cluster control array of size <strong>ncontrols</strong>.</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_auto_cluster">
void <code class="descname">v4l2_ctrl_auto_cluster</code><span class="sig-paren">(</span>unsigned int<em>&nbsp;ncontrols</em>, struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> **<em>&nbsp;controls</em>, u8<em>&nbsp;manual_val</em>, bool<em>&nbsp;set_volatile</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_auto_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark all controls in the cluster as belonging to that cluster and set it up for autofoo/foo-type handling.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">ncontrols</span></code></dt>
<dd>The number of controls in this cluster.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">**</span> <span class="pre">controls</span></code></dt>
<dd>The cluster control array of size <strong>ncontrols</strong>. The first control
must be the ‘auto’ control (e.g. autogain, autoexposure, etc.)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">manual_val</span></code></dt>
<dd>The value for the first control in the cluster that equals the
manual setting.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">set_volatile</span></code></dt>
<dd>If true, then all controls except the first auto control will
be volatile.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Use for control groups where one control selects some automatic feature and
the other controls are only active whenever the automatic feature is turned
off (manual mode). Typical examples: autogain vs gain, auto-whitebalance vs
red and blue balance, etc.</p>
<p>The behavior of such controls is as follows:</p>
<p>When the autofoo control is set to automatic, then any manual controls
are set to inactive and any reads will call g_volatile_ctrl (if the control
was marked volatile).</p>
<p>When the autofoo control is set to manual, then any manual controls will
be marked active, and any reads will just return the current value without
going through g_volatile_ctrl.</p>
<p>In addition, this function will set the <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_UPDATE</span></code> flag
on the autofoo control and <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_INACTIVE</span></code> on the foo control(s)
if autofoo is in auto mode.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_find">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_find</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, u32<em>&nbsp;id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_find" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a control with the given ID.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID to find.</dd>
</dl>
<p><strong>Description</strong></p>
<p>If <strong>hdl</strong> == NULL this will return NULL as well. Will lock the handler so
do not use from inside <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a>.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_activate">
void <code class="descname">v4l2_ctrl_activate</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, bool<em>&nbsp;active</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_activate" title="Permalink to this definition">¶</a></dt>
<dd><p>Make the control active or inactive.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to (de)activate.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">active</span></code></dt>
<dd>True if the control should become active.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets or clears the V4L2_CTRL_FLAG_INACTIVE flag atomically.
Does nothing if <strong>ctrl</strong> == NULL.
This will usually be called from within the s_ctrl op.
The V4L2_EVENT_CTRL event will be generated afterwards.</p>
<p>This function assumes that the control handler is locked.</p>
<dl class="function">
<dt id="c.__v4l2_ctrl_grab">
void <code class="descname">__v4l2_ctrl_grab</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, bool<em>&nbsp;grabbed</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_ctrl_grab" title="Permalink to this definition">¶</a></dt>
<dd><p>Unlocked variant of v4l2_ctrl_grab.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to (de)activate.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">grabbed</span></code></dt>
<dd>True if the control should become grabbed.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets or clears the V4L2_CTRL_FLAG_GRABBED flag atomically.
Does nothing if <strong>ctrl</strong> == NULL.
The V4L2_EVENT_CTRL event will be generated afterwards.
This will usually be called when starting or stopping streaming in the
driver.</p>
<p>This function assumes that the control handler is locked by the caller.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_grab">
void <code class="descname">v4l2_ctrl_grab</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, bool<em>&nbsp;grabbed</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_grab" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark the control as grabbed or not grabbed.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to (de)activate.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">grabbed</span></code></dt>
<dd>True if the control should become grabbed.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets or clears the V4L2_CTRL_FLAG_GRABBED flag atomically.
Does nothing if <strong>ctrl</strong> == NULL.
The V4L2_EVENT_CTRL event will be generated afterwards.
This will usually be called when starting or stopping streaming in the
driver.</p>
<p>This function assumes that the control handler is not locked and will
take the lock itself.</p>
<dl class="function">
<dt id="c.__v4l2_ctrl_modify_range">
int <code class="descname">__v4l2_ctrl_modify_range</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, s64<em>&nbsp;min</em>, s64<em>&nbsp;max</em>, u64<em>&nbsp;step</em>, s64<em>&nbsp;def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_ctrl_modify_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Unlocked variant of <a class="reference internal" href="#c.v4l2_ctrl_modify_range" title="v4l2_ctrl_modify_range"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_modify_range()</span></code></a></p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to update.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">min</span></code></dt>
<dd>The control’s minimum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">step</span></code></dt>
<dd>The control’s step value</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Update the range of a control on the fly. This works for control types
INTEGER, BOOLEAN, MENU, INTEGER MENU and BITMASK. For menu controls the
<strong>step</strong> value is interpreted as a menu_skip_mask.</p>
<p>An error is returned if one of the range arguments is invalid for this
control type.</p>
<p>The caller is responsible for acquiring the control handler mutex on behalf
of <a class="reference internal" href="#c.__v4l2_ctrl_modify_range" title="__v4l2_ctrl_modify_range"><code class="xref c c-func docutils literal notranslate"><span class="pre">__v4l2_ctrl_modify_range()</span></code></a>.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_modify_range">
int <code class="descname">v4l2_ctrl_modify_range</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, s64<em>&nbsp;min</em>, s64<em>&nbsp;max</em>, u64<em>&nbsp;step</em>, s64<em>&nbsp;def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_modify_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the range of a control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control to update.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">min</span></code></dt>
<dd>The control’s minimum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">max</span></code></dt>
<dd>The control’s maximum value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">step</span></code></dt>
<dd>The control’s step value</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">def</span></code></dt>
<dd>The control’s default value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Update the range of a control on the fly. This works for control types
INTEGER, BOOLEAN, MENU, INTEGER MENU and BITMASK. For menu controls the
<strong>step</strong> value is interpreted as a menu_skip_mask.</p>
<p>An error is returned if one of the range arguments is invalid for this
control type.</p>
<p>This function assumes that the control handler is not locked and will
take the lock itself.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_notify">
void <code class="descname">v4l2_ctrl_notify</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, <a class="reference internal" href="#c.v4l2_ctrl_notify_fnc" title="v4l2_ctrl_notify_fnc">v4l2_ctrl_notify_fnc</a><em>&nbsp;notify</em>, void *<em>&nbsp;priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to set a notify callback for a control.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_ctrl_notify_fnc</span> <span class="pre">notify</span></code></dt>
<dd>The callback function.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">priv</span></code></dt>
<dd>The callback private handle, passed as argument to the callback.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function sets a callback function for the control. If <strong>ctrl</strong> is NULL,
then it will do nothing. If <strong>notify</strong> is NULL, then the notify callback will
be removed.</p>
<p>There can be only one notify. If another already exists, then a WARN_ON
will be issued and the function will do nothing.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_get_name">
const char * <code class="descname">v4l2_ctrl_get_name</code><span class="sig-paren">(</span>u32<em>&nbsp;id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_get_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the name of the control</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns the name of the given control ID or NULL if it isn’t
a known control.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_get_menu">
const char * const * <code class="descname">v4l2_ctrl_get_menu</code><span class="sig-paren">(</span>u32<em>&nbsp;id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_get_menu" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the menu string array of the control</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns the NULL-terminated menu string array name of the
given control ID or NULL if it isn’t a known menu control.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_get_int_menu">
const s64 * <code class="descname">v4l2_ctrl_get_int_menu</code><span class="sig-paren">(</span>u32<em>&nbsp;id</em>, u32 *<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_get_int_menu" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the integer menu array of the control</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The control ID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">*</span> <span class="pre">len</span></code></dt>
<dd>The size of the integer array.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns the integer array of the given control ID or NULL if it
if it isn’t a known integer menu control.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_g_ctrl">
s32 <code class="descname">v4l2_ctrl_g_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_g_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to get the control’s value from within a driver.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This returns the control’s value safely by going through the control
framework. This function will lock the control’s handler, so it cannot be
used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for integer type controls only.</p>
<dl class="function">
<dt id="c.__v4l2_ctrl_s_ctrl">
int <code class="descname">__v4l2_ctrl_s_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, s32<em>&nbsp;val</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_ctrl_s_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Unlocked variant of <a class="reference internal" href="#c.v4l2_ctrl_s_ctrl" title="v4l2_ctrl_s_ctrl"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_s_ctrl()</span></code></a>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s32</span> <span class="pre">val</span></code></dt>
<dd>The new value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets the control’s new value safely by going through the control
framework. This function assumes the control’s handler is already locked,
allowing it to be used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for integer type controls only.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_s_ctrl">
int <code class="descname">v4l2_ctrl_s_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, s32<em>&nbsp;val</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_s_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to set the control’s value from within a driver.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s32</span> <span class="pre">val</span></code></dt>
<dd>The new value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets the control’s new value safely by going through the control
framework. This function will lock the control’s handler, so it cannot be
used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for integer type controls only.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_g_ctrl_int64">
s64 <code class="descname">v4l2_ctrl_g_ctrl_int64</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_g_ctrl_int64" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to get a 64-bit control’s value from within a driver.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This returns the control’s value safely by going through the control
framework. This function will lock the control’s handler, so it cannot be
used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for 64-bit integer type controls only.</p>
<dl class="function">
<dt id="c.__v4l2_ctrl_s_ctrl_int64">
int <code class="descname">__v4l2_ctrl_s_ctrl_int64</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, s64<em>&nbsp;val</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_ctrl_s_ctrl_int64" title="Permalink to this definition">¶</a></dt>
<dd><p>Unlocked variant of <a class="reference internal" href="#c.v4l2_ctrl_s_ctrl_int64" title="v4l2_ctrl_s_ctrl_int64"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_s_ctrl_int64()</span></code></a>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">val</span></code></dt>
<dd>The new value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets the control’s new value safely by going through the control
framework. This function assumes the control’s handler is already locked,
allowing it to be used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for 64-bit integer type controls only.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_s_ctrl_int64">
int <code class="descname">v4l2_ctrl_s_ctrl_int64</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, s64<em>&nbsp;val</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_s_ctrl_int64" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to set a 64-bit control’s value from within a driver.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">s64</span> <span class="pre">val</span></code></dt>
<dd>The new value.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets the control’s new value safely by going through the control
framework. This function will lock the control’s handler, so it cannot be
used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for 64-bit integer type controls only.</p>
<dl class="function">
<dt id="c.__v4l2_ctrl_s_ctrl_string">
int <code class="descname">__v4l2_ctrl_s_ctrl_string</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, const char *<em>&nbsp;s</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_ctrl_s_ctrl_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Unlocked variant of <a class="reference internal" href="#c.v4l2_ctrl_s_ctrl_string" title="v4l2_ctrl_s_ctrl_string"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_s_ctrl_string()</span></code></a>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">s</span></code></dt>
<dd>The new string.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets the control’s new string safely by going through the control
framework. This function assumes the control’s handler is already locked,
allowing it to be used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for string type controls only.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_s_ctrl_string">
int <code class="descname">v4l2_ctrl_s_ctrl_string</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> *<em>&nbsp;ctrl</em>, const char *<em>&nbsp;s</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_s_ctrl_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to set a control’s string value from within a driver.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>The control.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">s</span></code></dt>
<dd>The new string.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This sets the control’s new string safely by going through the control
framework. This function will lock the control’s handler, so it cannot be
used from within the <a class="reference internal" href="#c.v4l2_ctrl_ops" title="v4l2_ctrl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ctrl_ops</span></code></a> functions.</p>
<p>This function is for string type controls only.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_replace">
void <code class="descname">v4l2_ctrl_replace</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event">v4l2_event</a> *<em>&nbsp;old</em>, const struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event">v4l2_event</a> *<em>&nbsp;new</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be used as a callback to <a class="reference internal" href="v4l2-event.html#c.v4l2_subscribed_event_ops" title="v4l2_subscribed_event_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subscribed_event_ops</span></code></a> replace()</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_event</span> <span class="pre">*</span> <span class="pre">old</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_event</span></code></a> with the reported
event;</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_event</span> <span class="pre">*</span> <span class="pre">new</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_event</span></code></a> with the modified
event;</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_merge">
void <code class="descname">v4l2_ctrl_merge</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event">v4l2_event</a> *<em>&nbsp;old</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event">v4l2_event</a> *<em>&nbsp;new</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to be used as a callback to <a class="reference internal" href="v4l2-event.html#c.v4l2_subscribed_event_ops" title="v4l2_subscribed_event_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subscribed_event_ops</span></code></a> merge()</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_event</span> <span class="pre">*</span> <span class="pre">old</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_event</span></code></a> with the reported
event;</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_event</span> <span class="pre">*</span> <span class="pre">new</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-dqevent.html#c.v4l2_event" title="v4l2_event"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_event</span></code></a> with the merged
event;</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_log_status">
int <code class="descname">v4l2_ctrl_log_status</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, void *<em>&nbsp;fh</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_log_status" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function to implement <code class="docutils literal notranslate"><span class="pre">VIDIOC_LOG_STATUS</span></code> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct file</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">fh</span></code></dt>
<dd>unused. Kept just to be compatible to the arguments expected by
<a class="reference internal" href="v4l2-common.html#c.v4l2_ioctl_ops" title="v4l2_ioctl_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ioctl_ops</span></code></a>.vidioc_log_status.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Can be used as a vidioc_log_status function that just dumps all controls
associated with the filehandle.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_subscribe_event">
int <code class="descname">v4l2_ctrl_subscribe_event</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh">v4l2_fh</a> *<em>&nbsp;fh</em>, const struct <a class="reference internal" href="../uapi/v4l/vidioc-subscribe-event.html#c.v4l2_event_subscription" title="v4l2_event_subscription">v4l2_event_subscription</a> *<em>&nbsp;sub</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_subscribe_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Subscribes to an event</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span> <span class="pre">*</span> <span class="pre">fh</span></code></dt>
<dd>pointer to struct v4l2_fh</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_event_subscription</span> <span class="pre">*</span> <span class="pre">sub</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-subscribe-event.html#c.v4l2_event_subscription" title="v4l2_event_subscription"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_event_subscription</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>Can be used as a vidioc_subscribe_event function that just subscribes
control events.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_poll">
__poll_t <code class="descname">v4l2_ctrl_poll</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct poll_table_struct *<em>&nbsp;wait</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_poll" title="Permalink to this definition">¶</a></dt>
<dd><p>function to be used as a callback to the poll() That just polls for control events.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct file</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">poll_table_struct</span> <span class="pre">*</span> <span class="pre">wait</span></code></dt>
<dd>pointer to struct poll_table_struct</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_request_setup">
int <code class="descname">v4l2_ctrl_request_setup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_request" title="media_request">media_request</a> *<em>&nbsp;req</em>, struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;parent</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_request_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function to apply control values in a request</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>The request</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">parent</span></code></dt>
<dd>The parent control handler (‘priv’ in <a class="reference internal" href="mc-core.html#c.media_request_object_find" title="media_request_object_find"><code class="xref c c-func docutils literal notranslate"><span class="pre">media_request_object_find()</span></code></a>)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a helper function to call the control handler’s s_ctrl callback with
the control values contained in the request. Do note that this approach of
applying control values in a request is only applicable to memory-to-memory
devices.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_request_complete">
void <code class="descname">v4l2_ctrl_request_complete</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_request" title="media_request">media_request</a> *<em>&nbsp;req</em>, struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;parent</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_request_complete" title="Permalink to this definition">¶</a></dt>
<dd><p>Complete a control handler request object</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>The request</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">parent</span></code></dt>
<dd>The parent control handler (‘priv’ in <a class="reference internal" href="mc-core.html#c.media_request_object_find" title="media_request_object_find"><code class="xref c c-func docutils literal notranslate"><span class="pre">media_request_object_find()</span></code></a>)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is to be called on each control handler that may have had a
request object associated with it, i.e. control handlers of a driver that
supports requests.</p>
<p>The function first obtains the values of any volatile controls in the control
handler and attach them to the request. Then, the function completes the
request object.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_request_hdl_find">
struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> * <code class="descname">v4l2_ctrl_request_hdl_find</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_request" title="media_request">media_request</a> *<em>&nbsp;req</em>, struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;parent</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_request_hdl_find" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the control handler in the request</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>The request</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">parent</span></code></dt>
<dd>The parent control handler (‘priv’ in <a class="reference internal" href="mc-core.html#c.media_request_object_find" title="media_request_object_find"><code class="xref c c-func docutils literal notranslate"><span class="pre">media_request_object_find()</span></code></a>)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function finds the control handler in the request. It may return
NULL if not found. When done, you must call v4l2_ctrl_request_put_hdl()
with the returned handler pointer.</p>
<p>If the request is not in state VALIDATING or QUEUED, then this function
will always return NULL.</p>
<p>Note that in state VALIDATING the req_queue_mutex is held, so
no objects can be added or deleted from the request.</p>
<p>In state QUEUED it is the driver that will have to ensure this.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_request_hdl_put">
void <code class="descname">v4l2_ctrl_request_hdl_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_request_hdl_put" title="Permalink to this definition">¶</a></dt>
<dd><p>Put the control handler</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>Put this control handler</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function released the control handler previously obtained from’
<a class="reference internal" href="#c.v4l2_ctrl_request_hdl_find" title="v4l2_ctrl_request_hdl_find"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_ctrl_request_hdl_find()</span></code></a>.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_request_hdl_ctrl_find">
struct <a class="reference internal" href="#c.v4l2_ctrl" title="v4l2_ctrl">v4l2_ctrl</a> * <code class="descname">v4l2_ctrl_request_hdl_ctrl_find</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, u32<em>&nbsp;id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_request_hdl_ctrl_find" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a control with the given ID.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>The control handler from the request.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">id</span></code></dt>
<dd>The ID of the control to find.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns a pointer to the control if this control is
part of the request or NULL otherwise.</p>
<dl class="function">
<dt id="c.v4l2_queryctrl">
int <code class="descname">v4l2_queryctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="#c.v4l2_queryctrl" title="v4l2_queryctrl">v4l2_queryctrl</a> *<em>&nbsp;qc</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_queryctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">VIDIOC_QUERYCTRL</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_queryctrl</span> <span class="pre">*</span> <span class="pre">qc</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_queryctrl" title="v4l2_queryctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_queryctrl</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_query_ext_ctrl">
int <code class="descname">v4l2_query_ext_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="#c.v4l2_query_ext_ctrl" title="v4l2_query_ext_ctrl">v4l2_query_ext_ctrl</a> *<em>&nbsp;qc</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_query_ext_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">VIDIOC_QUERY_EXT_CTRL</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_query_ext_ctrl</span> <span class="pre">*</span> <span class="pre">qc</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_query_ext_ctrl" title="v4l2_query_ext_ctrl"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_query_ext_ctrl</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_querymenu">
int <code class="descname">v4l2_querymenu</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="#c.v4l2_querymenu" title="v4l2_querymenu">v4l2_querymenu</a> *<em>&nbsp;qm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_querymenu" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">VIDIOC_QUERYMENU</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_querymenu</span> <span class="pre">*</span> <span class="pre">qm</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_querymenu" title="v4l2_querymenu"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_querymenu</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_g_ctrl">
int <code class="descname">v4l2_g_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-g-ctrl.html#c.v4l2_control" title="v4l2_control">v4l2_control</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_g_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-g-ctrl.html#vidioc-g-ctrl"><span class="std std-ref">VIDIOC_G_CTRL</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_control</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-g-ctrl.html#c.v4l2_control" title="v4l2_control"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_control</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_s_ctrl">
int <code class="descname">v4l2_s_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh">v4l2_fh</a> *<em>&nbsp;fh</em>, struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-g-ctrl.html#c.v4l2_control" title="v4l2_control">v4l2_control</a> *<em>&nbsp;ctrl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_s_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-g-ctrl.html#vidioc-g-ctrl"><span class="std std-ref">VIDIOC_S_CTRL</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span> <span class="pre">*</span> <span class="pre">fh</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_control</span> <span class="pre">*</span> <span class="pre">ctrl</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-g-ctrl.html#c.v4l2_control" title="v4l2_control"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_control</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_g_ext_ctrls">
int <code class="descname">v4l2_g_ext_ctrls</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="mc-core.html#c.media_device" title="media_device">media_device</a> *<em>&nbsp;mdev</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_controls" title="v4l2_ext_controls">v4l2_ext_controls</a> *<em>&nbsp;c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_g_ext_ctrls" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#vidioc-g-ext-ctrls"><span class="std std-ref">VIDIOC_G_EXT_CTRLS</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span> <span class="pre">*</span> <span class="pre">mdev</span></code></dt>
<dd>pointer to <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ext_controls</span> <span class="pre">*</span> <span class="pre">c</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_controls" title="v4l2_ext_controls"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ext_controls</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_try_ext_ctrls">
int <code class="descname">v4l2_try_ext_ctrls</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="mc-core.html#c.media_device" title="media_device">media_device</a> *<em>&nbsp;mdev</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_controls" title="v4l2_ext_controls">v4l2_ext_controls</a> *<em>&nbsp;c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_try_ext_ctrls" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#vidioc-g-ext-ctrls"><span class="std std-ref">VIDIOC_TRY_EXT_CTRLS</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span> <span class="pre">*</span> <span class="pre">mdev</span></code></dt>
<dd>pointer to <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ext_controls</span> <span class="pre">*</span> <span class="pre">c</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_controls" title="v4l2_ext_controls"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ext_controls</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_s_ext_ctrls">
int <code class="descname">v4l2_s_ext_ctrls</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh">v4l2_fh</a> *<em>&nbsp;fh</em>, struct <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler">v4l2_ctrl_handler</a> *<em>&nbsp;hdl</em>, struct <a class="reference internal" href="mc-core.html#c.media_device" title="media_device">media_device</a> *<em>&nbsp;mdev</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_controls" title="v4l2_ext_controls">v4l2_ext_controls</a> *<em>&nbsp;c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_s_ext_ctrls" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#vidioc-g-ext-ctrls"><span class="std std-ref">VIDIOC_S_EXT_CTRLS</span></a> ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span> <span class="pre">*</span> <span class="pre">fh</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span> <span class="pre">*</span> <span class="pre">hdl</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_ctrl_handler" title="v4l2_ctrl_handler"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ctrl_handler</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span> <span class="pre">*</span> <span class="pre">mdev</span></code></dt>
<dd>pointer to <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ext_controls</span> <span class="pre">*</span> <span class="pre">c</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-g-ext-ctrls.html#c.v4l2_ext_controls" title="v4l2_ext_controls"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_ext_controls</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>If hdl == NULL then they will all return -EINVAL.</p>
<dl class="function">
<dt id="c.v4l2_ctrl_subdev_subscribe_event">
int <code class="descname">v4l2_ctrl_subdev_subscribe_event</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a> *<em>&nbsp;sd</em>, struct <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh">v4l2_fh</a> *<em>&nbsp;fh</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-subscribe-event.html#c.v4l2_event_subscription" title="v4l2_event_subscription">v4l2_event_subscription</a> *<em>&nbsp;sub</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_subdev_subscribe_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to implement as a <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_core_ops" title="v4l2_subdev_core_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_core_ops</span></code></a> subscribe_event function that just subscribes control events.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*</span> <span class="pre">sd</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span> <span class="pre">*</span> <span class="pre">fh</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-fh.html#c.v4l2_fh" title="v4l2_fh"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_fh</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_event_subscription</span> <span class="pre">*</span> <span class="pre">sub</span></code></dt>
<dd>pointer to <a class="reference internal" href="../uapi/v4l/vidioc-subscribe-event.html#c.v4l2_event_subscription" title="v4l2_event_subscription"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_event_subscription</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_ctrl_subdev_log_status">
int <code class="descname">v4l2_ctrl_subdev_log_status</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a> *<em>&nbsp;sd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_ctrl_subdev_log_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Log all controls owned by subdev’s control handler.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*</span> <span class="pre">sd</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="v4l2-videobuf.html" class="btn btn-neutral float-right" title="1.13. Videobuf Framework" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="v4l2-event.html" class="btn btn-neutral float-left" title="1.11. V4L2 events" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>