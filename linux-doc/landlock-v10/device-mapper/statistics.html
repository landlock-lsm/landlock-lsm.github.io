

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DM statistics &mdash; The Linux Kernel 5.2.0+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>DM statistics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/device-mapper/statistics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dm-statistics">
<h1>DM statistics<a class="headerlink" href="#dm-statistics" title="Permalink to this headline">¶</a></h1>
<p>Device Mapper supports the collection of I/O statistics on user-defined
regions of a DM device.  If no regions are defined no statistics are
collected so there isn’t any performance impact.  Only bio-based DM
devices are currently supported.</p>
<p>Each user-defined region specifies a starting sector, length and step.
Individual statistics will be collected for each step-sized area within
the range specified.</p>
<p>The I/O statistics counters for each step-sized area of a region are
in the same format as <cite>/sys/block/*/stat</cite> or <cite>/proc/diskstats</cite> (see:
Documentation/iostats.txt).  But two extra counters (12 and 13) are
provided: total time spent reading and writing.  When the histogram
argument is used, the 14th parameter is reported that represents the
histogram of latencies.  All these counters may be accessed by sending
the &#64;stats_print message to the appropriate DM device via dmsetup.</p>
<p>The reported times are in milliseconds and the granularity depends on
the kernel ticks.  When the option precise_timestamps is used, the
reported times are in nanoseconds.</p>
<p>Each region has a corresponding unique identifier, which we call a
region_id, that is assigned when the region is created.  The region_id
must be supplied when querying statistics about the region, deleting the
region, etc.  Unique region_ids enable multiple userspace programs to
request and process statistics for the same DM device without stepping
on each other’s data.</p>
<p>The creation of DM statistics will allocate memory via kmalloc or
fallback to using vmalloc space.  At most, 1/4 of the overall system
memory may be allocated by DM statistics.  The admin can see how much
memory is used by reading:</p>
<blockquote>
<div>/sys/module/dm_mod/parameters/stats_current_allocated_bytes</div></blockquote>
<div class="section" id="messages">
<h2>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl class="docutils">
<dt>&#64;stats_create &lt;range&gt; &lt;step&gt; [&lt;number_of_optional_arguments&gt; &lt;optional_arguments&gt;…] [&lt;program_id&gt; [&lt;aux_data&gt;]]</dt>
<dd><p class="first">Create a new region and return the region_id.</p>
<dl class="last docutils">
<dt>&lt;range&gt;</dt>
<dd><dl class="first last docutils">
<dt>“-“</dt>
<dd>whole device</dd>
<dt>“&lt;start_sector&gt;+&lt;length&gt;”</dt>
<dd>a range of &lt;length&gt; 512-byte sectors
starting with &lt;start_sector&gt;.</dd>
</dl>
</dd>
<dt>&lt;step&gt;</dt>
<dd><dl class="first last docutils">
<dt>“&lt;area_size&gt;”</dt>
<dd>the range is subdivided into areas each containing
&lt;area_size&gt; sectors.</dd>
<dt>“/&lt;number_of_areas&gt;”</dt>
<dd>the range is subdivided into the specified
number of areas.</dd>
</dl>
</dd>
<dt>&lt;number_of_optional_arguments&gt;</dt>
<dd>The number of optional arguments</dd>
<dt>&lt;optional_arguments&gt;</dt>
<dd><p class="first">The following optional arguments are supported:</p>
<dl class="last docutils">
<dt>precise_timestamps</dt>
<dd>use precise timer with nanosecond resolution
instead of the “jiffies” variable.  When this argument is
used, the resulting times are in nanoseconds instead of
milliseconds.  Precise timestamps are a little bit slower
to obtain than jiffies-based timestamps.</dd>
<dt>histogram:n1,n2,n3,n4,…</dt>
<dd>collect histogram of latencies.  The
numbers n1, n2, etc are times that represent the boundaries
of the histogram.  If precise_timestamps is not used, the
times are in milliseconds, otherwise they are in
nanoseconds.  For each range, the kernel will report the
number of requests that completed within this range. For
example, if we use “histogram:10,20,30”, the kernel will
report four numbers a:b:c:d. a is the number of requests
that took 0-10 ms to complete, b is the number of requests
that took 10-20 ms to complete, c is the number of requests
that took 20-30 ms to complete and d is the number of
requests that took more than 30 ms to complete.</dd>
</dl>
</dd>
<dt>&lt;program_id&gt;</dt>
<dd>An optional parameter.  A name that uniquely identifies
the userspace owner of the range.  This groups ranges together
so that userspace programs can identify the ranges they
created and ignore those created by others.
The kernel returns this string back in the output of
&#64;stats_list message, but it doesn’t use it for anything else.
If we omit the number of optional arguments, program id must not
be a number, otherwise it would be interpreted as the number of
optional arguments.</dd>
<dt>&lt;aux_data&gt;</dt>
<dd>An optional parameter.  A word that provides auxiliary data
that is useful to the client program that created the range.
The kernel returns this string back in the output of
&#64;stats_list message, but it doesn’t use this value for anything.</dd>
</dl>
</dd>
<dt>&#64;stats_delete &lt;region_id&gt;</dt>
<dd><p class="first">Delete the region with the specified id.</p>
<dl class="last docutils">
<dt>&lt;region_id&gt;</dt>
<dd>region_id returned from &#64;stats_create</dd>
</dl>
</dd>
<dt>&#64;stats_clear &lt;region_id&gt;</dt>
<dd><p class="first">Clear all the counters except the in-flight i/o counters.</p>
<dl class="last docutils">
<dt>&lt;region_id&gt;</dt>
<dd>region_id returned from &#64;stats_create</dd>
</dl>
</dd>
<dt>&#64;stats_list [&lt;program_id&gt;]</dt>
<dd><p class="first">List all regions registered with &#64;stats_create.</p>
<dl class="docutils">
<dt>&lt;program_id&gt;</dt>
<dd>An optional parameter.
If this parameter is specified, only matching regions
are returned.
If it is not specified, all regions are returned.</dd>
<dt>Output format:</dt>
<dd><dl class="first last docutils">
<dt>&lt;region_id&gt;: &lt;start_sector&gt;+&lt;length&gt; &lt;step&gt; &lt;program_id&gt; &lt;aux_data&gt;</dt>
<dd>precise_timestamps histogram:n1,n2,n3,…</dd>
</dl>
</dd>
</dl>
<p class="last">The strings “precise_timestamps” and “histogram” are printed only
if they were specified when creating the region.</p>
</dd>
<dt>&#64;stats_print &lt;region_id&gt; [&lt;starting_line&gt; &lt;number_of_lines&gt;]</dt>
<dd><p class="first">Print counters for each step-sized area of a region.</p>
<dl class="docutils">
<dt>&lt;region_id&gt;</dt>
<dd>region_id returned from &#64;stats_create</dd>
<dt>&lt;starting_line&gt;</dt>
<dd>The index of the starting line in the output.
If omitted, all lines are returned.</dd>
<dt>&lt;number_of_lines&gt;</dt>
<dd>The number of lines to include in the output.
If omitted, all lines are returned.</dd>
</dl>
<p>Output format for each step-sized area of a region:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>&lt;start_sector&gt;+&lt;length&gt;</dt>
<dd>counters</dd>
</dl>
<p>The first 11 counters have the same meaning as
<cite>/sys/block/*/stat or /proc/diskstats</cite>.</p>
<p>Please refer to Documentation/iostats.txt for details.</p>
<ol class="arabic simple">
<li>the number of reads completed</li>
<li>the number of reads merged</li>
<li>the number of sectors read</li>
<li>the number of milliseconds spent reading</li>
<li>the number of writes completed</li>
<li>the number of writes merged</li>
<li>the number of sectors written</li>
<li>the number of milliseconds spent writing</li>
<li>the number of I/Os currently in progress</li>
<li>the number of milliseconds spent doing I/Os</li>
<li>the weighted number of milliseconds spent doing I/Os</li>
</ol>
<p>Additional counters:</p>
<ol class="arabic simple" start="12">
<li>the total time spent reading in milliseconds</li>
<li>the total time spent writing in milliseconds</li>
</ol>
</div></blockquote>
</dd>
<dt>&#64;stats_print_clear &lt;region_id&gt; [&lt;starting_line&gt; &lt;number_of_lines&gt;]</dt>
<dd><p class="first">Atomically print and then clear all the counters except the
in-flight i/o counters.  Useful when the client consuming the
statistics does not want to lose any statistics (those updated
between printing and clearing).</p>
<dl class="last docutils">
<dt>&lt;region_id&gt;</dt>
<dd>region_id returned from &#64;stats_create</dd>
<dt>&lt;starting_line&gt;</dt>
<dd>The index of the starting line in the output.
If omitted, all lines are printed and then cleared.</dd>
<dt>&lt;number_of_lines&gt;</dt>
<dd>The number of lines to process.
If omitted, all lines are printed and then cleared.</dd>
</dl>
</dd>
<dt>&#64;stats_set_aux &lt;region_id&gt; &lt;aux_data&gt;</dt>
<dd><p class="first">Store auxiliary data aux_data for the specified region.</p>
<dl class="last docutils">
<dt>&lt;region_id&gt;</dt>
<dd>region_id returned from &#64;stats_create</dd>
<dt>&lt;aux_data&gt;</dt>
<dd>The string that identifies data which is useful to the client
program that created the range.  The kernel returns this
string back in the output of &#64;stats_list message, but it
doesn’t use this value for anything.</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Subdivide the DM device ‘vol’ into 100 pieces and start collecting
statistics on them:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmsetup message vol 0 @stats_create - /100
</pre></div>
</div>
<p>Set the auxiliary data string to “foo bar baz” (the escape for each
space must also be escaped, otherwise the shell will consume them):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmsetup message vol 0 @stats_set_aux 0 foo\\ bar\\ baz
</pre></div>
</div>
<p>List the statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmsetup message vol 0 @stats_list
</pre></div>
</div>
<p>Print the statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmsetup message vol 0 @stats_print 0
</pre></div>
</div>
<p>Delete the statistics:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmsetup message vol 0 @stats_delete 0
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>