

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MOXA Smartio/Industio Family Device Driver Installation Guide &mdash; The Linux Kernel 5.2.0+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>MOXA Smartio/Industio Family Device Driver Installation Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/serial/moxa-smartio.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="moxa-smartio-industio-family-device-driver-installation-guide">
<h1>MOXA Smartio/Industio Family Device Driver Installation Guide<a class="headerlink" href="#moxa-smartio-industio-family-device-driver-installation-guide" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This file is outdated. It needs some care in order to make it
updated to Kernel 5.0 and upper</p>
</div>
<p>Copyright (C) 2008, Moxa Inc.</p>
<p>Date: 01/21/2008</p>
<div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The Smartio/Industio/UPCI family Linux driver supports following multiport
boards.</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>2 ports multiport board</dt>
<dd>CP-102U, CP-102UL, CP-102UF
CP-132U-I, CP-132UL,
CP-132, CP-132I, CP132S, CP-132IS,
CI-132, CI-132I, CI-132IS,
(C102H, C102HI, C102HIS, C102P, CP-102, CP-102S)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>4 ports multiport board</dt>
<dd>CP-104EL,
CP-104UL, CP-104JU,
CP-134U, CP-134U-I,
C104H/PCI, C104HS/PCI,
CP-114, CP-114I, CP-114S, CP-114IS, CP-114UL,
C104H, C104HS,
CI-104J, CI-104JS,
CI-134, CI-134I, CI-134IS,
(C114HI, CT-114I, C104P),
POS-104UL,
CB-114,
CB-134I</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>8 ports multiport board</dt>
<dd>CP-118EL, CP-168EL,
CP-118U, CP-168U,
C168H/PCI,
C168H, C168HS,
(C168P),
CB-108</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>This driver and installation procedure have been developed upon Linux Kernel
2.4.x and 2.6.x. This driver supports Intel x86 hardware platform. In order
to maintain compatibility, this version has also been properly tested with
RedHat, Mandrake, Fedora and S.u.S.E Linux. However, if compatibility problem
occurs, please contact Moxa at <a class="reference external" href="mailto:support&#37;&#52;&#48;moxa&#46;com&#46;tw">support<span>&#64;</span>moxa<span>&#46;</span>com<span>&#46;</span>tw</a>.</p>
<p>In addition to device driver, useful utilities are also provided in this
version. They are:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>msdiag</dt>
<dd>Diagnostic program for displaying installed Moxa
Smartio/Industio boards.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>msmon</dt>
<dd>Monitor program to observe data count and line status signals.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>msterm     A simple terminal program which is useful in testing serial</dt>
<dd>ports.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>io-irq.exe</dt>
<dd>Configuration program to setup ISA boards. Please note that
this program can only be executed under DOS.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>All the drivers and utilities are published in form of source code under
GNU General Public License in this version. Please refer to GNU General
Public License announcement in each source code file for more detail.</p>
<p>In Moxa’s Web sites, you may always find latest driver at <a class="reference external" href="http://www.moxa.com/">http://www.moxa.com/</a>.</p>
<p>This version of driver can be installed as Loadable Module (Module driver)
or built-in into kernel (Static driver). You may refer to following
installation procedure for suitable one. Before you install the driver,
please refer to hardware installation procedure in the User’s Manual.</p>
<p>We assume the user should be familiar with following documents.</p>
<ul class="simple">
<li>Serial-HOWTO</li>
<li>Kernel-HOWTO</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="system-requirement">
<h2>2. System Requirement<a class="headerlink" href="#system-requirement" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Hardware platform: Intel x86 machine</li>
<li>Kernel version: 2.4.x or 2.6.x</li>
<li>gcc version 2.72 or later</li>
<li>Maximum 4 boards can be installed in combination</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="installation">
<h2>3. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hardware-installation">
<h3>3.1 Hardware installation<a class="headerlink" href="#hardware-installation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>There are two types of buses, ISA and PCI, for Smartio/Industio
family multiport board.</div></blockquote>
<div class="section" id="isa-board">
<h4>ISA board<a class="headerlink" href="#isa-board" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>You’ll have to configure CAP address, I/O address, Interrupt Vector
as well as IRQ before installing this driver. Please refer to hardware
installation procedure in User’s Manual before proceed any further.
Please make sure the JP1 is open after the ISA board is set properly.</div></blockquote>
</div>
<div class="section" id="pci-upci-board">
<h4>PCI/UPCI board<a class="headerlink" href="#pci-upci-board" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>You may need to adjust IRQ usage in BIOS to avoid from IRQ conflict
with other ISA devices. Please refer to hardware installation
procedure in User’s Manual in advance.</div></blockquote>
</div>
<div class="section" id="pci-irq-sharing">
<h4>PCI IRQ Sharing<a class="headerlink" href="#pci-irq-sharing" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>Each port within the same multiport board shares the same IRQ. Up to
4 Moxa Smartio/Industio PCI Family multiport boards can be installed
together on one system and they can share the same IRQ.</div></blockquote>
</div>
</div>
<div class="section" id="driver-files">
<h3>3.2 Driver files<a class="headerlink" href="#driver-files" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The driver file may be obtained from ftp, CD-ROM or floppy disk. The
first step, anyway, is to copy driver file “mxser.tgz” into specified
directory. e.g. /moxa. The execute commands as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /
# mkdir moxa
# cd /moxa
# tar xvf /dev/fd0
</pre></div>
</div>
</div></blockquote>
<p>or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /
# mkdir moxa
# cd /moxa
# cp /mnt/cdrom/&lt;driver directory&gt;/mxser.tgz .
# tar xvfz mxser.tgz
</pre></div>
</div>
</div>
<div class="section" id="device-naming-convention">
<h3>3.3 Device naming convention<a class="headerlink" href="#device-naming-convention" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>You may find all the driver and utilities files in /moxa/mxser.
Following installation procedure depends on the model you’d like to
run the driver. If you prefer module driver, please refer to 3.4.
If static driver is required, please refer to 3.5.</div></blockquote>
<div class="section" id="dialin-and-callout-port">
<h4>Dialin and callout port<a class="headerlink" href="#dialin-and-callout-port" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This driver remains traditional serial device properties. There are
two special file name for each serial port. One is dial-in port
which is named “ttyMxx”. For callout port, the naming convention
is “cumxx”.</div></blockquote>
</div>
<div class="section" id="device-naming-when-more-than-2-boards-installed">
<h4>Device naming when more than 2 boards installed<a class="headerlink" href="#device-naming-when-more-than-2-boards-installed" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Naming convention for each Smartio/Industio multiport board is
pre-defined as below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="37%" />
<col width="34%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Board Num.</td>
<td>Dial-in Port</td>
<td>Callout port</td>
</tr>
<tr class="row-even"><td>1st board</td>
<td>ttyM0  - ttyM7</td>
<td>cum0  - cum7</td>
</tr>
<tr class="row-odd"><td>2nd board</td>
<td>ttyM8  - ttyM15</td>
<td>cum8  - cum15</td>
</tr>
<tr class="row-even"><td>3rd board</td>
<td>ttyM16 - ttyM23</td>
<td>cum16 - cum23</td>
</tr>
<tr class="row-odd"><td>4th board</td>
<td>ttyM24 - ttym31</td>
<td>cum24 - cum31</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Under Kernel 2.6 and upper, the cum Device is Obsolete. So use ttyM*
device instead.</p>
</div>
</div>
<div class="section" id="board-sequence">
<h4>Board sequence<a class="headerlink" href="#board-sequence" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This driver will activate ISA boards according to the parameter set
in the driver. After all specified ISA board activated, PCI board
will be installed in the system automatically driven.
Therefore the board number is sorted by the CAP address of ISA boards.
For PCI boards, their sequence will be after ISA boards and C168H/PCI
has higher priority than C104H/PCI boards.</div></blockquote>
</div>
</div>
<div class="section" id="module-driver-configuration">
<h3>3.4 Module driver configuration<a class="headerlink" href="#module-driver-configuration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Module driver is easiest way to install. If you prefer static driver
installation, please skip this paragraph.</p>
<p>————- Prepare to use the MOXA driver ——————–</p>
</div></blockquote>
<div class="section" id="create-tty-device-with-correct-major-number">
<h4>3.4.1 Create tty device with correct major number<a class="headerlink" href="#create-tty-device-with-correct-major-number" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Before using MOXA driver, your system must have the tty devices
which are created with driver’s major number. We offer one shell
script “msmknod” to simplify the procedure.
This step is only needed to be executed once. But you still
need to do this procedure when:</p>
<ol class="loweralpha simple">
<li>You change the driver’s major number. Please refer the “3.7”
section.</li>
<li>Your total installed MOXA boards number is changed. Maybe you
add/delete one MOXA board.</li>
<li>You want to change the tty name. This needs to modify the
shell script “msmknod”</li>
</ol>
<p>The procedure is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /moxa/mxser/driver
# ./msmknod
</pre></div>
</div>
<p>This shell script will require the major number for dial-in
device and callout device to create tty device. You also need
to specify the total installed MOXA board number. Default major
numbers for dial-in device and callout device are 30, 35. If
you need to change to other number, please refer section “3.7”
for more detailed procedure.
Msmknod will delete any special files occupying the same device
naming.</p>
</div></blockquote>
</div>
<div class="section" id="build-the-moxa-driver-and-utilities">
<h4>3.4.2 Build the MOXA driver and utilities<a class="headerlink" href="#build-the-moxa-driver-and-utilities" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Before using the MOXA driver and utilities, you need compile the
all the source code. This step is only need to be executed once.
But you still re-compile the source code if you modify the source
code. For example, if you change the driver’s major number (see
“3.7” section), then you need to do this step again.</p>
<p>Find “Makefile” in /moxa/mxser, then run</p>
<blockquote>
<div># make clean; make install</div></blockquote>
<p>..note:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>For Red Hat 9, Red Hat Enterprise Linux AS3/ES3/WS3 &amp; Fedora Core1:
# make clean; make installsp1

For Red Hat Enterprise Linux AS4/ES4/WS4:
# make clean; make installsp2
</pre></div>
</div>
<p>The driver files “mxser.o” and utilities will be properly compiled
and copied to system directories respectively.</p>
</div></blockquote>
<p>————- Load MOXA driver——————–</p>
</div>
<div class="section" id="load-the-moxa-driver">
<h4>3.4.3 Load the MOXA driver<a class="headerlink" href="#load-the-moxa-driver" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span># modprobe mxser &lt;argument&gt;
</pre></div>
</div>
<p>will activate the module driver. You may run “lsmod” to check
if “mxser” is activated. If the MOXA board is ISA board, the
&lt;argument&gt; is needed. Please refer to section “3.4.5” for more
information.</p>
</div></blockquote>
<p>————- Load MOXA driver on boot ——————–</p>
</div>
<div class="section" id="load-the-mxser-driver">
<h4>3.4.4 Load the mxser driver<a class="headerlink" href="#load-the-mxser-driver" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>For the above description, you may manually execute
“modprobe mxser” to activate this driver and run
“rmmod mxser” to remove it.</p>
<p>However, it’s better to have a boot time configuration to
eliminate manual operation. Boot time configuration can be
achieved by rc file. We offer one “rc.mxser” file to simplify
the procedure under “moxa/mxser/driver”.</p>
<p>But if you use ISA board, please modify the “modprobe …” command
to add the argument (see “3.4.5” section). After modifying the
rc.mxser, please try to execute “/moxa/mxser/driver/rc.mxser”
manually to make sure the modification is ok. If any error
encountered, please try to modify again. If the modification is
completed, follow the below step.</p>
<p>Run following command for setting rc files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /moxa/mxser/driver
# cp ./rc.mxser /etc/rc.d
# cd /etc/rc.d
</pre></div>
</div>
<p>Check “rc.serial” is existed or not. If “rc.serial” doesn’t exist,
create it by vi, run “chmod 755 rc.serial” to change the permission.</p>
<p>Add “/etc/rc.d/rc.mxser” in last line.</p>
<p>Reboot and check if moxa.o activated by “lsmod” command.</p>
</div></blockquote>
</div>
<div class="section" id="specify-cap-address">
<h4>3.4.5. specify CAP address<a class="headerlink" href="#specify-cap-address" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>If you’d like to drive Smartio/Industio ISA boards in the system,
you’ll have to add parameter to specify CAP address of given
board while activating “mxser.o”. The format for parameters are
as follows.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe mxser ioaddr=0x???,0x???,0x???,0x???
                       |  |  |    |
                       |  |  |    +- 4th ISA board
                       |  |  +------ 3rd ISA board
                       |  +------------ 2nd ISA board
                       +-------------------1st ISA board
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="static-driver-configuration-for-linux-kernel-2-4-x-and-2-6-x">
<h3>3.5 Static driver configuration for Linux kernel 2.4.x and 2.6.x<a class="headerlink" href="#static-driver-configuration-for-linux-kernel-2-4-x-and-2-6-x" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="docutils">
<dt>Note:</dt>
<dd>To use static driver, you must install the linux kernel
source package.</dd>
</dl>
</div></blockquote>
<div class="section" id="backup-the-built-in-driver-in-the-kernel">
<h4>3.5.1 Backup the built-in driver in the kernel<a class="headerlink" href="#backup-the-built-in-driver-in-the-kernel" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /usr/src/linux/drivers/char
# mv mxser.c mxser.c.old

For Red Hat 7.x user, you need to create link:
# cd /usr/src
# ln -s linux-2.4 linux
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="create-link">
<h4>3.5.2 Create link<a class="headerlink" href="#create-link" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /usr/src/linux/drivers/char
# ln -s /moxa/mxser/driver/mxser.c mxser.c
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="add-cap-address-list-for-isa-boards">
<h4>3.5.3 Add CAP address list for ISA boards.<a class="headerlink" href="#add-cap-address-list-for-isa-boards" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>For PCI boards user, please skip this step.</p>
<p>In module mode, the CAP address for ISA board is given by
parameter. In static driver configuration, you’ll have to
assign it within driver’s source code. If you will not
install any ISA boards, you may skip to next portion.
The instructions to modify driver source code are as
below.</p>
<ol class="loweralpha">
<li><p class="first">run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /moxa/mxser/driver
# vi mxser.c
</pre></div>
</div>
</li>
<li><p class="first">Find the array mxserBoardCAP[] as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static int mxserBoardCAP[] = {0x00, 0x00, 0x00, 0x00};
</pre></div>
</div>
</li>
<li><p class="first">Change the address within this array using vi. For
example, to driver 2 ISA boards with CAP address
0x280 and 0x180 as 1st and 2nd board. Just to change
the source code as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static int mxserBoardCAP[] = {0x280, 0x180, 0x00, 0x00};
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="setup-kernel-configuration">
<h4>3.5.4 Setup kernel configuration<a class="headerlink" href="#setup-kernel-configuration" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Configure the kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /usr/src/linux
# make menuconfig
</pre></div>
</div>
<p>You will go into a menu-driven system. Please select [Character
devices][Non-standard serial port support], enable the [Moxa
SmartIO support] driver with “[*]” for built-in (not “[M]”), then
select [Exit] to exit this program.</p>
</div></blockquote>
</div>
<div class="section" id="rebuild-kernel">
<h4>3.5.5 Rebuild kernel<a class="headerlink" href="#rebuild-kernel" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>The following are for Linux kernel rebuilding, for your
reference only.</p>
<p>For appropriate details, please refer to the Linux document:</p>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">Run the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd /usr/src/linux
make clean              # take a few minutes
make dep                # take a few minutes
make bzImage            # take probably 10-20 minutes
make install            # copy boot image to correct position
</pre></div>
</div>
</li>
</ol>
<ol class="loweralpha simple" start="6">
<li>Please make sure the boot kernel (vmlinuz) is in the
correct position.</li>
<li>If you use ‘lilo’ utility, you should check /etc/lilo.conf
‘image’ item specified the path which is the ‘vmlinuz’ path,
or you will load wrong (or old) boot kernel image (vmlinuz).
After checking /etc/lilo.conf, please run “lilo”.</li>
</ol>
<blockquote>
<div>Note that if the result of “make bzImage” is ERROR, then you have to
go back to Linux configuration Setup. Type “make menuconfig” in
directory /usr/src/linux.</div></blockquote>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="make-tty-device-and-special-file">
<h4>3.5.6 Make tty device and special file<a class="headerlink" href="#make-tty-device-and-special-file" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><dl class="docutils">
<dt>::</dt>
<dd># cd /moxa/mxser/driver
# ./msmknod</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="make-utility">
<h4>3.5.7 Make utility<a class="headerlink" href="#make-utility" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /moxa/mxser/utility
# make clean; make install
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="reboot">
<h4>3.5.8 Reboot<a class="headerlink" href="#reboot" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="custom-configuration">
<h3>3.6 Custom configuration<a class="headerlink" href="#custom-configuration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Although this driver already provides you default configuration, you
still can change the device name and major number. The instruction to
change these parameters are shown as below.</div></blockquote>
<ol class="loweralpha">
<li><p class="first">Change Device name</p>
<blockquote>
<div><p>If you’d like to use other device names instead of default naming
convention, all you have to do is to modify the internal code
within the shell script “msmknod”. First, you have to open “msmknod”
by vi. Locate each line contains “ttyM” and “cum” and change them
to the device name you desired. “msmknod” creates the device names
you need next time executed.</p>
</div></blockquote>
</li>
<li><p class="first">Change Major number</p>
<blockquote>
<div><p>If major number 30 and 35 had been occupied, you may have to select
2 free major numbers for this driver. There are 3 steps to change
major numbers.</p>
</div></blockquote>
</li>
</ol>
<div class="section" id="find-free-major-numbers">
<h4>3.6.1 Find free major numbers<a class="headerlink" href="#find-free-major-numbers" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>In /proc/devices, you may find all the major numbers occupied
in the system. Please select 2 major numbers that are available.
e.g. 40, 45.</div></blockquote>
</div>
<div class="section" id="create-special-files">
<h4>3.6.2 Create special files<a class="headerlink" href="#create-special-files" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>Run /moxa/mxser/driver/msmknod to create special files with
specified major numbers.</div></blockquote>
</div>
<div class="section" id="modify-driver-with-new-major-number">
<h4>3.6.3 Modify driver with new major number<a class="headerlink" href="#modify-driver-with-new-major-number" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Run vi to open /moxa/mxser/driver/mxser.c. Locate the line
contains “MXSERMAJOR”. Change the content as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>      #define         MXSERMAJOR              40
      #define         MXSERCUMAJOR            45

3.6.4 Run &quot;make clean; make install&quot; in /moxa/mxser/driver.
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="verify-driver-installation">
<h3>3.7 Verify driver installation<a class="headerlink" href="#verify-driver-installation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>You may refer to /var/log/messages to check the latest status
log reported by this driver whenever it’s activated.</div></blockquote>
</div>
</div>
<div class="section" id="utilities">
<h2>4. Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>There are 3 utilities contained in this driver. They are msdiag, msmon and
msterm. These 3 utilities are released in form of source code. They should
be compiled into executable file and copied into /usr/bin.</p>
<p>Before using these utilities, please load driver (refer 3.4 &amp; 3.5) and
make sure you had run the “msmknod” utility.</p>
</div></blockquote>
<div class="section" id="msdiag-diagnostic">
<h3>msdiag - Diagnostic<a class="headerlink" href="#msdiag-diagnostic" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>This utility provides the function to display what Moxa Smartio/Industio
board found by driver in the system.</div></blockquote>
</div>
<div class="section" id="msmon-port-monitoring">
<h3>msmon - Port Monitoring<a class="headerlink" href="#msmon-port-monitoring" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>This utility gives the user a quick view about all the MOXA ports’
activities. One can easily learn each port’s total received/transmitted
(Rx/Tx) character count since the time when the monitoring is started.</p>
<p>Rx/Tx throughputs per second are also reported in interval basis (e.g.
the last 5 seconds) and in average basis (since the time the monitoring
is started). You can reset all ports’ count by &lt;HOME&gt; key. &lt;+&gt; &lt;-&gt;
(plus/minus) keys to change the displaying time interval. Press &lt;ENTER&gt;
on the port, that cursor stay, to view the port’s communication
parameters, signal status, and input/output queue.</p>
</div></blockquote>
</div>
<div class="section" id="msterm-terminal-emulation">
<h3>msterm - Terminal Emulation<a class="headerlink" href="#msterm-terminal-emulation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>This utility provides data sending and receiving ability of all tty ports,
especially for MOXA ports. It is quite useful for testing simple
application, for example, sending AT command to a modem connected to the
port or used as a terminal for login purpose. Note that this is only a
dumb terminal emulation without handling full screen operation.</div></blockquote>
</div>
</div>
<div class="section" id="setserial">
<h2>5. Setserial<a class="headerlink" href="#setserial" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Supported Setserial parameters are listed as below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>uart</td>
<td>set UART type(16450–&gt;disable FIFO, 16550A–&gt;enable FIFO)</td>
</tr>
<tr class="row-even"><td>close_delay</td>
<td>set the amount of time(in 1/100 of a second) that DTR
should be kept low while being closed.</td>
</tr>
<tr class="row-odd"><td>closing_wait</td>
<td>set the amount of time(in 1/100 of a second) that the
serial port should wait for data to be drained while
being closed, before the receiver is disable.</td>
</tr>
<tr class="row-even"><td>spd_hi</td>
<td>Use  57.6kb  when  the application requests 38.4kb.</td>
</tr>
<tr class="row-odd"><td>spd_vhi</td>
<td>Use  115.2kb  when  the application requests 38.4kb.</td>
</tr>
<tr class="row-even"><td>spd_shi</td>
<td>Use  230.4kb  when  the application requests 38.4kb.</td>
</tr>
<tr class="row-odd"><td>spd_warp</td>
<td>Use  460.8kb  when  the application requests 38.4kb.</td>
</tr>
<tr class="row-even"><td>spd_normal</td>
<td>Use  38.4kb  when  the application requests 38.4kb.</td>
</tr>
<tr class="row-odd"><td>spd_cust</td>
<td>Use  the custom divisor to set the speed when  the
application requests 38.4kb.</td>
</tr>
<tr class="row-even"><td>divisor</td>
<td>This option set the custom division.</td>
</tr>
<tr class="row-odd"><td>baud_base</td>
<td>This option set the base baud rate.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="troubleshooting">
<h2>6. Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The boot time error messages and solutions are stated as clearly as
possible. If all the possible solutions fail, please contact our technical
support team to get more help.</p>
<dl class="docutils">
<dt>Error msg:</dt>
<dd>More than 4 Moxa Smartio/Industio family boards found. Fifth board
and after are ignored.</dd>
</dl>
<p>Solution:
To avoid this problem, please unplug fifth and after board, because Moxa
driver supports up to 4 boards.</p>
<dl class="docutils">
<dt>Error msg:</dt>
<dd>Request_irq fail, IRQ(?) may be conflict with another device.</dd>
</dl>
<p>Solution:
Other PCI or ISA devices occupy the assigned IRQ. If you are not sure
which device causes the situation, please check /proc/interrupts to find
free IRQ and simply change another free IRQ for Moxa board.</p>
<dl class="docutils">
<dt>Error msg:</dt>
<dd>Board #: C1xx Series(CAP=xxx) interrupt number invalid.</dd>
</dl>
<p>Solution:
Each port within the same multiport board shares the same IRQ. Please set
one IRQ (IRQ doesn’t equal to zero) for one Moxa board.</p>
<dl class="docutils">
<dt>Error msg:</dt>
<dd>No interrupt vector be set for Moxa ISA board(CAP=xxx).</dd>
</dl>
<p>Solution:
Moxa ISA board needs an interrupt vector.Please refer to user’s manual
“Hardware Installation” chapter to set interrupt vector.</p>
<dl class="docutils">
<dt>Error msg:</dt>
<dd>Couldn’t install MOXA Smartio/Industio family driver!</dd>
</dl>
<p>Solution:
Load Moxa driver fail, the major number may conflict with other devices.
Please refer to previous section 3.7 to change a free major number for
Moxa driver.</p>
<dl class="docutils">
<dt>Error msg:</dt>
<dd>Couldn’t install MOXA Smartio/Industio family callout driver!</dd>
</dl>
<p>Solution:
Load Moxa callout driver fail, the callout device major number may
conflict with other devices. Please refer to previous section 3.7 to
change a free callout device major number for Moxa driver.</p>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>