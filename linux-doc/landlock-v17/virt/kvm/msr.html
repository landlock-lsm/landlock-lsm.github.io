

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>KVM-specific MSRs &mdash; The Linux Kernel 5.7.0-rc5+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Nested VMX" href="nested-vmx.html" />
    <link rel="prev" title="The x86 kvm shadow mmu" href="mmu.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Virtualization Support</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">KVM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api.html">The Definitive KVM (Kernel-based Virtual Machine) API Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="amd-memory-encryption.html">Secure Encrypted Virtualization (SEV)</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpuid.html">KVM CPUID bits</a></li>
<li class="toctree-l3"><a class="reference internal" href="halt-polling.html">The KVM halt polling system</a></li>
<li class="toctree-l3"><a class="reference internal" href="hypercalls.html">Linux KVM Hypercall</a></li>
<li class="toctree-l3"><a class="reference internal" href="locking.html">KVM Lock Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmu.html">The x86 kvm shadow mmu</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">KVM-specific MSRs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-msr-list">Custom MSR list</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="nested-vmx.html">Nested VMX</a></li>
<li class="toctree-l3"><a class="reference internal" href="ppc-pv.html">The PPC KVM paravirtual interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-diag.html">The s390 DIAGNOSE call on KVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-pv.html">s390 (IBM Z) Ultravisor and Protected VMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-pv-boot.html">s390 (IBM Z) Boot/IPL of Protected VMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="timekeeping.html">Timekeeping Virtualization for X86-Based Architectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="vcpu-requests.html">KVM VCPU Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="review-checklist.html">Review checklist for kvm patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="arm/index.html">ARM</a></li>
<li class="toctree-l3"><a class="reference internal" href="devices/index.html">Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="running-nested-guests.html">Running nested guests with KVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../uml/user_mode_linux.html">User Mode Linux HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paravirt_ops.html">Paravirt_ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guest-halt-polling.html">Guest halt polling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Virtualization Support</a> &raquo;</li>
        
          <li><a href="index.html">KVM</a> &raquo;</li>
        
      <li>KVM-specific MSRs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/virt/kvm/msr.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kvm-specific-msrs">
<h1>KVM-specific MSRs<a class="headerlink" href="#kvm-specific-msrs" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Glauber Costa &lt;<a class="reference external" href="mailto:glommer&#37;&#52;&#48;redhat&#46;com">glommer<span>&#64;</span>redhat<span>&#46;</span>com</a>&gt;, Red Hat Inc, 2010</p>
</dd>
</dl>
<p>KVM makes use of some custom MSRs to service some requests.</p>
<p>Custom MSRs have a range reserved for them, that goes from
0x4b564d00 to 0x4b564dff. There are MSRs outside this area,
but they are deprecated and their use is discouraged.</p>
<div class="section" id="custom-msr-list">
<h2>Custom MSR list<a class="headerlink" href="#custom-msr-list" title="Permalink to this headline">¶</a></h2>
<p>The current supported Custom MSR list is:</p>
<dl>
<dt>MSR_KVM_WALL_CLOCK_NEW:</dt><dd><p>0x4b564d00</p>
</dd>
<dt>data:</dt><dd><p>4-byte alignment physical address of a memory area which must be
in guest RAM. This memory is expected to hold a copy of the following
structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pvclock_wall_clock {
       u32   version;
       u32   sec;
       u32   nsec;
 } __attribute__((__packed__));
</pre></div>
</div>
<p>whose data will be filled in by the hypervisor. The hypervisor is only
guaranteed to update this data at the moment of MSR write.
Users that want to reliably query this information more than once have
to write more than once to this MSR. Fields have the following meanings:</p>
<dl class="simple">
<dt>version:</dt><dd><p>guest has to check version before and after grabbing
time information and check that they are both equal and even.
An odd version indicates an in-progress update.</p>
</dd>
<dt>sec:</dt><dd><p>number of seconds for wallclock at time of boot.</p>
</dd>
<dt>nsec:</dt><dd><p>number of nanoseconds for wallclock at time of boot.</p>
</dd>
</dl>
<p>In order to get the current wallclock time, the system_time from
MSR_KVM_SYSTEM_TIME_NEW needs to be added.</p>
<p>Note that although MSRs are per-CPU entities, the effect of this
particular MSR is global.</p>
<p>Availability of this MSR must be checked via bit 3 in 0x4000001 cpuid
leaf prior to usage.</p>
</dd>
<dt>MSR_KVM_SYSTEM_TIME_NEW:</dt><dd><p>0x4b564d01</p>
</dd>
<dt>data:</dt><dd><p>4-byte aligned physical address of a memory area which must be in
guest RAM, plus an enable bit in bit 0. This memory is expected to hold
a copy of the following structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pvclock_vcpu_time_info {
      u32   version;
      u32   pad0;
      u64   tsc_timestamp;
      u64   system_time;
      u32   tsc_to_system_mul;
      s8    tsc_shift;
      u8    flags;
      u8    pad[2];
} __attribute__((__packed__)); /* 32 bytes */
</pre></div>
</div>
<p>whose data will be filled in by the hypervisor periodically. Only one
write, or registration, is needed for each VCPU. The interval between
updates of this structure is arbitrary and implementation-dependent.
The hypervisor may update this structure at any time it sees fit until
anything with bit0 == 0 is written to it.</p>
<p>Fields have the following meanings:</p>
<dl>
<dt>version:</dt><dd><p>guest has to check version before and after grabbing
time information and check that they are both equal and even.
An odd version indicates an in-progress update.</p>
</dd>
<dt>tsc_timestamp:</dt><dd><p>the tsc value at the current VCPU at the time
of the update of this structure. Guests can subtract this value
from current tsc to derive a notion of elapsed time since the
structure update.</p>
</dd>
<dt>system_time:</dt><dd><p>a host notion of monotonic time, including sleep
time at the time this structure was last updated. Unit is
nanoseconds.</p>
</dd>
<dt>tsc_to_system_mul:</dt><dd><p>multiplier to be used when converting
tsc-related quantity to nanoseconds</p>
</dd>
<dt>tsc_shift:</dt><dd><p>shift to be used when converting tsc-related
quantity to nanoseconds. This shift will ensure that
multiplication with tsc_to_system_mul does not overflow.
A positive value denotes a left shift, a negative value
a right shift.</p>
<p>The conversion from tsc to nanoseconds involves an additional
right shift by 32 bits. With this information, guests can
derive per-CPU time by doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>time = (current_tsc - tsc_timestamp)
if (tsc_shift &gt;= 0)
        time &lt;&lt;= tsc_shift;
else
        time &gt;&gt;= -tsc_shift;
time = (time * tsc_to_system_mul) &gt;&gt; 32
time = time + system_time
</pre></div>
</div>
</dd>
<dt>flags:</dt><dd><p>bits in this field indicate extended capabilities
coordinated between the guest and the hypervisor. Availability
of specific flags has to be checked in 0x40000001 cpuid leaf.
Current flags are:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 24%" />
<col style="width: 58%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>flag bit</p></td>
<td><p>cpuid bit</p></td>
<td><p>meaning</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>24</p></td>
<td><p>time measures taken across
multiple cpus are guaranteed to
be monotonic</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>N/A</p></td>
<td><p>guest vcpu has been paused by
the host
See 4.70 in api.txt</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>Availability of this MSR must be checked via bit 3 in 0x4000001 cpuid
leaf prior to usage.</p>
</dd>
<dt>MSR_KVM_WALL_CLOCK:</dt><dd><p>0x11</p>
</dd>
<dt>data and functioning:</dt><dd><p>same as MSR_KVM_WALL_CLOCK_NEW. Use that instead.</p>
<p>This MSR falls outside the reserved KVM range and may be removed in the
future. Its usage is deprecated.</p>
<p>Availability of this MSR must be checked via bit 0 in 0x4000001 cpuid
leaf prior to usage.</p>
</dd>
<dt>MSR_KVM_SYSTEM_TIME:</dt><dd><p>0x12</p>
</dd>
<dt>data and functioning:</dt><dd><p>same as MSR_KVM_SYSTEM_TIME_NEW. Use that instead.</p>
<p>This MSR falls outside the reserved KVM range and may be removed in the
future. Its usage is deprecated.</p>
<p>Availability of this MSR must be checked via bit 0 in 0x4000001 cpuid
leaf prior to usage.</p>
<p>The suggested algorithm for detecting kvmclock presence is then:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (!kvm_para_available())    /* refer to cpuid.txt */
        return NON_PRESENT;

flags = cpuid_eax(0x40000001);
if (flags &amp; 3) {
        msr_kvm_system_time = MSR_KVM_SYSTEM_TIME_NEW;
        msr_kvm_wall_clock = MSR_KVM_WALL_CLOCK_NEW;
        return PRESENT;
} else if (flags &amp; 0) {
        msr_kvm_system_time = MSR_KVM_SYSTEM_TIME;
        msr_kvm_wall_clock = MSR_KVM_WALL_CLOCK;
        return PRESENT;
} else
        return NON_PRESENT;
</pre></div>
</div>
</dd>
<dt>MSR_KVM_ASYNC_PF_EN:</dt><dd><p>0x4b564d02</p>
</dd>
<dt>data:</dt><dd><p>Bits 63-6 hold 64-byte aligned physical address of a
64 byte memory area which must be in guest RAM and must be
zeroed. Bits 5-3 are reserved and should be zero. Bit 0 is 1
when asynchronous page faults are enabled on the vcpu 0 when
disabled. Bit 1 is 1 if asynchronous page faults can be injected
when vcpu is in cpl == 0. Bit 2 is 1 if asynchronous page faults
are delivered to L1 as #PF vmexits.  Bit 2 can be set only if
KVM_FEATURE_ASYNC_PF_VMEXIT is present in CPUID.</p>
<p>First 4 byte of 64 byte memory location will be written to by
the hypervisor at the time of asynchronous page fault (APF)
injection to indicate type of asynchronous page fault. Value
of 1 means that the page referred to by the page fault is not
present. Value 2 means that the page is now available. Disabling
interrupt inhibits APFs. Guest must not enable interrupt
before the reason is read, or it may be overwritten by another
APF. Since APF uses the same exception vector as regular page
fault guest must reset the reason to 0 before it does
something that can generate normal page fault.  If during page
fault APF reason is 0 it means that this is regular page
fault.</p>
<p>During delivery of type 1 APF cr2 contains a token that will
be used to notify a guest when missing page becomes
available. When page becomes available type 2 APF is sent with
cr2 set to the token associated with the page. There is special
kind of token 0xffffffff which tells vcpu that it should wake
up all processes waiting for APFs and no individual type 2 APFs
will be sent.</p>
<p>If APF is disabled while there are outstanding APFs, they will
not be delivered.</p>
<p>Currently type 2 APF will be always delivered on the same vcpu as
type 1 was, but guest should not rely on that.</p>
</dd>
<dt>MSR_KVM_STEAL_TIME:</dt><dd><p>0x4b564d03</p>
</dd>
<dt>data:</dt><dd><p>64-byte alignment physical address of a memory area which must be
in guest RAM, plus an enable bit in bit 0. This memory is expected to
hold a copy of the following structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct kvm_steal_time {
      __u64 steal;
      __u32 version;
      __u32 flags;
      __u8  preempted;
      __u8  u8_pad[3];
      __u32 pad[11];
}
</pre></div>
</div>
<p>whose data will be filled in by the hypervisor periodically. Only one
write, or registration, is needed for each VCPU. The interval between
updates of this structure is arbitrary and implementation-dependent.
The hypervisor may update this structure at any time it sees fit until
anything with bit0 == 0 is written to it. Guest is required to make sure
this structure is initialized to zero.</p>
<p>Fields have the following meanings:</p>
<dl class="simple">
<dt>version:</dt><dd><p>a sequence counter. In other words, guest has to check
this field before and after grabbing time information and make
sure they are both equal and even. An odd version indicates an
in-progress update.</p>
</dd>
<dt>flags:</dt><dd><p>At this point, always zero. May be used to indicate
changes in this structure in the future.</p>
</dd>
<dt>steal:</dt><dd><p>the amount of time in which this vCPU did not run, in
nanoseconds. Time during which the vcpu is idle, will not be
reported as steal time.</p>
</dd>
<dt>preempted:</dt><dd><p>indicate the vCPU who owns this struct is running or
not. Non-zero values mean the vCPU has been preempted. Zero
means the vCPU is not preempted. NOTE, it is always zero if the
the hypervisor doesn’t support this field.</p>
</dd>
</dl>
</dd>
<dt>MSR_KVM_EOI_EN:</dt><dd><p>0x4b564d04</p>
</dd>
<dt>data:</dt><dd><p>Bit 0 is 1 when PV end of interrupt is enabled on the vcpu; 0
when disabled.  Bit 1 is reserved and must be zero.  When PV end of
interrupt is enabled (bit 0 set), bits 63-2 hold a 4-byte aligned
physical address of a 4 byte memory area which must be in guest RAM and
must be zeroed.</p>
<p>The first, least significant bit of 4 byte memory location will be
written to by the hypervisor, typically at the time of interrupt
injection.  Value of 1 means that guest can skip writing EOI to the apic
(using MSR or MMIO write); instead, it is sufficient to signal
EOI by clearing the bit in guest memory - this location will
later be polled by the hypervisor.
Value of 0 means that the EOI write is required.</p>
<p>It is always safe for the guest to ignore the optimization and perform
the APIC EOI write anyway.</p>
<p>Hypervisor is guaranteed to only modify this least
significant bit while in the current VCPU context, this means that
guest does not need to use either lock prefix or memory ordering
primitives to synchronise with the hypervisor.</p>
<p>However, hypervisor can set and clear this memory bit at any time:
therefore to make sure hypervisor does not interrupt the
guest and clear the least significant bit in the memory area
in the window between guest testing it to detect
whether it can skip EOI apic write and between guest
clearing it to signal EOI to the hypervisor,
guest must both read the least significant bit in the memory area and
clear it using a single CPU instruction, such as test and clear, or
compare and exchange.</p>
</dd>
<dt>MSR_KVM_POLL_CONTROL:</dt><dd><p>0x4b564d05</p>
<p>Control host-side polling.</p>
</dd>
<dt>data:</dt><dd><p>Bit 0 enables (1) or disables (0) host-side HLT polling logic.</p>
<p>KVM guests can request the host not to poll on HLT, for example if
they are performing polling themselves.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nested-vmx.html" class="btn btn-neutral float-right" title="Nested VMX" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mmu.html" class="btn btn-neutral float-left" title="The x86 kvm shadow mmu" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>