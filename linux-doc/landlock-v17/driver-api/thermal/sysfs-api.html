

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generic Thermal Sysfs driver How To &mdash; The Linux Kernel 5.7.0-rc5+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Power allocator governor tunables" href="power_allocator.html" />
    <link rel="prev" title="CPU cooling APIs How To" href="cpu-cooling-api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux driver implementer’s API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../driver-model/index.html">Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioctl.html">ioctl based interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../early-userspace/index.html">Early Userspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">CPU and Device Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_connection.html">Device connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dma-buf.html">Buffer Sharing and Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../component.html">Component Helper for Aggregate Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound.html">Sound Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb/index.html">Linux USB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pci/index.html">The Linux PCI driver implementer’s API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devfreq.html">Device Frequency Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../w1.html">W1: Dallas’ 1-wire bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctl.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Thermal</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cpu-cooling-api.html">CPU cooling APIs How To</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generic Thermal Sysfs driver How To</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">0. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thermal-sysfs-driver-interface-functions">1. thermal sysfs driver interface functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sysfs-attributes-structure">2. sysfs attributes structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-simple-implementation">3. A simple implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-symbol-apis">4. Export Symbol APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thermal-emergency-poweroff">5. thermal_emergency_poweroff</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="power_allocator.html">Power allocator governor tunables</a></li>
<li class="toctree-l3"><a class="reference internal" href="exynos_thermal.html">Kernel driver exynos_tmu</a></li>
<li class="toctree-l3"><a class="reference internal" href="exynos_thermal_emulation.html">Exynos Emulation Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="intel_powerclamp.html">Intel Powerclamp Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="nouveau_thermal.html">Kernel driver nouveau</a></li>
<li class="toctree-l3"><a class="reference internal" href="x86_pkg_temperature_thermal.html">Kernel driver: x86_pkg_temp_thermal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connector.html">Kernel Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eisa.html">EISA bus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isa.html">ISA Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isapnp.html">ISA Plug &amp; Play support by Jaroslav Kysela &lt;perex&#64;suse.cz&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io-mapping.html">The io_mapping functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io_ordering.html">Ordering I/O writes to memory-mapped addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lightnvm-pblk.html">pblk: Physical Block Device Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pti_intel_mid.html">Intel MID PTI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smsc_ece1099.html">Msc Keyboard Scan Expansion/GPIO Expansion device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio-mediated-device.html">VFIO Mediated devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio.html">VFIO - “Virtual Function I/O” </a></li>
<li class="toctree-l2"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The Linux driver implementer’s API guide</a> &raquo;</li>
        
          <li><a href="index.html">Thermal</a> &raquo;</li>
        
      <li>Generic Thermal Sysfs driver How To</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/driver-api/thermal/sysfs-api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generic-thermal-sysfs-driver-how-to">
<h1>Generic Thermal Sysfs driver How To<a class="headerlink" href="#generic-thermal-sysfs-driver-how-to" title="Permalink to this headline">¶</a></h1>
<p>Written by Sujith Thomas &lt;<a class="reference external" href="mailto:sujith&#46;thomas&#37;&#52;&#48;intel&#46;com">sujith<span>&#46;</span>thomas<span>&#64;</span>intel<span>&#46;</span>com</a>&gt;, Zhang Rui &lt;<a class="reference external" href="mailto:rui&#46;zhang&#37;&#52;&#48;intel&#46;com">rui<span>&#46;</span>zhang<span>&#64;</span>intel<span>&#46;</span>com</a>&gt;</p>
<p>Updated: 2 January 2008</p>
<p>Copyright (c)  2008 Intel Corporation</p>
<div class="section" id="introduction">
<h2>0. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The generic thermal sysfs provides a set of interfaces for thermal zone
devices (sensors) and thermal cooling devices (fan, processor…) to register
with the thermal management solution and to be a part of it.</p>
<p>This how-to focuses on enabling new thermal zone and cooling devices to
participate in thermal management.
This solution is platform independent and any type of thermal zone devices
and cooling devices should be able to make use of the infrastructure.</p>
<p>The main task of the thermal sysfs driver is to expose thermal zone attributes
as well as cooling device attributes to the user space.
An intelligent thermal management application can make decisions based on
inputs from thermal zone attributes (the current temperature and trip point
temperature) and throttle appropriate devices.</p>
<ul class="simple">
<li><p><cite>[0-*]</cite>       denotes any positive number starting from 0</p></li>
<li><p><cite>[1-*]</cite>       denotes any positive number starting from 1</p></li>
</ul>
</div>
<div class="section" id="thermal-sysfs-driver-interface-functions">
<h2>1. thermal sysfs driver interface functions<a class="headerlink" href="#thermal-sysfs-driver-interface-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="thermal-zone-device-interface">
<h3>1.1 thermal zone device interface<a class="headerlink" href="#thermal-zone-device-interface" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_zone_device
*thermal_zone_device_register(char *type,
                              int trips, int mask, void *devdata,
                              struct thermal_zone_device_ops *ops,
                              const struct thermal_zone_params *tzp,
                              int passive_delay, int polling_delay))
</pre></div>
</div>
<p>This interface function adds a new thermal zone device (sensor) to
/sys/class/thermal folder as <cite>thermal_zone[0-*]</cite>. It tries to bind all the
thermal cooling devices registered at the same time.</p>
<dl>
<dt>type:</dt><dd><p>the thermal zone type.</p>
</dd>
<dt>trips:</dt><dd><p>the total number of trip points this thermal zone supports.</p>
</dd>
<dt>mask:</dt><dd><p>Bit string: If ‘n’th bit is set, then trip point ‘n’ is writeable.</p>
</dd>
<dt>devdata:</dt><dd><p>device private data</p>
</dd>
<dt>ops:</dt><dd><p>thermal zone device call-backs.</p>
<dl>
<dt>.bind:</dt><dd><p>bind the thermal zone device with a thermal cooling device.</p>
</dd>
<dt>.unbind:</dt><dd><p>unbind the thermal zone device with a thermal cooling device.</p>
</dd>
<dt>.get_temp:</dt><dd><p>get the current temperature of the thermal zone.</p>
</dd>
<dt>.set_trips:</dt><dd><p>set the trip points window. Whenever the current temperature
is updated, the trip points immediately below and above the
current temperature are found.</p>
</dd>
<dt>.get_mode:</dt><dd><p>get the current mode (enabled/disabled) of the thermal zone.</p>
<blockquote>
<div><ul class="simple">
<li><p>“enabled” means the kernel thermal management is
enabled.</p></li>
<li><p>“disabled” will prevent kernel thermal driver action
upon trip points so that user applications can take
charge of thermal management.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>.set_mode:</dt><dd><p>set the mode (enabled/disabled) of the thermal zone.</p>
</dd>
<dt>.get_trip_type:</dt><dd><p>get the type of certain trip point.</p>
</dd>
<dt>.get_trip_temp:</dt><dd><p>get the temperature above which the certain trip point
will be fired.</p>
</dd>
<dt>.set_emul_temp:</dt><dd><p>set the emulation temperature which helps in debugging
different threshold temperature points.</p>
</dd>
</dl>
</dd>
<dt>tzp:</dt><dd><p>thermal zone platform parameters.</p>
</dd>
<dt>passive_delay:</dt><dd><p>number of milliseconds to wait between polls when
performing passive cooling.</p>
</dd>
<dt>polling_delay:</dt><dd><p>number of milliseconds to wait between polls when checking
whether trip points have been crossed (0 for interrupt driven systems).</p>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void thermal_zone_device_unregister(struct thermal_zone_device *tz)
</pre></div>
</div>
<p>This interface function removes the thermal zone device.
It deletes the corresponding entry from /sys/class/thermal folder and
unbinds all the thermal cooling devices it uses.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_zone_device
*thermal_zone_of_sensor_register(struct device *dev, int sensor_id,
                     void *data,
                     const struct thermal_zone_of_device_ops *ops)
</pre></div>
</div>
<p>This interface adds a new sensor to a DT thermal zone.
This function will search the list of thermal zones described in
device tree and look for the zone that refer to the sensor device
pointed by dev-&gt;of_node as temperature providers. For the zone
pointing to the sensor node, the sensor will be added to the DT
thermal zone device.</p>
<p>The parameters for this interface are:</p>
<dl>
<dt>dev:</dt><dd><p>Device node of sensor containing valid node pointer in
dev-&gt;of_node.</p>
</dd>
<dt>sensor_id:</dt><dd><p>a sensor identifier, in case the sensor IP has more
than one sensors</p>
</dd>
<dt>data:</dt><dd><p>a private pointer (owned by the caller) that will be
passed back, when a temperature reading is needed.</p>
</dd>
<dt>ops:</dt><dd><p><cite>struct thermal_zone_of_device_ops *</cite>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>get_temp</p></td>
<td><p>a pointer to a function that reads the
sensor temperature. This is mandatory
callback provided by sensor driver.</p></td>
</tr>
<tr class="row-even"><td><p>set_trips</p></td>
<td><p>a pointer to a function that sets a
temperature window. When this window is
left the driver must inform the thermal
core via thermal_zone_device_update.</p></td>
</tr>
<tr class="row-odd"><td><p>get_trend</p></td>
<td><p>a pointer to a function that reads the
sensor temperature trend.</p></td>
</tr>
<tr class="row-even"><td><p>set_emul_temp</p></td>
<td><p>a pointer to a function that sets
sensor emulated temperature.</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>The thermal zone temperature is provided by the get_temp() function
pointer of thermal_zone_of_device_ops. When called, it will
have the private pointer &#64;data back.</p>
<p>It returns error pointer if fails otherwise valid thermal zone device
handle. Caller should check the return handle with IS_ERR() for finding
whether success or not.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void thermal_zone_of_sensor_unregister(struct device *dev,
                                       struct thermal_zone_device *tzd)
</pre></div>
</div>
<p>This interface unregisters a sensor from a DT thermal zone which was
successfully added by interface thermal_zone_of_sensor_register().
This function removes the sensor callbacks and private data from the
thermal zone device registered with thermal_zone_of_sensor_register()
interface. It will also silent the zone by remove the .get_temp() and
get_trend() thermal zone device callbacks.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_zone_device
*devm_thermal_zone_of_sensor_register(struct device *dev,
                      int sensor_id,
                      void *data,
                      const struct thermal_zone_of_device_ops *ops)
</pre></div>
</div>
<p>This interface is resource managed version of
thermal_zone_of_sensor_register().</p>
<p>All details of thermal_zone_of_sensor_register() described in
section 1.1.3 is applicable here.</p>
<p>The benefit of using this interface to register sensor is that it
is not require to explicitly call thermal_zone_of_sensor_unregister()
in error path or during driver unbinding as this is done by driver
resource manager.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void devm_thermal_zone_of_sensor_unregister(struct device *dev,
                                struct thermal_zone_device *tzd)
</pre></div>
</div>
<p>This interface is resource managed version of
thermal_zone_of_sensor_unregister().
All details of thermal_zone_of_sensor_unregister() described in
section 1.1.4 is applicable here.
Normally this function will not need to be called and the resource
management code will ensure that the resource is freed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int thermal_zone_get_slope(struct thermal_zone_device *tz)
</pre></div>
</div>
<p>This interface is used to read the slope attribute value
for the thermal zone device, which might be useful for platform
drivers for temperature calculations.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int thermal_zone_get_offset(struct thermal_zone_device *tz)
</pre></div>
</div>
<p>This interface is used to read the offset attribute value
for the thermal zone device, which might be useful for platform
drivers for temperature calculations.</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="thermal-cooling-device-interface">
<h3>1.2 thermal cooling device interface<a class="headerlink" href="#thermal-cooling-device-interface" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_cooling_device
*thermal_cooling_device_register(char *name,
                void *devdata, struct thermal_cooling_device_ops *)
</pre></div>
</div>
<p>This interface function adds a new thermal cooling device (fan/processor/…)
to /sys/class/thermal/ folder as <cite>cooling_device[0-*]</cite>. It tries to bind itself
to all the thermal zone devices registered at the same time.</p>
<dl>
<dt>name:</dt><dd><p>the cooling device name.</p>
</dd>
<dt>devdata:</dt><dd><p>device private data.</p>
</dd>
<dt>ops:</dt><dd><p>thermal cooling devices call-backs.</p>
<dl class="simple">
<dt>.get_max_state:</dt><dd><p>get the Maximum throttle state of the cooling device.</p>
</dd>
<dt>.get_cur_state:</dt><dd><p>get the Currently requested throttle state of the
cooling device.</p>
</dd>
<dt>.set_cur_state:</dt><dd><p>set the Current throttle state of the cooling device.</p>
</dd>
</dl>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void thermal_cooling_device_unregister(struct thermal_cooling_device *cdev)
</pre></div>
</div>
<p>This interface function removes the thermal cooling device.
It deletes the corresponding entry from /sys/class/thermal folder and
unbinds itself from all the thermal zone devices using it.</p>
</div></blockquote>
</div>
<div class="section" id="interface-for-binding-a-thermal-zone-device-with-a-thermal-cooling-device">
<h3>1.3 interface for binding a thermal zone device with a thermal cooling device<a class="headerlink" href="#interface-for-binding-a-thermal-zone-device-with-a-thermal-cooling-device" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int thermal_zone_bind_cooling_device(struct thermal_zone_device *tz,
        int trip, struct thermal_cooling_device *cdev,
        unsigned long upper, unsigned long lower, unsigned int weight);
</pre></div>
</div>
<p>This interface function binds a thermal cooling device to a particular trip
point of a thermal zone device.</p>
<p>This function is usually called in the thermal zone device .bind callback.</p>
<dl class="simple">
<dt>tz:</dt><dd><p>the thermal zone device</p>
</dd>
<dt>cdev:</dt><dd><p>thermal cooling device</p>
</dd>
<dt>trip:</dt><dd><p>indicates which trip point in this thermal zone the cooling device
is associated with.</p>
</dd>
<dt>upper:</dt><dd><p>the Maximum cooling state for this trip point.
THERMAL_NO_LIMIT means no upper limit,
and the cooling device can be in max_state.</p>
</dd>
<dt>lower:</dt><dd><p>the Minimum cooling state can be used for this trip point.
THERMAL_NO_LIMIT means no lower limit,
and the cooling device can be in cooling state 0.</p>
</dd>
<dt>weight:</dt><dd><p>the influence of this cooling device in this thermal
zone.  See 1.4.1 below for more information.</p>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int thermal_zone_unbind_cooling_device(struct thermal_zone_device *tz,
                        int trip, struct thermal_cooling_device *cdev);
</pre></div>
</div>
<p>This interface function unbinds a thermal cooling device from a particular
trip point of a thermal zone device. This function is usually called in
the thermal zone device .unbind callback.</p>
<dl class="simple">
<dt>tz:</dt><dd><p>the thermal zone device</p>
</dd>
<dt>cdev:</dt><dd><p>thermal cooling device</p>
</dd>
<dt>trip:</dt><dd><p>indicates which trip point in this thermal zone the cooling device
is associated with.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="thermal-zone-parameters">
<h3>1.4 Thermal Zone Parameters<a class="headerlink" href="#thermal-zone-parameters" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_bind_params
</pre></div>
</div>
<p>This structure defines the following parameters that are used to bind
a zone with a cooling device for a particular trip point.</p>
<dl class="simple">
<dt>.cdev:</dt><dd><p>The cooling device pointer</p>
</dd>
<dt>.weight:</dt><dd><p>The ‘influence’ of a particular cooling device on this
zone. This is relative to the rest of the cooling
devices. For example, if all cooling devices have a
weight of 1, then they all contribute the same. You can
use percentages if you want, but it’s not mandatory. A
weight of 0 means that this cooling device doesn’t
contribute to the cooling of this zone unless all cooling
devices have a weight of 0. If all weights are 0, then
they all contribute the same.</p>
</dd>
<dt>.trip_mask:</dt><dd><p>This is a bit mask that gives the binding relation between
this thermal zone and cdev, for a particular trip point.
If nth bit is set, then the cdev and thermal zone are bound
for trip point n.</p>
</dd>
<dt>.binding_limits:</dt><dd><p>This is an array of cooling state limits. Must have
exactly 2 * thermal_zone.number_of_trip_points. It is an
array consisting of tuples &lt;lower-state upper-state&gt; of
state limits. Each trip will be associated with one state
limit tuple when binding. A NULL pointer means
&lt;THERMAL_NO_LIMITS THERMAL_NO_LIMITS&gt; on all trips.
These limits are used when binding a cdev to a trip point.</p>
</dd>
<dt>.match:</dt><dd><p>This call back returns success(0) if the ‘tz and cdev’ need to
be bound, as per platform data.</p>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_zone_params
</pre></div>
</div>
<p>This structure defines the platform level parameters for a thermal zone.
This data, for each thermal zone should come from the platform layer.
This is an optional feature where some platforms can choose not to
provide this data.</p>
<dl class="simple">
<dt>.governor_name:</dt><dd><p>Name of the thermal governor used for this zone</p>
</dd>
<dt>.no_hwmon:</dt><dd><p>a boolean to indicate if the thermal to hwmon sysfs interface
is required. when no_hwmon == false, a hwmon sysfs interface
will be created. when no_hwmon == true, nothing will be done.
In case the thermal_zone_params is NULL, the hwmon interface
will be created (for backward compatibility).</p>
</dd>
<dt>.num_tbps:</dt><dd><p>Number of thermal_bind_params entries for this zone</p>
</dd>
<dt>.tbp:</dt><dd><p>thermal_bind_params entries</p>
</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="sysfs-attributes-structure">
<h2>2. sysfs attributes structure<a class="headerlink" href="#sysfs-attributes-structure" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>RO</p></td>
<td><p>read only value</p></td>
</tr>
<tr class="row-even"><td><p>WO</p></td>
<td><p>write only value</p></td>
</tr>
<tr class="row-odd"><td><p>RW</p></td>
<td><p>read/write value</p></td>
</tr>
</tbody>
</table>
<p>Thermal sysfs attributes will be represented under /sys/class/thermal.
Hwmon sysfs I/F extension is also available under /sys/class/hwmon
if hwmon is compiled in or built as a module.</p>
<p>Thermal zone device sys I/F, created once it’s registered:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/class/thermal/thermal_zone[0-*]:
  |---type:                   Type of the thermal zone
  |---temp:                   Current temperature
  |---mode:                   Working mode of the thermal zone
  |---policy:                 Thermal governor used for this zone
  |---available_policies:     Available thermal governors for this zone
  |---trip_point_[0-*]_temp:  Trip point temperature
  |---trip_point_[0-*]_type:  Trip point type
  |---trip_point_[0-*]_hyst:  Hysteresis value for this trip point
  |---emul_temp:              Emulated temperature set node
  |---sustainable_power:      Sustainable dissipatable power
  |---k_po:                   Proportional term during temperature overshoot
  |---k_pu:                   Proportional term during temperature undershoot
  |---k_i:                    PID&#39;s integral term in the power allocator gov
  |---k_d:                    PID&#39;s derivative term in the power allocator
  |---integral_cutoff:        Offset above which errors are accumulated
  |---slope:                  Slope constant applied as linear extrapolation
  |---offset:                 Offset constant applied as linear extrapolation
</pre></div>
</div>
<p>Thermal cooling device sys I/F, created once it’s registered:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/class/thermal/cooling_device[0-*]:
  |---type:                   Type of the cooling device(processor/fan/...)
  |---max_state:              Maximum cooling state of the cooling device
  |---cur_state:              Current cooling state of the cooling device
  |---stats:                  Directory containing cooling device&#39;s statistics
  |---stats/reset:            Writing any value resets the statistics
  |---stats/time_in_state_ms: Time (msec) spent in various cooling states
  |---stats/total_trans:      Total number of times cooling state is changed
  |---stats/trans_table:      Cooing state transition table
</pre></div>
</div>
<p>Then next two dynamic attributes are created/removed in pairs. They represent
the relationship between a thermal zone and its associated cooling device.
They are created/removed for each successful execution of
thermal_zone_bind_cooling_device/thermal_zone_unbind_cooling_device.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/class/thermal/thermal_zone[0-*]:
  |---cdev[0-*]:              [0-*]th cooling device in current thermal zone
  |---cdev[0-*]_trip_point:   Trip point that cdev[0-*] is associated with
  |---cdev[0-*]_weight:       Influence of the cooling device in
                              this thermal zone
</pre></div>
</div>
<p>Besides the thermal zone device sysfs I/F and cooling device sysfs I/F,
the generic thermal driver also creates a hwmon sysfs I/F for each _type_
of thermal zone device. E.g. the generic thermal driver registers one hwmon
class device and build the associated hwmon sysfs I/F for all the registered
ACPI thermal zones.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/class/hwmon/hwmon[0-*]:
  |---name:                   The type of the thermal zone devices
  |---temp[1-*]_input:        The current temperature of thermal zone [1-*]
  |---temp[1-*]_critical:     The critical trip point of thermal zone [1-*]
</pre></div>
</div>
<p>Please read Documentation/hwmon/sysfs-interface.rst for additional information.</p>
<div class="section" id="thermal-zone-attributes">
<h3>Thermal zone attributes<a class="headerlink" href="#thermal-zone-attributes" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>type</dt><dd><p>Strings which represent the thermal zone type.
This is given by thermal zone driver as part of registration.
E.g: “acpitz” indicates it’s an ACPI thermal device.
In order to keep it consistent with hwmon sys attribute; this should
be a short, lowercase string, not containing spaces nor dashes.
RO, Required</p>
</dd>
<dt>temp</dt><dd><p>Current temperature as reported by thermal zone (sensor).
Unit: millidegree Celsius
RO, Required</p>
</dd>
<dt>mode</dt><dd><p>One of the predefined values in [enabled, disabled].
This file gives information about the algorithm that is currently
managing the thermal zone. It can be either default kernel based
algorithm or user space application.</p>
<dl class="simple">
<dt>enabled</dt><dd><p>enable Kernel Thermal management.</p>
</dd>
<dt>disabled</dt><dd><p>Preventing kernel thermal zone driver actions upon
trip points so that user application can take full
charge of the thermal management.</p>
</dd>
</dl>
<p>RW, Optional</p>
</dd>
<dt>policy</dt><dd><p>One of the various thermal governors used for a particular zone.</p>
<p>RW, Required</p>
</dd>
<dt>available_policies</dt><dd><p>Available thermal governors which can be used for a particular zone.</p>
<p>RO, Required</p>
</dd>
<dt><cite>trip_point_[0-*]_temp</cite></dt><dd><p>The temperature above which trip point will be fired.</p>
<p>Unit: millidegree Celsius</p>
<p>RO, Optional</p>
</dd>
<dt><cite>trip_point_[0-*]_type</cite></dt><dd><p>Strings which indicate the type of the trip point.</p>
<p>E.g. it can be one of critical, hot, passive, <cite>active[0-*]</cite> for ACPI
thermal zone.</p>
<p>RO, Optional</p>
</dd>
<dt><cite>trip_point_[0-*]_hyst</cite></dt><dd><p>The hysteresis value for a trip point, represented as an integer
Unit: Celsius
RW, Optional</p>
</dd>
<dt><cite>cdev[0-*]</cite></dt><dd><p>Sysfs link to the thermal cooling device node where the sys I/F
for cooling device throttling control represents.</p>
<p>RO, Optional</p>
</dd>
<dt><cite>cdev[0-*]_trip_point</cite></dt><dd><p>The trip point in this thermal zone which <cite>cdev[0-*]</cite> is associated
with; -1 means the cooling device is not associated with any trip
point.</p>
<p>RO, Optional</p>
</dd>
<dt><cite>cdev[0-*]_weight</cite></dt><dd><p>The influence of <cite>cdev[0-*]</cite> in this thermal zone. This value
is relative to the rest of cooling devices in the thermal
zone. For example, if a cooling device has a weight double
than that of other, it’s twice as effective in cooling the
thermal zone.</p>
<p>RW, Optional</p>
</dd>
<dt>passive</dt><dd><p>Attribute is only present for zones in which the passive cooling
policy is not supported by native thermal driver. Default is zero
and can be set to a temperature (in millidegrees) to enable a
passive trip point for the zone. Activation is done by polling with
an interval of 1 second.</p>
<p>Unit: millidegrees Celsius</p>
<p>Valid values: 0 (disabled) or greater than 1000</p>
<p>RW, Optional</p>
</dd>
<dt>emul_temp</dt><dd><p>Interface to set the emulated temperature method in thermal zone
(sensor). After setting this temperature, the thermal zone may pass
this temperature to platform emulation function if registered or
cache it locally. This is useful in debugging different temperature
threshold and its associated cooling action. This is write only node
and writing 0 on this node should disable emulation.
Unit: millidegree Celsius</p>
<p>WO, Optional</p>
<blockquote>
<div><dl class="simple">
<dt>WARNING:</dt><dd><p>Be careful while enabling this option on production systems,
because userland can easily disable the thermal policy by simply
flooding this sysfs node with low temperature values.</p>
</dd>
</dl>
</div></blockquote>
</dd>
<dt>sustainable_power</dt><dd><p>An estimate of the sustained power that can be dissipated by
the thermal zone. Used by the power allocator governor. For
more information see Documentation/driver-api/thermal/power_allocator.rst</p>
<p>Unit: milliwatts</p>
<p>RW, Optional</p>
</dd>
<dt>k_po</dt><dd><p>The proportional term of the power allocator governor’s PID
controller during temperature overshoot. Temperature overshoot
is when the current temperature is above the “desired
temperature” trip point. For more information see
Documentation/driver-api/thermal/power_allocator.rst</p>
<p>RW, Optional</p>
</dd>
<dt>k_pu</dt><dd><p>The proportional term of the power allocator governor’s PID
controller during temperature undershoot. Temperature undershoot
is when the current temperature is below the “desired
temperature” trip point. For more information see
Documentation/driver-api/thermal/power_allocator.rst</p>
<p>RW, Optional</p>
</dd>
<dt>k_i</dt><dd><p>The integral term of the power allocator governor’s PID
controller. This term allows the PID controller to compensate
for long term drift. For more information see
Documentation/driver-api/thermal/power_allocator.rst</p>
<p>RW, Optional</p>
</dd>
<dt>k_d</dt><dd><p>The derivative term of the power allocator governor’s PID
controller. For more information see
Documentation/driver-api/thermal/power_allocator.rst</p>
<p>RW, Optional</p>
</dd>
<dt>integral_cutoff</dt><dd><p>Temperature offset from the desired temperature trip point
above which the integral term of the power allocator
governor’s PID controller starts accumulating errors. For
example, if integral_cutoff is 0, then the integral term only
accumulates error when temperature is above the desired
temperature trip point. For more information see
Documentation/driver-api/thermal/power_allocator.rst</p>
<p>Unit: millidegree Celsius</p>
<p>RW, Optional</p>
</dd>
<dt>slope</dt><dd><p>The slope constant used in a linear extrapolation model
to determine a hotspot temperature based off the sensor’s
raw readings. It is up to the device driver to determine
the usage of these values.</p>
<p>RW, Optional</p>
</dd>
<dt>offset</dt><dd><p>The offset constant used in a linear extrapolation model
to determine a hotspot temperature based off the sensor’s
raw readings. It is up to the device driver to determine
the usage of these values.</p>
<p>RW, Optional</p>
</dd>
</dl>
</div>
<div class="section" id="cooling-device-attributes">
<h3>Cooling device attributes<a class="headerlink" href="#cooling-device-attributes" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>type</dt><dd><p>String which represents the type of device, e.g:</p>
<ul class="simple">
<li><p>for generic ACPI: should be “Fan”, “Processor” or “LCD”</p></li>
<li><p>for memory controller device on intel_menlow platform:
should be “Memory controller”.</p></li>
</ul>
<p>RO, Required</p>
</dd>
<dt>max_state</dt><dd><p>The maximum permissible cooling state of this cooling device.</p>
<p>RO, Required</p>
</dd>
<dt>cur_state</dt><dd><p>The current cooling state of this cooling device.
The value can any integer numbers between 0 and max_state:</p>
<ul class="simple">
<li><p>cur_state == 0 means no cooling</p></li>
<li><p>cur_state == max_state means the maximum cooling.</p></li>
</ul>
<p>RW, Required</p>
</dd>
<dt>stats/reset</dt><dd><p>Writing any value resets the cooling device’s statistics.
WO, Required</p>
</dd>
<dt>stats/time_in_state_ms:</dt><dd><p>The amount of time spent by the cooling device in various cooling
states. The output will have “&lt;state&gt; &lt;time&gt;” pair in each line, which
will mean this cooling device spent &lt;time&gt; msec of time at &lt;state&gt;.
Output will have one line for each of the supported states.  usertime
units here is 10mS (similar to other time exported in /proc).
RO, Required</p>
</dd>
<dt>stats/total_trans:</dt><dd><p>A single positive value showing the total number of times the state of a
cooling device is changed.</p>
<p>RO, Required</p>
</dd>
<dt>stats/trans_table:</dt><dd><p>This gives fine grained information about all the cooling state
transitions. The cat output here is a two dimensional matrix, where an
entry &lt;i,j&gt; (row i, column j) represents the number of transitions from
State_i to State_j. If the transition table is bigger than PAGE_SIZE,
reading this will return an -EFBIG error.
RO, Required</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="a-simple-implementation">
<h2>3. A simple implementation<a class="headerlink" href="#a-simple-implementation" title="Permalink to this headline">¶</a></h2>
<p>ACPI thermal zone may support multiple trip points like critical, hot,
passive, active. If an ACPI thermal zone supports critical, passive,
active[0] and active[1] at the same time, it may register itself as a
thermal_zone_device (thermal_zone1) with 4 trip points in all.
It has one processor and one fan, which are both registered as
thermal_cooling_device. Both are considered to have the same
effectiveness in cooling the thermal zone.</p>
<p>If the processor is listed in _PSL method, and the fan is listed in _AL0
method, the sys I/F structure will be built like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/class/thermal:
 |thermal_zone1:
   |---type:                   acpitz
   |---temp:                   37000
   |---mode:                   enabled
   |---policy:                 step_wise
   |---available_policies:     step_wise fair_share
   |---trip_point_0_temp:      100000
   |---trip_point_0_type:      critical
   |---trip_point_1_temp:      80000
   |---trip_point_1_type:      passive
   |---trip_point_2_temp:      70000
   |---trip_point_2_type:      active0
   |---trip_point_3_temp:      60000
   |---trip_point_3_type:      active1
   |---cdev0:                  ---&gt;/sys/class/thermal/cooling_device0
   |---cdev0_trip_point:       1       /* cdev0 can be used for passive */
   |---cdev0_weight:           1024
   |---cdev1:                  ---&gt;/sys/class/thermal/cooling_device3
   |---cdev1_trip_point:       2       /* cdev1 can be used for active[0]*/
   |---cdev1_weight:           1024

 |cooling_device0:
   |---type:                   Processor
   |---max_state:              8
   |---cur_state:              0

 |cooling_device3:
   |---type:                   Fan
   |---max_state:              2
   |---cur_state:              0

/sys/class/hwmon:
 |hwmon0:
   |---name:                   acpitz
   |---temp1_input:            37000
   |---temp1_crit:             100000
</pre></div>
</div>
</div>
<div class="section" id="export-symbol-apis">
<h2>4. Export Symbol APIs<a class="headerlink" href="#export-symbol-apis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-tz-trend">
<h3>4.1. get_tz_trend<a class="headerlink" href="#get-tz-trend" title="Permalink to this headline">¶</a></h3>
<p>This function returns the trend of a thermal zone, i.e the rate of change
of temperature of the thermal zone. Ideally, the thermal sensor drivers
are supposed to implement the callback. If they don’t, the thermal
framework calculated the trend by comparing the previous and the current
temperature values.</p>
</div>
<div class="section" id="get-thermal-instance">
<h3>4.2. get_thermal_instance<a class="headerlink" href="#get-thermal-instance" title="Permalink to this headline">¶</a></h3>
<p>This function returns the thermal_instance corresponding to a given
{thermal_zone, cooling_device, trip_point} combination. Returns NULL
if such an instance does not exist.</p>
</div>
<div class="section" id="thermal-notify-framework">
<h3>4.3. thermal_notify_framework<a class="headerlink" href="#thermal-notify-framework" title="Permalink to this headline">¶</a></h3>
<p>This function handles the trip events from sensor drivers. It starts
throttling the cooling devices according to the policy configured.
For CRITICAL and HOT trip points, this notifies the respective drivers,
and does actual throttling for other trip points i.e ACTIVE and PASSIVE.
The throttling policy is based on the configured platform data; if no
platform data is provided, this uses the step_wise throttling policy.</p>
</div>
<div class="section" id="thermal-cdev-update">
<h3>4.4. thermal_cdev_update<a class="headerlink" href="#thermal-cdev-update" title="Permalink to this headline">¶</a></h3>
<p>This function serves as an arbitrator to set the state of a cooling
device. It sets the cooling device to the deepest cooling state if
possible.</p>
</div>
</div>
<div class="section" id="thermal-emergency-poweroff">
<h2>5. thermal_emergency_poweroff<a class="headerlink" href="#thermal-emergency-poweroff" title="Permalink to this headline">¶</a></h2>
<p>On an event of critical trip temperature crossing. Thermal framework
allows the system to shutdown gracefully by calling orderly_poweroff().
In the event of a failure of orderly_poweroff() to shut down the system
we are in danger of keeping the system alive at undesirably high
temperatures. To mitigate this high risk scenario we program a work
queue to fire after a pre-determined number of seconds to start
an emergency shutdown of the device using the kernel_power_off()
function. In case kernel_power_off() fails then finally
emergency_restart() is called in the worst case.</p>
<p>The delay should be carefully profiled so as to give adequate time for
orderly_poweroff(). In case of failure of an orderly_poweroff() the
emergency poweroff kicks in after the delay has elapsed and shuts down
the system.</p>
<p>If set to 0 emergency poweroff will not be supported. So a carefully
profiled non-zero positive value is a must for emergerncy poweroff to be
triggered.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="power_allocator.html" class="btn btn-neutral float-right" title="Power allocator governor tunables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cpu-cooling-api.html" class="btn btn-neutral float-left" title="CPU cooling APIs How To" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>