

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Devlink Trap &mdash; The Linux Kernel 5.7.0-rc7+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="bnxt devlink support" href="bnxt.html" />
    <link rel="prev" title="Devlink Resource" href="devlink-resource.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../netdev-FAQ.html">netdev FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bareudp.html">Bare UDP Tunnelling Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../batman-adv.html">batman-adv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_drivers/index.html">Vendor Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Linux Devlink Documentation</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html#interface-documentation">Interface documentation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="devlink-dpipe.html">Devlink DPIPE</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-health.html">Devlink Health</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-info.html">Devlink Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-flash.html">Devlink Flash</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-params.html">Devlink Params</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-region.html">Devlink Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-resource.html">Devlink Resource</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Devlink Trap</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#driver-specific-documentation">Driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ethtool-netlink.html">Netlink interface for ethtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ieee802154.html">IEEE 802.15.4 Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../j1939.html">J1939 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../z8530book.html">Z8530 Programming Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net_dim.html">Net DIM - Generic Network Dynamic Interrupt Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sfp-phylink.html">phylink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tls.html">Kernel TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tls-offload.html">Kernel TLS offload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc.html">Linux NFC subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6lowpan.html">Netdev private dataroom for 6lowpan interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Networking Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Linux Devlink Documentation</a> &raquo;</li>
        
      <li>Devlink Trap</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/networking/devlink/devlink-trap.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="devlink-trap">
<h1>Devlink Trap<a class="headerlink" href="#devlink-trap" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Devices capable of offloading the kernel’s datapath and perform functions such
as bridging and routing must also be able to send specific packets to the
kernel (i.e., the CPU) for processing.</p>
<p>For example, a device acting as a multicast-aware bridge must be able to send
IGMP membership reports to the kernel for processing by the bridge module.
Without processing such packets, the bridge module could never populate its
MDB.</p>
<p>As another example, consider a device acting as router which has received an IP
packet with a TTL of 1. Upon routing the packet the device must send it to the
kernel so that it will route it as well and generate an ICMP Time Exceeded
error datagram. Without letting the kernel route such packets itself, utilities
such as <code class="docutils literal notranslate"><span class="pre">traceroute</span></code> could never work.</p>
<p>The fundamental ability of sending certain packets to the kernel for processing
is called “packet trapping”.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism allows capable device drivers to register their
supported packet traps with <code class="docutils literal notranslate"><span class="pre">devlink</span></code> and report trapped packets to
<code class="docutils literal notranslate"><span class="pre">devlink</span></code> for further analysis.</p>
<p>Upon receiving trapped packets, <code class="docutils literal notranslate"><span class="pre">devlink</span></code> will perform a per-trap packets and
bytes accounting and potentially report the packet to user space via a netlink
event along with all the provided metadata (e.g., trap reason, timestamp, input
port). This is especially useful for drop traps (see <a class="reference internal" href="#trap-types"><span class="std std-ref">Trap Types</span></a>)
as it allows users to obtain further visibility into packet drops that would
otherwise be invisible.</p>
<p>The following diagram provides a general overview of <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                            Netlink event: Packet w/ metadata
                                           Or a summary of recent drops
                          ^
                          |
 Userspace                |
+---------------------------------------------------+
 Kernel                   |
                          |
                  +-------+--------+
                  |                |
                  |  drop_monitor  |
                  |                |
                  +-------^--------+
                          |
                          |
                          |
                     +----+----+
                     |         |      Kernel&#39;s Rx path
                     | devlink |      (non-drop traps)
                     |         |
                     +----^----+      ^
                          |           |
                          +-----------+
                          |
                  +-------+-------+
                  |               |
                  | Device driver |
                  |               |
                  +-------^-------+
 Kernel                   |
+---------------------------------------------------+
 Hardware                 |
                          | Trapped packet
                          |
                       +--+---+
                       |      |
                       | ASIC |
                       |      |
                       +------+
</pre></div>
</div>
</div>
<div class="section" id="trap-types">
<span id="id1"></span><h2>Trap Types<a class="headerlink" href="#trap-types" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism supports the following packet trap types:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">drop</span></code>: Trapped packets were dropped by the underlying device. Packets
are only processed by <code class="docutils literal notranslate"><span class="pre">devlink</span></code> and not injected to the kernel’s Rx path.
The trap action (see <a class="reference internal" href="#trap-actions"><span class="std std-ref">Trap Actions</span></a>) can be changed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exception</span></code>: Trapped packets were not forwarded as intended by the
underlying device due to an exception (e.g., TTL error, missing neighbour
entry) and trapped to the control plane for resolution. Packets are
processed by <code class="docutils literal notranslate"><span class="pre">devlink</span></code> and injected to the kernel’s Rx path. Changing the
action of such traps is not allowed, as it can easily break the control
plane.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="trap-actions">
<span id="id2"></span><h2>Trap Actions<a class="headerlink" href="#trap-actions" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism supports the following packet trap actions:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trap</span></code>: The sole copy of the packet is sent to the CPU.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drop</span></code>: The packet is dropped by the underlying device and a copy is not
sent to the CPU.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="generic-packet-traps">
<h2>Generic Packet Traps<a class="headerlink" href="#generic-packet-traps" title="Permalink to this headline">¶</a></h2>
<p>Generic packet traps are used to describe traps that trap well-defined packets
or packets that are trapped due to well-defined conditions (e.g., TTL error).
Such traps can be shared by multiple device drivers and their description must
be added to the following table:</p>
<table class="colwidths-given docutils align-default" id="id4">
<caption><span class="caption-text">List of Generic Packet Traps</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source_mac_is_multicast</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps incoming packets that the device decided to drop because of a
multicast source MAC</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">vlan_tag_mismatch</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps incoming packets that the device decided to drop in case of VLAN
tag mismatch: The ingress bridge port is not configured with a PVID and
the packet is untagged or prio-tagged</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ingress_vlan_filter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps incoming packets that the device decided to drop in case they are
tagged with a VLAN that is not configured on the ingress bridge port</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ingress_spanning_tree_filter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps incoming packets that the device decided to drop in case the STP
state of the ingress bridge port is not “forwarding”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">port_list_is_empty</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop in case they need to be
flooded (e.g., unknown unicast, unregistered multicast) and there are
no ports the packets should be flooded to</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">port_loopback_filter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop in case after layer 2
forwarding the only port from which they should be transmitted through
is the port from which they were received</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">blackhole_route</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop in case they hit a
blackhole route</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ttl_value_is_too_small</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps unicast packets that should be forwarded by the device whose TTL
was decremented to 0 or less</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tail_drop</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they could not be
enqueued to a transmission queue which is full</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">non_ip</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to
undergo a layer 3 lookup, but are not IP or MPLS packets</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">uc_dip_over_mc_dmac</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to be
routed and they have a unicast destination IP and a multicast destination
MAC</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dip_is_loopback_address</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to be
routed and their destination IP is the loopback address (i.e., 127.0.0.0/8
and ::1/128)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sip_is_mc</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to be
routed and their source IP is multicast (i.e., 224.0.0.0/8 and ff::/8)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sip_is_loopback_address</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to be
routed and their source IP is the loopback address (i.e., 127.0.0.0/8 and ::1/128)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ip_header_corrupted</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to be
routed and their IP header is corrupted: wrong checksum, wrong IP version
or too short Internet Header Length (IHL)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ipv4_sip_is_limited_bc</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they need to be
routed and their source IP is limited broadcast (i.e., 255.255.255.255/32)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipv6_mc_dip_reserved_scope</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps IPv6 packets that the device decided to drop because they need to
be routed and their IPv6 multicast destination IP has a reserved scope
(i.e., ffx0::/16)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ipv6_mc_dip_interface_local_scope</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps IPv6 packets that the device decided to drop because they need to
be routed and their IPv6 multicast destination IP has an interface-local scope
(i.e., ffx1::/16)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mtu_value_is_too_small</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps packets that should have been routed by the device, but were bigger
than the MTU of the egress interface</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">unresolved_neigh</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps packets that did not have a matching IP neighbour after routing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mc_reverse_path_forwarding</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps multicast IP packets that failed reverse-path forwarding (RPF)
check during multicast routing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">reject_route</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps packets that hit reject routes (i.e., “unreachable”, “prohibit”)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipv4_lpm_miss</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps unicast IPv4 packets that did not match any route</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ipv6_lpm_miss</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps unicast IPv6 packets that did not match any route</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">non_routable_packet</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets that the device decided to drop because they are not
supposed to be routed. For example, IGMP queries can be flooded by the
device in layer 2 and reach the router. Such packets should not be
routed and instead dropped</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">decap_error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exception</span></code></p></td>
<td><p>Traps NVE and IPinIP packets that the device decided to drop because of
failure during decapsulation (e.g., packet being too short, reserved
bits set in VXLAN header)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">overlay_smac_is_mc</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps NVE packets that the device decided to drop because their overlay
source MAC is multicast</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ingress_flow_action_drop</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets dropped during processing of ingress flow action drop</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">egress_flow_action_drop</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">drop</span></code></p></td>
<td><p>Traps packets dropped during processing of egress flow action drop</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="driver-specific-packet-traps">
<h2>Driver-specific Packet Traps<a class="headerlink" href="#driver-specific-packet-traps" title="Permalink to this headline">¶</a></h2>
<p>Device drivers can register driver-specific packet traps, but these must be
clearly documented. Such traps can correspond to device-specific exceptions and
help debug packet drops caused by these exceptions. The following list includes
links to the description of driver-specific traps registered by various device
drivers:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="netdevsim.html"><span class="doc">netdevsim devlink support</span></a></p></li>
<li><p><a class="reference internal" href="mlxsw.html"><span class="doc">mlxsw devlink support</span></a></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="generic-packet-trap-groups">
<span id="id3"></span><h2>Generic Packet Trap Groups<a class="headerlink" href="#generic-packet-trap-groups" title="Permalink to this headline">¶</a></h2>
<p>Generic packet trap groups are used to aggregate logically related packet
traps. These groups allow the user to batch operations such as setting the trap
action of all member traps. In addition, <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> can report aggregated
per-group packets and bytes statistics, in case per-trap statistics are too
narrow. The description of these groups must be added to the following table:</p>
<table class="colwidths-given docutils align-default" id="id5">
<caption><span class="caption-text">List of Generic Packet Trap Groups</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">l2_drops</span></code></p></td>
<td><p>Contains packet traps for packets that were dropped by the device during
layer 2 forwarding (i.e., bridge)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">l3_drops</span></code></p></td>
<td><p>Contains packet traps for packets that were dropped by the device or hit
an exception (e.g., TTL error) during layer 3 forwarding</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">buffer_drops</span></code></p></td>
<td><p>Contains packet traps for packets that were dropped by the device due to
an enqueue decision</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tunnel_drops</span></code></p></td>
<td><p>Contains packet traps for packets that were dropped by the device during
tunnel encapsulation / decapsulation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">acl_drops</span></code></p></td>
<td><p>Contains packet traps for packets that were dropped by the device during
ACL processing</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="packet-trap-policers">
<h2>Packet Trap Policers<a class="headerlink" href="#packet-trap-policers" title="Permalink to this headline">¶</a></h2>
<p>As previously explained, the underlying device can trap certain packets to the
CPU for processing. In most cases, the underlying device is capable of handling
packet rates that are several orders of magnitude higher compared to those that
can be handled by the CPU.</p>
<p>Therefore, in order to prevent the underlying device from overwhelming the CPU,
devices usually include packet trap policers that are able to police the
trapped packets to rates that can be handled by the CPU.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism allows capable device drivers to register their
supported packet trap policers with <code class="docutils literal notranslate"><span class="pre">devlink</span></code>. The device driver can choose
to associate these policers with supported packet trap groups (see
<a class="reference internal" href="#generic-packet-trap-groups"><span class="std std-ref">Generic Packet Trap Groups</span></a>) during its initialization, thereby exposing
its default control plane policy to user space.</p>
<p>Device drivers should allow user space to change the parameters of the policers
(e.g., rate, burst size) as well as the association between the policers and
trap groups by implementing the relevant callbacks.</p>
<p>If possible, device drivers should implement a callback that allows user space
to retrieve the number of packets that were dropped by the policer because its
configured policy was violated.</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>See <code class="docutils literal notranslate"><span class="pre">tools/testing/selftests/drivers/net/netdevsim/devlink_trap.sh</span></code> for a
test covering the core infrastructure. Test cases should be added for any new
functionality.</p>
<p>Device drivers should focus their tests on device-specific functionality, such
as the triggering of supported packet traps.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bnxt.html" class="btn btn-neutral float-right" title="bnxt devlink support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="devlink-resource.html" class="btn btn-neutral float-left" title="Devlink Resource" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>