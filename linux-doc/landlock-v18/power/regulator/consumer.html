

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Regulator Consumer Driver Interface &mdash; The Linux Kernel 5.7.0-rc7+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Regulator API design notes" href="design.html" />
    <link rel="prev" title="Power Capping Framework" href="../powercap/powercap.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Power Management</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../apm-acpi.html">APM or ACPI?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic-pm-debugging.html">Debugging hibernation and suspend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../charger-manager.html">Charger Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../drivers-testing.html">Testing suspend and resume support in device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../energy-model.html">Energy Model of CPUs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../freezing-of-tasks.html">Freezing of tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opp.html">Operating Performance Points (OPP) Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pci.html">PCI Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm_qos_interface.html">PM Quality Of Service Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../power_supply_class.html">Linux power supply class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime_pm.html">Runtime Power Management Framework for I/O Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s2ram.html">How to get s2ram working</a></li>
<li class="toctree-l2"><a class="reference internal" href="../suspend-and-cpuhotplug.html">Interaction of Suspend code (S3) with the CPU hotplug infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../suspend-and-interrupts.html">System Suspend and Device Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swsusp-and-swap-files.html">Using swap files with software suspend (swsusp)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swsusp-dmcrypt.html">How to use dm-crypt and swsusp together</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swsusp.html">Swap suspend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video.html">Video issues with S3 resume</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tricks.html">swsusp/S3 tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userland-swsusp.html">Documentation for userland software suspend interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../powercap/powercap.html">Power Capping Framework</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Regulator Consumer Driver Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#consumer-regulator-access-static-dynamic-drivers">1. Consumer Regulator Access (static &amp; dynamic drivers)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regulator-output-enable-disable-static-dynamic-drivers">2. Regulator Output Enable &amp; Disable (static &amp; dynamic drivers)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regulator-voltage-control-status-dynamic-drivers">3. Regulator Voltage Control &amp; Status (dynamic drivers)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regulator-current-limit-control-status-dynamic-drivers">4. Regulator Current Limit Control &amp; Status (dynamic drivers)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regulator-operating-mode-control-status-dynamic-drivers">5. Regulator Operating Mode Control &amp; Status (dynamic drivers)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#indirect-operating-mode-control">Indirect operating mode control.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#direct-operating-mode-control">Direct operating mode control.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#regulator-events">6. Regulator Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regulator-direct-register-access">7. Regulator Direct Register Access</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="design.html">Regulator API design notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="machine.html">Regulator Machine Driver Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">Linux voltage and current regulator framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="regulator.html">Regulator Driver Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Power Management</a> &raquo;</li>
        
      <li>Regulator Consumer Driver Interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/power/regulator/consumer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="regulator-consumer-driver-interface">
<h1>Regulator Consumer Driver Interface<a class="headerlink" href="#regulator-consumer-driver-interface" title="Permalink to this headline">¶</a></h1>
<p>This text describes the regulator interface for consumer device drivers.
Please see overview.txt for a description of the terms used in this text.</p>
<div class="section" id="consumer-regulator-access-static-dynamic-drivers">
<h2>1. Consumer Regulator Access (static &amp; dynamic drivers)<a class="headerlink" href="#consumer-regulator-access-static-dynamic-drivers" title="Permalink to this headline">¶</a></h2>
<p>A consumer driver can get access to its supply regulator by calling</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>regulator = regulator_get(dev, &quot;Vcc&quot;);
</pre></div>
</div>
<p>The consumer passes in its struct device pointer and power supply ID. The core
then finds the correct regulator by consulting a machine specific lookup table.
If the lookup is successful then this call will return a pointer to the struct
regulator that supplies this consumer.</p>
<p>To release the regulator the consumer driver should call</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>regulator_put(regulator);
</pre></div>
</div>
<p>Consumers can be supplied by more than one regulator e.g. codec consumer with
analog and digital supplies</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>digital = regulator_get(dev, &quot;Vcc&quot;);  /* digital core */
analog = regulator_get(dev, &quot;Avdd&quot;);  /* analog */
</pre></div>
</div>
<p>The regulator access functions <a class="reference internal" href="../../driver-api/regulator.html#c.regulator_get" title="regulator_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">regulator_get()</span></code></a> and <a class="reference internal" href="../../driver-api/regulator.html#c.regulator_put" title="regulator_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">regulator_put()</span></code></a> will
usually be called in your device drivers probe() and remove() respectively.</p>
</div>
<div class="section" id="regulator-output-enable-disable-static-dynamic-drivers">
<h2>2. Regulator Output Enable &amp; Disable (static &amp; dynamic drivers)<a class="headerlink" href="#regulator-output-enable-disable-static-dynamic-drivers" title="Permalink to this headline">¶</a></h2>
<p>A consumer can enable its power supply by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_enable(regulator);
</pre></div>
</div>
<dl class="simple">
<dt>NOTE:</dt><dd><p>The supply may already be enabled before regulator_enabled() is called.
This may happen if the consumer shares the regulator or the regulator has been
previously enabled by bootloader or kernel board initialization code.</p>
</dd>
</dl>
<p>A consumer can determine if a regulator is enabled by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_is_enabled(regulator);
</pre></div>
</div>
<p>This will return &gt; zero when the regulator is enabled.</p>
<p>A consumer can disable its supply when no longer needed by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_disable(regulator);
</pre></div>
</div>
<dl class="simple">
<dt>NOTE:</dt><dd><p>This may not disable the supply if it’s shared with other consumers. The
regulator will only be disabled when the enabled reference count is zero.</p>
</dd>
</dl>
<p>Finally, a regulator can be forcefully disabled in the case of an emergency:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_force_disable(regulator);
</pre></div>
</div>
<dl class="simple">
<dt>NOTE:</dt><dd><p>this will immediately and forcefully shutdown the regulator output. All
consumers will be powered off.</p>
</dd>
</dl>
</div>
<div class="section" id="regulator-voltage-control-status-dynamic-drivers">
<h2>3. Regulator Voltage Control &amp; Status (dynamic drivers)<a class="headerlink" href="#regulator-voltage-control-status-dynamic-drivers" title="Permalink to this headline">¶</a></h2>
<p>Some consumer drivers need to be able to dynamically change their supply
voltage to match system operating points. e.g. CPUfreq drivers can scale
voltage along with frequency to save power, SD drivers may need to select the
correct card voltage, etc.</p>
<p>Consumers can control their supply voltage by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_set_voltage(regulator, min_uV, max_uV);
</pre></div>
</div>
<p>Where min_uV and max_uV are the minimum and maximum acceptable voltages in
microvolts.</p>
<p>NOTE: this can be called when the regulator is enabled or disabled. If called
when enabled, then the voltage changes instantly, otherwise the voltage
configuration changes and the voltage is physically set when the regulator is
next enabled.</p>
<p>The regulators configured voltage output can be found by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_get_voltage(regulator);
</pre></div>
</div>
<dl class="simple">
<dt>NOTE:</dt><dd><p>get_voltage() will return the configured output voltage whether the
regulator is enabled or disabled and should NOT be used to determine regulator
output state. However this can be used in conjunction with is_enabled() to
determine the regulator physical output voltage.</p>
</dd>
</dl>
</div>
<div class="section" id="regulator-current-limit-control-status-dynamic-drivers">
<h2>4. Regulator Current Limit Control &amp; Status (dynamic drivers)<a class="headerlink" href="#regulator-current-limit-control-status-dynamic-drivers" title="Permalink to this headline">¶</a></h2>
<p>Some consumer drivers need to be able to dynamically change their supply
current limit to match system operating points. e.g. LCD backlight driver can
change the current limit to vary the backlight brightness, USB drivers may want
to set the limit to 500mA when supplying power.</p>
<p>Consumers can control their supply current limit by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_set_current_limit(regulator, min_uA, max_uA);
</pre></div>
</div>
<p>Where min_uA and max_uA are the minimum and maximum acceptable current limit in
microamps.</p>
<dl class="simple">
<dt>NOTE:</dt><dd><p>this can be called when the regulator is enabled or disabled. If called
when enabled, then the current limit changes instantly, otherwise the current
limit configuration changes and the current limit is physically set when the
regulator is next enabled.</p>
</dd>
</dl>
<p>A regulators current limit can be found by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_get_current_limit(regulator);
</pre></div>
</div>
<dl class="simple">
<dt>NOTE:</dt><dd><p>get_current_limit() will return the current limit whether the regulator
is enabled or disabled and should not be used to determine regulator current
load.</p>
</dd>
</dl>
</div>
<div class="section" id="regulator-operating-mode-control-status-dynamic-drivers">
<h2>5. Regulator Operating Mode Control &amp; Status (dynamic drivers)<a class="headerlink" href="#regulator-operating-mode-control-status-dynamic-drivers" title="Permalink to this headline">¶</a></h2>
<p>Some consumers can further save system power by changing the operating mode of
their supply regulator to be more efficient when the consumers operating state
changes. e.g. consumer driver is idle and subsequently draws less current</p>
<p>Regulator operating mode can be changed indirectly or directly.</p>
<div class="section" id="indirect-operating-mode-control">
<h3>Indirect operating mode control.<a class="headerlink" href="#indirect-operating-mode-control" title="Permalink to this headline">¶</a></h3>
<p>Consumer drivers can request a change in their supply regulator operating mode
by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_set_load(struct regulator *regulator, int load_uA);
</pre></div>
</div>
<p>This will cause the core to recalculate the total load on the regulator (based
on all its consumers) and change operating mode (if necessary and permitted)
to best match the current operating load.</p>
<p>The load_uA value can be determined from the consumer’s datasheet. e.g. most
datasheets have tables showing the maximum current consumed in certain
situations.</p>
<p>Most consumers will use indirect operating mode control since they have no
knowledge of the regulator or whether the regulator is shared with other
consumers.</p>
</div>
<div class="section" id="direct-operating-mode-control">
<h3>Direct operating mode control.<a class="headerlink" href="#direct-operating-mode-control" title="Permalink to this headline">¶</a></h3>
<p>Bespoke or tightly coupled drivers may want to directly control regulator
operating mode depending on their operating point. This can be achieved by
calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_set_mode(struct regulator *regulator, unsigned int mode);
unsigned int regulator_get_mode(struct regulator *regulator);
</pre></div>
</div>
<p>Direct mode will only be used by consumers that <em>know</em> about the regulator and
are not sharing the regulator with other consumers.</p>
</div>
</div>
<div class="section" id="regulator-events">
<h2>6. Regulator Events<a class="headerlink" href="#regulator-events" title="Permalink to this headline">¶</a></h2>
<p>Regulators can notify consumers of external events. Events could be received by
consumers under regulator stress or failure conditions.</p>
<p>Consumers can register interest in regulator events by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_register_notifier(struct regulator *regulator,
                                struct notifier_block *nb);
</pre></div>
</div>
<p>Consumers can unregister interest by calling:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_unregister_notifier(struct regulator *regulator,
                                  struct notifier_block *nb);
</pre></div>
</div>
<p>Regulators use the kernel notifier framework to send event to their interested
consumers.</p>
</div>
<div class="section" id="regulator-direct-register-access">
<h2>7. Regulator Direct Register Access<a class="headerlink" href="#regulator-direct-register-access" title="Permalink to this headline">¶</a></h2>
<p>Some kinds of power management hardware or firmware are designed such that
they need to do low-level hardware access to regulators, with no involvement
from the kernel. Examples of such devices are:</p>
<ul class="simple">
<li><p>clocksource with a voltage-controlled oscillator and control logic to change
the supply voltage over I2C to achieve a desired output clock rate</p></li>
<li><p>thermal management firmware that can issue an arbitrary I2C transaction to
perform system poweroff during overtemperature conditions</p></li>
</ul>
<p>To set up such a device/firmware, various parameters like I2C address of the
regulator, addresses of various regulator registers etc. need to be configured
to it. The regulator framework provides the following helpers for querying
these details.</p>
<p>Bus-specific details, like I2C addresses or transfer rates are handled by the
regmap framework. To get the regulator’s regmap (if supported), use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct regmap *regulator_get_regmap(struct regulator *regulator);
</pre></div>
</div>
<p>To obtain the hardware register offset and bitmask for the regulator’s voltage
selector register, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_get_hardware_vsel_register(struct regulator *regulator,
                                         unsigned *vsel_reg,
                                         unsigned *vsel_mask);
</pre></div>
</div>
<p>To convert a regulator framework voltage selector code (used by
regulator_list_voltage) to a hardware-specific voltage selector that can be
directly written to the voltage selector register, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int regulator_list_hardware_vsel(struct regulator *regulator,
                                 unsigned selector);
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="design.html" class="btn btn-neutral float-right" title="Regulator API design notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../powercap/powercap.html" class="btn btn-neutral float-left" title="Power Capping Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>