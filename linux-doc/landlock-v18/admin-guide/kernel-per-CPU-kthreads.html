

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reducing OS jitter due to per-cpu kthreads &mdash; The Linux Kernel 5.7.0-rc7+ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Laptop Drivers" href="laptops/index.html" />
    <link rel="prev" title="IBM’s Journaled File System (JFS) for Linux" href="jfs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0-rc7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Explaining the dreaded “No init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockdev/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Reducing OS jitter due to per-cpu kthreads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kthreads">kthreads</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#timer-softirq">TIMER_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#net-tx-softirq-and-net-rx-softirq">NET_TX_SOFTIRQ and NET_RX_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#block-softirq">BLOCK_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#irq-poll-softirq">IRQ_POLL_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tasklet-softirq">TASKLET_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sched-softirq">SCHED_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hrtimer-softirq">HRTIMER_SOFTIRQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rcu-softirq">RCU_SOFTIRQ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf-security.html">Perf Events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
      <li>Reducing OS jitter due to per-cpu kthreads</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin-guide/kernel-per-CPU-kthreads.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reducing-os-jitter-due-to-per-cpu-kthreads">
<h1>Reducing OS jitter due to per-cpu kthreads<a class="headerlink" href="#reducing-os-jitter-due-to-per-cpu-kthreads" title="Permalink to this headline">¶</a></h1>
<p>This document lists per-CPU kthreads in the Linux kernel and presents
options to control their OS jitter.  Note that non-per-CPU kthreads are
not listed here.  To reduce OS jitter from non-per-CPU kthreads, bind
them to a “housekeeping” CPU dedicated to such work.</p>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Documentation/IRQ-affinity.txt:  Binding interrupts to sets of CPUs.</p></li>
<li><p>Documentation/admin-guide/cgroup-v1:  Using cgroups to bind tasks to sets of CPUs.</p></li>
<li><p>man taskset:  Using the taskset command to bind tasks to sets
of CPUs.</p></li>
<li><p>man sched_setaffinity:  Using the sched_setaffinity() system
call to bind tasks to sets of CPUs.</p></li>
<li><p>/sys/devices/system/cpu/cpuN/online:  Control CPU N’s hotplug state,
writing “0” to offline and “1” to online.</p></li>
<li><p>In order to locate kernel-generated OS jitter on CPU N:</p>
<blockquote>
<div><p>cd /sys/kernel/debug/tracing
echo 1 &gt; max_graph_depth # Increase the “1” for more detail
echo function_graph &gt; current_tracer
# run workload
cat per_cpu/cpuN/trace</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="kthreads">
<h2>kthreads<a class="headerlink" href="#kthreads" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Name:</dt><dd><p>ehca_comp/%u</p>
</dd>
<dt>Purpose:</dt><dd><p>Periodically process Infiniband-related work.</p>
</dd>
</dl>
<p>To reduce its OS jitter, do any of the following:</p>
<ol class="arabic simple">
<li><p>Don’t use eHCA Infiniband hardware, instead choosing hardware
that does not require per-CPU kthreads.  This will prevent these
kthreads from being created in the first place.  (This will
work for most people, as this hardware, though important, is
relatively old and is produced in relatively low unit volumes.)</p></li>
<li><p>Do all eHCA-Infiniband-related work on other CPUs, including
interrupts.</p></li>
<li><p>Rework the eHCA driver so that its per-CPU kthreads are
provisioned only on selected CPUs.</p></li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>irq/%d-%s</p>
</dd>
<dt>Purpose:</dt><dd><p>Handle threaded interrupts.</p>
</dd>
</dl>
<p>To reduce its OS jitter, do the following:</p>
<ol class="arabic simple">
<li><p>Use irq affinity to force the irq threads to execute on
some other CPU.</p></li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>kcmtpd_ctr_%d</p>
</dd>
<dt>Purpose:</dt><dd><p>Handle Bluetooth work.</p>
</dd>
</dl>
<p>To reduce its OS jitter, do one of the following:</p>
<ol class="arabic simple">
<li><p>Don’t use Bluetooth, in which case these kthreads won’t be
created in the first place.</p></li>
<li><p>Use irq affinity to force Bluetooth-related interrupts to
occur on some other CPU and furthermore initiate all
Bluetooth activity on some other CPU.</p></li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>ksoftirqd/%u</p>
</dd>
<dt>Purpose:</dt><dd><p>Execute softirq handlers when threaded or when under heavy load.</p>
</dd>
</dl>
<p>To reduce its OS jitter, each softirq vector must be handled
separately as follows:</p>
<div class="section" id="timer-softirq">
<h3>TIMER_SOFTIRQ<a class="headerlink" href="#timer-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do all of the following:</p>
<ol class="arabic simple">
<li><p>To the extent possible, keep the CPU out of the kernel when it
is non-idle, for example, by avoiding system calls and by forcing
both kernel threads and interrupts to execute elsewhere.</p></li>
<li><p>Build with CONFIG_HOTPLUG_CPU=y.  After boot completes, force
the CPU offline, then bring it back online.  This forces
recurring timers to migrate elsewhere.  If you are concerned
with multiple CPUs, force them all offline before bringing the
first one back online.  Once you have onlined the CPUs in question,
do not offline any other CPUs, because doing so could force the
timer back onto one of the CPUs in question.</p></li>
</ol>
</div>
<div class="section" id="net-tx-softirq-and-net-rx-softirq">
<h3>NET_TX_SOFTIRQ and NET_RX_SOFTIRQ<a class="headerlink" href="#net-tx-softirq-and-net-rx-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do all of the following:</p>
<ol class="arabic simple">
<li><p>Force networking interrupts onto other CPUs.</p></li>
<li><p>Initiate any network I/O on other CPUs.</p></li>
<li><p>Once your application has started, prevent CPU-hotplug operations
from being initiated from tasks that might run on the CPU to
be de-jittered.  (It is OK to force this CPU offline and then
bring it back online before you start your application.)</p></li>
</ol>
</div>
<div class="section" id="block-softirq">
<h3>BLOCK_SOFTIRQ<a class="headerlink" href="#block-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do all of the following:</p>
<ol class="arabic simple">
<li><p>Force block-device interrupts onto some other CPU.</p></li>
<li><p>Initiate any block I/O on other CPUs.</p></li>
<li><p>Once your application has started, prevent CPU-hotplug operations
from being initiated from tasks that might run on the CPU to
be de-jittered.  (It is OK to force this CPU offline and then
bring it back online before you start your application.)</p></li>
</ol>
</div>
<div class="section" id="irq-poll-softirq">
<h3>IRQ_POLL_SOFTIRQ<a class="headerlink" href="#irq-poll-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do all of the following:</p>
<ol class="arabic simple">
<li><p>Force block-device interrupts onto some other CPU.</p></li>
<li><p>Initiate any block I/O and block-I/O polling on other CPUs.</p></li>
<li><p>Once your application has started, prevent CPU-hotplug operations
from being initiated from tasks that might run on the CPU to
be de-jittered.  (It is OK to force this CPU offline and then
bring it back online before you start your application.)</p></li>
</ol>
</div>
<div class="section" id="tasklet-softirq">
<h3>TASKLET_SOFTIRQ<a class="headerlink" href="#tasklet-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do one or more of the following:</p>
<ol class="arabic simple">
<li><p>Avoid use of drivers that use tasklets.  (Such drivers will contain
calls to things like tasklet_schedule().)</p></li>
<li><p>Convert all drivers that you must use from tasklets to workqueues.</p></li>
<li><p>Force interrupts for drivers using tasklets onto other CPUs,
and also do I/O involving these drivers on other CPUs.</p></li>
</ol>
</div>
<div class="section" id="sched-softirq">
<h3>SCHED_SOFTIRQ<a class="headerlink" href="#sched-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do all of the following:</p>
<ol class="arabic simple">
<li><p>Avoid sending scheduler IPIs to the CPU to be de-jittered,
for example, ensure that at most one runnable kthread is present
on that CPU.  If a thread that expects to run on the de-jittered
CPU awakens, the scheduler will send an IPI that can result in
a subsequent SCHED_SOFTIRQ.</p></li>
<li><p>CONFIG_NO_HZ_FULL=y and ensure that the CPU to be de-jittered
is marked as an adaptive-ticks CPU using the “nohz_full=”
boot parameter.  This reduces the number of scheduler-clock
interrupts that the de-jittered CPU receives, minimizing its
chances of being selected to do the load balancing work that
runs in SCHED_SOFTIRQ context.</p></li>
<li><p>To the extent possible, keep the CPU out of the kernel when it
is non-idle, for example, by avoiding system calls and by
forcing both kernel threads and interrupts to execute elsewhere.
This further reduces the number of scheduler-clock interrupts
received by the de-jittered CPU.</p></li>
</ol>
</div>
<div class="section" id="hrtimer-softirq">
<h3>HRTIMER_SOFTIRQ<a class="headerlink" href="#hrtimer-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do all of the following:</p>
<ol class="arabic simple">
<li><p>To the extent possible, keep the CPU out of the kernel when it
is non-idle.  For example, avoid system calls and force both
kernel threads and interrupts to execute elsewhere.</p></li>
<li><p>Build with CONFIG_HOTPLUG_CPU=y.  Once boot completes, force the
CPU offline, then bring it back online.  This forces recurring
timers to migrate elsewhere.  If you are concerned with multiple
CPUs, force them all offline before bringing the first one
back online.  Once you have onlined the CPUs in question, do not
offline any other CPUs, because doing so could force the timer
back onto one of the CPUs in question.</p></li>
</ol>
</div>
<div class="section" id="rcu-softirq">
<h3>RCU_SOFTIRQ<a class="headerlink" href="#rcu-softirq" title="Permalink to this headline">¶</a></h3>
<p>Do at least one of the following:</p>
<ol class="arabic simple">
<li><p>Offload callbacks and keep the CPU in either dyntick-idle or
adaptive-ticks state by doing all of the following:</p>
<ol class="loweralpha simple">
<li><p>CONFIG_NO_HZ_FULL=y and ensure that the CPU to be
de-jittered is marked as an adaptive-ticks CPU using the
“nohz_full=” boot parameter.  Bind the rcuo kthreads to
housekeeping CPUs, which can tolerate OS jitter.</p></li>
<li><p>To the extent possible, keep the CPU out of the kernel
when it is non-idle, for example, by avoiding system
calls and by forcing both kernel threads and interrupts
to execute elsewhere.</p></li>
</ol>
</li>
<li><p>Enable RCU to do its processing remotely via dyntick-idle by
doing all of the following:</p>
<ol class="loweralpha simple">
<li><p>Build with CONFIG_NO_HZ=y and CONFIG_RCU_FAST_NO_HZ=y.</p></li>
<li><p>Ensure that the CPU goes idle frequently, allowing other
CPUs to detect that it has passed through an RCU quiescent
state.  If the kernel is built with CONFIG_NO_HZ_FULL=y,
userspace execution also allows other CPUs to detect that
the CPU in question has passed through a quiescent state.</p></li>
<li><p>To the extent possible, keep the CPU out of the kernel
when it is non-idle, for example, by avoiding system
calls and by forcing both kernel threads and interrupts
to execute elsewhere.</p></li>
</ol>
</li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>kworker/%u:%d%s (cpu, id, priority)</p>
</dd>
<dt>Purpose:</dt><dd><p>Execute workqueue requests</p>
</dd>
</dl>
<p>To reduce its OS jitter, do any of the following:</p>
<ol class="arabic">
<li><p>Run your workload at a real-time priority, which will allow
preempting the kworker daemons.</p></li>
<li><p>A given workqueue can be made visible in the sysfs filesystem
by passing the WQ_SYSFS to that workqueue’s <a class="reference internal" href="../driver-api/basics.html#c.alloc_workqueue" title="alloc_workqueue"><code class="xref c c-func docutils literal notranslate"><span class="pre">alloc_workqueue()</span></code></a>.
Such a workqueue can be confined to a given subset of the
CPUs using the <code class="docutils literal notranslate"><span class="pre">/sys/devices/virtual/workqueue/*/cpumask</span></code> sysfs
files.  The set of WQ_SYSFS workqueues can be displayed using
“ls /sys/devices/virtual/workqueue”.  That said, the workqueues
maintainer would like to caution people against indiscriminately
sprinkling WQ_SYSFS across all the workqueues.  The reason for
caution is that it is easy to add WQ_SYSFS, but because sysfs is
part of the formal user/kernel API, it can be nearly impossible
to remove it, even if its addition was a mistake.</p></li>
<li><p>Do any of the following needed to avoid jitter that your
application cannot tolerate:</p>
<ol class="loweralpha">
<li><p>Build your kernel with CONFIG_SLUB=y rather than
CONFIG_SLAB=y, thus avoiding the slab allocator’s periodic
use of each CPU’s workqueues to run its cache_reap()
function.</p></li>
<li><p>Avoid using oprofile, thus avoiding OS jitter from
wq_sync_buffer().</p></li>
<li><p>Limit your CPU frequency so that a CPU-frequency
governor is not required, possibly enlisting the aid of
special heatsinks or other cooling technologies.  If done
correctly, and if you CPU architecture permits, you should
be able to build your kernel with CONFIG_CPU_FREQ=n to
avoid the CPU-frequency governor periodically running
on each CPU, including cs_dbs_timer() and od_dbs_timer().</p>
<p>WARNING:  Please check your CPU specifications to
make sure that this is safe on your particular system.</p>
</li>
<li><p>As of v3.18, Christoph Lameter’s on-demand vmstat workers
commit prevents OS jitter due to vmstat_update() on
CONFIG_SMP=y systems.  Before v3.18, is not possible
to entirely get rid of the OS jitter, but you can
decrease its frequency by writing a large value to
/proc/sys/vm/stat_interval.  The default value is HZ,
for an interval of one second.  Of course, larger values
will make your virtual-memory statistics update more
slowly.  Of course, you can also run your workload at
a real-time priority, thus preempting vmstat_update(),
but if your workload is CPU-bound, this is a bad idea.
However, there is an RFC patch from Christoph Lameter
(based on an earlier one from Gilad Ben-Yossef) that
reduces or even eliminates vmstat overhead for some
workloads at <a class="reference external" href="https://lkml.org/lkml/2013/9/4/379">https://lkml.org/lkml/2013/9/4/379</a>.</p></li>
<li><p>If running on high-end powerpc servers, build with
CONFIG_PPC_RTAS_DAEMON=n.  This prevents the RTAS
daemon from running on each CPU every second or so.
(This will require editing Kconfig files and will defeat
this platform’s RAS functionality.)  This avoids jitter
due to the rtas_event_scan() function.
WARNING:  Please check your CPU specifications to
make sure that this is safe on your particular system.</p></li>
<li><p>If running on Cell Processor, build your kernel with
CBE_CPUFREQ_SPU_GOVERNOR=n to avoid OS jitter from
spu_gov_work().
WARNING:  Please check your CPU specifications to
make sure that this is safe on your particular system.</p></li>
<li><p>If running on PowerMAC, build your kernel with
CONFIG_PMAC_RACKMETER=n to disable the CPU-meter,
avoiding OS jitter from rackmeter_do_timer().</p></li>
</ol>
</li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>rcuc/%u</p>
</dd>
<dt>Purpose:</dt><dd><p>Execute RCU callbacks in CONFIG_RCU_BOOST=y kernels.</p>
</dd>
</dl>
<p>To reduce its OS jitter, do at least one of the following:</p>
<ol class="arabic simple">
<li><p>Build the kernel with CONFIG_PREEMPT=n.  This prevents these
kthreads from being created in the first place, and also obviates
the need for RCU priority boosting.  This approach is feasible
for workloads that do not require high degrees of responsiveness.</p></li>
<li><p>Build the kernel with CONFIG_RCU_BOOST=n.  This prevents these
kthreads from being created in the first place.  This approach
is feasible only if your workload never requires RCU priority
boosting, for example, if you ensure frequent idle time on all
CPUs that might execute within the kernel.</p></li>
<li><p>Build with CONFIG_RCU_NOCB_CPU=y and boot with the rcu_nocbs=
boot parameter offloading RCU callbacks from all CPUs susceptible
to OS jitter.  This approach prevents the rcuc/%u kthreads from
having any work to do, so that they are never awakened.</p></li>
<li><p>Ensure that the CPU never enters the kernel, and, in particular,
avoid initiating any CPU hotplug operations on this CPU.  This is
another way of preventing any callbacks from being queued on the
CPU, again preventing the rcuc/%u kthreads from having any work
to do.</p></li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>rcuop/%d and rcuos/%d</p>
</dd>
<dt>Purpose:</dt><dd><p>Offload RCU callbacks from the corresponding CPU.</p>
</dd>
</dl>
<p>To reduce its OS jitter, do at least one of the following:</p>
<ol class="arabic simple">
<li><p>Use affinity, cgroups, or other mechanism to force these kthreads
to execute on some other CPU.</p></li>
<li><p>Build with CONFIG_RCU_NOCB_CPU=n, which will prevent these
kthreads from being created in the first place.  However, please
note that this will not eliminate OS jitter, but will instead
shift it to RCU_SOFTIRQ.</p></li>
</ol>
<dl class="simple">
<dt>Name:</dt><dd><p>watchdog/%u</p>
</dd>
<dt>Purpose:</dt><dd><p>Detect software lockups on each CPU.</p>
</dd>
</dl>
<p>To reduce its OS jitter, do at least one of the following:</p>
<ol class="arabic simple">
<li><p>Build with CONFIG_LOCKUP_DETECTOR=n, which will prevent these
kthreads from being created in the first place.</p></li>
<li><p>Boot with “nosoftlockup=0”, which will also prevent these kthreads
from being created.  Other related watchdog and softlockup boot
parameters may be found in Documentation/admin-guide/kernel-parameters.rst
and Documentation/watchdog/watchdog-parameters.rst.</p></li>
<li><p>Echo a zero to /proc/sys/kernel/watchdog to disable the
watchdog timer.</p></li>
<li><p>Echo a large number of /proc/sys/kernel/watchdog_thresh in
order to reduce the frequency of OS jitter due to the watchdog
timer down to a level that is acceptable for your workload.</p></li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="laptops/index.html" class="btn btn-neutral float-right" title="Laptop Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jfs.html" class="btn btn-neutral float-left" title="IBM’s Journaled File System (JFS) for Linux" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>